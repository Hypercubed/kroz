var kt=Object.defineProperty;var vt=(e,t,i)=>t in e?kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Ue=(e,t,i)=>vt(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const X of r.addedNodes)X.tagName==="LINK"&&X.rel==="modulepreload"&&a(X)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const de=23283064365386963e-26;class Ce{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*de,t=t*69069+1>>>0,this._s1=t*de,t=t*69069+1>>>0,this._s2=t*de,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*de;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let a=Math.max(t,i),s=Math.min(t,i);return Math.floor(this.getUniform()*(a-s+1))+s}getNormal(t=0,i=1){let a,s,r;do a=2*this.getUniform()-1,s=2*this.getUniform()-1,r=a*a+s*s;while(r>1||r==0);let X=a*Math.sqrt(-2*Math.log(r)/r);return t+X*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],a=t.slice();for(;a.length;){let s=a.indexOf(this.getItem(a));i.push(a.splice(s,1)[0])}return i}getWeightedValue(t){let i=0;for(let X in t)i+=t[X];let a=this.getUniform()*i,s,r=0;for(s in t)if(r+=t[s],a<r)return s;return s}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new Ce().setState(this.getState())}}const v=new Ce().setSeed(Date.now());class De{getContainer(){return null}setOptions(t){this._options=t}}class Ie extends De{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const a=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=a,this._updateSize(),this._ctx.font=a,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let a=this._ctx.canvas,s=a.getBoundingClientRect();return t-=s.left,i-=s.top,t*=a.width/s.width,i*=a.height/s.height,t<0||i<0||t>=a.width||i>=a.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function Le(e,t){return(e%t+t)%t}class st extends Ie{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[a,s,r,X,M]=t,c=[(a+1)*this._spacingX,s*this._spacingY+this._hexSize];if(this._options.transpose&&c.reverse(),i&&(this._ctx.fillStyle=M,this._fill(c[0],c[1])),!r)return;this._ctx.fillStyle=X;let h=[].concat(r);for(let y=0;y<h.length;y++)this._ctx.fillText(h[y],c[0],Math.ceil(c[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let a=Math.floor(t/this._spacingX)-1,s=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[a,s]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let a=2*t/((this._options.width+1)*Math.sqrt(3))-1,s=i/(2+1.5*(this._options.height-1)),r=Math.min(a,s),X=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let M=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=X;let c=M/100;r=Math.floor(r)+1;let h=2*r/(this._options.spacing*(1+c/Math.sqrt(3)));return Math.ceil(h)-1}_normalizedEventToPosition(t,i){let a;this._options.transpose?(t+=i,i=t-i,t-=i,a=this._ctx.canvas.width):a=this._ctx.canvas.height;let s=a/this._options.height;return i=Math.floor(i/s),Le(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let a=this._hexSize,s=this._options.border;const r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-a+s,i),r.lineTo(t-a/2+s,i+this._spacingX-s),r.lineTo(t+a/2-s,i+this._spacingX-s),r.lineTo(t+a-s,i),r.lineTo(t+a/2-s,i-this._spacingX+s),r.lineTo(t-a/2+s,i-this._spacingX+s),r.lineTo(t-a+s,i)):(r.moveTo(t,i-a+s),r.lineTo(t+this._spacingX-s,i-a/2+s),r.lineTo(t+this._spacingX-s,i+a/2-s),r.lineTo(t,i+a-s),r.lineTo(t-this._spacingX+s,i+a/2-s),r.lineTo(t-this._spacingX+s,i-a/2+s),r.lineTo(t,i-a+s)),r.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let a,s;t.transpose?(a="height",s="width"):(a="width",s="height"),this._ctx.canvas[a]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[s]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class Me extends Ie{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){Me.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,a,s,r,X]=t,M=""+s+r+X,c;if(M in this._canvasCache)c=this._canvasCache[M];else{let h=this._options.border;c=document.createElement("canvas");let y=c.getContext("2d");if(c.width=this._spacingX,c.height=this._spacingY,y.fillStyle=X,y.fillRect(h,h,c.width-h,c.height-h),s){y.fillStyle=r,y.font=this._ctx.font,y.textAlign="center",y.textBaseline="middle";let W=[].concat(s);for(let F=0;F<W.length;F++)y.fillText(W[F],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[M]=c}this._ctx.drawImage(c,i*this._spacingX,a*this._spacingY)}_drawNoCache(t,i){let[a,s,r,X,M]=t;if(i){let h=this._options.border;this._ctx.fillStyle=M,this._ctx.fillRect(a*this._spacingX+h,s*this._spacingY+h,this._spacingX-h,this._spacingY-h)}if(!r)return;this._ctx.fillStyle=X;let c=[].concat(r);for(let h=0;h<c.length;h++)this._ctx.fillText(c[h],(a+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(t,i){let a=Math.floor(t/this._spacingX),s=Math.floor(i/this._spacingY);return[a,s]}computeFontSize(t,i){let a=Math.floor(t/this._options.width),s=Math.floor(i/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let X=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let c=X/100*s/a;return c>1&&(s=Math.floor(s/c)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}Me.cache=!1;let ot=class extends Ie{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[a,s,r,X,M]=t,c=this._options.tileWidth,h=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(a*c,s*h,c,h):(this._ctx.fillStyle=M,this._ctx.fillRect(a*c,s*h,c,h))),!r)return;let y=[].concat(r),W=[].concat(X),F=[].concat(M);for(let S=0;S<y.length;S++){let _=this._options.tileMap[y[S]];if(!_)throw new Error(`Char "${y[S]}" not found in tileMap`);if(this._options.tileColorize){let p=this._colorCanvas,f=p.getContext("2d");f.globalCompositeOperation="source-over",f.clearRect(0,0,c,h);let w=W[S],O=F[S];f.drawImage(this._options.tileSet,_[0],_[1],c,h,0,0,c,h),w!="transparent"&&(f.fillStyle=w,f.globalCompositeOperation="source-atop",f.fillRect(0,0,c,h)),O!="transparent"&&(f.fillStyle=O,f.globalCompositeOperation="destination-over",f.fillRect(0,0,c,h)),this._ctx.drawImage(p,a*c,s*h,c,h)}else this._ctx.drawImage(this._options.tileSet,_[0],_[1],c,h,a*c,s*h,c,h)}}computeSize(t,i){let a=Math.floor(t/this._options.tileWidth),s=Math.floor(i/this._options.tileHeight);return[a,s]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}};function nt(e){let t,i;if(e in Fe)t=Fe[e];else{if(e.charAt(0)=="#"){let s=(e.match(/[0-9a-f]/gi)||[]).map(r=>parseInt(r,16));if(s.length==3)t=s.map(r=>r*17);else{for(let r=0;r<3;r++)s[r+1]+=16*s[r],s.splice(r,1);t=s}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(a=>parseInt(a)):t=[0,0,0];Fe[e]=t}return t.slice()}const Fe={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class rt extends De{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const a=this._gl,s=this._options;let[r,X,M,c,h]=t,y=a.canvas.height-(X+1)*s.tileHeight;if(a.scissor(r*s.tileWidth,y,s.tileWidth,s.tileHeight),i&&(s.tileColorize?a.clearColor(0,0,0,0):a.clearColor(...ge(h)),a.clear(a.COLOR_BUFFER_BIT)),!M)return;let W=[].concat(M),F=[].concat(h),S=[].concat(c);a.uniform2fv(this._uniforms.targetPosRel,[r,X]);for(let _=0;_<W.length;_++){let p=this._options.tileMap[W[_]];if(!p)throw new Error(`Char "${W[_]}" not found in tileMap`);a.uniform1f(this._uniforms.colorize,s.tileColorize?1:0),a.uniform2fv(this._uniforms.tilesetPosAbs,p),s.tileColorize&&(a.uniform4fv(this._uniforms.tint,ge(S[_])),a.uniform4fv(this._uniforms.bg,ge(F[_]))),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...ge(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let a=Math.floor(t/this._options.tileWidth),s=Math.floor(i/this._options.tileHeight);return[a,s]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let a=this._gl.canvas,s=a.getBoundingClientRect();return t-=s.left,i-=s.top,t*=a.width/s.width,i*=a.height/s.height,t<0||i<0||t>=a.width||i>=a.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=Ft(t,Ot,xt);return t.useProgram(i),Yt(t),Wt.forEach(a=>this._uniforms[a]=t.getUniformLocation(i,a)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,a=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=a[0],t.canvas.height=a[1],t.viewport(0,0,a[0],a[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,a)}_updateTexture(t){Pt(this._gl,t)}}const Wt=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],Ot=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),xt=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function Ft(e,t,i){const a=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(a)||"");const s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(s)||"");const r=e.createProgram();if(e.attachShader(r,a),e.attachShader(r,s),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(r)||"");return r}function Yt(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function Pt(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let Ye={};function ge(e){if(!(e in Ye)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=nt(e).map(i=>i/255),t.push(1);Ye[e]=t}return Ye[e]}function Tt(e){return`\x1B[0;48;5;${Pe(e)}m\x1B[2J`}function At(e,t){return`\x1B[0;38;5;${Pe(e)};48;5;${Pe(t)}m`}function Ct(e,t){return`\x1B[${t+1};${e+1}H`}function Pe(e){const a=.0234375;let s=nt(e),r=Math.floor(s[0]*a),X=Math.floor(s[1]*a),M=Math.floor(s[2]*a);return r*36+X*6+M*1+16}class Xt extends De{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],a=this.computeSize();this._offset=a.map((s,r)=>Math.floor((s-i[r])/2))}clear(){process.stdout.write(Tt(this._options.bg))}draw(t,i){let[a,s,r,X,M]=t,c=this._offset[0]+a,h=this._offset[1]+s,y=this.computeSize();if(c<0||c>=y[0]||h<0||h>=y[1]||((c!==this._cursor[0]||h!==this._cursor[1])&&(process.stdout.write(Ct(c,h)),this._cursor[0]=c,this._cursor[1]=h),i&&(r||(r=" ")),!r))return;let W=At(X,M);if(W!==this._lastColor&&(process.stdout.write(W),this._lastColor=W),r!="	"){let F=[].concat(r);process.stdout.write(F[0])}this._cursor[0]++,this._cursor[0]>=y[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const Dt=/%([bc]){([^}]*)}/g,ae=0,le=1,lt=2,ct=3;function It(e,t){let i=[],a=0;e.replace(Dt,function(r,X,M,c){let h=e.substring(a,c);return h.length&&i.push({type:ae,value:h}),i.push({type:X=="c"?lt:ct,value:M.trim()}),a=c+r.length,""});let s=e.substring(a);return s.length&&i.push({type:ae,value:s}),Lt(i,t)}function Lt(e,t){t||(t=1/0);let i=0,a=0,s=-1;for(;i<e.length;){let X=e[i];if(X.type==le&&(a=0,s=-1),X.type!=ae){i++;continue}for(;a==0&&X.value.charAt(0)==" ";)X.value=X.value.substring(1);let M=X.value.indexOf(`
`);if(M!=-1){X.value=we(e,i,M,!0);let c=X.value.split("");for(;c.length&&c[c.length-1]==" ";)c.pop();X.value=c.join("")}if(!X.value.length){e.splice(i,1);continue}if(a+X.value.length>t){let c=-1;for(;;){let h=X.value.indexOf(" ",c+1);if(h==-1||a+h>t)break;c=h}if(c!=-1)X.value=we(e,i,c,!0);else if(s!=-1){let h=e[s],y=h.value.lastIndexOf(" ");h.value=we(e,s,y,!0),i=s}else X.value=we(e,i,t-a,!1)}else a+=X.value.length,X.value.indexOf(" ")!=-1&&(s=i);i++}e.push({type:le});let r=null;for(let X=0;X<e.length;X++){let M=e[X];switch(M.type){case ae:r=M;break;case le:if(r){let c=r.value.split("");for(;c.length&&c[c.length-1]==" ";)c.pop();r.value=c.join("")}r=null;break}}return e.pop(),e}function we(e,t,i,a){let s={type:le},r={type:ae,value:e[t].value.substring(i+(a?1:0))};return e.splice(t+1,0,s,r),e[t].value.substring(0,i)}let Et=80,$t=25;const Bt={hex:st,rect:Me,tile:ot,"tile-gl":rt,term:Xt},zt={width:Et,height:$t,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class j{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},zt,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,a){let s=[this._options.bg,this._options.fg];this.draw(t,i,null,null,s[a%s.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=Bt[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let a=Math.floor(t/this._options.width),s=Math.floor(i/this._options.height);return[a,s]}eventToPosition(t){let i,a;return"touches"in t?(i=t.touches[0].clientX,a=t.touches[0].clientY):(i=t.clientX,a=t.clientY),this._backend.eventToPosition(i,a)}draw(t,i,a,s,r){s||(s=this._options.fg),r||(r=this._options.bg);let X=`${t},${i}`;this._data[X]=[t,i,a,s,r],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[X]=!0)}drawOver(t,i,a,s,r){const X=`${t},${i}`,M=this._data[X];M?(M[2]=a||M[2],M[3]=s||M[3],M[4]=r||M[4]):this.draw(t,i,a,s,r)}drawText(t,i,a,s){let r=null,X=null,M=t,c=i,h=1;s||(s=this._options.width-t);let y=It(a,s);for(;y.length;){let W=y.shift();switch(W.type){case ae:let F=!1,S=!1,_=!1,p=!1;for(let f=0;f<W.value.length;f++){let w=W.value.charCodeAt(f),O=W.value.charAt(f);if(this._options.layout==="term"){let b=w>>8;if(b===17||b>=46&&b<=159||b>=172&&b<=215||w>=43360&&w<=43391){this.draw(M+0,c,O,r,X),this.draw(M+1,c,"	",r,X),M+=2;continue}}_=w>65280&&w<65377||w>65500&&w<65512||w>65518,F=O.charCodeAt(0)==32||O.charCodeAt(0)==12288,p&&!_&&!F&&M++,_&&!S&&M++,this.draw(M++,c,O,r,X),S=F,p=_}break;case lt:r=W.value||null;break;case ct:X=W.value||null;break;case le:M=t,c++,h++;break}}return h}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let a=this._data[t];a[4]!=this._options.bg&&(i=!0),this._backend.draw(a,i)}}j.Rect=Me;j.Hex=st;j.Tile=ot;j.TileGL=rt;j.Term=Xt;class Ve{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:a,timestamp:s})=>({key:i+t,value:a,timestamp:s}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const a=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(a)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let a=0;a<this.len();a++)t==this.heap[a].value&&(i=a);if(i===null)return!1;if(this.len()>1){let a=this.heap.pop();return a.value!=t&&(this.heap[i]=a,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a}minNode(t){const i=t.filter(this.existNode.bind(this));let a=i[0];for(const s of i)this.lessThan(this.heap[s],this.heap[a])&&(a=s);return a}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),a=this.rightChildNode(t);if(!this.existNode(i))return;const s=this.minNode([t,i,a]);s!=t&&(this.swap(t,s),this.updateDown(s))}debugPrint(){console.log(this.heap)}}class Gt{constructor(){this._time=0,this._events=new Ve}getTime(){return this._time}clear(){return this._events=new Ve,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:a}=i;return a}}remove(t){return this._events.remove(t)}}let Ee=class{constructor(){this._queue=new Gt,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),a=this._repeat.indexOf(t);return a!=-1&&this._repeat.splice(a,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class Nt extends Ee{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class Ut extends Ee{add(t,i,a){return this._queue.add(t,a!==void 0?a:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}let Vt=class extends Ee{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,a){return this._queue.add(t,a||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}};const Kt={Simple:Nt,Speed:Ut,Action:Vt},Ke="The Underground Empire of Kroz",$e=80,ht=25,ue=1,se=$e-16,pe=1,ce=ht-2,C=se-ue,D=ce-pe,m=" ",E=1;var l=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(l||{});const U={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};var o=(e=>(e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(o||{});const be={0:m,1:"Ä",2:"Ö",3:"Ω",4:"▓",5:"⌠",6:"≡",7:"C",8:"Φ",9:"♦",10:"¡",11:"↑",12:"î",13:"ì",14:"█",15:"Θ",16:"∙",17:"≈",18:"○",19:"█",20:"♣",21:"¥",22:"▓",23:"░",24:"■",25:"∩",26:"ƒ",27:"☼",28:m,29:"▲",30:m,31:m,32:m,33:m,34:"▲",35:"▼",36:"♠",37:m,38:"▓",39:m,40:"☻",41:m,42:"■",43:"▓",44:m,45:"?",46:"☺",47:m,48:"K",49:"R",50:"O",51:"Z",52:"█",53:"█",54:"█",55:m,56:m,57:m,58:m,59:m,60:m,61:m,62:m,63:m,64:"▓",65:"O",66:"X",67:m,68:m,69:m,70:m,71:m,72:m,73:m,74:m,75:"│",76:"↓",77:"↓",78:"↓",79:"↓",80:"↓",81:"♀",82:"→",83:"←",224:m,225:m,226:m,227:m,228:m,229:m,230:m,231:m,252:"♣"},Ht={" ":0,1:1,2:2,3:3,X:4,W:5,L:6,C:7,S:8,"+":9,I:10,T:11,K:12,D:13,"#":14,F:15,".":16,R:17,Q:18,"/":19,"\\":20,"♣":20,B:21,V:22,"=":23,A:24,U:25,Z:26,"*":27,E:28,";":29,":":30,"`":31,"-":32,"@":33,"%":34,"]":35,G:36,")":37,M:38,"(":39,P:40,"&":41,"!":42,O:43,H:44,"?":45,">":46,N:47,"<":48,"[":49,"|":50,'"':51,4:52,5:53,6:54,7:55,8:56,9:57,ñ:58,ò:59,ó:60,ô:61,õ:62,ö:63,Y:64,0:65,"~":66,$:67,"‘":68,"’":69,"“":70,"”":71,"•":72,"–":73,"—":74,"³":75,"¹":76,º:77,"»":78,"¼":79,"½":80,ƒ:81,"¯":82,"®":83,à:224,á:225,â:226,ã:227,ä:228,å:229,æ:230,ç:231,ü:252},$={0:[l.White,l.Black],1:[l.LightRed,null],2:[l.LightGreen,null],3:[l.Green,null],4:[l.Brown,null],5:[l.HighIntensityWhite,null],6:[l.Black|16,l.White],7:[l.Yellow,l.Red],8:[l.Red,null],9:[l.Blue,null],10:[l.Green,null],11:[l.LightMagenta,null],12:[l.LightRed,null],13:[l.Magenta,l.Blue],14:[l.Brown,l.Brown],15:[l.LightCyan,null],16:[l.White,null],17:[l.LightBlue,l.Blue],18:[l.HighIntensityWhite,null],19:[l.Green,l.Green],20:[l.Brown,l.Green],21:[l.HighIntensityWhite,null],22:[l.LightRed,l.Red],23:[l.White,null],24:[l.HighIntensityWhite|32,l.Magenta],25:[l.HighIntensityWhite,null],26:[l.LightCyan,null],27:[l.Yellow,null],28:[l.HighIntensityWhite,null],29:[null,null],30:[null,null],31:[null,null],32:[null,null],34:[l.LightRed,null],35:[l.HighIntensityWhite,null],36:[l.Yellow|16,null],38:[l.Brown,null],33:[null,null],37:[null,null],39:[null,null],67:[null,null],224:[null,null],225:[null,null],226:[null,null],227:[null,null],228:[null,null],229:[null,null],230:[null,null],231:[null,null],40:[l.Yellow,l.Black],41:[null,null],42:[l.LightBlue,null],43:[l.Brown,null],44:[null,null],45:[l.HighIntensityWhite,null],46:[l.HighIntensityWhite,null],48:[l.White,null],49:[l.White,null],50:[l.White,null],51:[l.White,null],52:[l.Brown,l.Brown],53:[l.Brown,l.Brown],54:[l.White,l.Brown],55:[null,null],56:[null,null],57:[null,null],58:[l.LightCyan,null],59:[l.LightCyan,null],60:[l.LightCyan,null],61:[null,null],62:[null,null],63:[null,null],64:[l.White,null],65:[l.White,null],66:[l.LightRed,l.Red],68:[null,null],69:[null,null],70:[null,null],71:[null,null],72:[null,null],73:[null,null],74:[null,null],47:[l.HighIntensityWhite,null],75:[l.White,null],76:[l.White,null],77:[l.White,null],78:[l.White,null],79:[l.White,null],80:[l.White,null],82:[l.White,null],83:[l.White,null],81:[l.HighIntensityWhite,null],252:[l.Brown,l.Green]},Mt={4:"A Breakable Wall blocks your way",5:"You have found a Whip",6:"Stairs take you to the next lower level.",7:"`You found gems and whips inside the chest!",8:"You activated a Slow Time spell.",9:"Gems give you both points and strength.",10:"Oh no, a temporary Blindness Potion!",11:"You found a Teleport scroll.",12:"Use Keys to unlock doors.",13:"To pass the Door you need a Key.",14:"A Solid Wall blocks your way.",17:"You cannot travel through Water.",15:"You activated a Speed Creature spell.",16:"You activated a Teleport trap!",18:"A Power Ring--your whip is now a little stronger!",20:"A tree blocks your way.",19:"You cannot travel through forest terrain.",21:"You activated a Magic Bomb!",22:"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)",23:"* SPLAT!! *",24:"The Sacred Tome of Kroz is finally yours--50,000 points!",25:"You passed through a secret Tunnel!",26:"You have activated a Freeze Creature spell!",27:"You found a Gold Nugget...500 points!",28:"Oh no, you set off an Earthquake trap!",29:"An Invisible Crumbled Wall blocks your way.",31:"An Invisible Door blocks your way.",34:"A Creature Zap Spell!",35:"A Creature Creation Trap!",36:"You have discovered a Creature Generator!",38:"A Moving Wall blocks your way.",41:"Yah Hoo! You discovered a Reveal Gems Scroll!",42:"You found an Ancient Tablet of Wisdom...2,500 points!",44:"You triggered Exploding Walls!",45:"You found a Pouch containing Gems!",46:"Statues are very dangerous...they drain your Gems!",47:"Yikes!  A trap has made many of the wall sections invisible!",52:"A Solid Wall blocks your way.",58:"Magic has been released is this chamber!",61:"New Walls have magically appeared!",65:"You pushed a big Boulder!",66:"You hit a Electrified Wall!  You lose one Gem.",75:"You grabbed a Rope.",81:"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"},ut=[3,2,1],pt=[68,69,70,71,72,73,74],Be=[33,37,38,39,67,224,225,226,227,228,229,230,231],qt=[29,30,31],Zt=[5,9,11],Qt=[8,10,15,26],jt=[55,56,57],Jt=[61,62,63],ei=[...ut,4,...qt,43,64,...pt,13,16,...Be,19,28,32,35,36,45,48,49,50,51],ti=[...ut,...Zt,...Qt,7,16,...Be,32],ii=[0,32,...Be,41,44,47,...jt,...Jt,...pt];j.Rect.cache=!0;const Q=new j({width:$e,height:ht,fontFamily:"IBM_VGA_8x16, monospace",bg:U[l.Blue],fg:U[l.White],fontSize:64}),A={x:0,y:0,bg:"black",fg:"white"};function Se(e,t=A.y){A.x=e,A.y=t}function ve(e){typeof e=="number"&&(e=U[e]),A.bg=e}function We(e){typeof e=="number"&&(e=U[e]),A.fg=e}function ai(e){return Q.drawText(A.x,A.y,`%c{${A.fg}}%b{${A.bg}}`+e)}function x(e){A.y+=ai(e)}function J(e,t,i){Se(e,t),x(i)}function ze(){Q.clear()}function ft(e,t){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=U[e]),typeof t=="number"&&(t=U[t]),[e,t]}function Xe(e,t,i,a=A.fg,s=A.bg){[a,s]=ft(a,s),Q.draw(e,t,i,a,s)}function si(e,t,i,a=A.fg,s=A.bg){var r;[a,s]=ft(a,s),s=s??((r=Q._data[`${e},${t}`])==null?void 0:r[4])??$[o.Floor],Q.draw(e,t,i,a,s)}function z(e,t,i,a=A.fg,s=A.bg){typeof a=="number"&&a>15&&(a=Date.now()%500<250?a:s),typeof s=="number"&&(s=U[s%16]),typeof a=="number"&&(a=U[a%16]),Q.drawText(e,t,`%c{${a}}%b{${s}}`+i)}function oi(){return Q.getContainer()}var Re={exports:{}},ni=Re.exports,He;function ri(){return He||(He=1,function(e,t){(function(i,a){e.exports=a()})(ni,function(){var i=function(){function a(S){return X.appendChild(S.dom),S}function s(S){for(var _=0;_<X.children.length;_++)X.children[_].style.display=_===S?"block":"none";r=S}var r=0,X=document.createElement("div");X.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",X.addEventListener("click",function(S){S.preventDefault(),s(++r%X.children.length)},!1);var M=(performance||Date).now(),c=M,h=0,y=a(new i.Panel("FPS","#0ff","#002")),W=a(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var F=a(new i.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:X,addPanel:a,showPanel:s,begin:function(){M=(performance||Date).now()},end:function(){h++;var S=(performance||Date).now();if(W.update(S-M,200),S>c+1e3&&(y.update(1e3*h/(S-c),100),c=S,h=0,F)){var _=performance.memory;F.update(_.usedJSHeapSize/1048576,_.jsHeapSizeLimit/1048576)}return S},update:function(){M=this.end()},domElement:X,setMode:s}};return i.Panel=function(a,s,r){var X=1/0,M=0,c=Math.round,h=c(window.devicePixelRatio||1),y=80*h,W=48*h,F=3*h,S=2*h,_=3*h,p=15*h,f=74*h,w=30*h,O=document.createElement("canvas");O.width=y,O.height=W,O.style.cssText="width:80px;height:48px";var b=O.getContext("2d");return b.font="bold "+9*h+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=r,b.fillRect(0,0,y,W),b.fillStyle=s,b.fillText(a,F,S),b.fillRect(_,p,f,w),b.fillStyle=r,b.globalAlpha=.9,b.fillRect(_,p,f,w),{dom:O,update:function(I,q){X=Math.min(X,I),M=Math.max(M,I),b.fillStyle=r,b.globalAlpha=1,b.fillRect(0,0,y,p),b.fillStyle=s,b.fillText(c(I)+" "+a+" ("+c(X)+"-"+c(M)+")",F,S),b.drawImage(O,_+h,p,f-h,w,_,p,f-h,w),b.fillRect(_+f-h,p,h,w),b.fillStyle=r,b.globalAlpha=.9,b.fillRect(_+f-h,p,h,c((1-I/q)*w))}}},i})}(Re)),Re.exports}ri();const Te=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},G=e=>Te(e,"error"),Xi=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,oe=()=>({action:()=>{},after:()=>{},before:()=>{}}),L={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},li={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,a){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(a)||a<0||a>1)){G(L.INVALID_VALUE_NUMBER);return}this[i]=a}else G(L.INVALID_PROPERTY)},vibrate:function(i=.75,a=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,a);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:a,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,a,s,r,X){s&&r%2===X?(this.pressed[`${i}${a}`]||(this.pressed[`${i}${a}`]=!0,this.axesActions[a][i].before()),this.axesActions[a][i].action()):this.pressed[`${i}${a}`]&&r%2===X&&(delete this.pressed[`${i}${a}`],this.axesActions[a][i].after())},checkStatus:function(){let i={};const a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(a.length){if(i=a[this.id],i.buttons)for(let s=0;s<this.buttons;s++)i.buttons[s].pressed===!0?(this.pressed[`button${s}`]||(this.pressed[`button${s}`]=!0,this.buttonActions[s].before()),this.buttonActions[s].action()):this.pressed[`button${s}`]&&(delete this.pressed[`button${s}`],this.buttonActions[s].after());if(i.axes){const s=i.axes.length%2;for(let r=0;r<this.axes*2;r++){const X=i.axes[r+s].toFixed(4),M=Math.floor(r/2);this.axeValues[M][r%2]=X,this.triggerDirectionalAction("right",M,X>=this.axeThreshold[0],r,0),this.triggerDirectionalAction("left",M,X<=-this.axeThreshold[0],r,0),this.triggerDirectionalAction("down",M,X>=this.axeThreshold[0],r,1),this.triggerDirectionalAction("up",M,X<=-this.axeThreshold[0],r,1)}}}},associateEvent:function(i,a,s){if(i.match(/^button\d+$/)){const r=parseInt(i.match(/^button(\d+)$/)[1]);r>=0&&r<this.buttons?this.buttonActions[r][s]=a:G(L.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][s]=a;else if(i==="select")this.buttonActions[8][s]=a;else if(i==="r1")this.buttonActions[5][s]=a;else if(i==="r2")this.buttonActions[7][s]=a;else if(i==="l1")this.buttonActions[4][s]=a;else if(i==="l2")this.buttonActions[6][s]=a;else if(i==="power")this.buttons>=17?this.buttonActions[16][s]=a:G(L.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const r=i.match(/^(up|down|left|right)(\d+)$/),X=r[1],M=parseInt(r[2]);M>=0&&M<this.axes?this.axesActions[M][X][s]=a:G(L.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const r=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][r][s]=a}return this},on:function(i,a){return this.associateEvent(i,a,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,a){return this.associateEvent(i,a,"after")},before:function(i,a){return this.associateEvent(i,a,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=oe();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:oe(),left:oe(),right:oe(),up:oe()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},Z={gamepads:{},axeThreshold:[1],isReady:Xi(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){G(L.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const a=this.getGamepads(),s=Object.keys(a);for(let r=0;r<s.length;r++)a[s[r]].set("axeThreshold",this.axeThreshold)}}else G(L.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys(Z.gamepads);Z.onBeforeCycle();for(let i=0;i<t.length;i++)Z.gamepads[t[i]].checkStatus();Z.onAfterCycle(),t.length>0&&e(Z.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Te(L.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=li.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Te(L.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:G(L.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:G(L.UNKNOWN_EVENT);break}return this}};Z.init();let Oe=!1,ee=null;var d=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.PrevLevel=12]="PrevLevel",e[e.Teleport=13]="Teleport",e[e.ResetFound=14]="ResetFound",e[e.HideFound=15]="HideFound",e[e.Pause=16]="Pause",e[e.Quit=17]="Quit",e))(d||{});const Ae={},he={},ci={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:13,T:13,")":10,"+":14,"-":15,"(":11,PageDown:null,PageUp:null,p:16,P:16,Escape:17},hi={button0:9,button1:13,button4:null,button5:null,up:1,down:2,left:4,right:3,button12:1,button13:2,button14:4,button15:3};function Mi(){ee||Z.on("connect",e=>{if(!ee){ee=e,ee.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(hi))ee.before(t,()=>{Oe=!0,i&&(Ae[i]=!0)}),ee.after(t,()=>{i&&(Ae[i]=!1)})}})}function ui(e){Oe=!0;const t=ci[e.key];t&&(e.preventDefault(),he[t]=!0)}function pi(){Mi(),window.addEventListener("keydown",ui)}function ke(){Oe=!1;for(const e in he)he[e]=!1}function dt(){return Oe}function fi(){const e={};for(const t in d)if(!isNaN(Number(t))){const i=t;e[i]=!!he[i]||!!Ae[i],he[i]=!1}return e}function P(e=0){return e<=0?new Promise(t=>{requestAnimationFrame(()=>t())}):new Promise(t=>{setTimeout(()=>t(),e)})}const ne=new(window.AudioContext||window.webkitAudioContext),di=.005;function R(e,t,i=1){const a=ne.createOscillator(),s=ne.createGain();return a.type="sine",a.frequency.value=e,a.connect(s),s.connect(ne.destination),a.start(),s.gain.setValueAtTime(i*di,ne.currentTime),s.gain.exponentialRampToValueAtTime(.001,ne.currentTime+t/1e3),new Promise(r=>{setTimeout(()=>{a.stop(),r()},t)})}async function ie(){for(let e=1;e<=65;e++)R(Math.random()*1e3+1e3,1e3);await P(59)}async function qe(){for(let e=150;e>=35;e--)await R(e,1)}async function Ze(){await R(400,120,5),await P(10),await R(700,120,5),await P(10)}async function ye(){for(let e=1;e<=23;e++)R(Math.random()*550+350,120);await P(120);for(let e=1;e<=30;e++)R(Math.random()*50+150,50)}async function gi(){for(let e=10;e<=90;e++)await R(e,15,100)}async function Qe(){for(let e=1;e<65;e++)R(v.getUniformInt(0,1e3)+1e3,16,10);await P(50)}async function re(){for(let e=1;e<=2e3;e++)R(v.getUniformInt(0,e*2+200)+e,50)}async function wi(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=v.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)R(v.getUniformInt(0,4e3)+3e3,16,10)}else await P(v.getUniformInt(0,29))}function mi(){We(14),ve(l.Blue);const e=70;J(e,0,"Score"),J(e,3,"Level"),J(e,6,"Gems"),J(e,9,"Whips"),J(e-2,12,"Teleports"),J(e,15,"Keys")}function B(){const e=n.whipPower>2?`${n.whips}+${n.whipPower-2}`:n.whips.toString(),t=4,i=7,a=!n.paused&&n.gems<10?l.Red|16:l.Red,s=69;z(s,1,te((n.score*10).toString(),t+1,i),l.Red,l.Grey),z(s,4,te(n.level.toString(),t,i),l.Red,l.Grey),z(s,7,te(n.gems.toString(),t+1,i),a,l.Grey),z(s,10,te(e,t,i),l.Red,l.Grey),z(s,13,te(n.teleports.toString(),t,i),l.Red,l.Grey),z(s,16,te(n.keys.toString(),t,i),l.Red,l.Grey)}function je(){ze(),wt(),mi(),N(),B()}function gt(){N(),B()}function wt(){We(l.LightBlue),ve(l.Black);for(let e=ue-1;e<=se+1;e++)Xe(e,0,"▒"),Xe(e,ce+1,"▒");for(let e=pe-1;e<=ce+1;e++)Xe(0,e,"▒"),Xe(se+1,e,"▒")}async function u(e,t=!1){if(t){if(n.foundSet.has(e))return;n.foundSet.add(e)}if(typeof e=="number"&&(e=Mt[e]),!!e){for(n.paused=!0,ke();!dt();)Ri(e,v.getUniformInt(1,15)),await P(50);wt(),ke(),n.paused=!1}}function Ri(e,t,i){if(typeof e=="number"&&(e=Mt[e]),!e)return;const a=(se-e.length)/2,s=ce+1;i=i??l.Black,t=t??l.HighIntensityWhite,z(a,s,e,t,i)}function te(e,t,i){return e.padStart(t,m).padEnd(i,m)}async function yi(){ve(l.Blue),We(l.LightCyan),Se(1,9),x("  Revitalized from the Fountain of Youth you uncovered in your last adventure"),x("  through Kroz,  you decide it's time once again to explore the vast mystical"),x("  kingdom.  From your last journey through the underground world of Kroz, you"),x("  noticed a new tunnel that requires further investigation.  What new mystery"),x("  awaits below?  Your adrenaline level rises as you decend the secret tunnels"),x("               that lead into the heart of Kroz.  One more time..."),z(27,25,"Press any key to continue.",l.LightGreen);const e=$e/2-Ke.length/2;for(ke();!dt();)z(e,3,Ke,v.getUniformInt(0,16),l.Red),await P(50),await P(100);ke()}async function _i(){await ye(),await P(200),await ye(),await P(200),await ye(),await u("Oh no, something strange is happening!"),await u("You are magically transported from Kroz!");const e=n.gems=isFinite(n.gems)?n.gems:150,t=n.whips=isFinite(n.whips)?n.whips:20,i=n.teleports=isFinite(n.teleports)?n.teleports:10,a=n.keys=isFinite(n.keys)?n.keys:5;await u("Your Gems are worth 100 points each...");for(let s=0;s<e;s++)n.gems--,n.score+=10,B(),await R(s*8+100,20);await u("Your Whips are worth 100 points each...");for(let s=0;s<t;s++)n.whips--,n.score+=10,B(),await R(s*8+100,20);await u("Your Teleport Scrolls are worth 200 points each...");for(let s=0;s<i;s++)n.teleports--,n.score+=20,B(),await R(s*8+100,20);await u("Your Keys are worth 10,000 points each....");for(let s=0;s<a;s++)n.keys--,n.score+=1e3,B(),await R(s*8+100,20);ze(),Se(25,3),We(l.White),ve(l.Blue),x("ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"),Se(15,5),x("   Carefully, you place the ancient tome on your table and open"),x(" to the first page.  You read the book intently, quickly"),x(" deciphering the archaic writings."),x("   You learn of Lord Dullwit, the once powerful and benevolent"),x(" ruler of Kroz, who sought wealth and education for his people."),x(" The magnificent KINGDOM OF KROZ was once a great empire, until"),x(" it was overthrown by an evil Wizard, who wanted the riches of"),x(" Kroz for himself."),x("   Using magic beyond understanding, the Wizard trapped Lord"),x(" Dullwit and his people in a chamber so deep in Kroz that any"),x(" hope of escape was fruitless."),x("   The Wizard then built hundreds of deadly chambers that would"),x(" stop anyone from ever rescuing the good people of Kroz."),x("   Once again your thoughts becomes clear:  To venture into the"),x(" depths once more and set free the people of Kroz, in:"),x(""),await u("Press any key, Adventurer."),n.done=!0}class mt{constructor(t,i,a){Ue(this,"ch");this.type=t,this.x=i,this.y=a,this.x=i,this.y=a,this.ch=be[t]}move(t,i){this.type===o.Player?ye():this.type===o.Slow?this.ch=Math.random()>.5?"A":"Ä":this.type===o.Medium&&(this.ch=Math.random()>.5?"ö":"Ö"),this.x=t,this.y=i}async kill(){await R(200+200*this.type,25,100),this.x=-1,this.y=-1}getChar(){return this.type===o.Player?n.T[H.Invisible]>0?m:be[this.type]:this.ch}}const bi="Debug",Si=`
                                                       #1#1#1#1#
 ####### ##whip W W W                  ~~~~~   ewall## # # # # #
  3 3  # #chest C C C                  #####   wall### # # # # #
   3   # ##nugg * * *     ñ4444444444  RRRRR   river## # # # # #
  3 3  # ###gem + + +     ò5555555555  /////   forest# # # # # #
 ####### ##door D D D     ó6666666666  ♣♣♣♣♣   tree### #X#X#X#X#
         ##tele T T T                  VVVVV   lava### #2#2#2#2#
         ###key K K K                  =====   pit#### # # # # #
         #power Q Q Q                  XXXXX   block## # # # # #
 #######                                               # # # # #
  2 2  #                      P                        # # # # #
   2   #                                               #X#X#X#X#
  2 2  #                  XXXXXXXXXXX                  #3#3#3#3#
 #######                  XXXXXXXXXXX                  # # # # #
         ###zap % % %     XXXXXXXXXXX   0 0 0   rock## # # # # #
         ##slow S S S     XXXXXXXXXXX   < [ | " kroz## # # # # #
         #speed F F F     XXXXXXXXXXX                  # # # # #
 ####### #freez Z Z Z          B        U U U   tunnel #X#X#X#X#
  1 1  # ###inv I I I     ###bomb####                  #########
   1   # tablet ! ! !     #XG1 2 3GX#   . . .   traps#          
  1 1  # #amule ƒ ƒ ƒ     XXXXXXXXXXX   & & &   show##  S       
 ####### ##tome A A A     XDZ/EWLCSVX   E E E   quake#    F     
                          XXXXXXXXXXX   T T T               Z   
`,ki={id:bi,map:Si},vi="Lost1",Wi=`
//♣///////♣///♣////////♣////////♣//#the#lost#adventures#of#kroz#
//♣//////////////♣//♣////////♣////////♣///♣/♣♣/♣♣/♣/♣♣/♣♣♣♣♣♣♣/♣
♣###your#hut###////♣///♣/////////♣/////♣/♣♣//♣♣/♣♣/♣♣♣♣♣♣♣♣♣♣♣♣♣
/##           D---/////////♣//♣///♣//♣/♣/♣/♣/♣/♣/♣/♣♣♣♣♣♣♣###♣♣♣
/##  P ####  ##///-♣//♣//♣/----♣///♣////♣//♣//RRR/♣♣♣♣♣♣♣##L##♣♣
/##      K#**##/♣♣/-//--/♣-♣//♣--♣//♣//♣////RRRRR//♣♣♣♣♣♣♣#0#♣♣♣
♣##############/////--♣/--//♣////-///////♣////RRRRRRR/♣♣♣♣#!#♣♣♣
////♣♣///♣/♣♣///♣//♣//////////♣//♣---♣//♣////RRRRRR/♣♣/♣♣♣♣-♣♣♣♣
/♣//////♣/////♣////////♣///♣/////////--/////♣///RRRRR♣♣♣♣♣♣♣-♣♣♣
///////♣////////♣///////////////♣/////♣---/////RRRRR/♣/♣♣♣♣♣♣-♣♣
////♣/////♣♣♣//♣////♣/////♣//////♣////////-//♣/♣/RRRRRR♣/♣♣♣-♣♣♣
/////////♣♣♣♣♣///♣////♣////////♣///♣///////-//♣///RRRR♣//♣/-♣/♣/
♣//////♣//♣♣////♣////////♣//♣//////////♣///-♣////RRRRRR♣♣/♣-/♣/♣
//♣♣//////♣/###storage###///////♣--//♣♣///-////RRRRRRRRR/♣/♣-/♣/
////////♣///##WWW-WWW-W##/♣////--//-//♣♣/-///♣RRRRRRRRR/♣/♣/-/♣/
/♣////////♣/##W-WWW-WW---------//♣//-----//♣///RRRRRRRR♣♣//♣-♣//
♣/////♣/////#############♣///♣-/♣♣♣/♣/♣♣/♣////RRRRRRRR//♣/♣/-//♣
///♣////♣//////♣♣////♣////♣///-////♣/♣♣/♣///♣RRRRRRR/♣/♣//♣-/♣//
/♣///♣/////♣////♣///♣//♣//♣////------♣///♣////♣////♣//--/♣-♣♣//♣
♣//♣///♣/♣//♣/♣/♣///♣//♣/♣///♣////♣//------♣/♣//♣///♣-♣/--//♣/♣/
/♣///♣////♣//♣///♣////♣///♣//♣/♣////♣///♣/♣-----/♣♣/-/♣//♣/♣//♣/
♣//♣////♣/♣///♣//♣///♣/♣///♣//♣/////♣///♣/////♣/----♣♣//♣///♣//♣
#by#scott#miller#♣///♣/////♣/♣////♣////♣////♣//♣//♣/♣//♣/♣♣///♣ü
`,Oi={id:vi,map:Wi},xi=`
XXXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXXXX### P ###X
XXXXX##XXXXXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXXXXXXXXXXXXXX##  ##XX
XXXXXXXXXXXXXXX&-XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXX#XXXXX#  #XX
#XXXXXXXXXXXXXXXX-XXXX--XXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXX  XXXX
XXXXXXXXX#XXXXXXXX-XX-XX-XXXXXXX#XXXXXXXXXXXXXXXXXXXXX##   #XXXX
XXX#XXXXXXXXXXX#XXX--XX#X--XXXXXXXXX#XXXXX#XXXX##XXXX##  ##XXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXX##XX##XXXXXX
XXXXXXXXXXX##XXXXXXXXXXXXX#XX-XXXXXXXXXXXXXXXXXXXXX##  ##XXXX##X
XXXXX#XXXXXXXXXXXX#XXXXXXXXXXX--XXXX##XXXXXX#XXXXX##  ##XXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXX-#XXXXXXXXXXXXX      XXXX#XXXXXX
XXXXX##XXXXXX#XXXXXXX#XXXXXXXXXX#X##XXXXX       XXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXX##XXX#   0    XXXXXXXX!XXXXXXXXXXXXX
XXXXXXXXXXXXXX#XXXXXXX===XXXXXXX#  XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXX#XXXXXXXXXXXX=======XXXXX  XXXXXXXX#XXXXX#XXXXXXXXXX##XXX
XXXXXXXXXXXXXXXXX=========       XX=====XXXXXXXXXXXXX#XXXXXXXXXX
XX#XXXXXXX##XXX==========  ===========XXXXXXXXXXXXXXXXX#XXXXXXXX
XXXXXXXXXXXXXX==========  ===========XXXXXXXXX##XXXXXXXXXXXXXXXX
XXXX#XXXXXXX             ===========XX#XXXXXXXXXXXXXXXXXXXXX#XXX
XXXXXXXX    XX#XXXX================XXXXXXXX#XXXXXX#XXXXXXXXXXXXX
XXX     XX#XXXXXXXXXX===========XXXXXXXXXXXXXXXXXXXX##the#secret
XXXXXXXXXXXXXXXXXX#XXXXXX=====XXXXXXXXXX#XXXXXXXXXXX#tunnel#into
X  XX#XXXXXX##XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXX#the#kingdom
LLXXXXXX#XXXXXXXXXXXXX#XXXXXXXXXXXXXX#4XXXXXX##XXXXX#####of#kroz
`,Fi={id:"Lost2",map:xi},Yi=`
                                   1                        1  &
 ####shop####         1                                       ‘ 
 ##++++++++##                            1                      
 ##++++++++##                                 ##4444444444444444
 #####OO#####                                 ##   1   1   1  1 
                          ###spells###        ## 1 1  1  1   1  
     1                    ##ñEF‘Tò @##     1  ##    1   1  1  1 
                          ##I@ ‘S  T##        ##11   1 1    1   
                     1    ##ZóT‘  ] ##        ##   1   1 1  1 1 
                          #########X##        ## 1   1  1  1 1  
@@         1                                  ##1 1    1  1    1
1@W                            P              ## 1  1 1 1  1 1 1
1@W                                           ##1  11  1 1   1  
1@W   1                                     1 ##  1   1     1   
1@W                 1                         ##1    1  1  1  1 
1@W                                     #.#OXX## 1 1  1   1    1
1@W          ###lair#of#kroz###         #.#XOX##1    1  1   1 1 
1@W          77------------ôK##         #.#XXO##  1 1  1   1   1
1@W          ####1111111111####         #.#XOX## 1 1  1 1 1   1 
1@W    1      Z##############           #H#X!X##1  1 1  1  1 1  
1@W                                     ######## 1   1 1  1   1 
1@@@@@@@@@@@@@@@                  ########@       1   1   1 1  1
111111111111111@                1 ##LLWWWD@         1   1    1 1
`,Pi={id:"Lost4",map:Yi},Ti=`
66666666666666666666----------------------------66WW---I-------K
-----------D D D-----66666666666666666666666666(6666666666666---
-666666666666666666-((((((((((((((((22222222222(-----------666-6
-666666666666666666-66((((((((((((((22222222222(6-66666666-----6
-66666666666066WYY6-66VVVVVVVVVVVVVVVVVVVVVVVVV66-66666666666666
------------0B6WYY--66T-W-W-*-W-W-C-W-W-*-W-W-T66-66666666663666
-66666666666066WYY6666666666666666666666666666666’66666666636666
-MMMMM6666666666666666666666666666666666666666666-66666666366666
-MMMMM............................3!66222222266----$$$$$$$666666
-MMMMM6666666666666666666666666666666622222266~~~~~~~~~~~~-66666
-MMMMM666666666666666666666666666666662222266------------~~-6666
-MMMMM............................3H66222266-~~~~~~~~~~~~-~~-666
-MMMMM6666666666666666666666666666666622266-~~----------~~-~~-66
-66666666666666666666666666666666666@@@@66-~~-~~~~~~~~~~-~~-~~-6
----666-OWOWOWOWOWOWOWOWOWO 66666666@66@666-~~-~~K’-----~~-~~-66
-66-666-6666666666666666666 66666666@66-6666-~~-~~~~~~~~~-~~-666
-66F666-666T-3)K)3-T66           666@66-66666-~~---------~~-666C
-66F666-666T-3)))3-T66     G     666-66-666666-~~~~~~~~~~~-6666-
-66666---666666-666666           666-66-6633666-----------666333
-66YYYYYYYYY666-66666666666-66666666-66-66--6666666666666-666-66
--     P    666-66+------66-66-------66----Y--D-D-D-LL 66-666-66
666---------666-66666666-66-66Y66666-66666666666666666666-666-66
666222222222666-------------66---Z66--------------------------66`,Ai={id:"Lost11",map:Ti},Ci="Lost22",Di=`
###key#shop###MTMMMMMMMMMMMMMMMMMMMMM-----MMMMMMMMMMMM-MM--!##LL
##Káà44@@@@@##MMMMMMMMMMMMMMMMMMMMMM-MMMMM-MMMMMMMMMM-M-M-P-##LL
##Ká3##@@@@@@DMMMMMMCMMMMMMMMMMMMMM-MMMMMMM-MMM<MMMM-MMM----##DD
##Káà##@@@@@##M-MMMMMMMMMMMMMMMM---MMMMMMMM-MMMMMMM-MMMMMMMM##DD
#######X######MM-MMMMMMMMMMM----MMMMMMMMMMMM-MMMMM-MMMMMMMMM##DD
##ñ-----##MMMMMMM-MMMMM-----MMMMMMMMMMMKMMMMM-MMM-MMMMMMMMMM##DD
##########MMMMMMTMMMMM-MMMMMMMMMMMMMMMMMMMMMMM-M-MMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMM-MMMMMMMMMMMMMMMMMMMMMMMMM-MMMMMMCMMMMMM-MM
MMMMMMMM-----MMMM----MMMMMMMM[MMMMMMMMMMMMMMMMMMMMMMMMMMMMMM-MMM
MMMM----MMMMM----MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMTMMMMMMMMMMM-MMMM
MMM-MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM-MMM
MM-MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM-MM
MM-MMMMMMCMMMMMMMMMMMMMMMBWWWWWWWWWW-------------------------MMM
MM-MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM-MM
MM-MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMTMMMMMMMMMMMMMMM-M
MMM-------MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM-MM
MMMMMMMMMM-----MMMMMMMMMMMMMMMM]MMMMMMMMM-M-MMMMMMMMMMMMMMMM-MMM
)))))))))MMMMMM-MMMMMMMMMMMMMMMMMMMMMM-M-M-M-MMMMMMMMCMMMMM-MMMM
22222222)MMTMMM-MMMMMCMMMMMMMMMMMMMMM-M-MMMMM-MMM-MMMMMMMM-MMMMM
22222222)MMMMMM-MMMMMMMMMMMMMMM------MMMMMMM-MMM-M-MMMMMM-MMMMMM
22222222)MMMMMM-MMMMMMMMMM-----MMMMMMMMMMMM-MMM-MM-MMMMM-MMMMMMM
--222222)MMMMMM-----------MMMMMMMMMMMMMMMM-MM-M-MMM-M-M-MMMMM"MM
K-222222)MMMMMMMMMMMMMMMMMMMMMMMMMM|MMMMMMM--M-MMMMM-M-MMMMMMMMM
`,Ii={id:Ci,map:Di},Li="Lost26",Ei=`
::::::::::::::::::::::::::::::::::::::::::::::::####amulet####::
:###########::::::::::::::::::::::::::::::::::::#55]-----]---#::
:#         #::::::::::::::::::::::::::::::::::::#ƒ5----]--L-ò#::
:#    P   HOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO::::::#55-]------]-#::
:#K        #::::::O::::::::::::-:::::::::O::::::###D##########::
:###########::::::O::::::::::::-:::::::::O:::::::::O::::::::::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::-----:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::::::-:::::
:::::::::::OOOOOOOO::::::::::::-::::#####D###::::::O::::::-:::::
:::::::::::O:::::::::::::::::::-::::#K;     #::::::OOOOO::-:::::
:::::::::::O:::::::::::::::::::-::::#;;     #::::::::::O::-:::::
:::::######D#############::::::-::::# W     #::::::::::O::-:::::
:::::#!---...----T---I--#::::::-::::#       #::::::::::O::-:::::
:::::#----K----F---’---ñ#::::::-::::#     * #::::::::::O::-:::::
:::::#-S---I----------Z-#::::::-::::#       #::::::::::O::-:::::
:::::####################::::::-::::#   W   #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#       #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#4444444#::::::::::O::-:::::
::::::::::::::::::::::::+++::::-::::#K;-----DOOOOOOOOOOOOOOOOO::
###rogue###:::::::::::::+++-----::::#########:::::::::::::::::::
#was#hereÃ#:::::::::::::::::::::::::::::::::::::::::::::::::::::
`,$i={id:Li,map:Ei},Bi="Lost30",zi=`
1111144       ##C######locksmith#shoppe######C##         RRRRRRR
1111144       ##]##K#K#K#K#K#-3-3#K#K#K#K#K##]##        RRRRRRRñ
1111144          ##:::::::::######::::::::;##         RRRRRRRCYY
1111144          ##------------------------##     666RRRRRRRR66 
1111144          #############--#############     6666666666666 
1111144                                           HOOOOOOOOH    
1111144                                        6666666666666    
1111144                                        66RRRRRRR6666    
1111144                                        RRRRRRR          
1111144                                      RRRRRR           YY
1111144               P                    RRRRRR             YZ
1111144                                 RRRRRRRRRR            YY
1111144                              RRRRR333RRRRR              
1111144                             RRR3333333RRRRR             
@@@@@##                           RRR3333333333RRRRR            
MMMMM##                           RRR333333333RRRRR             
)))))##                          RRR33333333RRRRR               
MMMMM##                        RRRR333333RRRRRRR        DDDDDDDD
(((((##                       RRRR3LL3RRRRRRRR          DDDDDDDD
MMMMM##                      RRRRRRRRRRRRRR             DDDDDDDD
$$$$$##                     RRRRRRRRRRRR                DDDD7777
MMMMM##                     RRRRRRRR                    DDDD77ôô
]]K]]##“                   RRRRRRK]                     DDDD77ô!
`,Gi={id:Bi,map:zi},Ni="Lost42",Ui=`
###########klose#enkounters#of#the#krazy#kubikal#kindÃ##########
3                               P                              3
##-##############:########:#######:###########:##############:##
XXXXXXXXX##~W~W~W~W~##‘-M----M.--$$$$$$$$$-9/-/♣--♣-|##---’ò’---
---------##*~*~*~*~*##-‘.-”M-”-##$$$$$$$$$##♣--/-♣-/♣##YYYYYYYYY
MMMMMMMMM##~W~W~W~W~##M--‘-.-M-##111111111##-/-♣/--/-##(((((((((
)))))))))##*~*~*~*~*##.”-.-”-.”##222222222##/♣--♣-♣-/##(((((((((
C))))))))--~W~W~W~W~##ó.-”--‘-M##333333333##ü-//-♣-/-9-(((((((((
###################-################################9##55555555-
“-“-“-“-“##YYYYYYYYY##222222222------0---W##RRRRRRRRR##MMMMMMMMM
-----------YYYYYYYYY##@@@@@@@@@##---000---##RXXXXXXXR##MMMMMMMMM
XXXXXXXXX##YYYYYYYYY##@@@@@@@@@##--00G00--##RXXXKXXXR##MMMMMMMMM
---------##YYYYYYYYY##@@XXX@@@@##---000---##RXXXXXXXR##MMMMMMMMM
’’’’’’’’’##YYYYYYYYK##@@XZX@@@@##----0---W##RRRRRRRRR##MMMMMMMMK
-#####################-##########ô##################H##Z########
~-~[~-~-~##WWW......à1:1:1:1:1:##-773C7--7##=--=I==-=##ááááááY0"
-~-~-~-~-##WWW......##1:1:1:1:1##7-777-77-##!==-=--==##ááááááY00
~-~-~-~-~##.........##:1:1:1:1:##-77--77-7##=======-=##ááááááYYY
-~-~-~-~-##.........##1:1:1:1:1##7-7-77-77##-==-=-==I##ááááááááá
K-~-~-~-~-à..<......##:1:1:1:1ñ##77-7777---I=--=-=--=##222222222
############################################################44##
LL---V--V-VV-V--VV---D-----D--’--D--”--D--66333333333333333-WWWW
LL--V-VV-V--V-VV--V--D-----D--”--D--’--D--66YYYYYYYYYYYYYYYYYYYY
`,Vi={id:Ni,map:Ui},Ki=`
ñö22222229       &#the#sacred#chamber#of#kroz#&2      82222222õò
öö22222999      F       $®$$$$$$$$$$$¯$ 2    .    F   88822222õõ
22222999     2• .   ”   $$$333333333$$$         •    2  88822222
222999   ”   ###        $$3=========3$$   ]    ###        888222
2999   .     #K#       $$3==úúúùúúú==3$$       #ó# .        8882
99   F  ]    #K#  2   $$3==úúùVVVùúú==3$$   2  #2#    ”    2  88
RRRRRRR      #0#      $3==úùïúVAVúïùú==3$      #2#       RRRRRRR
22222RR.     #0# .    $3==úùùúVVVúùùú==3$ .    #2#  2   .RR22222
22222RR  2   #0#      $$3==úúùú6úùúú==3$$      #2#       RR22222
22222RR      #D#   2   $$3==úúù&ùúú==3$$    ‘  #D#     2 RR22222
22222RR                 $$3==úú0úú==3$$                  RR22222
22222RR     2        ]   $3==úúGúú==3$    ”    .   2   . RR22222
22222RR  .     ”     .   $$3==úDú==3$$                ]  RR22222
22222RR    F              $$3=====3$$   2      2    ”    RR22222
RRRRRRR 2         2        $$33333$$       ]      F     2RRRRRRR
444444444444444’            $$$$$$$   .      .  H444444444444444
77777777777777###   ‘ .        P           2   ###YYYYYYYYYYYYYY
77777777777777#U#       2                      #U#YYXXXXXXXXXXXX
77777777777777#-#  2       .   T      2        #0#YYXXYYYYYYYYYY
77777777777777#<#   ]          ” 2       ”    2#0#YYXXYYOOOOOOOO
77777777777777#[#        2  5555555 N     .    #0#YYXXYYOOYYYYYY
77777777777777#|#          55DDDDD55 2      F  #0#YYXXYYOOYYXXXX
K777777777777C#"#E  2     555D]!]D555     2    40#CYXXYYOOYYXX]K
`,Hi={id:"Lost75",map:Ki},qi="Kingdom1",Zi="Welcome to Kroz II",Qi=`
W W W W             2 2 2 2 2  C  2 2 2 2 2              W W W W
XXXXXXXXXXXXXXXXXXX###########   ###########XXXXXXXXXXXXXXXXXXXX
 1           1                               1                  
                                    1            XX         1   
       1            1                           XXXX            
#        XX                    +                 XX            #
##      XXXX  1                +          1          1        ##
T##      XX               2    +    2                        ##T
T1##                       W   +   W                        ##1T
T########X                 WX     XW             1    X########T
.        X                2WX  P  XW2                 X        .
T########X         1       WX     XW                  X########T
T1##                       W   +   W         1              ##1T
T##                       2    +    2                        ##T
##   1                         +                      XX      ##
#       XX      1              +                 1   XXXX     1#
       XXXX                 ##   ##                   XX        
1       XX                 ##     ##     1        1           1 
                    1#######       ########                     
    1         ########11111  +++++  111111########              
WW     ########+++++        #######         WWWWW########1    WW
########¯                    2 2 2                     C########
L2  +  X      #kingdom#of#kroz#ii#by#scott#miller#      X  +  2L`,ji={id:qi,name:Zi,map:Qi},Ji="Caverns2",ea=`
LXXX2    2     2        2   2  2  2   2    2 2    2  2    2    +
+XXX  2     2      2        2          2  2    2     2      XXX 
 XXX2   2      2       2  2     2   2       2      2  2  2  XTX 
+XXX          2  2           2         2  2     2   2       XXX 
 XXX   2   2         2   2     2    2      2  2        2     2  
+XXX 2                                                          
 XXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  2  2 
+XXX2    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
 XXX  2  XXX2                    W                   2XXX 2     
+XXX   2 XXX  2                FFFFF               2  XXX   2 2 
 XXX2 2  XXX                   F111F                  XXX       
+XXX2    XXX+   3  3        W  F1P1F  W       3  3   +XXX  2    
XXXX   2 XXX                   F111F                  XXX 2    2
WXXX 2   XXX  2                FFFFF               2  XXX   2   
WXXX2    XXX2                    W                   2XXX    2  
WXXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX 2     
WXXX   2 XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
WXXX2                                                      2    
WXXX    2   2      2   2     2    2   2    2    2      2      2 
XXXX 2    2   2 2    2    2     2       2     2     2     2 XXX 
XXXX2  2    2  2  2      2    2     2  2  2  2    2         XTX 
XXXX 2   2 2    2   2  2    2   2       2       2   2   2   XXX 
CXXX   2    2  2 2    2 2     2    2  2  2   2    2  2    2    +`,ta={id:Ji,map:ea},ia="Caverns4",aa=`
WFP I        C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
XX############################################################CC
             C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
  ##############################################################
  #     1        +              1     +                  X      
 1#I##################################################   #   #  
  #X #XX    X    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#1  #   #+ 
  # X#XX XX X XX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#   # 1 #  
+ #X #X +XX  +X  XXLX  W + + + + + T + + + + + W   XX#   #   # 1
  # X#X XXXXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  X# 1 #+  #  
1 #X #X   X     +XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX X#   #   #  
  # X#XXX X ####################################### X#  +#1  #  
  #X #XXXIX     1   +    1   +   1  +               X#   #   #  
  # X#X   ###################################XXX######  1#   #  
  #X #X #####################################XXX######   #   #1 
 1# X#X     1 +1 +1 +1 +1 +1++++                     #+  #  1#  
  #X ########################################XXX#### #   #   # +
  # XXXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXWWWXXX# # 1 #  +#  
  # XXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXX#1#   #1  #  
 +# ################################################ #   #   # 1
  #    1+++1            C           1+++1            #       #  
1 ############################################################  
         1       +            1         +               1       `,sa={id:ia,map:aa},xe=[ki,Oi,Fi,Pi,ta,sa,ji,Ai,Ii,$i,Gi,Vi,Hi];var H=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e))(H||{});const me={4:70*E,5:75*E,6:80*E,7:55*E},n=Rt();function Rt(){return{player:new mt(o.Player,0,0),entities:[],PF:[],foundSet:new Set,T:[0,0,0,0,4,5,6,7,0,0],level:1,levelId:"Lost1",score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2,actionActive:!1,paused:!1,done:!1}}function oa(){Object.assign(n,Rt())}function Ge(){const e=xe[n.level];n.levelId=e.id,ha(e.map),n.T=n.T.map(()=>0),N(),B()}async function yt(){n.level=Le(n.level+1,xe.length),Ge(),await u("Press any key to begin this level.")}async function na(){n.level=Le(n.level-1,xe.length),Ge(),await u("Press any key to begin this level.")}async function ra(){n.T=n.T.map(e=>e>0?e-1:0)}async function Xa(e){var X,M;if(e.x===-1||e.y===-1||n.PF[e.x][e.y]!==e.type){e.kill();return}let t=0,i=0;n.player.x<e.x&&(t=-1),n.player.x>e.x&&(t=1),n.player.y<e.y&&(i=-1),n.player.y>e.y&&(i=1);const a=e.x+t,s=e.y+i;if(a<0||a>=C||s<0||s>=D)return;const r=((M=(X=n.PF)==null?void 0:X[a])==null?void 0:M[s])??o.Floor;switch(r){case o.Floor:case o.TBlock:case o.TRock:case o.TGem:case o.TBlind:case o.TGold:case o.TWhip:case o.TTree:g(e,a,s);break;case o.Block:case o.MBlock:case o.ZBlock:case o.GBlock:n.PF[e.x][e.y]=o.Floor,n.PF[a][s]=o.Floor,e.kill(),k(r),R(800,18),R(400,20);break;case o.Player:n.gems--,n.PF[e.x][e.y]=o.Floor,e.kill(),k(r);break;case o.Whip:case o.Chest:case o.SlowTime:case o.Gem:case o.Invisible:case o.Teleport:case o.Key:case o.SpeedTime:case o.Trap:case o.Power:case o.Freeze:case o.Nugget:case o.K:case o.R:case o.O:case o.Z:case o.ShootRight:case o.ShootLeft:ie(),g(e,a,s);break;default:g(e,e.x,e.y);break}}async function la(e){if(e!==o.Player&&!(n.T[7]>0))for(let t=0;t<n.entities.length;t++){const i=n.entities[t];e&&i.type!==e||i.x===-1||i.y===-1||await Xa(i)}}async function ca(){const e=fi();if(e[d.FreeItems]&&await T(d.FreeItems),e[d.NextLevel]&&await T(d.NextLevel),e[d.PrevLevel]&&await T(d.PrevLevel),e[d.ResetFound]&&(n.foundSet=new Set),e[d.Pause]&&da(),e[d.Quit]&&fa(),e[d.North]&&e[d.West])return await T(d.Northwest);if(e[d.North]&&e[d.East])return await T(d.Northeast);if(e[d.South]&&e[d.West])return await T(d.Southwest);if(e[d.South]&&e[d.East])return await T(d.Southeast);if(e[d.North])return await T(d.North);if(e[d.South])return await T(d.South);if(e[d.West])return await T(d.West);if(e[d.East])return await T(d.East);if(e[d.Southeast])return await T(d.Southeast);if(e[d.Southwest])return await T(d.Southwest);if(e[d.Northeast])return await T(d.Northeast);if(e[d.Northwest])return await T(d.Northwest);if(e[d.Whip])return await T(d.Whip);if(e[d.Teleport])return await T(d.Teleport)}async function T(e){let t=!1;switch(e){case d.FreeItems:n.gems=1/0,n.whips=1/0,n.teleports=1/0,n.keys=1/0,B();break;case d.NextLevel:await yt();break;case d.PrevLevel:await na();break;case d.North:await V(0,-1),t=!0;break;case d.South:await V(0,1),t=!0;break;case d.West:await V(-1,0),t=!0;break;case d.East:await V(1,0),t=!0;break;case d.Southeast:await V(1,1),t=!0;break;case d.Southwest:await V(-1,1),t=!0;break;case d.Northeast:await V(1,-1),t=!0;break;case d.Northwest:await V(-1,-1),t=!0;break;case d.Whip:n.whips<1?Ze():(n.whips--,await ua()),t=!0;break;case d.Teleport:n.teleports<1?await Ze():(n.teleports--,await bt()),t=!0;break}return t}function ha(e){n.entities=[];const t=e.split(`
`).filter(i=>i.length>0);for(let i=0;i<t.length;i++){const a=t[i];for(let s=0;s<a.length;s++){const r=a.charAt(s)??m,X=Ht[r];switch(n.PF[s]=n.PF[s]||[],n.PF[s][i]=X??r,X){case o.Player:n.player.x=s,n.player.y=i;break;case o.Slow:case o.Medium:case o.Fast:n.entities.push(new mt(X,s,i));break}}}$[o.Floor][0]=l.White,$[o.Floor][1]=l.Black,$[o.Gem]=[v.getUniformInt(1,16),null]}async function V(e,t){var r,X,M,c,h,y,W,F,S,_;const i=n.player.x+e,a=n.player.y+t;if(i<0||i>C||a<0||a>D)return;const s=((X=(r=n.PF)==null?void 0:r[i])==null?void 0:X[a])||o.Floor;switch(s){case o.Floor:case o.Stop:g(n.player,i,a);break;case o.Slow:case o.Medium:case o.Fast:_e(i,a),g(n.player,i,a),k(s);break;case o.Block:case o.ZBlock:case o.GBlock:k(s),await u(o.Block,!0);break;case o.Whip:ie(),n.whips++,k(s),g(n.player,i,a),await u(o.Whip,!0);break;case o.Stairs:if(n.level===xe.length-1){g(n.player,i,a),await _i();return}k(s),g(n.player,i,a),await u(o.Stairs,!0),yt();break;case o.Chest:if(n.keys>0){n.keys--;const p=v.getUniformInt(2,5),f=v.getUniformInt(2,5);n.whips+=p,n.gems+=f,k(s),g(n.player,i,a),await u(`You found ${f} gems and ${p} whips inside the chest!`)}break;case o.SlowTime:n.T[6]=0,n.T[4]=me[4],k(s),g(n.player,i,a),await u(s,!0);break;case o.Gem:n.gems++,k(s),g(n.player,i,a),u(s,!0);break;case o.Invisible:n.T[5]=me[5],k(s),g(n.player,i,a),await u(s,!0);break;case o.Teleport:n.teleports++,k(s),g(n.player,i,a),u(s,!0);break;case o.Key:ie(),n.keys++,g(n.player,i,a),await u(s,!0);break;case o.Door:n.keys<1?(R(Math.random()*129+30,150,100),await u(s)):(gi(),n.keys--,k(s),g(n.player,i,a),await u("The Door opens!  (One of your Keys is used.)"));break;case o.Wall:re(),k(s),await u(s,!0);break;case o.River:k(s),await u(s,!0);break;case o.SpeedTime:n.T[4]=0,n.T[6]=me[6],k(s),g(n.player,i,a),await u(s,!0);break;case o.Trap:k(s),g(n.player,i,a),await u(s,!0),await bt();break;case o.Power:n.whipPower++,k(s),g(n.player,i,a),await u(s,!0);break;case o.Tree:case o.Forest:k(s),await qe(),await u(s,!0);break;case o.Bomb:{g(n.player,i,a);const p=4,f=Math.max(n.player.x-p,ue),w=Math.min(n.player.x+p,se),O=Math.max(n.player.y-p,pe),b=Math.min(n.player.y+p,ce);for(let I=f;I<=w;I++)for(let q=O;q<=b;q++){const fe=((c=(M=n.PF)==null?void 0:M[I])==null?void 0:c[q])??o.Floor;ei.includes(fe)&&(fe>=1&&fe<=4&&(k(fe),await _e(I,q)),n.PF[I][q]=o.Floor)}await u(s,!0);break}case o.Lava:n.gems-=10,k(s),g(n.player,i,a),await u(s,!0);break;case o.Pit:g(n.player,i,a),n.gems=-1,await u(s);break;case o.Tome:n.PF[31][6]=o.Stairs,Y(31,6,o.Stairs),k(s),await u(s),await u("Congratulations, Adventurer, you finally did it!!!");break;case o.Nugget:ie(),g(n.player,i,a),k(s),await u(s,!0);break;case o.Freeze:n.T[7]=me[7],g(n.player,i,a),await u(s,!0);break;case o.Tunnel:g(n.player,i,a),await u(s,!0);break;case o.Quake:g(n.player,i,a);for(let p=0;p<2500;p++)R(v.getUniformInt(0,p),5,100),p%25===0&&await P();await P(50);for(let p=0;p<50;p++){do{const f=v.getUniformInt(0,C),w=v.getUniformInt(0,D),O=((y=(h=n.PF)==null?void 0:h[f])==null?void 0:y[w])??o.Floor;if(ti.includes(O)){n.PF[f][w]=o.Rock,Y(f,w,o.Rock);break}}while(Math.random()>.01);for(let f=0;f<50;f++)R(v.getUniformInt(0,200),50,100);await P(50)}for(let p=2500;p>50;p--)R(v.getUniformInt(0,p),5,100),p%25===0&&await P();await u(s,!0);break;case o.IWall:re(),n.PF[i][a]=o.Wall,Y(i,a),await u(s,!0);break;case o.IBlock:re(),n.PF[i][a]=o.Block,Y(i,a),await u(s,!0);break;case o.IDoor:re(),n.PF[i][a]=o.Door,Y(i,a),await u(s,!0);break;case o.Zap:{g(n.player,i,a);let p=0,f=0;for(;p<500&&f<40;){p++;const w=v.getUniformInt(0,n.entities.length),O=n.entities[w];!O||O.x===-1||O.y===-1||(await _e(O.x,O.y),await P(20),f++)}n.score+=Math.floor(f/3+2),N(),B(),await u(s,!0);break}case o.Create:case o.Generator:k(s),g(n.player,i,a),await u(s,!0);break;case o.MBlock:k(s),await u(s,!0);break;case o.ShowGems:g(n.player,i,a),await u(s);break;case o.Tablet:g(n.player,i,a),ie(),k(s),await u(s,!0),await ga();break;case o.BlockSpell:{g(n.player,i,a);for(let p=0;p<=C;p++)for(let f=0;f<=D;f++)if(n.PF[p][f]===o.ZBlock){R(200,60,100);for(let w=20;w>0;w--)Y(p,f,o.Block,v.getUniformInt(0,15)),await P(3);n.PF[p][f]=o.Floor,Y(p,f)}else n.PF[p][f]===o.BlockSpell&&(n.PF[p][f]=o.Block,Y(p,f));await u(s,!0);break}case o.Chance:{k(s);const p=v.getUniformInt(14,18);n.gems+=p,g(n.player,i,a),await u(`You found a Pouch containing ${p} Gems!`);break}case o.Statue:g(n.player,i,a),await u(s);break;case o.WallVanish:g(n.player,i,a),await u(s);break;case o.K:case o.R:case o.O:case o.Z:g(n.player,i,a);break;case o.OWall1:case o.OWall2:case o.OWall3:re(),await u(o.OWall1,!0);break;case o.OSpell1:case o.OSpell2:case o.OSpell3:{g(n.player,i,a);let p=o.OWall1;s===o.OSpell2&&(p=o.OWall2),s===o.OSpell3&&(p=o.OWall3);for(let f=0;f<=C;f++)for(let w=0;w<=D;w++)if((((F=(W=n.PF)==null?void 0:W[f])==null?void 0:F[w])??o.Floor)===p){for(let b=60;b>0;b--)Y(f,w,o.Wall,v.getUniformInt(0,14)),R(b*40,5,10),b%5===0&&await P(1);Y(f,w,o.Wall),n.PF[f][w]=o.Floor,Y(f,w)}await u(o.OSpell1,!0);break}case o.CSpell1:case o.CSpell2:case o.CSpell3:g(n.player,i,a),await u(o.CSpell1,!0);break;case o.Rock:{let p=!1;const f=n.player.x+e*2,w=n.player.y+t*2;if((f<0||f>C||w<0||w>D)&&(p=!0),!p)switch(((_=(S=n.PF)==null?void 0:S[f])==null?void 0:_[w])??o.Floor){case o.Floor:p=!1,await Qe(),n.PF[f][w]=o.Rock,g(n.player,i,a),N(),await u(o.Rock,!0);break;case o.Stairs:p=!1,await Qe(),g(n.player,i,a),N(),await u(o.Rock,!0);break;default:p=!1;break}p&&await qe();break}case o.EWall:k(s),n.gems--,wi(),await u(o.EWall,!0);break;case o.CWall1:case o.CWall2:case o.CWall3:g(n.player,i,a);break;case o.Trap2:case o.Trap3:case o.Trap4:case o.Trap5:case o.Trap6:case o.Trap7:case o.Trap8:case o.Trap9:case o.Trap10:case o.Trap11:case o.Trap12:case o.Trap13:g(n.player,i,a);break;case o.TBlind:case o.TBlock:case o.TGem:case o.TGold:case o.TRock:case o.TTree:case o.TWhip:g(n.player,i,a);break;case o.Rope:g(n.player,i,a),await u(o.Rope,!0);break;case o.Message:break;case o.ShootRight:break;case o.ShootLeft:break;case o.DropRope:case o.DropRope2:case o.DropRope3:case o.DropRope4:case o.DropRope5:g(n.player,i,a);break;case o.Amulet:g(n.player,i,a),await Ma();break}}async function Ma(){await ie();for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await R(e*e*t,t+1,100);k(o.Amulet),await u("You have found the Amulet of Yendor -- 25,000 points!"),await u("It seems that Kroz and Rogue share the same underground!)"),await u("Your quest for the treasure of Kroz must still continue...")}async function _e(e,t){var a,s;const i=((s=(a=n.PF)==null?void 0:a[e])==null?void 0:s[t])??o.Floor;if(n.PF[e][t]=o.Floor,i===o.Slow||i===o.Medium||i===o.Fast)for(let r=0;r<n.entities.length;r++){const X=n.entities[r];X.x===e&&X.y===t&&await X.kill()}N()}function g(e,t,i){const a=e.x,s=e.y;e.move(t,i),n.PF[a][s]=o.Floor,n.PF[t][i]=e.type,N()}async function ua(){const e=n.player.x,t=n.player.y;R(70,50*8,100),t>0&&e>0&&await K(e-1,t-1,"\\"),e>0&&await K(e-1,t,"-"),t<D&&e>0&&await K(e-1,t+1,"/"),t<D&&await K(e,t+1,"❘"),t<D&&e<C&&await K(e+1,t+1,"\\"),e<C&&await K(e+1,t,"-"),t>0&&e<C&&await K(e+1,t-1,"/"),t>0&&await K(e,t-1,"❘")}async function _t(){for(let e=0;e<80;e++)Y(n.player.x,n.player.y,o.Player,v.getUniformInt(0,15),v.getUniformInt(0,8)),await P(1),R(e/2,1e3,30)}async function bt(){var e,t,i,a;await _t(),n.PF[n.player.x][n.player.y]=o.Floor,Y(n.player.x,n.player.y);for(let s=0;s<700;s++){const r=v.getUniformInt(0,C),X=v.getUniformInt(0,D),M=((t=(e=n.PF)==null?void 0:e[r])==null?void 0:t[X])??o.Floor;ii.indexOf(M)>-1&&(Y(r,X,"☺",v.getUniformInt(0,15),v.getUniformInt(0,7)),await R(20,10,100),Y(r,X,M))}for(;;){const s=v.getUniformInt(0,C),r=v.getUniformInt(0,D);if((((a=(i=n.PF)==null?void 0:i[s])==null?void 0:a[r])??o.Floor)===o.Floor){n.PF[s][r]=o.Player,n.player.x=s,n.player.y=r,N();break}}}function N(){for(let t=0;t<n.PF.length;t++)for(let i=0;i<n.PF[t].length;i++){const a=n.PF[t][i]||o.Floor;a!==o.Player&&(a===o.Slow||a===o.Medium||a===o.Fast||Y(t,i,n.PF[t][i]||o.Floor))}const e=$[o.Floor][1];for(let t=0;t<n.entities.length;t++){const i=n.entities[t];i.x===-1||i.y===-1||Y(i.x,i.y,i.getChar(),$[i.type][0],e)}Y(n.player.x,n.player.y,n.player.getChar(),$[n.player.type][0],e)}function Y(e,t,i=o.Floor,a,s){var X,M;let r;switch(typeof i=="number"?(r=be[i]??i??be[o.Floor],a=a??((X=$[i])==null?void 0:X[0])??$[o.Floor][0],s=s??((M=$[i])==null?void 0:M[1])??$[o.Floor][1]):i>="a"&&i<="z"?(r=i.toUpperCase(),a=a??l.HighIntensityWhite,s=s??l.Brown):r=i,i){case o.Stairs:a=typeof a=="number"&&!n.paused?a|16:a;break}Xe(e+ue,t+pe,r,a,s)}async function K(e,t,i){var s,r;const a=((r=(s=n.PF)==null?void 0:s[e])==null?void 0:r[t])??o.Floor;switch(si(e+ue,t+pe,i,U[v.getUniformInt(0,15)]),a){case o.Slow:case o.Medium:case o.Fast:_e(e,t),k(a);break;case o.Block:case o.Forest:case o.Tree:case o.Message:{const X=n.whipPower;6*Math.random()<X?(R(130,50),n.PF[e][t]=o.Floor):(R(130,25),R(90,50));break}case o.Invisible:case o.SpeedTime:case o.Trap:case o.Power:case o.Generator:case o.K:case o.R:case o.O:case o.Z:n.PF[e][t]=o.Floor,R(400,50);break;case o.IBlock:case o.IWall:case o.IDoor:case o.Quake:case o.Trap2:case o.Trap3:case o.Trap4:case o.ShowGems:case o.BlockSpell:case o.Trap5:case o.Trap6:case o.Trap7:case o.Trap8:case o.Trap9:case o.Trap10:case o.Trap11:case o.Trap12:case o.Trap13:case o.Stop:n.PF[e][t]=o.Floor;break;case o.Rock:30*Math.random()<n.whipPower?(R(130,50),n.PF[e][t]=o.Floor):(R(130,25),R(90,50));break;case o.MBlock:case o.ZBlock:case o.GBlock:{6*Math.random()<n.whipPower?(R(130,50),n.PF[e][t]=o.Floor):(R(130,25),R(90,50));break}case o.Wall:case o.Statue:}B(),await P(10)}function k(e){switch(e){case o.Slow:case o.Medium:case o.Fast:n.score+=e;break;case o.Block:case o.ZBlock:case o.GBlock:case o.Wall:case o.River:case o.Tree:case o.Forest:case o.MBlock:case o.OWall1:case o.OWall2:case o.OWall3:case o.EWall:n.score>2&&(n.score-=2);break;case o.Whip:case o.SlowTime:case o.Bomb:n.score++;break;case o.Stairs:n.score+=n.level*5;break;case o.Chest:n.score+=10+Math.floor(n.level/2);break;case o.Gem:n.score+=Math.floor(n.level/2)+1;break;case o.Invisible:n.score+=25;break;case o.Nugget:n.score+=50;break;case o.Door:n.score+=10;break;case o.Teleport:case o.Freeze:n.score+=2;break;case o.SpeedTime:case o.Power:n.score+=5;break;case o.Trap:n.score>5&&(n.score-=5);break;case o.Lava:n.score>100&&(n.score+=100);break;case o.Tome:n.score+=5e3;break;case o.Tablet:n.score+=n.level+250;break;case o.Chance:n.score+=100;break;case o.Amulet:n.score+=2500;break}B()}async function pa(){z(se/2-7,0,"You have died.",l.Black,l.Red),await u("Press any key to continue.",!1),n.done=!0}function fa(){n.done=!0}async function da(){await u("Press any key to resume",!1)}async function ga(){switch(n.levelId){case"Debug":case"Lost30":await Je(),await u('"If goodness is in my heart, that which flows shall..."');for(let e=0;e<=C;e++)for(let t=0;t<=D;t++)n.PF[e][t]===o.River&&(await R(e*t,50,10),n.PF[e][t]=o.Nugget,Y(e,t,o.Nugget));await u('"...Turn to Gold!"');break;case"Lost42":await Je(),await u('"Barriers of water, like barriers in life, can always be..."');for(let e=0;e<=C;e++)for(let t=0;t<=D;t++)n.PF[e][t]===o.River&&(await R(e*t,50,10),n.PF[e][t]=o.Block,Y(e,t,o.Block));await u('"...Overcome!"');break}}async function Je(){await u("On the Ancient Tablet is a short Mantra, a prayer..."),await u("You take a deep breath and speak the words aloud...")}const Ne=E,et=E/4,tt=E/3,it=E/2,wa={type:o.Player,getSpeed:()=>1},ma={type:o.Slow,getSpeed:()=>n.T[H.SlowTime]>0?et/5:n.T[H.SpeedTime]>0?Ne:et},Ra={type:o.Medium,getSpeed:()=>n.T[H.SlowTime]>0?tt/5:n.T[H.SpeedTime]>0?Ne:tt},ya={type:o.Fast,getSpeed:()=>n.T[H.SlowTime]>0?it/5*E:n.T[H.SpeedTime]>0?Ne*E:it*E};async function St(){pi(),await yi(),Ge(),je(),await _t(),gt(),await u("Press any key to begin this level."),je(),await _a()}async function _a(){const e=new Kt.Speed;e.add(wa,!0),e.add(ma,!0),e.add(Ra,!0),e.add(ya,!0);const t=16*8;let i=0,a=0;const s=async r=>{if(n.gems<0){await pa(),at();return}if(n.done){at();return}if(i+=r-a,a=r,i>t){i%=t,await ra(),await ca();const X=e.next();await la(X.type)}gt(),requestAnimationFrame(s)};requestAnimationFrame(s)}function at(){ze(),oa(),St()}window.addEventListener("DOMContentLoaded",()=>{const e=oi();document.getElementById("app").appendChild(e),St()});
