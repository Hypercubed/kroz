var no=Object.defineProperty;var ao=(e,t,i)=>t in e?no(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var it=(e,t,i)=>ao(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();var an={exports:{}},ro=an.exports,ua;function oo(){return ua||(ua=1,function(e,t){(function(i,n){e.exports=n()})(ro,function(){var i=function(){function n(w){return f.appendChild(w.dom),w}function a(w){for(var R=0;R<f.children.length;R++)f.children[R].style.display=R===w?"block":"none";o=w}var o=0,f=document.createElement("div");f.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",f.addEventListener("click",function(w){w.preventDefault(),a(++o%f.children.length)},!1);var c=(performance||Date).now(),p=c,d=0,S=n(new i.Panel("FPS","#0ff","#002")),B=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var X=n(new i.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:f,addPanel:n,showPanel:a,begin:function(){c=(performance||Date).now()},end:function(){d++;var w=(performance||Date).now();if(B.update(w-c,200),w>p+1e3&&(S.update(1e3*d/(w-p),100),p=w,d=0,X)){var R=performance.memory;X.update(R.usedJSHeapSize/1048576,R.jsHeapSizeLimit/1048576)}return w},update:function(){c=this.end()},domElement:f,setMode:a}};return i.Panel=function(n,a,o){var f=1/0,c=0,p=Math.round,d=p(window.devicePixelRatio||1),S=80*d,B=48*d,X=3*d,w=2*d,R=3*d,L=15*d,C=74*d,J=30*d,q=document.createElement("canvas");q.width=S,q.height=B,q.style.cssText="width:80px;height:48px";var O=q.getContext("2d");return O.font="bold "+9*d+"px Helvetica,Arial,sans-serif",O.textBaseline="top",O.fillStyle=o,O.fillRect(0,0,S,B),O.fillStyle=a,O.fillText(n,X,w),O.fillRect(R,L,C,J),O.fillStyle=o,O.globalAlpha=.9,O.fillRect(R,L,C,J),{dom:q,update:function(b,M){f=Math.min(f,b),c=Math.max(c,b),O.fillStyle=o,O.globalAlpha=1,O.fillRect(0,0,S,L),O.fillStyle=a,O.fillText(p(b)+" "+n+" ("+p(f)+"-"+p(c)+")",X,w),O.drawImage(q,R+d,L,C-d,J,R,L,C-d,J),O.fillRect(R+C-d,L,d,J),O.fillStyle=o,O.globalAlpha=.9,O.fillRect(R+C-d,L,d,p((1-b/M)*J))}}},i})}(an)),an.exports}oo();const Nn=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},zt=e=>Nn(e,"error"),so=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,pi=()=>({action:()=>{},after:()=>{},before:()=>{}}),kt={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},lo={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){zt(kt.INVALID_VALUE_NUMBER);return}this[i]=n}else zt(kt.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,a,o,f){a&&o%2===f?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&o%2===f&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let a=0;a<this.buttons;a++)i.buttons[a].pressed===!0?(this.pressed[`button${a}`]||(this.pressed[`button${a}`]=!0,this.buttonActions[a].before()),this.buttonActions[a].action()):this.pressed[`button${a}`]&&(delete this.pressed[`button${a}`],this.buttonActions[a].after());if(i.axes){const a=i.axes.length%2;for(let o=0;o<this.axes*2;o++){const f=i.axes[o+a].toFixed(4),c=Math.floor(o/2);this.axeValues[c][o%2]=f,this.triggerDirectionalAction("right",c,f>=this.axeThreshold[0],o,0),this.triggerDirectionalAction("left",c,f<=-this.axeThreshold[0],o,0),this.triggerDirectionalAction("down",c,f>=this.axeThreshold[0],o,1),this.triggerDirectionalAction("up",c,f<=-this.axeThreshold[0],o,1)}}}},associateEvent:function(i,n,a){if(i.match(/^button\d+$/)){const o=parseInt(i.match(/^button(\d+)$/)[1]);o>=0&&o<this.buttons?this.buttonActions[o][a]=n:zt(kt.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][a]=n;else if(i==="select")this.buttonActions[8][a]=n;else if(i==="r1")this.buttonActions[5][a]=n;else if(i==="r2")this.buttonActions[7][a]=n;else if(i==="l1")this.buttonActions[4][a]=n;else if(i==="l2")this.buttonActions[6][a]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][a]=n:zt(kt.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const o=i.match(/^(up|down|left|right)(\d+)$/),f=o[1],c=parseInt(o[2]);c>=0&&c<this.axes?this.axesActions[c][f][a]=n:zt(kt.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const o=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][o][a]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=pi();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:pi(),left:pi(),right:pi(),up:pi()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},Kt={gamepads:{},axeThreshold:[1],isReady:so(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){zt(kt.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const n=this.getGamepads(),a=Object.keys(n);for(let o=0;o<a.length;o++)n[a[o]].set("axeThreshold",this.axeThreshold)}}else zt(kt.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys(Kt.gamepads);Kt.onBeforeCycle();for(let i=0;i<t.length;i++)Kt.gamepads[t[i]].checkStatus();Kt.onAfterCycle(),t.length>0&&e(Kt.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Nn(kt.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=lo.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Nn(kt.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:zt(kt.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:zt(kt.UNKNOWN_EVENT);break}return this}};Kt.init();const rn=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},co=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return fo(Math.atan2(n,i))},uo=(e,t,i)=>{const n={x:0,y:0};return i=Un(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n},Un=e=>e*(Math.PI/180),fo=e=>e*(180/Math.PI),ho=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,vn=new Map,fa=e=>{vn.has(e)&&clearTimeout(vn.get(e)),vn.set(e,setTimeout(e,100))},sn=(e,t,i)=>{const n=t.split(/[ ,]+/g);let a;for(let o=0;o<n.length;o+=1)a=n[o],e.addEventListener?e.addEventListener(a,i,!1):e.attachEvent&&e.attachEvent(a,i)},ha=(e,t,i)=>{const n=t.split(/[ ,]+/g);let a;for(let o=0;o<n.length;o+=1)a=n[o],e.removeEventListener?e.removeEventListener(a,i):e.detachEvent&&e.detachEvent(a,i)},dr=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),da=()=>{const e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},pa=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},jn=(e,t,i)=>{const n=pr(e);for(let a in n)if(n.hasOwnProperty(a))if(typeof t=="string")n[a]=t+" "+i;else{let o="";for(let f=0,c=t.length;f<c;f+=1)o+=t[f]+" "+i+", ";n[a]=o.slice(0,-2)}return n},po=(e,t)=>{const i=pr(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},pr=e=>{const t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},wn=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},go=(e,t)=>{const i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},Wn=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},mo=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});var _o="ontouchstart"in window,yo=!!window.PointerEvent,vo=!!window.MSPointerEvent,gi={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},li,Ni={};yo?li=gi.pointer:vo?li=gi.MSPointer:_o?(li=gi.touch,Ni=gi.mouse):li=gi.mouse;function Ut(){}Ut.prototype.on=function(e,t){var i=this,n=e.split(/[ ,]+/g),a;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)a=n[o],i._handlers_[a]=i._handlers_[a]||[],i._handlers_[a].push(t);return i};Ut.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Ut.prototype.trigger=function(e,t){var i=this,n=e.split(/[ ,]+/g),a;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)a=n[o],i._handlers_[a]&&i._handlers_[a].length&&i._handlers_[a].forEach(function(f){f.call(i,{type:a,target:i},t)})};Ut.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=go(t.options,e))};Ut.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},sn(e,li[t],i._domHandlers_[t]),Ni[t]&&sn(e,Ni[t],i._domHandlers_[t]),i};Ut.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},ha(e,li[t],i._domHandlers_[t]),Ni[t]&&ha(e,Ni[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};function st(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=st.id,st.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}st.prototype=new Ut;st.constructor=st;st.id=0;st.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};st.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=po("borderRadius","50%"),i=jn("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},wn(n.el,i),this.options.shape==="circle"&&wn(n.back,t),wn(n.front,t),this.applyStyles(n),this};st.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};st.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};st.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};st.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};st.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};st.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const i=t.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t};st.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",a={};a.front=jn("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(a),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};st.prototype.restCallback=function(){var e=this,t={};t.front=jn("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};st.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};st.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,n=Math.PI/2,a,o,f;if(t>i&&t<i*3&&!e.lockX?a="up":t>-i&&t<=i&&!e.lockY?a="left":t>-i*3&&t<=-i&&!e.lockX?a="down":e.lockY||(a="right"),e.lockY||(t>-n&&t<n?o="left":o="right"),e.lockX||(t>0?f="up":f="down"),e.force>this.options.threshold){var c={},p;for(p in this.direction)this.direction.hasOwnProperty(p)&&(c[p]=this.direction[p]);var d={};this.direction={x:o,y:f,angle:a},e.direction=this.direction;for(p in c)c[p]===this.direction[p]&&(d[p]=!0);if(d.x&&d.y&&d.angle)return e;(!d.x||!d.y)&&this.trigger("plain",e),d.x||this.trigger("plain:"+o,e),d.y||this.trigger("plain:"+f,e),d.angle||this.trigger("dir dir:"+a,e)}else this.resetDirection();return e};function tt(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=tt.id,tt.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}tt.prototype=new Ut;tt.constructor=tt;tt.id=0;tt.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var n=0,a=t.length;n<a;n+=1)if(t[n].identifier===i)return t[n];return!1}};tt.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};tt.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};tt.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,a={},o=i.options,f={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(e.x&&e.y)a={x:e.x-f.x,y:e.y-f.y};else if(e.top||e.right||e.bottom||e.left){var c=document.createElement("DIV");c.style.display="hidden",c.style.top=e.top,c.style.right=e.right,c.style.bottom=e.bottom,c.style.left=e.left,c.style.position="absolute",o.zone.appendChild(c);var p=c.getBoundingClientRect();o.zone.removeChild(c),a=e,e={x:p.left+n.x,y:p.top+n.y}}var d=new st(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(pa(d.ui.el,a),pa(d.ui.front,d.frontPosition)),i.nipples.push(d),i.trigger("added "+d.identifier+":added",d),i.manager.trigger("added "+d.identifier+":added",d),i.bindNipple(d),d};tt.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};tt.prototype.bindNipple=function(e){var t=this,i,n=function(a,o){i=a.type+" "+o.id+":"+a.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};tt.prototype.pressureFn=function(e,t,i){var n=this,a=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=e.force||e.pressure||e.webkitForce||0;o!==a&&(t.trigger("pressure",o),n.trigger("pressure "+t.identifier+":pressure",o),a=o)}).bind(n),100)};tt.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=dr(e),t.updateBox();var a=function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(f){if(Object.values(n.touches).findIndex(function(p){return p.identifier===f})<0){var c=[e[0]];c.identifier=f,t.processOnEnd(c)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))};return Wn(e,a),t.manager.bindDocument(),!1};tt.prototype.processOnStart=function(e){var t=this,i=t.options,n,a=t.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,f={x:e.pageX,y:e.pageY},c=t.getOrCreate(a,f);c.identifier!==a&&t.manager.removeIdentifier(c.identifier),c.identifier=a;var p=function(S){S.trigger("start",S),t.trigger("start "+S.id+":start",S),S.show(),o>0&&t.pressureFn(e,S,S.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(c))>=0&&t.idles.splice(n,1),t.actives.push(c),t.ids.push(c.identifier),i.mode!=="semi")p(c);else{var d=rn(f,c.position);if(d<=i.catchDistance)p(c);else{c.destroy(),t.processOnStart(e);return}}return c};tt.prototype.getOrCreate=function(e,t){var i=this,n=i.options,a;return/(semi|static)/.test(n.mode)?(a=i.idles[0],a?(i.idles.splice(0,1),a):n.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(a=i.createNipple(t,e),a)};tt.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),a=t.nipples.get(n),o=t.manager.scroll;if(!ho(e)){this.processOnEnd(e);return}if(!a){console.error("Found zombie joystick with ID "+n),t.manager.removeIdentifier(n);return}if(i.dynamicPage){var f=a.el.getBoundingClientRect();a.position={x:o.x+f.left,y:o.y+f.top}}a.identifier=n;var c=a.options.size/2,p={x:e.pageX,y:e.pageY};i.lockX&&(p.y=a.position.y),i.lockY&&(p.x=a.position.x);var d=rn(p,a.position),S=co(p,a.position),B=Un(S),X=d/c,w={distance:d,position:p},R,L;if(a.options.shape==="circle"?(R=Math.min(d,c),L=uo(a.position,R,S)):(L=mo(p,a.position,c),R=rn(L,a.position)),i.follow){if(d>c){let O=p.x-L.x,b=p.y-L.y;a.position.x+=O,a.position.y+=b,a.el.style.top=a.position.y-(t.box.top+o.y)+"px",a.el.style.left=a.position.x-(t.box.left+o.x)+"px",d=rn(p,a.position)}}else p=L,d=R;var C=p.x-a.position.x,J=p.y-a.position.y;a.frontPosition={x:C,y:J},i.dataOnly||(a.ui.front.style.transform="translate("+C+"px,"+J+"px)");var q={identifier:a.identifier,position:p,force:X,pressure:e.force||e.pressure||e.webkitForce||0,distance:d,angle:{radian:B,degree:S},vector:{x:C/c,y:-J/c},raw:w,instance:a,lockX:i.lockX,lockY:i.lockY};q=a.computeDirection(q),q.angle={radian:Un(180-S),degree:180-S},a.trigger("move",q),t.trigger("move "+a.id+":move",q)};tt.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),a=t.nipples.get(n),o=t.manager.removeIdentifier(a.identifier);a&&(i.dataOnly||a.hide(function(){i.mode==="dynamic"&&(a.trigger("removed",a),t.trigger("removed "+a.id+":removed",a),t.manager.trigger("removed "+a.id+":removed",a),a.destroy())}),clearInterval(t.pressureIntervals[a.identifier]),a.resetDirection(),a.trigger("end",a),t.trigger("end "+a.id+":end",a),t.ids.indexOf(a.identifier)>=0&&t.ids.splice(t.ids.indexOf(a.identifier),1),t.actives.indexOf(a)>=0&&t.actives.splice(t.actives.indexOf(a),1),/(semi|static)/.test(i.mode)?t.idles.push(a):t.nipples.indexOf(a)>=0&&t.nipples.splice(t.nipples.indexOf(a),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))};tt.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};tt.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};function lt(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=da(),t.config(e),t.prepareCollections();var i=function(){var a;t.collections.forEach(function(o){o.forEach(function(f){a=f.el.getBoundingClientRect(),f.position={x:t.scroll.x+a.left,y:t.scroll.y+a.top}})})};sn(window,"resize",function(){fa(i)});var n=function(){t.scroll=da()};return sn(window,"scroll",function(){fa(n)}),t.collections}lt.prototype=new Ut;lt.constructor=lt;lt.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return i=n.get(t),!i}),i}};lt.prototype.create=function(e){return this.createCollection(e)};lt.prototype.createCollection=function(e){var t=this,i=new tt(t,e);return t.bindCollection(i),t.collections.push(i),i};lt.prototype.bindCollection=function(e){var t=this,i,n=function(a,o){i=a.type+" "+o.id+":"+a.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};lt.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};lt.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};lt.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};lt.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};lt.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};lt.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};lt.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};lt.prototype.onAny=function(e,t){var i=this,n,a="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=dr(t);var o=function(c,p,d){d.ids.indexOf(p)>=0&&(d[a](c),c._found_=!0)},f=function(c){n=i.getIdentifier(c),Wn(i.collections,o.bind(null,c,n)),c._found_||i.removeIdentifier(n)};return Wn(t,f),!1};lt.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};lt.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};const ga=new lt,bn={create:function(e){return ga.create(e)},factory:ga},Ui="The Forgotton Adventures of Kroz",fn=80,Dt=25,Bt=1,hi=fn-16,Vt=1,Wi=Dt-2,Ke=63,Je=22,Yt=" ",Rt=1,wo=8;var mi={},_i={},ma;function bo(){if(ma)return _i;ma=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.MiniSignal=void 0;const e=Symbol("SIGNAL");function t(n){return typeof n=="object"&&e in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...a){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let o=this._head;if(o==null)return!1;for(this._dispatching=!0;o!=null;)o.fn(...a),o=o.next;return this._dispatching=!1,!0}add(a){if(typeof a!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:a}))}detach(a){if(!t(a))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(a[e]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const o=this._refMap.get(a);return o?(this._refMap.delete(a),this._disconnectNode(o),this._destroyNode(o),this):this}detachAll(){let a=this._head;if(a==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;a!=null;)this._destroyNode(a),a=a.next;return this}_destroyNode(a){a.fn=void 0,a.prev=void 0}_disconnectNode(a){a===this._head?(this._head=a.next,a.next==null&&(this._tail=void 0)):a===this._tail&&(this._tail=a.prev,this._tail!=null&&(this._tail.next=void 0)),a.prev!=null&&(a.prev.next=a.next),a.next!=null&&(a.next.prev=a.prev)}_addNode(a){return this._head==null?(this._head=a,this._tail=a):(this._tail.next=a,a.prev=this._tail,this._tail=a),a}_createRef(a){const o={[e]:this._symbol};return this._refMap.set(o,a),o}_getRef(a){return this._refMap.get(a)}}return _i.MiniSignal=i,_i}var _a;function To(){return _a||(_a=1,function(e){var t=mi.__createBinding||(Object.create?function(n,a,o,f){f===void 0&&(f=o);var c=Object.getOwnPropertyDescriptor(a,o);(!c||("get"in c?!a.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(n,f,c)}:function(n,a,o,f){f===void 0&&(f=o),n[f]=a[o]}),i=mi.__exportStar||function(n,a){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,n,o)};Object.defineProperty(e,"__esModule",{value:!0}),i(bo(),e)}(mi)),mi}var Xn=To();function Me(e=0){return new Promise(t=>{setTimeout(()=>t(),e)})}function ya(e,t,i){return Math.min(Math.max(e,t),i)}const xo={145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,159:402};function gr(e){const t=xo[e]||e;return String.fromCharCode(t)}function mr(e){if(Array.isArray(e)){const t={};for(const i of e)t[i.name]=i.value;return t}return e}const Gn=new Xn.MiniSignal,Ct=new Xn.MiniSignal,Pt=new Xn.MiniSignal;let ri=null;var je=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.NextLevelCheat=12]="NextLevelCheat",e[e.PrevLevel=13]="PrevLevel",e[e.Teleport=14]="Teleport",e[e.ResetFound=15]="ResetFound",e[e.HideFound=16]="HideFound",e[e.Pause=17]="Pause",e[e.Quit=18]="Quit",e[e.Save=19]="Save",e[e.Restore=20]="Restore",e[e.SlowerClock=21]="SlowerClock",e[e.FasterClock=22]="FasterClock",e))(je||{});const It={},dt={},hn={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:14,T:14,")":10,"+":15,"-":16,"(":12,PageDown:null,PageUp:null,p:17,P:17,Escape:18,s:19,S:19,r:20,R:20,F11:21,F12:22},vt={button0:"w",button1:"t",button4:null,button5:null,button8:"s",button9:"p",button16:"Escape",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",button12:"ArrowUp",button13:"ArrowDown",button14:"ArrowLeft",button15:"ArrowRight"};function So(){ri||Kt.on("connect",e=>{if(!ri){ri=e,ri.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(vt))i&&(ri.before(t,()=>Ct.dispatch(i)),ri.after(t,()=>Pt.dispatch(i)))}})}let Tn=null,xn=null,Sn=null;const ko="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;function Eo(){Tn||!ko||(document.querySelectorAll(".touch_zone").forEach(e=>{e.style.display="block"}),Tn=bn.create({zone:document.querySelector(".touch_zone--axis"),mode:"dynamic",threshold:.5,dynamicPage:!0,position:{left:"50px",bottom:"50px"},restOpacity:.3}),Tn.on("move end",(e,t)=>{if(t.force<.5)return;const i=.3,{x:n,y:a}=t.vector||{x:0,y:0};n>i&&!Vi(3)?Ct.dispatch(vt.right):n<-i&&!Vi(4)?Ct.dispatch(vt.left):Math.abs(n)<=i&&(Pt.dispatch(vt.right),Pt.dispatch(vt.left)),a>i&&!Vi(1)?Ct.dispatch(vt.up):a<-i&&!Vi(2)?Ct.dispatch(vt.down):Math.abs(a)<=i&&(Pt.dispatch(vt.up),Pt.dispatch(vt.down))}),xn=bn.create({zone:document.querySelector(".touch_zone--button-0"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{left:"50px",bottom:"50px"}}),xn.on("start",()=>Ct.dispatch(vt.button0)),xn.on("end",()=>Pt.dispatch(vt.button0)),Sn=bn.create({zone:document.querySelector(".touch_zone--button-1"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{right:"50px",top:"50px"}}),Sn.on("start",()=>Ct.dispatch(vt.button1)),Sn.on("end",()=>Pt.dispatch(vt.button1)))}function Oo(e){e.repeat||(hn[e.key]&&e.preventDefault(),Ct.dispatch(e.key))}function Ao(e){hn[e.key]&&e.preventDefault(),Pt.dispatch(e.key)}Ct.add(e=>{It[e]=3;const t=hn[e];t&&(dt[t]=3)});Pt.add(e=>{(It[e]||0)&3&&Gn.dispatch(e),It[e]&=-2,It[e]|=4;const t=hn[e];t&&(dt[t]&=-2,dt[t]|=4)});function Ro(){So(),Eo(),window.addEventListener("keydown",Oo),window.addEventListener("keyup",Ao)}function Ki(){for(const e in It)It[e]&&(It[e]=0)}function Kn(){for(const e in dt)Object.prototype.hasOwnProperty.call(dt,e)&&delete dt[e];for(const e in It)Object.prototype.hasOwnProperty.call(It,e)&&delete It[e]}function _r(){for(const e in dt){const t=e;if(!dt[t])continue;const i=!!(dt[t]&2);dt[t]&=-15,i&&(dt[t]|=8)}}function Vi(e){return!!(dt[e]&1)}function At(e){return!!(dt[e]&3)&&!(dt[e]&8)}function bt(e){return!!(dt[e]&4)}async function ci(){return Kn(),new Promise(e=>{const t=Gn.add(i=>{Gn.detach(t),e(i)})})}async function Vn(e,t=50){const i=ci();do await(e==null?void 0:e());while(!await Promise.race([i,Me(t)]));return i}class Jn{getContainer(){return null}setOptions(t){this._options=t}}class Qn extends Jn{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const n=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let n=this._ctx.canvas,a=n.getBoundingClientRect();return t-=a.left,i-=a.top,t*=n.width/a.width,i*=n.height/a.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function dn(e,t){return(e%t+t)%t}class yr extends Qn{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[n,a,o,f,c]=t,p=[(n+1)*this._spacingX,a*this._spacingY+this._hexSize];if(this._options.transpose&&p.reverse(),i&&(this._ctx.fillStyle=c,this._fill(p[0],p[1])),!o)return;this._ctx.fillStyle=f;let d=[].concat(o);for(let S=0;S<d.length;S++)this._ctx.fillText(d[S],p[0],Math.ceil(p[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=Math.floor(t/this._spacingX)-1,a=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,a]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,a=i/(2+1.5*(this._options.height-1)),o=Math.min(n,a),f=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let c=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=f;let p=c/100;o=Math.floor(o)+1;let d=2*o/(this._options.spacing*(1+p/Math.sqrt(3)));return Math.ceil(d)-1}_normalizedEventToPosition(t,i){let n;this._options.transpose?(t+=i,i=t-i,t-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let a=n/this._options.height;return i=Math.floor(i/a),dn(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let n=this._hexSize,a=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-n+a,i),o.lineTo(t-n/2+a,i+this._spacingX-a),o.lineTo(t+n/2-a,i+this._spacingX-a),o.lineTo(t+n-a,i),o.lineTo(t+n/2-a,i-this._spacingX+a),o.lineTo(t-n/2+a,i-this._spacingX+a),o.lineTo(t-n+a,i)):(o.moveTo(t,i-n+a),o.lineTo(t+this._spacingX-a,i-n/2+a),o.lineTo(t+this._spacingX-a,i+n/2-a),o.lineTo(t,i+n-a),o.lineTo(t-this._spacingX+a,i+n/2-a),o.lineTo(t-this._spacingX+a,i-n/2+a),o.lineTo(t,i-n+a)),o.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,a;t.transpose?(n="height",a="width"):(n="width",a="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[a]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class qi extends Qn{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){qi.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,n,a,o,f]=t,c=""+a+o+f,p;if(c in this._canvasCache)p=this._canvasCache[c];else{let d=this._options.border;p=document.createElement("canvas");let S=p.getContext("2d");if(p.width=this._spacingX,p.height=this._spacingY,S.fillStyle=f,S.fillRect(d,d,p.width-d,p.height-d),a){S.fillStyle=o,S.font=this._ctx.font,S.textAlign="center",S.textBaseline="middle";let B=[].concat(a);for(let X=0;X<B.length;X++)S.fillText(B[X],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[c]=p}this._ctx.drawImage(p,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,i){let[n,a,o,f,c]=t;if(i){let d=this._options.border;this._ctx.fillStyle=c,this._ctx.fillRect(n*this._spacingX+d,a*this._spacingY+d,this._spacingX-d,this._spacingY-d)}if(!o)return;this._ctx.fillStyle=f;let p=[].concat(o);for(let d=0;d<p.length;d++)this._ctx.fillText(p[d],(n+.5)*this._spacingX,Math.ceil((a+.5)*this._spacingY))}computeSize(t,i){let n=Math.floor(t/this._spacingX),a=Math.floor(i/this._spacingY);return[n,a]}computeFontSize(t,i){let n=Math.floor(t/this._options.width),a=Math.floor(i/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let f=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let p=f/100*a/n;return p>1&&(a=Math.floor(a/p)),Math.floor(a/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}qi.cache=!1;class vr extends Qn{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[n,a,o,f,c]=t,p=this._options.tileWidth,d=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*p,a*d,p,d):(this._ctx.fillStyle=c,this._ctx.fillRect(n*p,a*d,p,d))),!o)return;let S=[].concat(o),B=[].concat(f),X=[].concat(c);for(let w=0;w<S.length;w++){let R=this._options.tileMap[S[w]];if(!R)throw new Error(`Char "${S[w]}" not found in tileMap`);if(this._options.tileColorize){let L=this._colorCanvas,C=L.getContext("2d");C.globalCompositeOperation="source-over",C.clearRect(0,0,p,d);let J=B[w],q=X[w];C.drawImage(this._options.tileSet,R[0],R[1],p,d,0,0,p,d),J!="transparent"&&(C.fillStyle=J,C.globalCompositeOperation="source-atop",C.fillRect(0,0,p,d)),q!="transparent"&&(C.fillStyle=q,C.globalCompositeOperation="destination-over",C.fillRect(0,0,p,d)),this._ctx.drawImage(L,n*p,a*d,p,d)}else this._ctx.drawImage(this._options.tileSet,R[0],R[1],p,d,n*p,a*d,p,d)}}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),a=Math.floor(i/this._options.tileHeight);return[n,a]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}const Ji=23283064365386963e-26;class ea{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*Ji,t=t*69069+1>>>0,this._s1=t*Ji,t=t*69069+1>>>0,this._s2=t*Ji,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*Ji;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let n=Math.max(t,i),a=Math.min(t,i);return Math.floor(this.getUniform()*(n-a+1))+a}getNormal(t=0,i=1){let n,a,o;do n=2*this.getUniform()-1,a=2*this.getUniform()-1,o=n*n+a*a;while(o>1||o==0);let f=n*Math.sqrt(-2*Math.log(o)/o);return t+f*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],n=t.slice();for(;n.length;){let a=n.indexOf(this.getItem(n));i.push(n.splice(a,1)[0])}return i}getWeightedValue(t){let i=0;for(let f in t)i+=t[f];let n=this.getUniform()*i,a,o=0;for(a in t)if(o+=t[a],n<o)return a;return a}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new ea().setState(this.getState())}}const Q=new ea().setSeed(Date.now());function wr(e){let t,i;if(e in kn)t=kn[e];else{if(e.charAt(0)=="#"){let a=(e.match(/[0-9a-f]/gi)||[]).map(o=>parseInt(o,16));if(a.length==3)t=a.map(o=>o*17);else{for(let o=0;o<3;o++)a[o+1]+=16*a[o],a.splice(o,1);t=a}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):t=[0,0,0];kn[e]=t}return t.slice()}const kn={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class br extends Jn{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const n=this._gl,a=this._options;let[o,f,c,p,d]=t,S=n.canvas.height-(f+1)*a.tileHeight;if(n.scissor(o*a.tileWidth,S,a.tileWidth,a.tileHeight),i&&(a.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...Qi(d)),n.clear(n.COLOR_BUFFER_BIT)),!c)return;let B=[].concat(c),X=[].concat(d),w=[].concat(p);n.uniform2fv(this._uniforms.targetPosRel,[o,f]);for(let R=0;R<B.length;R++){let L=this._options.tileMap[B[R]];if(!L)throw new Error(`Char "${B[R]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,a.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,L),a.tileColorize&&(n.uniform4fv(this._uniforms.tint,Qi(w[R])),n.uniform4fv(this._uniforms.bg,Qi(X[R]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...Qi(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),a=Math.floor(i/this._options.tileHeight);return[n,a]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let n=this._gl.canvas,a=n.getBoundingClientRect();return t-=a.left,i-=a.top,t*=n.width/a.width,i*=n.height/a.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=Co(t,Lo,Mo);return t.useProgram(i),Po(t),Io.forEach(n=>this._uniforms[n]=t.getUniformLocation(i,n)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){zo(this._gl,t)}}const Io=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],Lo=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),Mo=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function Co(e,t,i){const n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"");const a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,i),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(a)||"");const o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o)||"");return o}function Po(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function zo(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let En={};function Qi(e){if(!(e in En)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=wr(e).map(i=>i/255),t.push(1);En[e]=t}return En[e]}function Do(e){return`\x1B[0;48;5;${Hn(e)}m\x1B[2J`}function Fo(e,t){return`\x1B[0;38;5;${Hn(e)};48;5;${Hn(t)}m`}function Bo(e,t){return`\x1B[${t+1};${e+1}H`}function Hn(e){const n=.0234375;let a=wr(e),o=Math.floor(a[0]*n),f=Math.floor(a[1]*n),c=Math.floor(a[2]*n);return o*36+f*6+c*1+16}class Tr extends Jn{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],n=this.computeSize();this._offset=n.map((a,o)=>Math.floor((a-i[o])/2))}clear(){process.stdout.write(Do(this._options.bg))}draw(t,i){let[n,a,o,f,c]=t,p=this._offset[0]+n,d=this._offset[1]+a,S=this.computeSize();if(p<0||p>=S[0]||d<0||d>=S[1]||((p!==this._cursor[0]||d!==this._cursor[1])&&(process.stdout.write(Bo(p,d)),this._cursor[0]=p,this._cursor[1]=d),i&&(o||(o=" ")),!o))return;let B=Fo(f,c);if(B!==this._lastColor&&(process.stdout.write(B),this._lastColor=B),o!="	"){let X=[].concat(o);process.stdout.write(X[0])}this._cursor[0]++,this._cursor[0]>=S[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const No=/%([bc]){([^}]*)}/g,di=0,Bi=1,xr=2,Sr=3;function Uo(e,t){let i=[],n=0;e.replace(No,function(o,f,c,p){let d=e.substring(n,p);return d.length&&i.push({type:di,value:d}),i.push({type:f=="c"?xr:Sr,value:c.trim()}),n=p+o.length,""});let a=e.substring(n);return a.length&&i.push({type:di,value:a}),Wo(i,t)}function Wo(e,t){t||(t=1/0);let i=0,n=0,a=-1;for(;i<e.length;){let f=e[i];if(f.type==Bi&&(n=0,a=-1),f.type!=di){i++;continue}for(;n==0&&f.value.charAt(0)==" ";)f.value=f.value.substring(1);let c=f.value.indexOf(`
`);if(c!=-1){f.value=en(e,i,c,!0);let p=f.value.split("");for(;p.length&&p[p.length-1]==" ";)p.pop();f.value=p.join("")}if(!f.value.length){e.splice(i,1);continue}if(n+f.value.length>t){let p=-1;for(;;){let d=f.value.indexOf(" ",p+1);if(d==-1||n+d>t)break;p=d}if(p!=-1)f.value=en(e,i,p,!0);else if(a!=-1){let d=e[a],S=d.value.lastIndexOf(" ");d.value=en(e,a,S,!0),i=a}else f.value=en(e,i,t-n,!1)}else n+=f.value.length,f.value.indexOf(" ")!=-1&&(a=i);i++}e.push({type:Bi});let o=null;for(let f=0;f<e.length;f++){let c=e[f];switch(c.type){case di:o=c;break;case Bi:if(o){let p=o.value.split("");for(;p.length&&p[p.length-1]==" ";)p.pop();o.value=p.join("")}o=null;break}}return e.pop(),e}function en(e,t,i,n){let a={type:Bi},o={type:di,value:e[t].value.substring(i+(n?1:0))};return e.splice(t+1,0,a,o),e[t].value.substring(0,i)}let Go=80,Ho=25;const Yo={hex:yr,rect:qi,tile:vr,"tile-gl":br,term:Tr},qo={width:Go,height:Ho,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class Jt{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},qo,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,n){let a=[this._options.bg,this._options.fg];this.draw(t,i,null,null,a[n%a.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=Yo[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let n=Math.floor(t/this._options.width),a=Math.floor(i/this._options.height);return[n,a]}eventToPosition(t){let i,n;return"touches"in t?(i=t.touches[0].clientX,n=t.touches[0].clientY):(i=t.clientX,n=t.clientY),this._backend.eventToPosition(i,n)}draw(t,i,n,a,o){a||(a=this._options.fg),o||(o=this._options.bg);let f=`${t},${i}`;this._data[f]=[t,i,n,a,o],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[f]=!0)}drawOver(t,i,n,a,o){const f=`${t},${i}`,c=this._data[f];c?(c[2]=n||c[2],c[3]=a||c[3],c[4]=o||c[4]):this.draw(t,i,n,a,o)}drawText(t,i,n,a){let o=null,f=null,c=t,p=i,d=1;a||(a=this._options.width-t);let S=Uo(n,a);for(;S.length;){let B=S.shift();switch(B.type){case di:let X=!1,w=!1,R=!1,L=!1;for(let C=0;C<B.value.length;C++){let J=B.value.charCodeAt(C),q=B.value.charAt(C);if(this._options.layout==="term"){let O=J>>8;if(O===17||O>=46&&O<=159||O>=172&&O<=215||J>=43360&&J<=43391){this.draw(c+0,p,q,o,f),this.draw(c+1,p,"	",o,f),c+=2;continue}}R=J>65280&&J<65377||J>65500&&J<65512||J>65518,X=q.charCodeAt(0)==32||q.charCodeAt(0)==12288,L&&!R&&!X&&c++,R&&!w&&c++,this.draw(c++,p,q,o,f),w=X,L=R}break;case xr:o=B.value||null;break;case Sr:f=B.value||null;break;case Bi:c=t,p++,d++;break}}return d}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let n=this._data[t];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}Jt.Rect=qi;Jt.Hex=yr;Jt.Tile=vr;Jt.TileGL=br;Jt.Term=Tr;var z=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(z||{});const Ot={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};let at;function Zo(){Jt.Rect.cache=!0,at=new Jt({width:fn,height:Dt,fontFamily:"IBM_VGA, monospace",bg:Ot[z.Black],fg:Ot[z.White],fontSize:64});const e=at.drawOver;at.drawOver=function(t,i,n,a,o){e.call(this,t,i,n,a,o),this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[`${t},${i}`]=!0)}}function pt(e,t,i=at.getOptions().fg,n=at.getOptions().bg){const a=Math.floor((fn-t.length)/2);Ae(a,e,t,i,n)}function ni(e=at.getOptions().bg){typeof e=="number"&&(e=Ot[e]),at.setOptions({bg:e}),at.clear()}function ta(e,t=at.getOptions().bg){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=Ot[e]),typeof t=="number"&&(t=Ot[t]),[e,t]}function Gt(e,t,i,n=at.getOptions().fg,a=at.getOptions().bg){[n,a]=ta(n,a),at.draw(e,t,i,n,a)}function $o(e,t,i,n=at.getOptions().fg,a=at.getOptions().bg){[n,a]=ta(n,a),at.drawOver(e,t,i,n,a)}function Ae(e,t,i,n=at.getOptions().fg,a=at.getOptions().bg){return typeof n=="number"&&n>15&&(n=Date.now()%500<250?n:a),typeof a=="number"&&(a=Ot[a%16]),typeof n=="number"&&(n=Ot[n%16]),at.drawText(e,t,`%c{${n}}%b{${a}}`+i)}function jo(){return at||Zo(),at.getContainer()}const pn={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((n,a)=>t.getChannelData(a).set(n)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,n=0,a=0,o=.1,f=0,c=1,p=0,d=0,S=0,B=0,X=0,w=0,R=0,L=0,C=0,J=1,q=0,O=0,b=0){let M=Math.PI*2,Y=$e=>$e<0?-1:1,Z=this.sampleRate,ue=p*=500*M/Z/Z,fe=i*=(1+t*2*Math.random()-t)*M/Z,xe=[],we=0,se=0,ie=0,m=1,T=0,A=0,F=0,N,te,D=2,ne=M*Math.abs(b)*2/Z,re=Math.cos(ne),Se=Math.sin(ne)/2/D,be=1+Se,le=-2*re/be,he=(1-Se)/be,Ie=(1+Y(b)*re)/2/be,Ne=-(Y(b)+re)/be,pe=Ie,ke=0,ge=0,Te=0,Re=0;for(n=n*Z+9,q*=Z,a*=Z,o*=Z,C*=Z,d*=500*M/Z**3,R*=M/Z,S*=M/Z,B*=Z,X=X*Z|0,e*=this.volume,te=n+q+a+o+C|0;ie<te;xe[ie++]=F*e)++A%(L*100|0)||(F=f?f>1?f>2?f>3?Math.sin(we*we):Math.max(Math.min(Math.tan(we),1),-1):1-(2*we/M%2+2)%2:1-4*Math.abs(Math.round(we/M)-we/M):Math.sin(we),F=(X?1-O+O*Math.sin(M*ie/X):1)*Y(F)*Math.abs(F)**c*(ie<n?ie/n:ie<n+q?1-(ie-n)/q*(1-J):ie<n+q+a?J:ie<te-C?(te-ie-C)/o*J:0),F=C?F/2+(C>ie?0:(ie<te-C?1:(te-ie)/C)*xe[ie-C|0]/2/e):F,b&&(F=Re=pe*ke+Ne*(ke=ge)+Ie*(ge=F)-he*Te-le*(Te=Re))),N=(i+=p+=d)*Math.cos(R*se++),we+=N+N*w*Math.sin(ie**5),m&&++m>B&&(i+=S,fe+=S,m=0),X&&!(++T%X)&&(i=fe,p=ue,m=m||1);return xe},getNote:function(e=0,t=440){return t*2**(e/12)}};pn.volume=.005;function de(e,t,i=1){return pn.play(i,0,e,0,t/1e3,0),Me(t)}async function Qt(){for(let e=1;e<=65;e++)de(Q.getUniformInt(1e3,2e3),1);await Me(0)}async function Fi(){for(let e=150;e>=35;e--)await de(e,1)}async function va(){await de(400,120,5),await Me(10),await de(700,120,5),await Me(10)}async function fi(){for(let e=1;e<=23;e++)de(Q.getUniformInt(350,900),120);await Me(120);for(let e=1;e<=30;e++)de(Q.getUniformInt(150,200),50)}async function Xo(){for(let e=10;e<=90;e++)await de(e,15,100)}async function wa(){for(let e=150;e>35;e--)await de(e,16,50)}const Ko=pn.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function oi(){pn.playSamples(Ko)}async function ba(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=Q.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)de(Q.getUniformInt(0,4e3)+3e3,16,10)}else await Me(Q.getUniformInt(0,29))}async function Vo(){for(let e=10;e<45;e++)for(let t=1;t<13;t++)await de(e*e*t,t+1,100)}async function Jo(e){await de(200+200*e,25,100)}async function Qo(){await de(2e3,40,10)}async function es(){await de(Math.random()*129+30,150,100)}async function ts(){await de(70,50*8,100)}async function is(){for(let e=330;e>20;e--)de(90,10,.5)}async function ns(){await de(400,50)}async function as(){await de(130,50)}async function On(){de(130,25),await de(90,50)}async function rs(){await de(20,10,100)}async function os(){await de(300,10,10)}async function ss(){for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await de(e*e*t,t+1,100)}async function ls(){for(let e=70;e<=600;e++)de(e*2,3,10),e%10===0&&await Me(1)}async function cs(){await de(30,10,10),await Me(20)}async function us(){for(let e=0;e<2500;e++)de(Q.getUniformInt(0,e),5,100),e%25===0&&await Me()}async function fs(){for(let e=2500;e>50;e--)de(Q.getUniformInt(0,e),5,100),e%25===0&&await Me()}async function hs(){for(let e=0;e<50;e++)de(Q.getUniformInt(0,200),50,100);await Me(50)}async function ds(){await de(Q.getUniformInt(110,1310),7,100)}async function ps(){await de(200,60,100)}async function gs(){await de(600,20)}async function ms(){await de(90,10,10)}async function _s(){for(let e=130;e>5;e--)await de(e*8,16,100)}async function ys(){for(let e=20;e<8e3;e++)de(e,1,100);await Me(100)}async function vs(){for(let e=5;e<70;e++)de(e*8,1);await Me(50)}class Ta{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:n,timestamp:a})=>({key:i+t,value:n,timestamp:a}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const n=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(n)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let n=0;n<this.len();n++)t==this.heap[n].value&&(i=n);if(i===null)return!1;if(this.len()>1){let n=this.heap.pop();return n.value!=t&&(this.heap[i]=n,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const n=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=n}minNode(t){const i=t.filter(this.existNode.bind(this));let n=i[0];for(const a of i)this.lessThan(this.heap[a],this.heap[n])&&(n=a);return n}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),n=this.rightChildNode(t);if(!this.existNode(i))return;const a=this.minNode([t,i,n]);a!=t&&(this.swap(t,a),this.updateDown(a))}debugPrint(){console.log(this.heap)}}class ws{constructor(){this._time=0,this._events=new Ta}getTime(){return this._time}clear(){return this._events=new Ta,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:n}=i;return n}}remove(t){return this._events.remove(t)}}let ia=class{constructor(){this._queue=new ws,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),n=this._repeat.indexOf(t);return n!=-1&&this._repeat.splice(n,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class bs extends ia{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class Ts extends ia{add(t,i,n){return this._queue.add(t,n!==void 0?n:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}class xs extends ia{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,n){return this._queue.add(t,n||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}const Ss={Simple:bs,Speed:Ts,Action:xs},kr=Symbol("FollowsPlayer"),na=Symbol("isPlayer"),Er=Symbol("isMobile"),Or=Symbol("isGenerator"),ei=Symbol("isInvisible"),Gi=Symbol("isChanced");class qt{constructor(t){it(this,"ch");it(this,"fg");it(this,"bg");this.ch=t.ch??Yt,this.fg=t.fg??nt[u.Floor][0],this.bg=t.bg??nt[u.Floor][1]}}class rt{constructor(t={}){it(this,"replacement",u.Floor);it(this,"x");it(this,"y");this.x=t.x??0,this.y=t.y??0}moveTo(t,i){this.x=t,this.y=i}die(){this.x=-1,this.y=-1}isDead(){return this.x===-1||this.y===-1}}class ui{constructor(t){it(this,"set");this.set=new Set(t)}by(t){return this.set.has(t)}}class Ar{constructor(t){it(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class Rr{constructor(t){it(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class Hi{constructor(t){it(this,"damage");this.damage=t.damage||1}}class on{constructor(t){this.probability=t}}class Mt{constructor(t){it(this,"keys",0);it(this,"gems",0);it(this,"whips",0);it(this,"teleports",0);it(this,"whipPower",0);this.keys=(t==null?void 0:t.keys)||0,this.gems=(t==null?void 0:t.gems)||0,this.whips=(t==null?void 0:t.whips)||0,this.whipPower=(t==null?void 0:t.whipPower)||0,this.teleports=(t==null?void 0:t.teleports)||0}}class ln{constructor(t){this.frames=t}getFrame(){return this.frames[Q.getUniformInt(0,this.frames.length-1)]}}class Yn{constructor(t){this.type=t}}class gn{constructor(t){it(this,"_components",new Map);it(this,"_tags",new Set);this.type=t}add(t){return typeof t=="symbol"||typeof t=="string"?(this._tags.add(t),this):(this._components.set(t.constructor.name,t),this)}get(t){return this._components.get(t.name)}has(t){return typeof t=="symbol"||typeof t=="string"?this._tags.has(t):this._components.has(t.name)}remove(t){return typeof t=="symbol"||typeof t=="string"?this._tags.delete(t):this._components.delete(t.name)}}const ks=16,Es={export:{format:"lua",target:"kroz.lua"}},Os="../../tiled/ASCII.png",As=576,Rs=384,Is=0,Ls="Curses_1920x900",Ms=0,Cs=256,Ps="1.11.1",zs=36,Ds=JSON.parse('[{"id":32,"properties":[{"name":"Tile.bg","type":"string","value":"Black"},{"name":"Tile.ch","type":"string","value":" "},{"name":"Tile.fg","type":"string","value":"Black"},{"name":"name","type":"string","value":"Floor"}],"type":"0"},{"id":33,"properties":[{"name":"Tile.ch","type":"string","value":"■"},{"name":"Tile.fg","type":"string","value":"LightBlue"},{"name":"message","type":"string","value":"You found an Ancient Tablet of Wisdom...2,500 points!"},{"name":"name","type":"string","value":"Tablet"}],"type":"42"},{"id":34,"properties":[{"name":"Tile.ch","type":"string","value":"Z"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"message","type":"string","value":"Super Kroz Bonus -- 10,000 points!"},{"name":"name","type":"string","value":"Z"}],"type":"51"},{"id":35,"properties":[{"name":"Tile.bg","type":"string","value":"Brown"},{"name":"Tile.ch","type":"string","value":"█"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"message","type":"string","value":"A Solid Wall blocks your way."},{"name":"name","type":"string","value":"Wall"}],"type":"14"},{"id":36,"properties":[{"name":"name","type":"string","value":"Trap5"}],"type":"67"},{"id":37,"properties":[{"name":"Tile.ch","type":"string","value":"▲"},{"name":"Tile.fg","type":"string","value":"LightRed"},{"name":"description","type":"string","value":"Creature zap spell"},{"name":"message","type":"string","value":"A Creature Zap Spell!"},{"name":"name","type":"string","value":"Zap"}],"type":"34"},{"id":38,"properties":[{"name":"message","type":"string","value":"Yah Hoo! You discovered a Reveal Gems Scroll!"},{"name":"name","type":"string","value":"ShowGems"}],"type":"41"},{"id":40,"properties":[{"name":"name","type":"string","value":"Trap4"}],"type":"39"},{"id":41,"properties":[{"name":"name","type":"string","value":"Trap3"}],"type":"37"},{"id":42,"properties":[{"name":"Tile.ch","type":"string","value":"☼"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"message","type":"string","value":"You found a Gold Nugget...500 points!"},{"name":"name","type":"string","value":"Nugget"}],"type":"27"},{"id":43,"properties":[{"name":"Tile.ch","type":"string","value":"♦"},{"name":"Tile.fg","type":"string","value":"Blue"},{"name":"message","type":"string","value":"Gems give you both points and strength."},{"name":"name","type":"string","value":"Gem"}],"type":"9"},{"id":45,"properties":[{"name":"description","type":"string","value":"Stop space"},{"name":"name","type":"string","value":"Stop"}],"type":"32"},{"id":46,"properties":[{"name":"Tile.ch","type":"string","value":"∙"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"message","type":"string","value":"You activated a Teleport trap!"},{"name":"name","type":"string","value":"Trap"}],"type":"16"},{"id":47,"properties":[{"name":"Tile.bg","type":"string","value":"Green"},{"name":"Tile.ch","type":"string","value":"█"},{"name":"Tile.fg","type":"string","value":"Green"},{"name":"message","type":"string","value":"You cannot travel through forest terrain."},{"name":"name","type":"string","value":"Forest"}],"type":"19"},{"id":48,"properties":[{"name":"Tile.ch","type":"string","value":"O"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"message","type":"string","value":"You pushed a big Boulder!"},{"name":"name","type":"string","value":"Rock"}],"type":"65"},{"id":49,"properties":[{"name":"Attacks.damage","type":"int","value":1},{"name":"Movement.pace","type":"int","value":4},{"name":"Tile.ch","type":"string","value":"Ä"},{"name":"Tile.fg","type":"string","value":"LightRed"},{"name":"description","type":"string","value":"Red enemy"},{"name":"name","type":"string","value":"Slow"}],"type":"1"},{"id":50,"properties":[{"name":"Attacks.damage","type":"int","value":2},{"name":"Movement.pace","type":"int","value":3},{"name":"Tile.ch","type":"string","value":"Ö"},{"name":"Tile.fg","type":"string","value":"Green"},{"name":"description","type":"string","value":"Green enemy"},{"name":"name","type":"string","value":"Medium"}],"type":"2"},{"id":51,"properties":[{"name":"Attacks.damage","type":"int","value":3},{"name":"Movement.pace","type":"int","value":2},{"name":"Tile.ch","type":"string","value":"Ω"},{"name":"Tile.fg","type":"string","value":"LightBlue"},{"name":"description","type":"string","value":"Blue enemy"},{"name":"name","type":"string","value":"Fast"}],"type":"3"},{"id":52,"properties":[{"name":"Tile.bg","type":"string","value":"Brown"},{"name":"Tile.ch","type":"string","value":"█"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"message","type":"string","value":"A Solid Wall blocks your way."},{"name":"name","type":"string","value":"OWall1"}],"type":"52"},{"id":53,"properties":[{"name":"Tile.bg","type":"string","value":"Brown"},{"name":"Tile.ch","type":"string","value":"█"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"name","type":"string","value":"OWall2"}],"type":"53"},{"id":54,"properties":[{"name":"Tile.bg","type":"string","value":"White"},{"name":"Tile.ch","type":"string","value":"█"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"OWall3"}],"type":"54"},{"id":55,"properties":[{"name":"name","type":"string","value":"CWall1"}],"type":"55"},{"id":56,"properties":[{"name":"name","type":"string","value":"CWall2"}],"type":"56"},{"id":57,"properties":[{"name":"name","type":"string","value":"CWall3"}],"type":"57"},{"id":58,"properties":[{"name":"name","type":"string","value":"IWall"}],"type":"30"},{"id":59,"properties":[{"name":"message","type":"string","value":"An Invisible Crumbled Wall blocks your way."},{"name":"name","type":"string","value":"IBlock"}],"type":"29"},{"id":60,"properties":[{"name":"Tile.ch","type":"string","value":"K"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"name","type":"string","value":"K"}],"type":"48"},{"id":61,"properties":[{"name":"Tile.ch","type":"string","value":"░"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"message","type":"string","value":"* SPLAT!! *"},{"name":"name","type":"string","value":"Pit"}],"type":"23"},{"id":62,"properties":[{"name":"Tile.ch","type":"string","value":"☺"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"Statues are very dangerous...they drain your Gems!"},{"name":"name","type":"string","value":"Statue"}],"type":"46"},{"id":63,"properties":[{"name":"Tile.ch","type":"string","value":"?"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"You found a Pouch containing Gems!"},{"name":"name","type":"string","value":"Chance"}],"type":"45"},{"id":64,"properties":[{"name":"name","type":"string","value":"Trap2"}],"type":"33"},{"id":65,"properties":[{"name":"Tile.bg","type":"string","value":"Magenta"},{"name":"Tile.ch","type":"string","value":"■"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"The Sacred Tome of Kroz is finally yours--50,000 points!"},{"name":"name","type":"string","value":"Tome"}],"type":"24"},{"id":66,"properties":[{"name":"Tile.ch","type":"string","value":"¥"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"You activated a Magic Bomb!"},{"name":"name","type":"string","value":"Bomb"}],"type":"21"},{"id":67,"properties":[{"name":"Tile.bg","type":"string","value":"Red"},{"name":"Tile.ch","type":"string","value":"C"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"message","type":"string","value":"You found gems and whips inside the chest!"},{"name":"name","type":"string","value":"Chest"}],"type":"7"},{"id":68,"properties":[{"name":"Tile.bg","type":"string","value":"Magenta"},{"name":"Tile.ch","type":"string","value":"∞"},{"name":"Tile.fg","type":"string","value":"Cyan"},{"name":"message","type":"string","value":"The Door opens!  (One of your Keys is used.)"},{"name":"name","type":"string","value":"Door"}],"type":"13"},{"id":69,"properties":[{"name":"message","type":"string","value":"Oh no, you set off an Earthquake trap!"},{"name":"name","type":"string","value":"Quake"}],"type":"28"},{"id":70,"properties":[{"name":"Tile.ch","type":"string","value":"Θ"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"description","type":"string","value":"Speed time spell"},{"name":"message","type":"string","value":"You activated a Speed Creature spell."},{"name":"name","type":"string","value":"SpeedTime"}],"type":"15"},{"id":71,"properties":[{"name":"Tile.ch","type":"string","value":"♠"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"message","type":"string","value":"You have discovered a Creature Generator!"},{"name":"name","type":"string","value":"Generator"}],"type":"36"},{"id":72,"properties":[{"name":"message","type":"string","value":"You triggered Exploding Walls!"},{"name":"name","type":"string","value":"BlockSpell"}],"type":"44"},{"id":73,"properties":[{"name":"Tile.ch","type":"string","value":"¡"},{"name":"Tile.fg","type":"string","value":"Green"},{"name":"message","type":"string","value":"Oh no, a temporary Blindness Potion!"},{"name":"name","type":"string","value":"Invisible"}],"type":"10"},{"id":75,"properties":[{"name":"Tile.ch","type":"string","value":"î"},{"name":"Tile.fg","type":"string","value":"LightRed"},{"name":"message","type":"string","value":"Use Keys to unlock doors."},{"name":"name","type":"string","value":"Key"}],"type":"12"},{"id":76,"properties":[{"name":"Tile.bg","type":"string","value":"White"},{"name":"Tile.ch","type":"string","value":"≡"},{"name":"message","type":"string","value":"Stairs take you to the next lower level."},{"name":"name","type":"string","value":"Stairs"}],"type":"6"},{"id":77,"properties":[{"name":"Movement.pace","type":"int","value":2},{"name":"Tile.ch","type":"string","value":"▓"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"description","type":"string","value":"Moving wall"},{"name":"message","type":"string","value":"A Moving Wall blocks your way."},{"name":"name","type":"string","value":"MBlock"}],"type":"38"},{"id":78,"properties":[{"name":"message","type":"string","value":"Yikes!  A trap has made many of the wall sections invisible!"},{"name":"name","type":"string","value":"WallVanish"}],"type":"47"},{"id":79,"properties":[{"name":"Tile.ch","type":"string","value":"▓"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"name","type":"string","value":"ZBlock"}],"type":"43"},{"id":80,"properties":[{"name":"Movement.pace","type":"int","value":1},{"name":"Tile.bg","type":"string","value":"Black"},{"name":"Tile.ch","type":"string","value":"☻"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"description","type":"string","value":"The player"},{"name":"name","type":"string","value":"Player"}],"type":"40"},{"id":81,"properties":[{"name":"Tile.ch","type":"string","value":"○"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"A Power Ring--your whip is now a little stronger!"},{"name":"name","type":"string","value":"Power"}],"type":"18"},{"id":82,"properties":[{"name":"Tile.bg","type":"string","value":"Blue"},{"name":"Tile.ch","type":"string","value":"≈"},{"name":"Tile.fg","type":"string","value":"LightBlue"},{"name":"message","type":"string","value":"You cannot travel through Water."},{"name":"name","type":"string","value":"River"}],"type":"17"},{"id":83,"properties":[{"name":"Tile.ch","type":"string","value":"Φ"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"description","type":"string","value":"Slow time spell"},{"name":"message","type":"string","value":"You activated a Slow Time spell."},{"name":"name","type":"string","value":"SlowTime"}],"type":"8"},{"id":84,"properties":[{"name":"Tile.ch","type":"string","value":"↑"},{"name":"Tile.fg","type":"string","value":"LightMagenta"},{"name":"message","type":"string","value":"You found a Teleport scroll."},{"name":"name","type":"string","value":"Teleport"}],"type":"11"},{"id":85,"properties":[{"name":"Tile.ch","type":"string","value":"∩"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"message","type":"string","value":"You passed through a secret Tunnel!"},{"name":"name","type":"string","value":"Tunnel"}],"type":"25"},{"id":86,"properties":[{"name":"Tile.bg","type":"string","value":"Red"},{"name":"Tile.ch","type":"string","value":"▓"},{"name":"Tile.fg","type":"string","value":"LightRed"},{"name":"message","type":"string","value":"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)"},{"name":"name","type":"string","value":"Lava"}],"type":"22"},{"id":87,"properties":[{"name":"Tile.ch","type":"string","value":"⌠"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"description","type":"string","value":"Breakable wall"},{"name":"message","type":"string","value":"You found a Whip"},{"name":"name","type":"string","value":"Whip"}],"type":"5"},{"id":88,"properties":[{"name":"Tile.ch","type":"string","value":"▓"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"message","type":"string","value":"A Breakable Wall blocks your way"},{"name":"name","type":"string","value":"Block"}],"type":"4"},{"id":89,"properties":[{"name":"Tile.bg","type":"string","value":"Black"},{"name":"Tile.ch","type":"string","value":"▓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"GBlock"}],"type":"64"},{"id":90,"properties":[{"name":"Tile.ch","type":"string","value":"ƒ"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"description","type":"string","value":"Freeze time spell"},{"name":"message","type":"string","value":"You have activated a Freeze Creature spell!"},{"name":"name","type":"string","value":"Freeze"}],"type":"26"},{"id":91,"properties":[{"name":"Tile.ch","type":"string","value":"R"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"name","type":"string","value":"R"}],"type":"49"},{"id":92,"properties":[{"name":"Tile.bg","type":"string","value":"Green"},{"name":"Tile.ch","type":"string","value":"♣"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"message","type":"string","value":"A tree blocks your way."},{"name":"name","type":"string","value":"Tree"}],"type":"20"},{"id":93,"properties":[{"name":"Tile.ch","type":"string","value":"▼"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"description","type":"string","value":"Creature creation trap"},{"name":"message","type":"string","value":"A Creature Creation Trap!"},{"name":"name","type":"string","value":"Create"}],"type":"35"},{"id":96,"properties":[{"name":"message","type":"string","value":"An Invisible Door blocks your way."},{"name":"name","type":"string","value":"IDoor"}],"type":"31"},{"id":124,"properties":[{"name":"Tile.ch","type":"string","value":"O"},{"name":"Tile.fg","type":"string","value":"Yellow"},{"name":"name","type":"string","value":"O"}],"type":"50"},{"id":126,"properties":[{"name":"Tile.bg","type":"string","value":"Red"},{"name":"Tile.ch","type":"string","value":"X"},{"name":"Tile.fg","type":"string","value":"LightRed"},{"name":"message","type":"string","value":"You hit a Electrified Wall!  You lose one Gem."},{"name":"name","type":"string","value":"EWall"}],"type":"66"},{"id":145,"properties":[{"name":"name","type":"string","value":"TBlock"}],"type":"68"},{"id":146,"properties":[{"name":"name","type":"string","value":"TRock"}],"type":"69"},{"id":147,"properties":[{"name":"name","type":"string","value":"TGem"}],"type":"70"},{"id":148,"properties":[{"name":"name","type":"string","value":"TBlind"}],"type":"71"},{"id":149,"properties":[{"name":"name","type":"string","value":"TWhip"}],"type":"72"},{"id":150,"properties":[{"name":"name","type":"string","value":"TGold"}],"type":"73"},{"id":151,"properties":[{"name":"name","type":"string","value":"TTree"}],"type":"74"},{"id":159,"properties":[{"name":"Tile.ch","type":"string","value":"♀"},{"name":"Tile.fg","type":"string","value":"HighIntensityWhite"},{"name":"description","type":"string","value":"Amulet of Yendor"},{"name":"message","type":"string","value":"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"},{"name":"name","type":"string","value":"Amulet"}],"type":"81"},{"id":174,"properties":[{"name":"Tile.ch","type":"string","value":"←"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"ShootLeft"}],"type":"83"},{"id":175,"properties":[{"name":"Tile.ch","type":"string","value":"→"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"ShootRight"}],"type":"82"},{"id":179,"properties":[{"name":"Tile.ch","type":"string","value":"│"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"message","type":"string","value":"You grabbed a Rope."},{"name":"name","type":"string","value":"Rope"}],"type":"75"},{"id":185,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope"}],"type":"76"},{"id":186,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope2"}],"type":"77"},{"id":187,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope3"}],"type":"78"},{"id":188,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope4"}],"type":"79"},{"id":189,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope5"}],"type":"80"},{"id":224,"properties":[{"name":"name","type":"string","value":"Trap6"}],"type":"224"},{"id":225,"properties":[{"name":"name","type":"string","value":"Trap7"}],"type":"225"},{"id":226,"properties":[{"name":"name","type":"string","value":"Trap8"}],"type":"226"},{"id":227,"properties":[{"name":"name","type":"string","value":"Trap9"}],"type":"227"},{"id":228,"properties":[{"name":"name","type":"string","value":"Trap10"}],"type":"228"},{"id":229,"properties":[{"name":"name","type":"string","value":"Trap11"}],"type":"229"},{"id":230,"properties":[{"name":"name","type":"string","value":"Trap12"}],"type":"230"},{"id":231,"properties":[{"name":"name","type":"string","value":"Trap13"}],"type":"231"},{"id":241,"properties":[{"name":"Tile.ch","type":"string","value":"⌂"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"message","type":"string","value":"Magic has been released is this chamber!"},{"name":"name","type":"string","value":"OSpell1"}],"type":"58"},{"id":242,"properties":[{"name":"Tile.ch","type":"string","value":"⌂"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"message","type":"string","value":"Magic has been released is this chamber!"},{"name":"name","type":"string","value":"OSpell2"}],"type":"59"},{"id":243,"properties":[{"name":"Tile.ch","type":"string","value":"⌂"},{"name":"Tile.fg","type":"string","value":"LightCyan"},{"name":"message","type":"string","value":"Magic has been released is this chamber!"},{"name":"name","type":"string","value":"OSpell3"}],"type":"60"},{"id":244,"properties":[{"name":"message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell1"}],"type":"61"},{"id":245,"properties":[{"name":"message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell2"}],"type":"62"},{"id":246,"properties":[{"name":"message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell3"}],"type":"63"},{"id":252,"properties":[{"name":"Tile.bg","type":"string","value":"Green"},{"name":"Tile.ch","type":"string","value":"♣"},{"name":"Tile.fg","type":"string","value":"Brown"},{"name":"name","type":"string","value":"Message"}],"type":"252"}]'),Fs=24,Bs="tileset",Ns="1.11",xa={columns:ks,editorsettings:Es,image:Os,imageheight:As,imagewidth:Rs,margin:Is,name:Ls,spacing:Ms,tilecount:Cs,tiledversion:Ps,tileheight:zs,tiles:Ds,tilewidth:Fs,type:Bs,version:Ns};var u=(e=>(e[e.Border=-1]="Border",e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(u||{});const Ir={[-1]:"▒",0:Yt},Lr={},Mr={[-1]:[z.LightBlue,z.Black],0:[z.Black,z.Black]},Cr={[-1]:"An Electrified Wall blocks your way."};function Pr(){if(!xa.tiles)throw new Error("No tiles found in tileset");for(const e of xa.tiles){const t=e.id,i=+e.type;gr(+t),Lr[+t]=i;const n=mr(e.properties);if(n.name!==u[i])throw new Error("Tile ID mismatch");const a=n["Tile.fg"],o=n["Tile.bg"],f=n["Tile.ch"];Mr[i]=[z[a]??null,z[o]??null],Ir[i]=f??Yt,"message"in n&&(Cr[i]=n.message)}}Pr();const nt=Mr,Yi=Ir,Us=Cr,Ws=Lr,mn=[3,2,1],zr=[5,9,11,7],Gs=[8,10,15,26],Zi=[33,37,39,67,224,225,226,227,228,229,230,231],Dr=[16,...Zi],Hs=[29,30,31],Fr=[48,49,50,51],Ys=[52,53,54],$i=[55,56,57],qs=[58,59,60],aa=[61,62,63],ji=[68,69,70,71,72,73,74],Zs=[76,77,78,79,80],Sa=[...mn,4,...Hs,43,64,38,...ji,13,...Dr,19,28,32,35,36,45,...Fr],$s=[0,...mn,...zr,...Gs,...Dr,32],js=[0,32,...Zi,41,44,47,...$i,...aa,...ji],Xs=[0,32,...Zi,41,47,...ji],Ks=[0,32,41,44,47,...$i,...aa,...ji,...Zi],Vs=[...zr,8,10,12,16,18,21,26,27,34,35,42,45,...Fr,...qs,...Zs,82,83],Js=[6,23],Qs=[0,32,...Zi,...$i],el=[4,6,13,14,22,25,31,36,38,42,43,46,...Ys,64,65,66,81],tl=[0,17,23,28,29,30,32,33,37,39,67,41,44,47,...$i,...aa,...ji,75],ka={7:20,8:35,12:25,15:10,18:15,21:40,28:15,47:20};function ra(e){var a,o;let t=nt[0][0],i=nt[0][1],n=Yt;switch(e){case"Ã":e="!";break;case"´":e=".";break;case"µ":e="?";break;case"¶":e="'";break;case"·":e=",";break;case"¸":e=":";break;case"ú":e="·";break;case"ù":e="∙";break;case"ï":e="∩";break}return typeof e=="string"?(n=e.toLocaleUpperCase(),t=z.HighIntensityWhite,i=z.Brown):(n=Yi[e],t=((a=nt[e])==null?void 0:a[0])??nt[0][0],i=((o=nt[e])==null?void 0:o[1])??nt[0][1]),t??(t=nt[0][0]),i??(i=nt[0][1]),n??(n=Yt),{ch:n,fg:t,bg:i}}const il=[0,68,69,70,71,73,72,74,5,7,8,9,10,11,12,15,16,18,26,27,48,49,50,51,82,83],nl=[5,7,8,9,10,11,12,15,16,18,26,27,48,49,50,51,82,83],al=[8,10,15,16,21,26,28,33,34,35,41,44,47,48,49,50,51,58,59,60,61,62,63,37,39,67,224,225,226,227,228,229,230,231,68,69,70,71,72,73,74,82,83];function Br(e){return e===40?rl():mn.includes(e)||e===38?Ur(e):Nr(e)}function Nr(e){const t=new gn(e);switch(t.add(new qt(ra(e))),e===0?t.add(new ui([3,2,1,38,40])):e===32?t.add(new ui([40])):il.includes(e)?t.add(new ui([3,2,1,40])):$i.includes(e)&&t.add(new ui([40])),e){case 5:t.add(new Mt({whips:1}));break;case 9:t.add(new Mt({gems:1}));break;case 12:t.add(new Mt({keys:1}));break;case 7:t.add(new Mt({whips:Q.getUniformInt(2,5),gems:Q.getUniformInt(5,Ze.difficulty+2)}));break;case 27:t.add(new Mt);break;case 45:t.add(new Mt({gems:Q.getUniformInt(14,18)}));break;case 11:t.add(new Mt({teleports:1}));break}return al.includes(e)&&t.add(new Yn(e)),ka[e]&&t.add(new on(1/ka[e])),e===36&&t.add(Or),t}function rl(){return new gn(40).add(new qt(ra(40))).add(na)}function Ur(e){const t=new gn(e).add(new qt(ra(e))).add(Er).add(kr);return(e===3||e===2||e===1)&&t.add(new Ar(nl)).add(new Rr([4,38,43,64])).add(new Hi({damage:e})),e===1?t.add(new ln("AÄ")):e===2&&t.add(new ln("öÖ")),e===35&&t.add(Gi),t}var An={},yi={},Ea;function ol(){if(Ea)return yi;Ea=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.GridOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric"}(e||(yi.GridOrientation=e={})),yi}var ht={},vi={},Oa;function oa(){if(Oa)return vi;Oa=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.Encoding=void 0;var e;return function(t){t.CSV="csv",t.BASE64="base64"}(e||(vi.Encoding=e={})),vi}var Aa;function Wr(){if(Aa)return ht;Aa=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.isGroup=ht.isImageLayer=ht.isObjectGroup=ht.isUnencodedTileLayer=ht.isEncodedTileLayer=ht.isTileLayer=void 0;const e=oa();function t(c){return c.type==="tilelayer"}ht.isTileLayer=t;function i(c){return c.type==="tilelayer"&&c.encoding!==e.Encoding.CSV}ht.isEncodedTileLayer=i;function n(c){return c.type==="tilelayer"&&(c.encoding==null||c.encoding===e.Encoding.CSV)}ht.isUnencodedTileLayer=n;function a(c){return c.type==="objectgroup"}ht.isObjectGroup=a;function o(c){return c.type==="imagelayer"}ht.isImageLayer=o;function f(c){return c.type==="group"}return ht.isGroup=f,ht}var wi={},Ra;function Gr(){if(Ra)return wi;Ra=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.Compression=void 0;var e;return function(t){t.NONE="",t.GZIP="gzip",t.ZLIB="zlib",t.ZSTD="zstd"}(e||(wi.Compression=e={})),wi}var bi={},Ti={},Ia;function sl(){if(Ia)return Ti;Ia=1,Ti.byteLength=c,Ti.toByteArray=d,Ti.fromByteArray=X;for(var e=[],t=[],i=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)e[a]=n[a],t[n.charCodeAt(a)]=a;t[45]=62,t[95]=63;function f(w){var R=w.length;if(R%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var L=w.indexOf("=");L===-1&&(L=R);var C=L===R?0:4-L%4;return[L,C]}function c(w){var R=f(w),L=R[0],C=R[1];return(L+C)*3/4-C}function p(w,R,L){return(R+L)*3/4-L}function d(w){var R,L=f(w),C=L[0],J=L[1],q=new i(p(w,C,J)),O=0,b=J>0?C-4:C,M;for(M=0;M<b;M+=4)R=t[w.charCodeAt(M)]<<18|t[w.charCodeAt(M+1)]<<12|t[w.charCodeAt(M+2)]<<6|t[w.charCodeAt(M+3)],q[O++]=R>>16&255,q[O++]=R>>8&255,q[O++]=R&255;return J===2&&(R=t[w.charCodeAt(M)]<<2|t[w.charCodeAt(M+1)]>>4,q[O++]=R&255),J===1&&(R=t[w.charCodeAt(M)]<<10|t[w.charCodeAt(M+1)]<<4|t[w.charCodeAt(M+2)]>>2,q[O++]=R>>8&255,q[O++]=R&255),q}function S(w){return e[w>>18&63]+e[w>>12&63]+e[w>>6&63]+e[w&63]}function B(w,R,L){for(var C,J=[],q=R;q<L;q+=3)C=(w[q]<<16&16711680)+(w[q+1]<<8&65280)+(w[q+2]&255),J.push(S(C));return J.join("")}function X(w){for(var R,L=w.length,C=L%3,J=[],q=16383,O=0,b=L-C;O<b;O+=q)J.push(B(w,O,O+q>b?b:O+q));return C===1?(R=w[L-1],J.push(e[R>>2]+e[R<<4&63]+"==")):C===2&&(R=(w[L-2]<<8)+w[L-1],J.push(e[R>>10]+e[R>>4&63]+e[R<<2&63]+"=")),J.join("")}return Ti}var xi={},La;function ll(){if(La)return xi;La=1;var e=ArrayBuffer,t=Uint8Array,i=Uint16Array,n=Int16Array,a=Int32Array,o=function(m,T,A){if(t.prototype.slice)return t.prototype.slice.call(m,T,A);(T==null||T<0)&&(T=0),(A==null||A>m.length)&&(A=m.length);var F=new t(A-T);return F.set(m.subarray(T,A)),F},f=function(m,T,A,F){if(t.prototype.fill)return t.prototype.fill.call(m,T,A,F);for((A==null||A<0)&&(A=0),(F==null||F>m.length)&&(F=m.length);A<F;++A)m[A]=T;return m},c=function(m,T,A,F){if(t.prototype.copyWithin)return t.prototype.copyWithin.call(m,T,A,F);for((A==null||A<0)&&(A=0),(F==null||F>m.length)&&(F=m.length);A<F;)m[T++]=m[A++]};xi.ZstdErrorCode={InvalidData:0,WindowSizeTooLarge:1,InvalidBlockType:2,FSEAccuracyTooHigh:3,DistanceTooFarBack:4,UnexpectedEOF:5};var p=["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"],d=function(m,T,A){var F=new Error(T||p[m]);if(F.code=m,Error.captureStackTrace&&Error.captureStackTrace(F,d),!A)throw F;return F},S=function(m,T,A){for(var F=0,N=0;F<A;++F)N|=m[T++]<<(F<<3);return N},B=function(m,T){return(m[T]|m[T+1]<<8|m[T+2]<<16|m[T+3]<<24)>>>0},X=function(m,T){var A=m[0]|m[1]<<8|m[2]<<16;if(A==3126568&&m[3]==253){var F=m[4],N=F>>5&1,te=F>>2&1,D=F&3,ne=F>>6;F&8&&d(0);var re=6-N,Se=D==3?4:D,be=S(m,re,Se);re+=Se;var le=ne?1<<ne:N,he=S(m,re,le)+(ne==1&&256),Ie=he;if(!N){var Ne=1<<10+(m[5]>>3);Ie=Ne+(Ne>>3)*(m[5]&7)}Ie>2145386496&&d(1);var pe=new t((T==1?he||Ie:T?0:Ie)+12);return pe[0]=1,pe[4]=4,pe[8]=8,{b:re+le,y:0,l:0,d:be,w:T&&T!=1?T:pe.subarray(12),e:Ie,o:new a(pe.buffer,0,3),u:he,c:te,m:Math.min(131072,Ie)}}else if((A>>4|m[3]<<20)==25481893)return B(m,4)+8;d(0)},w=function(m){for(var T=0;1<<T<=m;++T);return T-1},R=function(m,T,A){var F=(T<<3)+4,N=(m[T]&15)+5;N>A&&d(3);for(var te=1<<N,D=te,ne=-1,re=-1,Se=-1,be=te,le=new e(512+(te<<2)),he=new n(le,0,256),Ie=new i(le,0,256),Ne=new i(le,512,te),pe=512+(te<<1),ke=new t(le,pe,te),ge=new t(le,pe+te);ne<255&&D>0;){var Te=w(D+1),Re=F>>3,$e=(1<<Te+1)-1,Ce=(m[Re]|m[Re+1]<<8|m[Re+2]<<16)>>(F&7)&$e,ye=(1<<Te)-1,De=$e-D-1,Qe=Ce&ye;if(Qe<De?(F+=Te,Ce=Qe):(F+=Te+1,Ce>ye&&(Ce-=De)),he[++ne]=--Ce,Ce==-1?(D+=Ce,ke[--be]=ne):D-=Ce,!Ce)do{var Ye=F>>3;re=(m[Ye]|m[Ye+1]<<8)>>(F&7)&3,F+=2,ne+=re}while(re==3)}(ne>255||D)&&d(0);for(var Ue=0,ct=(te>>1)+(te>>3)+3,qe=te-1,Pe=0;Pe<=ne;++Pe){var me=he[Pe];if(me<1){Ie[Pe]=-me;continue}for(Se=0;Se<me;++Se){ke[Ue]=Pe;do Ue=Ue+ct&qe;while(Ue>=be)}}for(Ue&&d(0),Se=0;Se<te;++Se){var V=Ie[ke[Se]]++,Ge=ge[Se]=N-w(V);Ne[Se]=(V<<Ge)-te}return[F+7>>3,{b:N,s:ke,n:ge,t:Ne}]},L=function(m,T){var A=0,F=-1,N=new t(292),te=m[T],D=N.subarray(0,256),ne=N.subarray(256,268),re=new i(N.buffer,268);if(te<128){var Se=R(m,T+1,6),be=Se[0],le=Se[1];T+=te;var he=be<<3,Ie=m[T];Ie||d(0);for(var Ne=0,pe=0,ke=le.b,ge=ke,Te=(++T<<3)-8+w(Ie);Te-=ke,!(Te<he);){var Re=Te>>3;if(Ne+=(m[Re]|m[Re+1]<<8)>>(Te&7)&(1<<ke)-1,D[++F]=le.s[Ne],Te-=ge,Te<he)break;Re=Te>>3,pe+=(m[Re]|m[Re+1]<<8)>>(Te&7)&(1<<ge)-1,D[++F]=le.s[pe],ke=le.n[Ne],Ne=le.t[Ne],ge=le.n[pe],pe=le.t[pe]}++F>255&&d(0)}else{for(F=te-127;A<F;A+=2){var $e=m[++T];D[A]=$e>>4,D[A+1]=$e&15}++T}var Ce=0;for(A=0;A<F;++A){var ye=D[A];ye>11&&d(0),Ce+=ye&&1<<ye-1}var De=w(Ce)+1,Qe=1<<De,Ye=Qe-Ce;for(Ye&Ye-1&&d(0),D[F++]=w(Ye)+1,A=0;A<F;++A){var ye=D[A];++ne[D[A]=ye&&De+1-ye]}var Ue=new t(Qe<<1),ct=Ue.subarray(0,Qe),qe=Ue.subarray(Qe);for(re[De]=0,A=De;A>0;--A){var Pe=re[A];f(qe,A,Pe,re[A-1]=Pe+ne[A]*(1<<De-A))}for(re[0]!=Qe&&d(0),A=0;A<F;++A){var me=D[A];if(me){var V=re[me];f(ct,A,V,re[me]=V+(1<<De-me))}}return[T,{n:qe,b:De,s:ct}]},C=R(new t([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],J=R(new t([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],q=R(new t([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],O=function(m,T){for(var A=m.length,F=new a(A),N=0;N<A;++N)F[N]=T,T+=1<<m[N];return F},b=new t(new a([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),M=O(b,0),Y=new t(new a([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),Z=O(Y,3),ue=function(m,T,A){var F=m.length,N=T.length,te=m[F-1],D=(1<<A.b)-1,ne=-A.b;te||d(0);for(var re=0,Se=A.b,be=(F<<3)-8+w(te)-Se,le=-1;be>ne&&le<N;){var he=be>>3,Ie=(m[he]|m[he+1]<<8|m[he+2]<<16)>>(be&7);re=(re<<Se|Ie)&D,T[++le]=A.s[re],be-=Se=A.n[re]}(be!=ne||le+1!=N)&&d(0)},fe=function(m,T,A){var F=6,N=T.length,te=N+3>>2,D=te<<1,ne=te+D;ue(m.subarray(F,F+=m[0]|m[1]<<8),T.subarray(0,te),A),ue(m.subarray(F,F+=m[2]|m[3]<<8),T.subarray(te,D),A),ue(m.subarray(F,F+=m[4]|m[5]<<8),T.subarray(D,ne),A),ue(m.subarray(F),T.subarray(ne),A)},xe=function(m,T,A){var F,N=T.b,te=m[N],D=te>>1&3;T.l=te&1;var ne=te>>3|m[N+1]<<5|m[N+2]<<13,re=(N+=3)+ne;if(D==1)return N>=m.length?void 0:(T.b=N+1,A?(f(A,m[N],T.y,T.y+=ne),A):f(new t(ne),m[N]));if(!(re>m.length)){if(D==0)return T.b=re,A?(A.set(m.subarray(N,re),T.y),T.y+=ne,A):o(m,N,re);if(D==2){var Se=m[N],be=Se&3,le=Se>>2&3,he=Se>>4,Ie=0,Ne=0;be<2?le&1?he|=m[++N]<<4|(le&2&&m[++N]<<12):he=Se>>3:(Ne=le,le<2?(he|=(m[++N]&63)<<4,Ie=m[N]>>6|m[++N]<<2):le==2?(he|=m[++N]<<4|(m[++N]&3)<<12,Ie=m[N]>>2|m[++N]<<6):(he|=m[++N]<<4|(m[++N]&63)<<12,Ie=m[N]>>6|m[++N]<<2|m[++N]<<10)),++N;var pe=A?A.subarray(T.y,T.y+T.m):new t(T.m),ke=pe.length-he;if(be==0)pe.set(m.subarray(N,N+=he),ke);else if(be==1)f(pe,m[N++],ke);else{var ge=T.h;if(be==2){var Te=L(m,N);Ie+=N-(N=Te[0]),T.h=ge=Te[1]}else ge||d(0);(Ne?fe:ue)(m.subarray(N,N+=Ie),pe.subarray(ke),ge)}var Re=m[N++];if(Re){Re==255?Re=(m[N++]|m[N++]<<8)+32512:Re>127&&(Re=Re-128<<8|m[N++]);var $e=m[N++];$e&3&&d(0);for(var Ce=[J,q,C],ye=2;ye>-1;--ye){var De=$e>>(ye<<1)+2&3;if(De==1){var Qe=new t([0,0,m[N++]]);Ce[ye]={s:Qe.subarray(2,3),n:Qe.subarray(0,1),t:new i(Qe.buffer,0,1),b:0}}else De==2?(F=R(m,N,9-(ye&1)),N=F[0],Ce[ye]=F[1]):De==3&&(T.t||d(0),Ce[ye]=T.t[ye])}var Ye=T.t=Ce,Ue=Ye[0],ct=Ye[1],qe=Ye[2],Pe=m[re-1];Pe||d(0);var me=(re<<3)-8+w(Pe)-qe.b,V=me>>3,Ge=0,gt=(m[V]|m[V+1]<<8)>>(me&7)&(1<<qe.b)-1;V=(me-=ct.b)>>3;var _t=(m[V]|m[V+1]<<8)>>(me&7)&(1<<ct.b)-1;V=(me-=Ue.b)>>3;var l=(m[V]|m[V+1]<<8)>>(me&7)&(1<<Ue.b)-1;for(++Re;--Re;){var P=qe.s[gt],G=qe.n[gt],K=Ue.s[l],ae=Ue.n[l],oe=ct.s[_t],g=ct.n[_t];V=(me-=oe)>>3;var k=1<<oe,s=k+((m[V]|m[V+1]<<8|m[V+2]<<16|m[V+3]<<24)>>>(me&7)&k-1);V=(me-=Y[K])>>3;var W=Z[K]+((m[V]|m[V+1]<<8|m[V+2]<<16)>>(me&7)&(1<<Y[K])-1);V=(me-=b[P])>>3;var _e=M[P]+((m[V]|m[V+1]<<8|m[V+2]<<16)>>(me&7)&(1<<b[P])-1);if(V=(me-=G)>>3,gt=qe.t[gt]+((m[V]|m[V+1]<<8)>>(me&7)&(1<<G)-1),V=(me-=ae)>>3,l=Ue.t[l]+((m[V]|m[V+1]<<8)>>(me&7)&(1<<ae)-1),V=(me-=g)>>3,_t=ct.t[_t]+((m[V]|m[V+1]<<8)>>(me&7)&(1<<g)-1),s>3)T.o[2]=T.o[1],T.o[1]=T.o[0],T.o[0]=s-=3;else{var H=s-(_e!=0);H?(s=H==3?T.o[0]-1:T.o[H],H>1&&(T.o[2]=T.o[1]),T.o[1]=T.o[0],T.o[0]=s):s=T.o[0]}for(var ye=0;ye<_e;++ye)pe[Ge+ye]=pe[ke+ye];Ge+=_e,ke+=_e;var ve=Ge-s;if(ve<0){var $=-ve,Fe=T.e+ve;$>W&&($=W);for(var ye=0;ye<$;++ye)pe[Ge+ye]=T.w[Fe+ye];Ge+=$,W-=$,ve=0}for(var ye=0;ye<W;++ye)pe[Ge+ye]=pe[ve+ye];Ge+=W}if(Ge!=ke)for(;ke<pe.length;)pe[Ge++]=pe[ke++];else Ge=pe.length;A?T.y+=Ge:pe=o(pe,0,Ge)}else if(A){if(T.y+=he,ke)for(var ye=0;ye<he;++ye)pe[ye]=pe[ke+ye]}else ke&&(pe=o(pe,ke));return T.b=re,pe}d(2)}},we=function(m,T){if(m.length==1)return m[0];for(var A=new t(T),F=0,N=0;F<m.length;++F){var te=m[F];A.set(te,N),N+=te.length}return A};function se(m,T){for(var A=[],F=+!T,N=0,te=0;m.length;){var D=X(m,F||T);if(typeof D=="object"){for(F?(T=null,D.w.length==D.u&&(A.push(T=D.w),te+=D.u)):(A.push(T),D.e=0);!D.l;){var ne=xe(m,D,T);ne||d(5),T?D.e=D.y:(A.push(ne),te+=ne.length,c(D.w,0,ne.length),D.w.set(ne,D.w.length-ne.length))}N=D.b+D.c*4}else N=D;m=m.subarray(N)}return we(A,te)}xi.decompress=se;var ie=function(){function m(T){this.ondata=T,this.c=[],this.l=0,this.z=0}return m.prototype.push=function(T,A){if(typeof this.s=="number"){var F=Math.min(T.length,this.s);T=T.subarray(F),this.s-=F}var N=T.length,te=N+this.l;if(!this.s){if(A){if(!te){this.ondata(new t(0),!0);return}te<5&&d(5)}else if(te<18){this.c.push(T),this.l=te;return}if(this.l&&(this.c.push(T),T=we(this.c,te),this.c=[],this.l=0),typeof(this.s=X(T))=="number")return this.push(T,A)}if(typeof this.s!="number"){if(te<(this.z||3)){A&&d(5),this.c.push(T),this.l=te;return}if(this.l&&(this.c.push(T),T=we(this.c,te),this.c=[],this.l=0),!this.z&&te<(this.z=T[this.s.b]&2?4:3+(T[this.s.b]>>3|T[this.s.b+1]<<5|T[this.s.b+2]<<13))){A&&d(5),this.c.push(T),this.l=te;return}else this.z=0;for(;;){var D=xe(T,this.s);if(D)this.ondata(D,!1),c(this.s.w,0,D.length),this.s.w.set(D,this.s.w.length-D.length);else{A&&d(5);var ne=T.subarray(this.s.b);this.s.b=0,this.c.push(ne),this.l+=ne.length;return}if(this.s.l){var re=T.subarray(this.s.b);this.s=this.s.c*4,this.push(re,A);return}}}else A&&d(5)},m}();return xi.Decompress=ie,xi}var xt={},Zt={},St={},$t={},Ma;function cl(){if(Ma)return $t;Ma=1;const e=4,t=0,i=1,n=2;function a(l){let P=l.length;for(;--P>=0;)l[P]=0}const o=0,f=1,c=2,p=3,d=258,S=29,B=256,X=B+1+S,w=30,R=19,L=2*X+1,C=15,J=16,q=7,O=256,b=16,M=17,Y=18,Z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ue=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),we=512,se=new Array((X+2)*2);a(se);const ie=new Array(w*2);a(ie);const m=new Array(we);a(m);const T=new Array(d-p+1);a(T);const A=new Array(S);a(A);const F=new Array(w);a(F);function N(l,P,G,K,ae){this.static_tree=l,this.extra_bits=P,this.extra_base=G,this.elems=K,this.max_length=ae,this.has_stree=l&&l.length}let te,D,ne;function re(l,P){this.dyn_tree=l,this.max_code=0,this.stat_desc=P}const Se=l=>l<256?m[l]:m[256+(l>>>7)],be=(l,P)=>{l.pending_buf[l.pending++]=P&255,l.pending_buf[l.pending++]=P>>>8&255},le=(l,P,G)=>{l.bi_valid>J-G?(l.bi_buf|=P<<l.bi_valid&65535,be(l,l.bi_buf),l.bi_buf=P>>J-l.bi_valid,l.bi_valid+=G-J):(l.bi_buf|=P<<l.bi_valid&65535,l.bi_valid+=G)},he=(l,P,G)=>{le(l,G[P*2],G[P*2+1])},Ie=(l,P)=>{let G=0;do G|=l&1,l>>>=1,G<<=1;while(--P>0);return G>>>1},Ne=l=>{l.bi_valid===16?(be(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},pe=(l,P)=>{const G=P.dyn_tree,K=P.max_code,ae=P.stat_desc.static_tree,oe=P.stat_desc.has_stree,g=P.stat_desc.extra_bits,k=P.stat_desc.extra_base,s=P.stat_desc.max_length;let W,_e,H,ve,$,Fe,E=0;for(ve=0;ve<=C;ve++)l.bl_count[ve]=0;for(G[l.heap[l.heap_max]*2+1]=0,W=l.heap_max+1;W<L;W++)_e=l.heap[W],ve=G[G[_e*2+1]*2+1]+1,ve>s&&(ve=s,E++),G[_e*2+1]=ve,!(_e>K)&&(l.bl_count[ve]++,$=0,_e>=k&&($=g[_e-k]),Fe=G[_e*2],l.opt_len+=Fe*(ve+$),oe&&(l.static_len+=Fe*(ae[_e*2+1]+$)));if(E!==0){do{for(ve=s-1;l.bl_count[ve]===0;)ve--;l.bl_count[ve]--,l.bl_count[ve+1]+=2,l.bl_count[s]--,E-=2}while(E>0);for(ve=s;ve!==0;ve--)for(_e=l.bl_count[ve];_e!==0;)H=l.heap[--W],!(H>K)&&(G[H*2+1]!==ve&&(l.opt_len+=(ve-G[H*2+1])*G[H*2],G[H*2+1]=ve),_e--)}},ke=(l,P,G)=>{const K=new Array(C+1);let ae=0,oe,g;for(oe=1;oe<=C;oe++)ae=ae+G[oe-1]<<1,K[oe]=ae;for(g=0;g<=P;g++){let k=l[g*2+1];k!==0&&(l[g*2]=Ie(K[k]++,k))}},ge=()=>{let l,P,G,K,ae;const oe=new Array(C+1);for(G=0,K=0;K<S-1;K++)for(A[K]=G,l=0;l<1<<Z[K];l++)T[G++]=K;for(T[G-1]=K,ae=0,K=0;K<16;K++)for(F[K]=ae,l=0;l<1<<ue[K];l++)m[ae++]=K;for(ae>>=7;K<w;K++)for(F[K]=ae<<7,l=0;l<1<<ue[K]-7;l++)m[256+ae++]=K;for(P=0;P<=C;P++)oe[P]=0;for(l=0;l<=143;)se[l*2+1]=8,l++,oe[8]++;for(;l<=255;)se[l*2+1]=9,l++,oe[9]++;for(;l<=279;)se[l*2+1]=7,l++,oe[7]++;for(;l<=287;)se[l*2+1]=8,l++,oe[8]++;for(ke(se,X+1,oe),l=0;l<w;l++)ie[l*2+1]=5,ie[l*2]=Ie(l,5);te=new N(se,Z,B+1,X,C),D=new N(ie,ue,0,w,C),ne=new N(new Array(0),fe,0,R,q)},Te=l=>{let P;for(P=0;P<X;P++)l.dyn_ltree[P*2]=0;for(P=0;P<w;P++)l.dyn_dtree[P*2]=0;for(P=0;P<R;P++)l.bl_tree[P*2]=0;l.dyn_ltree[O*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},Re=l=>{l.bi_valid>8?be(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},$e=(l,P,G,K)=>{const ae=P*2,oe=G*2;return l[ae]<l[oe]||l[ae]===l[oe]&&K[P]<=K[G]},Ce=(l,P,G)=>{const K=l.heap[G];let ae=G<<1;for(;ae<=l.heap_len&&(ae<l.heap_len&&$e(P,l.heap[ae+1],l.heap[ae],l.depth)&&ae++,!$e(P,K,l.heap[ae],l.depth));)l.heap[G]=l.heap[ae],G=ae,ae<<=1;l.heap[G]=K},ye=(l,P,G)=>{let K,ae,oe=0,g,k;if(l.sym_next!==0)do K=l.pending_buf[l.sym_buf+oe++]&255,K+=(l.pending_buf[l.sym_buf+oe++]&255)<<8,ae=l.pending_buf[l.sym_buf+oe++],K===0?he(l,ae,P):(g=T[ae],he(l,g+B+1,P),k=Z[g],k!==0&&(ae-=A[g],le(l,ae,k)),K--,g=Se(K),he(l,g,G),k=ue[g],k!==0&&(K-=F[g],le(l,K,k)));while(oe<l.sym_next);he(l,O,P)},De=(l,P)=>{const G=P.dyn_tree,K=P.stat_desc.static_tree,ae=P.stat_desc.has_stree,oe=P.stat_desc.elems;let g,k,s=-1,W;for(l.heap_len=0,l.heap_max=L,g=0;g<oe;g++)G[g*2]!==0?(l.heap[++l.heap_len]=s=g,l.depth[g]=0):G[g*2+1]=0;for(;l.heap_len<2;)W=l.heap[++l.heap_len]=s<2?++s:0,G[W*2]=1,l.depth[W]=0,l.opt_len--,ae&&(l.static_len-=K[W*2+1]);for(P.max_code=s,g=l.heap_len>>1;g>=1;g--)Ce(l,G,g);W=oe;do g=l.heap[1],l.heap[1]=l.heap[l.heap_len--],Ce(l,G,1),k=l.heap[1],l.heap[--l.heap_max]=g,l.heap[--l.heap_max]=k,G[W*2]=G[g*2]+G[k*2],l.depth[W]=(l.depth[g]>=l.depth[k]?l.depth[g]:l.depth[k])+1,G[g*2+1]=G[k*2+1]=W,l.heap[1]=W++,Ce(l,G,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],pe(l,P),ke(G,s,l.bl_count)},Qe=(l,P,G)=>{let K,ae=-1,oe,g=P[0*2+1],k=0,s=7,W=4;for(g===0&&(s=138,W=3),P[(G+1)*2+1]=65535,K=0;K<=G;K++)oe=g,g=P[(K+1)*2+1],!(++k<s&&oe===g)&&(k<W?l.bl_tree[oe*2]+=k:oe!==0?(oe!==ae&&l.bl_tree[oe*2]++,l.bl_tree[b*2]++):k<=10?l.bl_tree[M*2]++:l.bl_tree[Y*2]++,k=0,ae=oe,g===0?(s=138,W=3):oe===g?(s=6,W=3):(s=7,W=4))},Ye=(l,P,G)=>{let K,ae=-1,oe,g=P[0*2+1],k=0,s=7,W=4;for(g===0&&(s=138,W=3),K=0;K<=G;K++)if(oe=g,g=P[(K+1)*2+1],!(++k<s&&oe===g)){if(k<W)do he(l,oe,l.bl_tree);while(--k!==0);else oe!==0?(oe!==ae&&(he(l,oe,l.bl_tree),k--),he(l,b,l.bl_tree),le(l,k-3,2)):k<=10?(he(l,M,l.bl_tree),le(l,k-3,3)):(he(l,Y,l.bl_tree),le(l,k-11,7));k=0,ae=oe,g===0?(s=138,W=3):oe===g?(s=6,W=3):(s=7,W=4)}},Ue=l=>{let P;for(Qe(l,l.dyn_ltree,l.l_desc.max_code),Qe(l,l.dyn_dtree,l.d_desc.max_code),De(l,l.bl_desc),P=R-1;P>=3&&l.bl_tree[xe[P]*2+1]===0;P--);return l.opt_len+=3*(P+1)+5+5+4,P},ct=(l,P,G,K)=>{let ae;for(le(l,P-257,5),le(l,G-1,5),le(l,K-4,4),ae=0;ae<K;ae++)le(l,l.bl_tree[xe[ae]*2+1],3);Ye(l,l.dyn_ltree,P-1),Ye(l,l.dyn_dtree,G-1)},qe=l=>{let P=4093624447,G;for(G=0;G<=31;G++,P>>>=1)if(P&1&&l.dyn_ltree[G*2]!==0)return t;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return i;for(G=32;G<B;G++)if(l.dyn_ltree[G*2]!==0)return i;return t};let Pe=!1;const me=l=>{Pe||(ge(),Pe=!0),l.l_desc=new re(l.dyn_ltree,te),l.d_desc=new re(l.dyn_dtree,D),l.bl_desc=new re(l.bl_tree,ne),l.bi_buf=0,l.bi_valid=0,Te(l)},V=(l,P,G,K)=>{le(l,(o<<1)+(K?1:0),3),Re(l),be(l,G),be(l,~G),G&&l.pending_buf.set(l.window.subarray(P,P+G),l.pending),l.pending+=G},Ge=l=>{le(l,f<<1,3),he(l,O,se),Ne(l)},gt=(l,P,G,K)=>{let ae,oe,g=0;l.level>0?(l.strm.data_type===n&&(l.strm.data_type=qe(l)),De(l,l.l_desc),De(l,l.d_desc),g=Ue(l),ae=l.opt_len+3+7>>>3,oe=l.static_len+3+7>>>3,oe<=ae&&(ae=oe)):ae=oe=G+5,G+4<=ae&&P!==-1?V(l,P,G,K):l.strategy===e||oe===ae?(le(l,(f<<1)+(K?1:0),3),ye(l,se,ie)):(le(l,(c<<1)+(K?1:0),3),ct(l,l.l_desc.max_code+1,l.d_desc.max_code+1,g+1),ye(l,l.dyn_ltree,l.dyn_dtree)),Te(l),K&&Re(l)},_t=(l,P,G)=>(l.pending_buf[l.sym_buf+l.sym_next++]=P,l.pending_buf[l.sym_buf+l.sym_next++]=P>>8,l.pending_buf[l.sym_buf+l.sym_next++]=G,P===0?l.dyn_ltree[G*2]++:(l.matches++,P--,l.dyn_ltree[(T[G]+B+1)*2]++,l.dyn_dtree[Se(P)*2]++),l.sym_next===l.sym_end);return $t._tr_init=me,$t._tr_stored_block=V,$t._tr_flush_block=gt,$t._tr_tally=_t,$t._tr_align=Ge,$t}var Rn,Ca;function Hr(){return Ca||(Ca=1,Rn=(t,i,n,a)=>{let o=t&65535|0,f=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do o=o+i[a++]|0,f=f+o|0;while(--c);o%=65521,f%=65521}return o|f<<16|0}),Rn}var In,Pa;function Yr(){if(Pa)return In;Pa=1;const e=()=>{let n,a=[];for(var o=0;o<256;o++){n=o;for(var f=0;f<8;f++)n=n&1?3988292384^n>>>1:n>>>1;a[o]=n}return a},t=new Uint32Array(e());return In=(n,a,o,f)=>{const c=t,p=f+o;n^=-1;for(let d=f;d<p;d++)n=n>>>8^c[(n^a[d])&255];return n^-1},In}var Ln,za;function sa(){return za||(za=1,Ln={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),Ln}var Mn,Da;function ti(){return Da||(Da=1,Mn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),Mn}var Fa;function ul(){if(Fa)return St;Fa=1;const{_tr_init:e,_tr_stored_block:t,_tr_flush_block:i,_tr_tally:n,_tr_align:a}=cl(),o=Hr(),f=Yr(),c=sa(),{Z_NO_FLUSH:p,Z_PARTIAL_FLUSH:d,Z_FULL_FLUSH:S,Z_FINISH:B,Z_BLOCK:X,Z_OK:w,Z_STREAM_END:R,Z_STREAM_ERROR:L,Z_DATA_ERROR:C,Z_BUF_ERROR:J,Z_DEFAULT_COMPRESSION:q,Z_FILTERED:O,Z_HUFFMAN_ONLY:b,Z_RLE:M,Z_FIXED:Y,Z_DEFAULT_STRATEGY:Z,Z_UNKNOWN:ue,Z_DEFLATED:fe}=ti(),xe=9,we=15,se=8,T=256+1+29,A=30,F=19,N=2*T+1,te=15,D=3,ne=258,re=ne+D+1,Se=32,be=42,le=57,he=69,Ie=73,Ne=91,pe=103,ke=113,ge=666,Te=1,Re=2,$e=3,Ce=4,ye=3,De=(r,x)=>(r.msg=c[x],x),Qe=r=>r*2-(r>4?9:0),Ye=r=>{let x=r.length;for(;--x>=0;)r[x]=0},Ue=r=>{let x,h,y,v=r.w_size;x=r.hash_size,y=x;do h=r.head[--y],r.head[y]=h>=v?h-v:0;while(--x);x=v,y=x;do h=r.prev[--y],r.prev[y]=h>=v?h-v:0;while(--x)};let qe=(r,x,h)=>(x<<r.hash_shift^h)&r.hash_mask;const Pe=r=>{const x=r.state;let h=x.pending;h>r.avail_out&&(h=r.avail_out),h!==0&&(r.output.set(x.pending_buf.subarray(x.pending_out,x.pending_out+h),r.next_out),r.next_out+=h,x.pending_out+=h,r.total_out+=h,r.avail_out-=h,x.pending-=h,x.pending===0&&(x.pending_out=0))},me=(r,x)=>{i(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,x),r.block_start=r.strstart,Pe(r.strm)},V=(r,x)=>{r.pending_buf[r.pending++]=x},Ge=(r,x)=>{r.pending_buf[r.pending++]=x>>>8&255,r.pending_buf[r.pending++]=x&255},gt=(r,x,h,y)=>{let v=r.avail_in;return v>y&&(v=y),v===0?0:(r.avail_in-=v,x.set(r.input.subarray(r.next_in,r.next_in+v),h),r.state.wrap===1?r.adler=o(r.adler,x,v,h):r.state.wrap===2&&(r.adler=f(r.adler,x,v,h)),r.next_in+=v,r.total_in+=v,v)},_t=(r,x)=>{let h=r.max_chain_length,y=r.strstart,v,j,ce=r.prev_length,ee=r.nice_match;const ft=r.strstart>r.w_size-re?r.strstart-(r.w_size-re):0,Le=r.window,Ve=r.w_mask,mt=r.prev,et=r.strstart+ne;let wt=Le[y+ce-1],yt=Le[y+ce];r.prev_length>=r.good_match&&(h>>=2),ee>r.lookahead&&(ee=r.lookahead);do if(v=x,!(Le[v+ce]!==yt||Le[v+ce-1]!==wt||Le[v]!==Le[y]||Le[++v]!==Le[y+1])){y+=2,v++;do;while(Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&Le[++y]===Le[++v]&&y<et);if(j=ne-(et-y),y=et-ne,j>ce){if(r.match_start=x,ce=j,j>=ee)break;wt=Le[y+ce-1],yt=Le[y+ce]}}while((x=mt[x&Ve])>ft&&--h!==0);return ce<=r.lookahead?ce:r.lookahead},l=r=>{const x=r.w_size;let h,y,v;do{if(y=r.window_size-r.lookahead-r.strstart,r.strstart>=x+(x-re)&&(r.window.set(r.window.subarray(x,x+x-y),0),r.match_start-=x,r.strstart-=x,r.block_start-=x,r.insert>r.strstart&&(r.insert=r.strstart),Ue(r),y+=x),r.strm.avail_in===0)break;if(h=gt(r.strm,r.window,r.strstart+r.lookahead,y),r.lookahead+=h,r.lookahead+r.insert>=D)for(v=r.strstart-r.insert,r.ins_h=r.window[v],r.ins_h=qe(r,r.ins_h,r.window[v+1]);r.insert&&(r.ins_h=qe(r,r.ins_h,r.window[v+D-1]),r.prev[v&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=v,v++,r.insert--,!(r.lookahead+r.insert<D)););}while(r.lookahead<re&&r.strm.avail_in!==0)},P=(r,x)=>{let h=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,y,v,j,ce=0,ee=r.strm.avail_in;do{if(y=65535,j=r.bi_valid+42>>3,r.strm.avail_out<j||(j=r.strm.avail_out-j,v=r.strstart-r.block_start,y>v+r.strm.avail_in&&(y=v+r.strm.avail_in),y>j&&(y=j),y<h&&(y===0&&x!==B||x===p||y!==v+r.strm.avail_in)))break;ce=x===B&&y===v+r.strm.avail_in?1:0,t(r,0,0,ce),r.pending_buf[r.pending-4]=y,r.pending_buf[r.pending-3]=y>>8,r.pending_buf[r.pending-2]=~y,r.pending_buf[r.pending-1]=~y>>8,Pe(r.strm),v&&(v>y&&(v=y),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+v),r.strm.next_out),r.strm.next_out+=v,r.strm.avail_out-=v,r.strm.total_out+=v,r.block_start+=v,y-=v),y&&(gt(r.strm,r.strm.output,r.strm.next_out,y),r.strm.next_out+=y,r.strm.avail_out-=y,r.strm.total_out+=y)}while(ce===0);return ee-=r.strm.avail_in,ee&&(ee>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=ee&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-ee,r.strm.next_in),r.strstart),r.strstart+=ee,r.insert+=ee>r.w_size-r.insert?r.w_size-r.insert:ee),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),ce?Ce:x!==p&&x!==B&&r.strm.avail_in===0&&r.strstart===r.block_start?Re:(j=r.window_size-r.strstart,r.strm.avail_in>j&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,j+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),j>r.strm.avail_in&&(j=r.strm.avail_in),j&&(gt(r.strm,r.window,r.strstart,j),r.strstart+=j,r.insert+=j>r.w_size-r.insert?r.w_size-r.insert:j),r.high_water<r.strstart&&(r.high_water=r.strstart),j=r.bi_valid+42>>3,j=r.pending_buf_size-j>65535?65535:r.pending_buf_size-j,h=j>r.w_size?r.w_size:j,v=r.strstart-r.block_start,(v>=h||(v||x===B)&&x!==p&&r.strm.avail_in===0&&v<=j)&&(y=v>j?j:v,ce=x===B&&r.strm.avail_in===0&&y===v?1:0,t(r,r.block_start,y,ce),r.block_start+=y,Pe(r.strm)),ce?$e:Te)},G=(r,x)=>{let h,y;for(;;){if(r.lookahead<re){if(l(r),r.lookahead<re&&x===p)return Te;if(r.lookahead===0)break}if(h=0,r.lookahead>=D&&(r.ins_h=qe(r,r.ins_h,r.window[r.strstart+D-1]),h=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),h!==0&&r.strstart-h<=r.w_size-re&&(r.match_length=_t(r,h)),r.match_length>=D)if(y=n(r,r.strstart-r.match_start,r.match_length-D),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=D){r.match_length--;do r.strstart++,r.ins_h=qe(r,r.ins_h,r.window[r.strstart+D-1]),h=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=qe(r,r.ins_h,r.window[r.strstart+1]);else y=n(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(y&&(me(r,!1),r.strm.avail_out===0))return Te}return r.insert=r.strstart<D-1?r.strstart:D-1,x===B?(me(r,!0),r.strm.avail_out===0?$e:Ce):r.sym_next&&(me(r,!1),r.strm.avail_out===0)?Te:Re},K=(r,x)=>{let h,y,v;for(;;){if(r.lookahead<re){if(l(r),r.lookahead<re&&x===p)return Te;if(r.lookahead===0)break}if(h=0,r.lookahead>=D&&(r.ins_h=qe(r,r.ins_h,r.window[r.strstart+D-1]),h=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=D-1,h!==0&&r.prev_length<r.max_lazy_match&&r.strstart-h<=r.w_size-re&&(r.match_length=_t(r,h),r.match_length<=5&&(r.strategy===O||r.match_length===D&&r.strstart-r.match_start>4096)&&(r.match_length=D-1)),r.prev_length>=D&&r.match_length<=r.prev_length){v=r.strstart+r.lookahead-D,y=n(r,r.strstart-1-r.prev_match,r.prev_length-D),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=v&&(r.ins_h=qe(r,r.ins_h,r.window[r.strstart+D-1]),h=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=D-1,r.strstart++,y&&(me(r,!1),r.strm.avail_out===0))return Te}else if(r.match_available){if(y=n(r,0,r.window[r.strstart-1]),y&&me(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Te}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(y=n(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<D-1?r.strstart:D-1,x===B?(me(r,!0),r.strm.avail_out===0?$e:Ce):r.sym_next&&(me(r,!1),r.strm.avail_out===0)?Te:Re},ae=(r,x)=>{let h,y,v,j;const ce=r.window;for(;;){if(r.lookahead<=ne){if(l(r),r.lookahead<=ne&&x===p)return Te;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=D&&r.strstart>0&&(v=r.strstart-1,y=ce[v],y===ce[++v]&&y===ce[++v]&&y===ce[++v])){j=r.strstart+ne;do;while(y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&v<j);r.match_length=ne-(j-v),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=D?(h=n(r,1,r.match_length-D),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(h=n(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),h&&(me(r,!1),r.strm.avail_out===0))return Te}return r.insert=0,x===B?(me(r,!0),r.strm.avail_out===0?$e:Ce):r.sym_next&&(me(r,!1),r.strm.avail_out===0)?Te:Re},oe=(r,x)=>{let h;for(;;){if(r.lookahead===0&&(l(r),r.lookahead===0)){if(x===p)return Te;break}if(r.match_length=0,h=n(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,h&&(me(r,!1),r.strm.avail_out===0))return Te}return r.insert=0,x===B?(me(r,!0),r.strm.avail_out===0?$e:Ce):r.sym_next&&(me(r,!1),r.strm.avail_out===0)?Te:Re};function g(r,x,h,y,v){this.good_length=r,this.max_lazy=x,this.nice_length=h,this.max_chain=y,this.func=v}const k=[new g(0,0,0,0,P),new g(4,4,8,4,G),new g(4,5,16,8,G),new g(4,6,32,32,G),new g(4,4,16,16,K),new g(8,16,32,32,K),new g(8,16,128,128,K),new g(8,32,128,256,K),new g(32,128,258,1024,K),new g(32,258,258,4096,K)],s=r=>{r.window_size=2*r.w_size,Ye(r.head),r.max_lazy_match=k[r.level].max_lazy,r.good_match=k[r.level].good_length,r.nice_match=k[r.level].nice_length,r.max_chain_length=k[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=D-1,r.match_available=0,r.ins_h=0};function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(N*2),this.dyn_dtree=new Uint16Array((2*A+1)*2),this.bl_tree=new Uint16Array((2*F+1)*2),Ye(this.dyn_ltree),Ye(this.dyn_dtree),Ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(te+1),this.heap=new Uint16Array(2*T+1),Ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*T+1),Ye(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const _e=r=>{if(!r)return 1;const x=r.state;return!x||x.strm!==r||x.status!==be&&x.status!==le&&x.status!==he&&x.status!==Ie&&x.status!==Ne&&x.status!==pe&&x.status!==ke&&x.status!==ge?1:0},H=r=>{if(_e(r))return De(r,L);r.total_in=r.total_out=0,r.data_type=ue;const x=r.state;return x.pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap===2?le:x.wrap?be:ke,r.adler=x.wrap===2?0:1,x.last_flush=-2,e(x),w},ve=r=>{const x=H(r);return x===w&&s(r.state),x},$=(r,x)=>_e(r)||r.state.wrap!==2?L:(r.state.gzhead=x,w),Fe=(r,x,h,y,v,j)=>{if(!r)return L;let ce=1;if(x===q&&(x=6),y<0?(ce=0,y=-y):y>15&&(ce=2,y-=16),v<1||v>xe||h!==fe||y<8||y>15||x<0||x>9||j<0||j>Y||y===8&&ce!==1)return De(r,L);y===8&&(y=9);const ee=new W;return r.state=ee,ee.strm=r,ee.status=be,ee.wrap=ce,ee.gzhead=null,ee.w_bits=y,ee.w_size=1<<ee.w_bits,ee.w_mask=ee.w_size-1,ee.hash_bits=v+7,ee.hash_size=1<<ee.hash_bits,ee.hash_mask=ee.hash_size-1,ee.hash_shift=~~((ee.hash_bits+D-1)/D),ee.window=new Uint8Array(ee.w_size*2),ee.head=new Uint16Array(ee.hash_size),ee.prev=new Uint16Array(ee.w_size),ee.lit_bufsize=1<<v+6,ee.pending_buf_size=ee.lit_bufsize*4,ee.pending_buf=new Uint8Array(ee.pending_buf_size),ee.sym_buf=ee.lit_bufsize,ee.sym_end=(ee.lit_bufsize-1)*3,ee.level=x,ee.strategy=j,ee.method=h,ve(r)},E=(r,x)=>Fe(r,x,fe,we,se,Z),I=(r,x)=>{if(_e(r)||x>X||x<0)return r?De(r,L):L;const h=r.state;if(!r.output||r.avail_in!==0&&!r.input||h.status===ge&&x!==B)return De(r,r.avail_out===0?J:L);const y=h.last_flush;if(h.last_flush=x,h.pending!==0){if(Pe(r),r.avail_out===0)return h.last_flush=-1,w}else if(r.avail_in===0&&Qe(x)<=Qe(y)&&x!==B)return De(r,J);if(h.status===ge&&r.avail_in!==0)return De(r,J);if(h.status===be&&h.wrap===0&&(h.status=ke),h.status===be){let v=fe+(h.w_bits-8<<4)<<8,j=-1;if(h.strategy>=b||h.level<2?j=0:h.level<6?j=1:h.level===6?j=2:j=3,v|=j<<6,h.strstart!==0&&(v|=Se),v+=31-v%31,Ge(h,v),h.strstart!==0&&(Ge(h,r.adler>>>16),Ge(h,r.adler&65535)),r.adler=1,h.status=ke,Pe(r),h.pending!==0)return h.last_flush=-1,w}if(h.status===le){if(r.adler=0,V(h,31),V(h,139),V(h,8),h.gzhead)V(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),V(h,h.gzhead.time&255),V(h,h.gzhead.time>>8&255),V(h,h.gzhead.time>>16&255),V(h,h.gzhead.time>>24&255),V(h,h.level===9?2:h.strategy>=b||h.level<2?4:0),V(h,h.gzhead.os&255),h.gzhead.extra&&h.gzhead.extra.length&&(V(h,h.gzhead.extra.length&255),V(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(r.adler=f(r.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=he;else if(V(h,0),V(h,0),V(h,0),V(h,0),V(h,0),V(h,h.level===9?2:h.strategy>=b||h.level<2?4:0),V(h,ye),h.status=ke,Pe(r),h.pending!==0)return h.last_flush=-1,w}if(h.status===he){if(h.gzhead.extra){let v=h.pending,j=(h.gzhead.extra.length&65535)-h.gzindex;for(;h.pending+j>h.pending_buf_size;){let ee=h.pending_buf_size-h.pending;if(h.pending_buf.set(h.gzhead.extra.subarray(h.gzindex,h.gzindex+ee),h.pending),h.pending=h.pending_buf_size,h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v)),h.gzindex+=ee,Pe(r),h.pending!==0)return h.last_flush=-1,w;v=0,j-=ee}let ce=new Uint8Array(h.gzhead.extra);h.pending_buf.set(ce.subarray(h.gzindex,h.gzindex+j),h.pending),h.pending+=j,h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v)),h.gzindex=0}h.status=Ie}if(h.status===Ie){if(h.gzhead.name){let v=h.pending,j;do{if(h.pending===h.pending_buf_size){if(h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v)),Pe(r),h.pending!==0)return h.last_flush=-1,w;v=0}h.gzindex<h.gzhead.name.length?j=h.gzhead.name.charCodeAt(h.gzindex++)&255:j=0,V(h,j)}while(j!==0);h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v)),h.gzindex=0}h.status=Ne}if(h.status===Ne){if(h.gzhead.comment){let v=h.pending,j;do{if(h.pending===h.pending_buf_size){if(h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v)),Pe(r),h.pending!==0)return h.last_flush=-1,w;v=0}h.gzindex<h.gzhead.comment.length?j=h.gzhead.comment.charCodeAt(h.gzindex++)&255:j=0,V(h,j)}while(j!==0);h.gzhead.hcrc&&h.pending>v&&(r.adler=f(r.adler,h.pending_buf,h.pending-v,v))}h.status=pe}if(h.status===pe){if(h.gzhead.hcrc){if(h.pending+2>h.pending_buf_size&&(Pe(r),h.pending!==0))return h.last_flush=-1,w;V(h,r.adler&255),V(h,r.adler>>8&255),r.adler=0}if(h.status=ke,Pe(r),h.pending!==0)return h.last_flush=-1,w}if(r.avail_in!==0||h.lookahead!==0||x!==p&&h.status!==ge){let v=h.level===0?P(h,x):h.strategy===b?oe(h,x):h.strategy===M?ae(h,x):k[h.level].func(h,x);if((v===$e||v===Ce)&&(h.status=ge),v===Te||v===$e)return r.avail_out===0&&(h.last_flush=-1),w;if(v===Re&&(x===d?a(h):x!==X&&(t(h,0,0,!1),x===S&&(Ye(h.head),h.lookahead===0&&(h.strstart=0,h.block_start=0,h.insert=0))),Pe(r),r.avail_out===0))return h.last_flush=-1,w}return x!==B?w:h.wrap<=0?R:(h.wrap===2?(V(h,r.adler&255),V(h,r.adler>>8&255),V(h,r.adler>>16&255),V(h,r.adler>>24&255),V(h,r.total_in&255),V(h,r.total_in>>8&255),V(h,r.total_in>>16&255),V(h,r.total_in>>24&255)):(Ge(h,r.adler>>>16),Ge(h,r.adler&65535)),Pe(r),h.wrap>0&&(h.wrap=-h.wrap),h.pending!==0?w:R)},ai=r=>{if(_e(r))return L;const x=r.state.status;return r.state=null,x===ke?De(r,C):w},He=(r,x)=>{let h=x.length;if(_e(r))return L;const y=r.state,v=y.wrap;if(v===2||v===1&&y.status!==be||y.lookahead)return L;if(v===1&&(r.adler=o(r.adler,x,h,0)),y.wrap=0,h>=y.w_size){v===0&&(Ye(y.head),y.strstart=0,y.block_start=0,y.insert=0);let ft=new Uint8Array(y.w_size);ft.set(x.subarray(h-y.w_size,h),0),x=ft,h=y.w_size}const j=r.avail_in,ce=r.next_in,ee=r.input;for(r.avail_in=h,r.next_in=0,r.input=x,l(y);y.lookahead>=D;){let ft=y.strstart,Le=y.lookahead-(D-1);do y.ins_h=qe(y,y.ins_h,y.window[ft+D-1]),y.prev[ft&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=ft,ft++;while(--Le);y.strstart=ft,y.lookahead=D-1,l(y)}return y.strstart+=y.lookahead,y.block_start=y.strstart,y.insert=y.lookahead,y.lookahead=0,y.match_length=y.prev_length=D-1,y.match_available=0,r.next_in=ce,r.input=ee,r.avail_in=j,y.wrap=v,w};return St.deflateInit=E,St.deflateInit2=Fe,St.deflateReset=ve,St.deflateResetKeep=H,St.deflateSetHeader=$,St.deflate=I,St.deflateEnd=ai,St.deflateSetDictionary=He,St.deflateInfo="pako deflate (from Nodeca project)",St}var tn={},Ba;function qr(){if(Ba)return tn;Ba=1;const e=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);return tn.assign=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const a in n)e(n,a)&&(t[a]=n[a])}}return t},tn.flattenChunks=t=>{let i=0;for(let a=0,o=t.length;a<o;a++)i+=t[a].length;const n=new Uint8Array(i);for(let a=0,o=0,f=t.length;a<f;a++){let c=t[a];n.set(c,o),o+=c.length}return n},tn}var Si={},Na;function Zr(){if(Na)return Si;Na=1;let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}const t=new Uint8Array(256);for(let n=0;n<256;n++)t[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;t[254]=t[254]=1,Si.string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let a,o,f,c,p,d=n.length,S=0;for(c=0;c<d;c++)o=n.charCodeAt(c),(o&64512)===55296&&c+1<d&&(f=n.charCodeAt(c+1),(f&64512)===56320&&(o=65536+(o-55296<<10)+(f-56320),c++)),S+=o<128?1:o<2048?2:o<65536?3:4;for(a=new Uint8Array(S),p=0,c=0;p<S;c++)o=n.charCodeAt(c),(o&64512)===55296&&c+1<d&&(f=n.charCodeAt(c+1),(f&64512)===56320&&(o=65536+(o-55296<<10)+(f-56320),c++)),o<128?a[p++]=o:o<2048?(a[p++]=192|o>>>6,a[p++]=128|o&63):o<65536?(a[p++]=224|o>>>12,a[p++]=128|o>>>6&63,a[p++]=128|o&63):(a[p++]=240|o>>>18,a[p++]=128|o>>>12&63,a[p++]=128|o>>>6&63,a[p++]=128|o&63);return a};const i=(n,a)=>{if(a<65534&&n.subarray&&e)return String.fromCharCode.apply(null,n.length===a?n:n.subarray(0,a));let o="";for(let f=0;f<a;f++)o+=String.fromCharCode(n[f]);return o};return Si.buf2string=(n,a)=>{const o=a||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,a));let f,c;const p=new Array(o*2);for(c=0,f=0;f<o;){let d=n[f++];if(d<128){p[c++]=d;continue}let S=t[d];if(S>4){p[c++]=65533,f+=S-1;continue}for(d&=S===2?31:S===3?15:7;S>1&&f<o;)d=d<<6|n[f++]&63,S--;if(S>1){p[c++]=65533;continue}d<65536?p[c++]=d:(d-=65536,p[c++]=55296|d>>10&1023,p[c++]=56320|d&1023)}return i(p,c)},Si.utf8border=(n,a)=>{a=a||n.length,a>n.length&&(a=n.length);let o=a-1;for(;o>=0&&(n[o]&192)===128;)o--;return o<0||o===0?a:o+t[n[o]]>a?o:a},Si}var Cn,Ua;function $r(){if(Ua)return Cn;Ua=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return Cn=e,Cn}var Wa;function fl(){if(Wa)return Zt;Wa=1;const e=ul(),t=qr(),i=Zr(),n=sa(),a=$r(),o=Object.prototype.toString,{Z_NO_FLUSH:f,Z_SYNC_FLUSH:c,Z_FULL_FLUSH:p,Z_FINISH:d,Z_OK:S,Z_STREAM_END:B,Z_DEFAULT_COMPRESSION:X,Z_DEFAULT_STRATEGY:w,Z_DEFLATED:R}=ti();function L(O){this.options=t.assign({level:X,method:R,chunkSize:16384,windowBits:15,memLevel:8,strategy:w},O||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let M=e.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(M!==S)throw new Error(n[M]);if(b.header&&e.deflateSetHeader(this.strm,b.header),b.dictionary){let Y;if(typeof b.dictionary=="string"?Y=i.string2buf(b.dictionary):o.call(b.dictionary)==="[object ArrayBuffer]"?Y=new Uint8Array(b.dictionary):Y=b.dictionary,M=e.deflateSetDictionary(this.strm,Y),M!==S)throw new Error(n[M]);this._dict_set=!0}}L.prototype.push=function(O,b){const M=this.strm,Y=this.options.chunkSize;let Z,ue;if(this.ended)return!1;for(b===~~b?ue=b:ue=b===!0?d:f,typeof O=="string"?M.input=i.string2buf(O):o.call(O)==="[object ArrayBuffer]"?M.input=new Uint8Array(O):M.input=O,M.next_in=0,M.avail_in=M.input.length;;){if(M.avail_out===0&&(M.output=new Uint8Array(Y),M.next_out=0,M.avail_out=Y),(ue===c||ue===p)&&M.avail_out<=6){this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;continue}if(Z=e.deflate(M,ue),Z===B)return M.next_out>0&&this.onData(M.output.subarray(0,M.next_out)),Z=e.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===S;if(M.avail_out===0){this.onData(M.output);continue}if(ue>0&&M.next_out>0){this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;continue}if(M.avail_in===0)break}return!0},L.prototype.onData=function(O){this.chunks.push(O)},L.prototype.onEnd=function(O){O===S&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg};function C(O,b){const M=new L(b);if(M.push(O,!0),M.err)throw M.msg||n[M.err];return M.result}function J(O,b){return b=b||{},b.raw=!0,C(O,b)}function q(O,b){return b=b||{},b.gzip=!0,C(O,b)}return Zt.Deflate=L,Zt.deflate=C,Zt.deflateRaw=J,Zt.gzip=q,Zt.constants=ti(),Zt}var jt={},Tt={},Pn,Ga;function hl(){if(Ga)return Pn;Ga=1;const e=16209,t=16191;return Pn=function(n,a){let o,f,c,p,d,S,B,X,w,R,L,C,J,q,O,b,M,Y,Z,ue,fe,xe,we,se;const ie=n.state;o=n.next_in,we=n.input,f=o+(n.avail_in-5),c=n.next_out,se=n.output,p=c-(a-n.avail_out),d=c+(n.avail_out-257),S=ie.dmax,B=ie.wsize,X=ie.whave,w=ie.wnext,R=ie.window,L=ie.hold,C=ie.bits,J=ie.lencode,q=ie.distcode,O=(1<<ie.lenbits)-1,b=(1<<ie.distbits)-1;e:do{C<15&&(L+=we[o++]<<C,C+=8,L+=we[o++]<<C,C+=8),M=J[L&O];t:for(;;){if(Y=M>>>24,L>>>=Y,C-=Y,Y=M>>>16&255,Y===0)se[c++]=M&65535;else if(Y&16){Z=M&65535,Y&=15,Y&&(C<Y&&(L+=we[o++]<<C,C+=8),Z+=L&(1<<Y)-1,L>>>=Y,C-=Y),C<15&&(L+=we[o++]<<C,C+=8,L+=we[o++]<<C,C+=8),M=q[L&b];i:for(;;){if(Y=M>>>24,L>>>=Y,C-=Y,Y=M>>>16&255,Y&16){if(ue=M&65535,Y&=15,C<Y&&(L+=we[o++]<<C,C+=8,C<Y&&(L+=we[o++]<<C,C+=8)),ue+=L&(1<<Y)-1,ue>S){n.msg="invalid distance too far back",ie.mode=e;break e}if(L>>>=Y,C-=Y,Y=c-p,ue>Y){if(Y=ue-Y,Y>X&&ie.sane){n.msg="invalid distance too far back",ie.mode=e;break e}if(fe=0,xe=R,w===0){if(fe+=B-Y,Y<Z){Z-=Y;do se[c++]=R[fe++];while(--Y);fe=c-ue,xe=se}}else if(w<Y){if(fe+=B+w-Y,Y-=w,Y<Z){Z-=Y;do se[c++]=R[fe++];while(--Y);if(fe=0,w<Z){Y=w,Z-=Y;do se[c++]=R[fe++];while(--Y);fe=c-ue,xe=se}}}else if(fe+=w-Y,Y<Z){Z-=Y;do se[c++]=R[fe++];while(--Y);fe=c-ue,xe=se}for(;Z>2;)se[c++]=xe[fe++],se[c++]=xe[fe++],se[c++]=xe[fe++],Z-=3;Z&&(se[c++]=xe[fe++],Z>1&&(se[c++]=xe[fe++]))}else{fe=c-ue;do se[c++]=se[fe++],se[c++]=se[fe++],se[c++]=se[fe++],Z-=3;while(Z>2);Z&&(se[c++]=se[fe++],Z>1&&(se[c++]=se[fe++]))}}else if(Y&64){n.msg="invalid distance code",ie.mode=e;break e}else{M=q[(M&65535)+(L&(1<<Y)-1)];continue i}break}}else if(Y&64)if(Y&32){ie.mode=t;break e}else{n.msg="invalid literal/length code",ie.mode=e;break e}else{M=J[(M&65535)+(L&(1<<Y)-1)];continue t}break}}while(o<f&&c<d);Z=C>>3,o-=Z,C-=Z<<3,L&=(1<<C)-1,n.next_in=o,n.next_out=c,n.avail_in=o<f?5+(f-o):5-(o-f),n.avail_out=c<d?257+(d-c):257-(c-d),ie.hold=L,ie.bits=C},Pn}var zn,Ha;function dl(){if(Ha)return zn;Ha=1;const e=15,t=852,i=592,n=0,a=1,o=2,f=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),c=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),p=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);return zn=(B,X,w,R,L,C,J,q)=>{const O=q.bits;let b=0,M=0,Y=0,Z=0,ue=0,fe=0,xe=0,we=0,se=0,ie=0,m,T,A,F,N,te=null,D;const ne=new Uint16Array(e+1),re=new Uint16Array(e+1);let Se=null,be,le,he;for(b=0;b<=e;b++)ne[b]=0;for(M=0;M<R;M++)ne[X[w+M]]++;for(ue=O,Z=e;Z>=1&&ne[Z]===0;Z--);if(ue>Z&&(ue=Z),Z===0)return L[C++]=1<<24|64<<16|0,L[C++]=1<<24|64<<16|0,q.bits=1,0;for(Y=1;Y<Z&&ne[Y]===0;Y++);for(ue<Y&&(ue=Y),we=1,b=1;b<=e;b++)if(we<<=1,we-=ne[b],we<0)return-1;if(we>0&&(B===n||Z!==1))return-1;for(re[1]=0,b=1;b<e;b++)re[b+1]=re[b]+ne[b];for(M=0;M<R;M++)X[w+M]!==0&&(J[re[X[w+M]]++]=M);if(B===n?(te=Se=J,D=20):B===a?(te=f,Se=c,D=257):(te=p,Se=d,D=0),ie=0,M=0,b=Y,N=C,fe=ue,xe=0,A=-1,se=1<<ue,F=se-1,B===a&&se>t||B===o&&se>i)return 1;for(;;){be=b-xe,J[M]+1<D?(le=0,he=J[M]):J[M]>=D?(le=Se[J[M]-D],he=te[J[M]-D]):(le=96,he=0),m=1<<b-xe,T=1<<fe,Y=T;do T-=m,L[N+(ie>>xe)+T]=be<<24|le<<16|he|0;while(T!==0);for(m=1<<b-1;ie&m;)m>>=1;if(m!==0?(ie&=m-1,ie+=m):ie=0,M++,--ne[b]===0){if(b===Z)break;b=X[w+J[M]]}if(b>ue&&(ie&F)!==A){for(xe===0&&(xe=ue),N+=Y,fe=b-xe,we=1<<fe;fe+xe<Z&&(we-=ne[fe+xe],!(we<=0));)fe++,we<<=1;if(se+=1<<fe,B===a&&se>t||B===o&&se>i)return 1;A=ie&F,L[A]=ue<<24|fe<<16|N-C|0}}return ie!==0&&(L[N+ie]=b-xe<<24|64<<16|0),q.bits=ue,0},zn}var Ya;function pl(){if(Ya)return Tt;Ya=1;const e=Hr(),t=Yr(),i=hl(),n=dl(),a=0,o=1,f=2,{Z_FINISH:c,Z_BLOCK:p,Z_TREES:d,Z_OK:S,Z_STREAM_END:B,Z_NEED_DICT:X,Z_STREAM_ERROR:w,Z_DATA_ERROR:R,Z_MEM_ERROR:L,Z_BUF_ERROR:C,Z_DEFLATED:J}=ti(),q=16180,O=16181,b=16182,M=16183,Y=16184,Z=16185,ue=16186,fe=16187,xe=16188,we=16189,se=16190,ie=16191,m=16192,T=16193,A=16194,F=16195,N=16196,te=16197,D=16198,ne=16199,re=16200,Se=16201,be=16202,le=16203,he=16204,Ie=16205,Ne=16206,pe=16207,ke=16208,ge=16209,Te=16210,Re=16211,$e=852,Ce=592,De=15,Qe=g=>(g>>>24&255)+(g>>>8&65280)+((g&65280)<<8)+((g&255)<<24);function Ye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ue=g=>{if(!g)return 1;const k=g.state;return!k||k.strm!==g||k.mode<q||k.mode>Re?1:0},ct=g=>{if(Ue(g))return w;const k=g.state;return g.total_in=g.total_out=k.total=0,g.msg="",k.wrap&&(g.adler=k.wrap&1),k.mode=q,k.last=0,k.havedict=0,k.flags=-1,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new Int32Array($e),k.distcode=k.distdyn=new Int32Array(Ce),k.sane=1,k.back=-1,S},qe=g=>{if(Ue(g))return w;const k=g.state;return k.wsize=0,k.whave=0,k.wnext=0,ct(g)},Pe=(g,k)=>{let s;if(Ue(g))return w;const W=g.state;return k<0?(s=0,k=-k):(s=(k>>4)+5,k<48&&(k&=15)),k&&(k<8||k>15)?w:(W.window!==null&&W.wbits!==k&&(W.window=null),W.wrap=s,W.wbits=k,qe(g))},me=(g,k)=>{if(!g)return w;const s=new Ye;g.state=s,s.strm=g,s.window=null,s.mode=q;const W=Pe(g,k);return W!==S&&(g.state=null),W},V=g=>me(g,De);let Ge=!0,gt,_t;const l=g=>{if(Ge){gt=new Int32Array(512),_t=new Int32Array(32);let k=0;for(;k<144;)g.lens[k++]=8;for(;k<256;)g.lens[k++]=9;for(;k<280;)g.lens[k++]=7;for(;k<288;)g.lens[k++]=8;for(n(o,g.lens,0,288,gt,0,g.work,{bits:9}),k=0;k<32;)g.lens[k++]=5;n(f,g.lens,0,32,_t,0,g.work,{bits:5}),Ge=!1}g.lencode=gt,g.lenbits=9,g.distcode=_t,g.distbits=5},P=(g,k,s,W)=>{let _e;const H=g.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new Uint8Array(H.wsize)),W>=H.wsize?(H.window.set(k.subarray(s-H.wsize,s),0),H.wnext=0,H.whave=H.wsize):(_e=H.wsize-H.wnext,_e>W&&(_e=W),H.window.set(k.subarray(s-W,s-W+_e),H.wnext),W-=_e,W?(H.window.set(k.subarray(s-W,s),0),H.wnext=W,H.whave=H.wsize):(H.wnext+=_e,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=_e))),0},G=(g,k)=>{let s,W,_e,H,ve,$,Fe,E,I,ai,He,r,x,h,y=0,v,j,ce,ee,ft,Le,Ve,mt;const et=new Uint8Array(4);let wt,yt;const ca=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ue(g)||!g.output||!g.input&&g.avail_in!==0)return w;s=g.state,s.mode===ie&&(s.mode=m),ve=g.next_out,_e=g.output,Fe=g.avail_out,H=g.next_in,W=g.input,$=g.avail_in,E=s.hold,I=s.bits,ai=$,He=Fe,mt=S;e:for(;;)switch(s.mode){case q:if(s.wrap===0){s.mode=m;break}for(;I<16;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(s.wrap&2&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,et[0]=E&255,et[1]=E>>>8&255,s.check=t(s.check,et,2,0),E=0,I=0,s.mode=O;break}if(s.head&&(s.head.done=!1),!(s.wrap&1)||(((E&255)<<8)+(E>>8))%31){g.msg="incorrect header check",s.mode=ge;break}if((E&15)!==J){g.msg="unknown compression method",s.mode=ge;break}if(E>>>=4,I-=4,Ve=(E&15)+8,s.wbits===0&&(s.wbits=Ve),Ve>15||Ve>s.wbits){g.msg="invalid window size",s.mode=ge;break}s.dmax=1<<s.wbits,s.flags=0,g.adler=s.check=1,s.mode=E&512?we:ie,E=0,I=0;break;case O:for(;I<16;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(s.flags=E,(s.flags&255)!==J){g.msg="unknown compression method",s.mode=ge;break}if(s.flags&57344){g.msg="unknown header flags set",s.mode=ge;break}s.head&&(s.head.text=E>>8&1),s.flags&512&&s.wrap&4&&(et[0]=E&255,et[1]=E>>>8&255,s.check=t(s.check,et,2,0)),E=0,I=0,s.mode=b;case b:for(;I<32;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.head&&(s.head.time=E),s.flags&512&&s.wrap&4&&(et[0]=E&255,et[1]=E>>>8&255,et[2]=E>>>16&255,et[3]=E>>>24&255,s.check=t(s.check,et,4,0)),E=0,I=0,s.mode=M;case M:for(;I<16;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.head&&(s.head.xflags=E&255,s.head.os=E>>8),s.flags&512&&s.wrap&4&&(et[0]=E&255,et[1]=E>>>8&255,s.check=t(s.check,et,2,0)),E=0,I=0,s.mode=Y;case Y:if(s.flags&1024){for(;I<16;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.length=E,s.head&&(s.head.extra_len=E),s.flags&512&&s.wrap&4&&(et[0]=E&255,et[1]=E>>>8&255,s.check=t(s.check,et,2,0)),E=0,I=0}else s.head&&(s.head.extra=null);s.mode=Z;case Z:if(s.flags&1024&&(r=s.length,r>$&&(r=$),r&&(s.head&&(Ve=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(W.subarray(H,H+r),Ve)),s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,r,H)),$-=r,H+=r,s.length-=r),s.length))break e;s.length=0,s.mode=ue;case ue:if(s.flags&2048){if($===0)break e;r=0;do Ve=W[H+r++],s.head&&Ve&&s.length<65536&&(s.head.name+=String.fromCharCode(Ve));while(Ve&&r<$);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,r,H)),$-=r,H+=r,Ve)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=fe;case fe:if(s.flags&4096){if($===0)break e;r=0;do Ve=W[H+r++],s.head&&Ve&&s.length<65536&&(s.head.comment+=String.fromCharCode(Ve));while(Ve&&r<$);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,r,H)),$-=r,H+=r,Ve)break e}else s.head&&(s.head.comment=null);s.mode=xe;case xe:if(s.flags&512){for(;I<16;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(s.wrap&4&&E!==(s.check&65535)){g.msg="header crc mismatch",s.mode=ge;break}E=0,I=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),g.adler=s.check=0,s.mode=ie;break;case we:for(;I<32;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}g.adler=s.check=Qe(E),E=0,I=0,s.mode=se;case se:if(s.havedict===0)return g.next_out=ve,g.avail_out=Fe,g.next_in=H,g.avail_in=$,s.hold=E,s.bits=I,X;g.adler=s.check=1,s.mode=ie;case ie:if(k===p||k===d)break e;case m:if(s.last){E>>>=I&7,I-=I&7,s.mode=Ne;break}for(;I<3;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}switch(s.last=E&1,E>>>=1,I-=1,E&3){case 0:s.mode=T;break;case 1:if(l(s),s.mode=ne,k===d){E>>>=2,I-=2;break e}break;case 2:s.mode=N;break;case 3:g.msg="invalid block type",s.mode=ge}E>>>=2,I-=2;break;case T:for(E>>>=I&7,I-=I&7;I<32;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if((E&65535)!==(E>>>16^65535)){g.msg="invalid stored block lengths",s.mode=ge;break}if(s.length=E&65535,E=0,I=0,s.mode=A,k===d)break e;case A:s.mode=F;case F:if(r=s.length,r){if(r>$&&(r=$),r>Fe&&(r=Fe),r===0)break e;_e.set(W.subarray(H,H+r),ve),$-=r,H+=r,Fe-=r,ve+=r,s.length-=r;break}s.mode=ie;break;case N:for(;I<14;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(s.nlen=(E&31)+257,E>>>=5,I-=5,s.ndist=(E&31)+1,E>>>=5,I-=5,s.ncode=(E&15)+4,E>>>=4,I-=4,s.nlen>286||s.ndist>30){g.msg="too many length or distance symbols",s.mode=ge;break}s.have=0,s.mode=te;case te:for(;s.have<s.ncode;){for(;I<3;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.lens[ca[s.have++]]=E&7,E>>>=3,I-=3}for(;s.have<19;)s.lens[ca[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,wt={bits:s.lenbits},mt=n(a,s.lens,0,19,s.lencode,0,s.work,wt),s.lenbits=wt.bits,mt){g.msg="invalid code lengths set",s.mode=ge;break}s.have=0,s.mode=D;case D:for(;s.have<s.nlen+s.ndist;){for(;y=s.lencode[E&(1<<s.lenbits)-1],v=y>>>24,j=y>>>16&255,ce=y&65535,!(v<=I);){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(ce<16)E>>>=v,I-=v,s.lens[s.have++]=ce;else{if(ce===16){for(yt=v+2;I<yt;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(E>>>=v,I-=v,s.have===0){g.msg="invalid bit length repeat",s.mode=ge;break}Ve=s.lens[s.have-1],r=3+(E&3),E>>>=2,I-=2}else if(ce===17){for(yt=v+3;I<yt;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}E>>>=v,I-=v,Ve=0,r=3+(E&7),E>>>=3,I-=3}else{for(yt=v+7;I<yt;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}E>>>=v,I-=v,Ve=0,r=11+(E&127),E>>>=7,I-=7}if(s.have+r>s.nlen+s.ndist){g.msg="invalid bit length repeat",s.mode=ge;break}for(;r--;)s.lens[s.have++]=Ve}}if(s.mode===ge)break;if(s.lens[256]===0){g.msg="invalid code -- missing end-of-block",s.mode=ge;break}if(s.lenbits=9,wt={bits:s.lenbits},mt=n(o,s.lens,0,s.nlen,s.lencode,0,s.work,wt),s.lenbits=wt.bits,mt){g.msg="invalid literal/lengths set",s.mode=ge;break}if(s.distbits=6,s.distcode=s.distdyn,wt={bits:s.distbits},mt=n(f,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,wt),s.distbits=wt.bits,mt){g.msg="invalid distances set",s.mode=ge;break}if(s.mode=ne,k===d)break e;case ne:s.mode=re;case re:if($>=6&&Fe>=258){g.next_out=ve,g.avail_out=Fe,g.next_in=H,g.avail_in=$,s.hold=E,s.bits=I,i(g,He),ve=g.next_out,_e=g.output,Fe=g.avail_out,H=g.next_in,W=g.input,$=g.avail_in,E=s.hold,I=s.bits,s.mode===ie&&(s.back=-1);break}for(s.back=0;y=s.lencode[E&(1<<s.lenbits)-1],v=y>>>24,j=y>>>16&255,ce=y&65535,!(v<=I);){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(j&&!(j&240)){for(ee=v,ft=j,Le=ce;y=s.lencode[Le+((E&(1<<ee+ft)-1)>>ee)],v=y>>>24,j=y>>>16&255,ce=y&65535,!(ee+v<=I);){if($===0)break e;$--,E+=W[H++]<<I,I+=8}E>>>=ee,I-=ee,s.back+=ee}if(E>>>=v,I-=v,s.back+=v,s.length=ce,j===0){s.mode=Ie;break}if(j&32){s.back=-1,s.mode=ie;break}if(j&64){g.msg="invalid literal/length code",s.mode=ge;break}s.extra=j&15,s.mode=Se;case Se:if(s.extra){for(yt=s.extra;I<yt;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,I-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=be;case be:for(;y=s.distcode[E&(1<<s.distbits)-1],v=y>>>24,j=y>>>16&255,ce=y&65535,!(v<=I);){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(!(j&240)){for(ee=v,ft=j,Le=ce;y=s.distcode[Le+((E&(1<<ee+ft)-1)>>ee)],v=y>>>24,j=y>>>16&255,ce=y&65535,!(ee+v<=I);){if($===0)break e;$--,E+=W[H++]<<I,I+=8}E>>>=ee,I-=ee,s.back+=ee}if(E>>>=v,I-=v,s.back+=v,j&64){g.msg="invalid distance code",s.mode=ge;break}s.offset=ce,s.extra=j&15,s.mode=le;case le:if(s.extra){for(yt=s.extra;I<yt;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,I-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){g.msg="invalid distance too far back",s.mode=ge;break}s.mode=he;case he:if(Fe===0)break e;if(r=He-Fe,s.offset>r){if(r=s.offset-r,r>s.whave&&s.sane){g.msg="invalid distance too far back",s.mode=ge;break}r>s.wnext?(r-=s.wnext,x=s.wsize-r):x=s.wnext-r,r>s.length&&(r=s.length),h=s.window}else h=_e,x=ve-s.offset,r=s.length;r>Fe&&(r=Fe),Fe-=r,s.length-=r;do _e[ve++]=h[x++];while(--r);s.length===0&&(s.mode=re);break;case Ie:if(Fe===0)break e;_e[ve++]=s.length,Fe--,s.mode=re;break;case Ne:if(s.wrap){for(;I<32;){if($===0)break e;$--,E|=W[H++]<<I,I+=8}if(He-=Fe,g.total_out+=He,s.total+=He,s.wrap&4&&He&&(g.adler=s.check=s.flags?t(s.check,_e,He,ve-He):e(s.check,_e,He,ve-He)),He=Fe,s.wrap&4&&(s.flags?E:Qe(E))!==s.check){g.msg="incorrect data check",s.mode=ge;break}E=0,I=0}s.mode=pe;case pe:if(s.wrap&&s.flags){for(;I<32;){if($===0)break e;$--,E+=W[H++]<<I,I+=8}if(s.wrap&4&&E!==(s.total&4294967295)){g.msg="incorrect length check",s.mode=ge;break}E=0,I=0}s.mode=ke;case ke:mt=B;break e;case ge:mt=R;break e;case Te:return L;case Re:default:return w}return g.next_out=ve,g.avail_out=Fe,g.next_in=H,g.avail_in=$,s.hold=E,s.bits=I,(s.wsize||He!==g.avail_out&&s.mode<ge&&(s.mode<Ne||k!==c))&&P(g,g.output,g.next_out,He-g.avail_out),ai-=g.avail_in,He-=g.avail_out,g.total_in+=ai,g.total_out+=He,s.total+=He,s.wrap&4&&He&&(g.adler=s.check=s.flags?t(s.check,_e,He,g.next_out-He):e(s.check,_e,He,g.next_out-He)),g.data_type=s.bits+(s.last?64:0)+(s.mode===ie?128:0)+(s.mode===ne||s.mode===A?256:0),(ai===0&&He===0||k===c)&&mt===S&&(mt=C),mt},K=g=>{if(Ue(g))return w;let k=g.state;return k.window&&(k.window=null),g.state=null,S},ae=(g,k)=>{if(Ue(g))return w;const s=g.state;return s.wrap&2?(s.head=k,k.done=!1,S):w},oe=(g,k)=>{const s=k.length;let W,_e,H;return Ue(g)||(W=g.state,W.wrap!==0&&W.mode!==se)?w:W.mode===se&&(_e=1,_e=e(_e,k,s,0),_e!==W.check)?R:(H=P(g,k,s,s),H?(W.mode=Te,L):(W.havedict=1,S))};return Tt.inflateReset=qe,Tt.inflateReset2=Pe,Tt.inflateResetKeep=ct,Tt.inflateInit=V,Tt.inflateInit2=me,Tt.inflate=G,Tt.inflateEnd=K,Tt.inflateGetHeader=ae,Tt.inflateSetDictionary=oe,Tt.inflateInfo="pako inflate (from Nodeca project)",Tt}var Dn,qa;function gl(){if(qa)return Dn;qa=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return Dn=e,Dn}var Za;function ml(){if(Za)return jt;Za=1;const e=pl(),t=qr(),i=Zr(),n=sa(),a=$r(),o=gl(),f=Object.prototype.toString,{Z_NO_FLUSH:c,Z_FINISH:p,Z_OK:d,Z_STREAM_END:S,Z_NEED_DICT:B,Z_STREAM_ERROR:X,Z_DATA_ERROR:w,Z_MEM_ERROR:R}=ti();function L(q){this.options=t.assign({chunkSize:1024*64,windowBits:15,to:""},q||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,O.windowBits===0&&(O.windowBits=-15)),O.windowBits>=0&&O.windowBits<16&&!(q&&q.windowBits)&&(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&(O.windowBits&15||(O.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let b=e.inflateInit2(this.strm,O.windowBits);if(b!==d)throw new Error(n[b]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),O.dictionary&&(typeof O.dictionary=="string"?O.dictionary=i.string2buf(O.dictionary):f.call(O.dictionary)==="[object ArrayBuffer]"&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(b=e.inflateSetDictionary(this.strm,O.dictionary),b!==d)))throw new Error(n[b])}L.prototype.push=function(q,O){const b=this.strm,M=this.options.chunkSize,Y=this.options.dictionary;let Z,ue,fe;if(this.ended)return!1;for(O===~~O?ue=O:ue=O===!0?p:c,f.call(q)==="[object ArrayBuffer]"?b.input=new Uint8Array(q):b.input=q,b.next_in=0,b.avail_in=b.input.length;;){for(b.avail_out===0&&(b.output=new Uint8Array(M),b.next_out=0,b.avail_out=M),Z=e.inflate(b,ue),Z===B&&Y&&(Z=e.inflateSetDictionary(b,Y),Z===d?Z=e.inflate(b,ue):Z===w&&(Z=B));b.avail_in>0&&Z===S&&b.state.wrap>0&&q[b.next_in]!==0;)e.inflateReset(b),Z=e.inflate(b,ue);switch(Z){case X:case w:case B:case R:return this.onEnd(Z),this.ended=!0,!1}if(fe=b.avail_out,b.next_out&&(b.avail_out===0||Z===S))if(this.options.to==="string"){let xe=i.utf8border(b.output,b.next_out),we=b.next_out-xe,se=i.buf2string(b.output,xe);b.next_out=we,b.avail_out=M-we,we&&b.output.set(b.output.subarray(xe,xe+we),0),this.onData(se)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(!(Z===d&&fe===0)){if(Z===S)return Z=e.inflateEnd(this.strm),this.onEnd(Z),this.ended=!0,!0;if(b.avail_in===0)break}}return!0},L.prototype.onData=function(q){this.chunks.push(q)},L.prototype.onEnd=function(q){q===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg};function C(q,O){const b=new L(O);if(b.push(q),b.err)throw b.msg||n[b.err];return b.result}function J(q,O){return O=O||{},O.raw=!0,C(q,O)}return jt.Inflate=L,jt.inflate=C,jt.inflateRaw=J,jt.ungzip=C,jt.constants=ti(),jt}var $a;function _l(){if($a)return xt;$a=1;const{Deflate:e,deflate:t,deflateRaw:i,gzip:n}=fl(),{Inflate:a,inflate:o,inflateRaw:f,ungzip:c}=ml(),p=ti();return xt.Deflate=e,xt.deflate=t,xt.deflateRaw=i,xt.gzip=n,xt.Inflate=a,xt.inflate=o,xt.inflateRaw=f,xt.ungzip=c,xt.constants=p,xt}var ja;function yl(){if(ja)return bi;ja=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.decodeTileLayer=void 0;const e=sl(),t=ll(),i=_l(),n=Wr(),a=Gr(),o=oa(),f={[o.Encoding.BASE64]:e.toByteArray},c={[a.Compression.NONE]:d=>d,[a.Compression.ZLIB]:i.inflate,[a.Compression.GZIP]:i.ungzip,[a.Compression.ZSTD]:t.decompress};function p(d){var w;if((0,n.isUnencodedTileLayer)(d))return d;const S=f[d.encoding],B=c[d.compression??a.Compression.NONE],X=R=>Array.from(new Uint32Array(R.buffer,R.byteOffset));return{...d,compression:a.Compression.NONE,encoding:o.Encoding.CSV,data:d.data!=null?X(B(S(d.data))):void 0,chunks:(w=d.chunks)==null?void 0:w.map(R=>({...R,data:X(B(S(R.data)))}))}}return bi.decodeTileLayer=p,bi}var ki={},Xa;function vl(){if(Xa)return ki;Xa=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.DrawOrder=void 0;var e;return function(t){t.TOPDOWN="topdown",t.INDEX="index"}(e||(ki.DrawOrder=e={})),ki}var Ei={},Ka;function wl(){if(Ka)return Ei;Ka=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.MapOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric",t.STAGGERED="staggered",t.HEXAGONAL="hexagonal"}(e||(Ei.MapOrientation=e={})),Ei}var Oi={},Va;function bl(){if(Va)return Oi;Va=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.MapRenderOrder=void 0;var e;return function(t){t.RIGHT_DOWN="right-down",t.RIGHT_UP="right-up",t.LEFT_DOWN="left-down",t.LEFT_UP="left-up"}(e||(Oi.MapRenderOrder=e={})),Oi}var Ai={},Ja;function Tl(){if(Ja)return Ai;Ja=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.StaggerAxis=void 0;var e;return function(t){t.X="x",t.Y="y"}(e||(Ai.StaggerAxis=e={})),Ai}var Ri={},Qa;function xl(){if(Qa)return Ri;Qa=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.StaggerIndex=void 0;var e;return function(t){t.ODD="odd",t.EVEN="even"}(e||(Ri.StaggerIndex=e={})),Ri}var Ii={},er;function Sl(){if(er)return Ii;er=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.PropertyType=void 0;var e;return function(t){t.STRING="string",t.INT="int",t.FLOAT="float",t.BOOL="bool",t.COLOR="color",t.FILE="file",t.OBJECT="object",t.CLASS="class"}(e||(Ii.PropertyType=e={})),Ii}var Li={},tr;function kl(){if(tr)return Li;tr=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.HorizontalAlign=void 0;var e;return function(t){t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify",t.LEFT="left"}(e||(Li.HorizontalAlign=e={})),Li}var Mi={},ir;function El(){if(ir)return Mi;ir=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.VerticalAlign=void 0;var e;return function(t){t.CENTER="center",t.BOTTOM="bottom",t.TOP="top"}(e||(Mi.VerticalAlign=e={})),Mi}var Xt={},nr;function Ol(){if(nr)return Xt;nr=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.isTilesetRef=Xt.isEmbeddedTileset=void 0;function e(i){return i.source==null}Xt.isEmbeddedTileset=e;function t(i){return i.source!=null}return Xt.isTilesetRef=t,Xt}var Ci={},ar;function Al(){if(ar)return Ci;ar=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.FillMode=void 0;var e;return function(t){t.STRETCH="stretch",t.PRESERVE_ASPECT_FIT="preserve-aspect-fit"}(e||(Ci.FillMode=e={})),Ci}var Pi={},rr;function Rl(){if(rr)return Pi;rr=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.ObjectAlignment=void 0;var e;return function(t){t.UNSPECIFIED="unspecified",t.TOPLEFT="topleft",t.TOP="top",t.TOPRIGHT="topright",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.BOTTOMLEFT="bottomleft",t.BOTTOM="bottom",t.BOTTOMRIGHT="bottomright"}(e||(Pi.ObjectAlignment=e={})),Pi}var zi={},or;function Il(){if(or)return zi;or=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.TileRenderSize=void 0;var e;return function(t){t.TILE="tile",t.GRID="grid"}(e||(zi.TileRenderSize=e={})),zi}var Di={},sr;function Ll(){if(sr)return Di;sr=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.WangSetType=void 0;var e;return function(t){t.CORNER="corner",t.EDGE="edge",t.MIXED="mixed"}(e||(Di.WangSetType=e={})),Di}var lr;function Ml(){return lr||(lr=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WangSetType=e.TileRenderSize=e.ObjectAlignment=e.FillMode=e.isTilesetRef=e.isEmbeddedTileset=e.VerticalAlign=e.HorizontalAlign=e.PropertyType=e.StaggerIndex=e.StaggerAxis=e.RenderOrder=e.MapOrientation=e.Encoding=e.DrawOrder=e.decodeTileLayer=e.Compression=e.isUnencodedTileLayer=e.isTileLayer=e.isObjectGroup=e.isImageLayer=e.isGroup=e.isEncodedTileLayer=e.GridOrientation=void 0;var t=ol();Object.defineProperty(e,"GridOrientation",{enumerable:!0,get:function(){return t.GridOrientation}});var i=Wr();Object.defineProperty(e,"isEncodedTileLayer",{enumerable:!0,get:function(){return i.isEncodedTileLayer}}),Object.defineProperty(e,"isGroup",{enumerable:!0,get:function(){return i.isGroup}}),Object.defineProperty(e,"isImageLayer",{enumerable:!0,get:function(){return i.isImageLayer}}),Object.defineProperty(e,"isObjectGroup",{enumerable:!0,get:function(){return i.isObjectGroup}}),Object.defineProperty(e,"isTileLayer",{enumerable:!0,get:function(){return i.isTileLayer}}),Object.defineProperty(e,"isUnencodedTileLayer",{enumerable:!0,get:function(){return i.isUnencodedTileLayer}});var n=Gr();Object.defineProperty(e,"Compression",{enumerable:!0,get:function(){return n.Compression}});var a=yl();Object.defineProperty(e,"decodeTileLayer",{enumerable:!0,get:function(){return a.decodeTileLayer}});var o=vl();Object.defineProperty(e,"DrawOrder",{enumerable:!0,get:function(){return o.DrawOrder}});var f=oa();Object.defineProperty(e,"Encoding",{enumerable:!0,get:function(){return f.Encoding}});var c=wl();Object.defineProperty(e,"MapOrientation",{enumerable:!0,get:function(){return c.MapOrientation}});var p=bl();Object.defineProperty(e,"RenderOrder",{enumerable:!0,get:function(){return p.MapRenderOrder}});var d=Tl();Object.defineProperty(e,"StaggerAxis",{enumerable:!0,get:function(){return d.StaggerAxis}});var S=xl();Object.defineProperty(e,"StaggerIndex",{enumerable:!0,get:function(){return S.StaggerIndex}});var B=Sl();Object.defineProperty(e,"PropertyType",{enumerable:!0,get:function(){return B.PropertyType}});var X=kl();Object.defineProperty(e,"HorizontalAlign",{enumerable:!0,get:function(){return X.HorizontalAlign}});var w=El();Object.defineProperty(e,"VerticalAlign",{enumerable:!0,get:function(){return w.VerticalAlign}});var R=Ol();Object.defineProperty(e,"isEmbeddedTileset",{enumerable:!0,get:function(){return R.isEmbeddedTileset}}),Object.defineProperty(e,"isTilesetRef",{enumerable:!0,get:function(){return R.isTilesetRef}});var L=Al();Object.defineProperty(e,"FillMode",{enumerable:!0,get:function(){return L.FillMode}});var C=Rl();Object.defineProperty(e,"ObjectAlignment",{enumerable:!0,get:function(){return C.ObjectAlignment}});var J=Il();Object.defineProperty(e,"TileRenderSize",{enumerable:!0,get:function(){return J.TileRenderSize}});var q=Ll();Object.defineProperty(e,"WangSetType",{enumerable:!0,get:function(){return q.WangSetType}})}(An)),An}var Fn=Ml();const Cl="modulepreload",Pl=function(e,t){return new URL(e,t).href},cr={},We=function(t,i,n){let a=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),p=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=Promise.allSettled(i.map(d=>{if(d=Pl(d,n),d in cr)return;cr[d]=!0;const S=d.endsWith(".css"),B=S?'[rel="stylesheet"]':"";if(!!n)for(let R=f.length-1;R>=0;R--){const L=f[R];if(L.href===d&&(!S||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${B}`))return;const w=document.createElement("link");if(w.rel=S?"stylesheet":Cl,S||(w.as="script"),w.crossOrigin="",w.href=d,p&&w.setAttribute("nonce",p),document.head.appendChild(w),S)return new Promise((R,L)=>{w.addEventListener("load",R),w.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(f){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=f,window.dispatchEvent(c),!c.defaultPrevented)throw f}return a.then(f=>{for(const c of f||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},zl=[async()=>ot((await We(async()=>{const{default:e}=await import("./effects.map-CrwxzR-u.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-1.map-HrzVBmhk.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-2.map-B9357vMd.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-4.map-D9CvEFBT.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./caverns-2.map-D0cHw8kd.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./caverns-4.map-R0LJRFNv.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./kingdom-1.map-DSGwk9nm.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./kingdom-2.map-CrKj8if5.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./kingdom-4.map-Dlcr1cGS.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./kingdom-6.map-yZMZR-y_.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-11.map-DjyoMIfB.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./kingdom-12.map-CAVaFIL0.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-18.map-DMg-ibUj.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-20.map-DUDjj6lk.js");return{default:e}},[],import.meta.url)).default),async()=>(await We(async()=>{const{default:e}=await import("./lost-26-DsBs9HTn.js");return{default:e}},[],import.meta.url)).default,async()=>(await We(async()=>{const{default:e}=await import("./lost-30-C2KVY9SJ.js");return{default:e}},[],import.meta.url)).default,async()=>ot((await We(async()=>{const{default:e}=await import("./lost-34.map-DrFLm4tU.js");return{default:e}},[],import.meta.url)).default),async()=>(await We(async()=>{const{default:e}=await import("./lost-42-DGnoJQ-u.js");return{default:e}},[],import.meta.url)).default,async()=>ot((await We(async()=>{const{default:e}=await import("./lost-46.map-CPZfKSZ7.js");return{default:e}},[],import.meta.url)).default),async()=>ot((await We(async()=>{const{default:e}=await import("./lost-48.map-2VM31G-j.js");return{default:e}},[],import.meta.url)).default),async()=>(await We(async()=>{const{default:e}=await import("./lost-52-axIKLzlg.js");return{default:e}},[],import.meta.url)).default,async()=>ot((await We(async()=>{const{default:e}=await import("./lost-59.map-C37FraUq.js");return{default:e}},[],import.meta.url)).default),async()=>(await We(async()=>{const{default:e}=await import("./lost-61-DuMVrCPp.js");return{default:e}},[],import.meta.url)).default,async()=>(await We(async()=>{const{default:e}=await import("./lost-64-DBwWEeNv.js");return{default:e}},[],import.meta.url)).default,async()=>ot((await We(async()=>{const{default:e}=await import("./lost-70.map-C-VewNCz.js");return{default:e}},[],import.meta.url)).default),async()=>(await We(async()=>{const{default:e}=await import("./lost-75-3GQVI5c9.js");return{default:e}},[],import.meta.url)).default],Ht=zl;async function _n(){var n;Ul();let e=U.levelIndex;for(;!Ht[e];)e=dn(e+1,Ht.length);Pr();const t=Ht[U.levelIndex=e],i=await t();_.tabletMessage=i.tabletMessage,Fl(i.data),_.map.updateTilesByType(u.Gem,{fg:Q.getUniformInt(1,15)}),nt[u.Border]=[Q.getUniformInt(8,15),Q.getUniformInt(1,8)],(n=i==null?void 0:i.onLevelStart)==null||n.call(i),Wl(),Zn()}async function jr(){Kn();let e=U.levelIndex;do e=dn(e+1,Ht.length);while(!Ht[e]);e%10===0&&await $l(),U.levelIndex=e,await _n(),await Ee("Press any key to begin this level.")}async function Dl(){Kn();let e=U.levelIndex;do e=dn(e-1,Ht.length);while(!Ht[e]);U.levelIndex=e,await _n(),await Ee("Press any key to begin this level.")}function ot(e){const{layers:t,properties:i}=e,n=mr(i),a=[];for(const f of t){let c;if(Fn.isEncodedTileLayer(f))c=Fn.decodeTileLayer(f).data;else if(Fn.isUnencodedTileLayer(f))c=f.data;else throw new Error("Unsupported layer encoding");if(c)for(let p=0;p<c.length;p++){const d=+c[p]-1;d>-1&&(a[p]=d)}}async function o(){if(n&&(_.magicEwalls=n.MagicEWalls??!1,_.evapoRate=n.EvapoRate??0,_.treeRate=n.TreeRate??0,_.lavaRate=n.LavaRate??0,_.lavaFlow=n.LavaFlow??!1,console.log(_,n),n.HideGems&&_.map.hideType(u.Gem),n.HideRocks&&_.map.hideType(u.Rock),n.HideStairs&&_.map.hideType(u.Stairs),n.HideOpenWall&&(_.map.hideType(u.OSpell1),_.map.hideType(u.OSpell2),_.map.hideType(u.OSpell3)),n.HideCreate&&_.map.hideType(u.Create),n.HideMBlock&&_.map.hideType(u.MBlock),n.HideTrap&&_.map.hideType(u.Trap),n.HideLevel))for(let f=0;f<_.map.width;f++)for(let c=0;c<_.map.height;c++){const p=_.map.get(f,c);p&&!p.has(na)&&p.add(ei)}}return{id:(n==null?void 0:n.id)||"",data:a,onLevelStart:o,tabletMessage:n==null?void 0:n.tabletMessage,properties:n}}function Fl(e){const t=_.map;let i=0;for(let n=0;n<=Je;n++)for(let a=0;a<=Ke;a++){const o=e[i++],f=Ws[o]??gr(o)??0,c=Br(f);if(t.set(a,n,c),c.type===u.Statue&&(_.T[Xe.StatueGemDrain]=32e3),c.has(na)&&(c.add(new rt({x:a,y:n})),_.player=c),c.has(Er)&&(c.add(new rt({x:a,y:n})),_.entities.push(c)),c.has(Or)&&_.genNum++,c.has(on)){const p=c.get(on).probability;Math.random()<p&&(c.remove(on),c.add(Gi))}}}class Bl{constructor(t=Ke+1,i=Je+1){it(this,"PF",[]);this.width=t,this.height=i}get(t,i){var n,a;return t<0||t>=this.width||i<0||i>=this.height?null:(a=(n=this.PF)==null?void 0:n[t])==null?void 0:a[i]}set(t,i,n){var a;t<0||t>=this.width||i<0||i>=this.height||((a=this.PF)[t]??(a[t]=[]),this.PF[t][i]=n)}getType(t,i){var a;if(t<0||t>=this.width||i<0||i>=this.height)return u.Border;const n=(a=this.get(t,i))==null?void 0:a.type;return typeof n=="string"?n:n??u.Floor}setType(t,i,n){this.set(t,i,Nr(n))}findRandomEmptySpace(){for(;;){const t=Q.getUniformInt(0,Ke),i=Q.getUniformInt(0,Je);if(this.getType(t,i)===u.Floor)return[t,i]}}updateTilesByType(t,i){for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++){const o=this.get(n,a);if((o==null?void 0:o.type)===t){const f=o.get(qt);Object.assign(f,i)}}}hideType(t){for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++){const a=this.get(i,n);(a==null?void 0:a.type)===t&&a.add(ei)}}}var Xe=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e[e.StatueGemDrain=9]="StatueGemDrain",e))(Xe||{});function yn(){return{levelIndex:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2}}function la(){return{bonus:0,genNum:0,magicEwalls:!1,evapoRate:0,treeRate:0,lavaRate:0,lavaFlow:!1,level:null,player:new gn(u.Player),entities:[],map:new Bl,replacement:u.Floor,T:[0,0,0,0,0,0,0,0,0,0],tabletMessage:void 0}}function Xr(){return{difficulty:8,clockScale:wo,paused:!1,done:!1,foundSet:new Set}}const U=yn(),_=la(),Ze=Xr(),Kr=yn(),qn=yn();function Nl(){Object.assign(U,yn()),Object.assign(_,la()),Object.assign(Ze,Xr())}function Ul(){Object.assign(_,la())}function Wl(){Object.assign(Kr,U)}async function Gl(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await Ee("Are you sure you want to SAVE? (Y/N)");e.toLowerCase()==="y"&&(Object.assign(qn,Kr),localStorage.setItem("Kroz--saveState--v1",JSON.stringify(qn)))}async function Hl(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await Ee("Are you sure you want to RESTORE? (Y/N)");if(e.toLowerCase()==="y"){let t=qn;const i=localStorage.getItem("Kroz--saveState--v1");if(i)try{t=JSON.parse(i)}catch(n){console.error(n)}Object.assign(U,t),await _n(),await Ee("Press any key to begin this level.")}}function Be(e){switch(e){case u.Border:U.score>U.levelIndex&&(U.score-=U.levelIndex/2);break;case u.Slow:case u.Medium:case u.Fast:U.score+=e;break;case u.Block:case u.ZBlock:case u.GBlock:case u.Wall:case u.River:case u.Tree:case u.Forest:case u.MBlock:case u.OWall1:case u.OWall2:case u.OWall3:case u.EWall:U.score>2&&(U.score-=2);break;case u.Whip:case u.SlowTime:case u.Bomb:U.score++;break;case u.Stairs:U.score+=U.levelIndex*5;break;case u.Chest:U.score+=10+Math.floor(U.levelIndex/2);break;case u.Gem:U.score+=Math.floor(U.levelIndex/2)+1;break;case u.Invisible:U.score+=25;break;case u.Nugget:U.score+=50;break;case u.Door:U.score+=10;break;case u.Teleport:case u.Freeze:U.score+=2;break;case u.SpeedTime:case u.Power:U.score+=5;break;case u.Trap:U.score>5&&(U.score-=5);break;case u.Lava:U.score>100&&(U.score+=100);break;case u.Tome:U.score+=5e3;break;case u.Tablet:U.score+=U.levelIndex+250;break;case u.Chance:U.score+=100;break;case u.Statue:U.score+=10;break;case u.Amulet:U.score+=2500;break;case u.Z:U.score+=1e3;break}Et()}async function ii(e,t){const i=_.map.get(e,t);_.map.setType(e,t,u.Floor),ze(e,t),i&&i.has(rt)&&await cn(i)}async function cn(e){var t;typeof e.type=="number"&&e.type<4&&await Jo(e.type),(t=e.get(rt))==null||t.die()}async function Vr(e=1){for(let t=0;t<e;t++){let i=!1;do{const n=Q.getUniformInt(0,Ke),a=Q.getUniformInt(0,Je);if(_.map.getType(n,a)===u.Floor){const o=Ur(u.Slow);o.add(new rt({x:n,y:a})),_.entities.push(o),_.map.set(n,a,o),await vs(),i=!0}Lt()}while(!i&&Q.getUniformInt(0,50)!==0)}}function Ft(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.from(typeof e=="string"?[e]:e);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var a=n.reduce(function(c,p){var d=p.match(/\n([\t ]+|(?!\s).)/g);return d?c.concat(d.map(function(S){var B,X;return(X=(B=S.match(/[\t ]/g))===null||B===void 0?void 0:B.length)!==null&&X!==void 0?X:0})):c},[]);if(a.length){var o=new RegExp(`
[	 ]{`+Math.min.apply(Math,a)+"}","g");n=n.map(function(c){return c.replace(o,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var f=n[0];return t.forEach(function(c,p){var d=f.match(/(?:^|\n)( *)$/),S=d?d[1]:"",B=c;typeof c=="string"&&c.includes(`
`)&&(B=String(c).split(`
`).map(function(X,w){return w===0?X:""+S+X}).join(`
`)),f+=B+n[p+1]}),f}function Yl(){Ae(70,0,"Score",z.Yellow,z.Blue),Ae(70,3,"Level",z.Yellow,z.Blue),Ae(70,6,"Gems",z.Yellow,z.Blue),Ae(70,9,"Whips",z.Yellow,z.Blue),Ae(68,12,"Teleports",z.Yellow,z.Blue),Ae(70,15,"Keys",z.Yellow,z.Blue);const[t,i]=ta(z.HighIntensityWhite,z.Blue);Ae(69,18,"OPTIONS",t,z.Red),Ae(69,19,`%c{${t}}W%c{}hip`,z.White,i),Ae(69,20,`%c{${t}}T%c{}eleport`,z.White,i),Ae(69,21,`%c{${t}}P%c{}ause`,z.White,i),Ae(69,22,`%c{${t}}Q%c{}uit`,z.White,i),Ae(69,23,`%c{${t}}S%c{}ave`,z.White,i),Ae(69,24,`%c{${t}}R%c{}estore`,z.White,i)}function Et(){const e=U.whipPower>2?`${U.whips}+${U.whipPower-2}`:U.whips.toString(),t=4,i=7,n=!Ze.paused&&U.gems<10?z.Red|16:z.Red,a=69;Ae(a,1,si((U.score*10).toString(),t+1,i),z.Red,z.Grey),Ae(a,4,si(U.levelIndex.toString(),t,i),z.Red,z.Grey),Ae(a,7,si(U.gems.toString(),t+1,i),n,z.Grey),Ae(a,10,si(e,t,i),z.Red,z.Grey),Ae(a,13,si(U.teleports.toString(),t,i),z.Red,z.Grey),Ae(a,16,si(U.keys.toString(),t,i),z.Red,z.Grey)}function Jr(){const e=Yi[u.Border],[t,i]=nt[u.Border];for(let n=Bt-1;n<=hi+1;n++)Gt(n,0,e,t,i),Gt(n,Wi+1,e,t,i);for(let n=Vt-1;n<=Wi+1;n++)Gt(0,n,e,t,i),Gt(hi+1,n,e,t,i)}async function ql(){return ni(z.Black),pt(20,Ui,z.Yellow),pt(21,"Original Level Design (C) 1990 Scott Miller",z.Yellow),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite),Vn(async()=>{Ae(5,5,Ft`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `,Q.getUniformInt(1,15)),await Me(500)})}async function Zl(){ni(z.Black),pt(0,Ui,z.Yellow,z.Black),pt(1,"INSTRUCTIONS",z.HighIntensityWhite,z.Black),pt(2,"------------",z.HighIntensityWhite,z.Black),Ae(0,5,Ft`
    The dungeons contain dozens of treasures,  spells,  traps and other mysteries.
  Touching an object for the first time will reveal a little of its identity,  but
  it will be left to you to decide how best to use it or avoid it.                
    When a creature touches you it will vanish,  taking with it a few of your gems
  that you have collected. If you have no gems then the creature will instead take
  your life!  Whips can be used to kill nearby creatures, but they are better used
  to smash through crumbled walls and forest terrain.`,z.LightBlue,z.Black),Ae(3,13,Ft`
    You can use these        u i o    7 8 9
    cursor keys to            \\|/      \\|/     w or 5: Whip
    move your man,           j- -k    4- -6         T: Teleport
    and the four              /|\\      /|\\
    normal cursor keys       n m ,    1 2 3`,z.LightBlue,z.Black),Ae(0,19,Ft`
    It's a good idea to save (S) your game at every new level,  therefore,  if you
    die you can easily restore (R) the game at that level and try again.`,z.LightBlue,z.Black),pt(22,"Have fun and good-luck...",z.HighIntensityWhite,z.Black),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await ci()}async function $l(){ni(z.Black),pt(1,Ui,z.Yellow),Ae(2,4,Ft`
    Kroz is a series of Roguelike video games created by Scott Miller and 
    published by Apogee Software in the late 1980s and early 1990s.  In March
    2009, the whole Kroz series was released as freeware by Apogee, and the
    source code was released as free software under the GPL license.`,z.White),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await ci(),Ki(),Ae(2,9,Ft`
    This is a re-implementation the original Kroz series of games in typescript 
    playable in the browser.  The source code completly open-source.  If you
    enjoy this game you are asked by the author to please add a star to the
    github repo at https://github.com/Hypercubed/kroz.`,z.White),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await ci(),Ki(),Ae(2,15,Ft`
    Better yet, contribute to the game yourself; or maybe fork it and add your
    own levels.  That might make a nice 7DRL challenge entry
    (https://7drl.com/).`,z.White),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await ci(),Ki(),Ae(10,20,"Thank you and enjoy the game.  -- Hypercubed"),pt(Dt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await ci(),Ki()}function si(e,t,i){return e.padStart(t,Yt).padEnd(i,Yt)}function Lt(){for(let t=0;t<_.map.width;t++)for(let i=0;i<_.map.height;i++){const n=_.map.get(t,i);if(!n){Qr(t,i);continue}n.type===u.Player||n.type===u.Slow||n.type===u.Medium||n.type===u.Fast||ze(t,i,n)}for(let t=0;t<_.entities.length;t++){const i=_.entities[t],n=i.get(rt);n.x===-1||n.y===-1||ze(n.x,n.y,i)}const e=_.player.get(rt);e&&ze(e.x,e.y,_.player)}function Qr(e,t){const[i,n]=nt[u.Floor];Gt(e+Bt,t+Bt,Yt,i,n)}function ze(e,t,i){if(Qr(e,t),i??(i=_.map.get(e,t)),!i||i.has(ei))return;if(i.has(Gi)){const[a,o]=nt[u.Chance];Gt(e+Bt,t+Vt,Yi[u.Chance],a,o);return}if(!i.has(qt))return;const n=i.get(qt);Gt(e+Bt,t+Vt,n.ch,n.fg,n.bg)}function Nt(e,t,i,n,a){var f,c;i??(i=_.map.getType(e,t));let o;switch(jl(i)?(o=Yi[i]??i??Yi[u.Floor],n??(n=((f=nt[i])==null?void 0:f[0])??nt[u.Floor][0]),a??(a=((c=nt[i])==null?void 0:c[1])??nt[u.Floor][1])):i>="a"&&i<="z"||["!","·","∙","∩"].includes(i)?(o=i.toUpperCase(),n=n??z.HighIntensityWhite,a=a??z.Brown):o=i,i){case u.Stairs:n=typeof n=="number"&&!Ze.paused?n|16:n;break}Gt(e+Bt,t+Vt,o,n,a)}function un(e,t,i,n){var f;const a=_.map.getType(e,t);let o;a>="a"&&a<="z"||a==="!"?o=z.Brown:o=((f=nt[a])==null?void 0:f[1])??nt[u.Floor][1],$o(e+Bt,t+Vt,i,n,o)}async function Oe(e,t=!1){if(t){if(Ze.foundSet===!0||Ze.foundSet.has(e))return"";Ze.foundSet.add(e)}const i=Us[e];return i?await Ee(i):""}async function Ee(e){if(!e)return"";const t=(hi-e.length)/2,i=Wi+1;Ze.paused=!0;const n=await Vn(()=>{Ae(t,i,e,Q.getUniformInt(1,15),z.Black)});return Jr(),Ze.paused=!1,n}function Zn(){ni(z.Blue),Jr(),Yl(),Lt(),Et()}function eo(){Lt(),Et()}function jl(e){return typeof e=="number"}async function Xl(){ni(z.Blue),Ae(2,5,Ft`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `,z.LightCyan,z.Blue),Ae(9,16,`Use the cursor keys to move yourself (%c{${Ot[z.Yellow]}}☻%c{${Ot[z.LightGreen]}}) through the caverns.`,z.LightGreen,z.Blue),pt(17,"Use your whip (press W) to destroy all nearby creatures.",z.LightGreen,z.Blue),pt(Dt-1,"Press any key to begin your decent into Kroz.",z.HighIntensityWhite,z.Blue);const e=fn/2-Ui.length/2;await Vn(async()=>{Ae(e,3,Ui,Q.getUniformInt(0,16),z.Red),await Me(500)})}const nn={[Xe.SlowTime]:70*Rt,[Xe.Invisible]:75*Rt,[Xe.SpeedTime]:80*Rt,[Xe.FreezeTime]:55*Rt};async function Kl(){if(bt(je.NextLevel))return await jr();if(bt(je.PrevLevel))return await Dl();if(bt(je.NextLevelCheat)){const i=_.player.get(rt);_.map.setType(i.x+1,i.y,u.Stairs),await Qo();return}if(bt(je.FreeItems)){U.gems=150,U.whips=99,U.teleports=99,U.keys=9,Et();return}if(bt(je.SlowerClock)){Ze.clockScale=Math.min(20,Ze.clockScale+1),console.log("Clock Scale:",Ze.clockScale);return}if(bt(je.FasterClock)){Ze.clockScale=Math.max(1,Ze.clockScale-1),console.log("Clock Scale:",Ze.clockScale);return}if(bt(je.ResetFound)){Ze.foundSet=new Set,await Ee("Newly found object descriptions are reset.");return}if(bt(je.HideFound)){Ze.foundSet=!0,await Ee("References to new objects will not be displayed.");return}if(bt(je.Pause))return tc();if(bt(je.Quit))return ec();if(bt(je.Save))return Gl();if(bt(je.Restore))return Hl();At(je.Whip)&&(U.whips<1?va():(U.whips--,await Jl())),At(je.Teleport)&&(U.teleports<1?await va():(U.teleports--,await io()));let e=0,t=0;At(je.North)&&t--,At(je.South)&&t++,At(je.West)&&e--,At(je.East)&&e++,At(je.Southeast)&&(e++,t++),At(je.Southwest)&&(e--,t++),At(je.Northeast)&&(e++,t--),At(je.Northwest)&&(e--,t--),e=ya(e,-1,1),t=ya(t,-1,1),(e!==0||t!==0)&&await Vl(e,t)}async function Vl(e,t){var c;const i=_.player.get(rt),n=i.x+e,a=i.y+t;if(n<0||n>Ke||a<0||a>Je){await ba(),Be(u.Border),await Oe(u.Border,!0);return}const o=_.map.get(n,a);if(!o)return;const f=_.map.getType(n,a)||u.Floor;if(o!=null&&o.has(Hi)){const p=o.get(Hi).damage;U.gems-=p,ii(n,a),Be(o.type),ut(n,a);return}if(o!=null&&o.has(Mt)){Qt();const p=o.get(Mt);switch(U.whips+=p.whips,U.gems+=p.gems,U.teleports+=p.teleports,U.keys+=p.keys,U.whipPower+=p.whipPower,Be(f),ut(n,a),f){case u.Chest:await Ee(`You found ${p.gems} gems and ${p.whips} whips inside the chest!`);break;case u.Chance:await Ee(`You found a Pouch containing ${p.gems} Gems!`);break;default:await Oe(f,!0);break}return}if(o!=null&&o.has(Yn)){ut(n,a),await vc(o.get(Yn).type,n,a);return}if((c=o==null?void 0:o.get(ui))!=null&&c.by(u.Player)){ut(n,a);return}switch(f){case u.Wall:case u.River:case u.Block:case u.ZBlock:case u.GBlock:oi(),Be(f),await Oe(f,!0);break;case u.Tree:case u.Forest:Be(f),await Fi(),await Oe(f,!0);break;case u.Stairs:if(ut(n,a),U.levelIndex===Ht.length-1){await nc();return}Be(f),await Oe(u.Stairs,!0),fi(),await jr();break;case u.Door:U.keys<1?(es(),await Me(100),await Ee("To pass the Door you need a Key.")):(U.keys--,Be(f),await Xo(),ut(n,a),Lt(),await Oe(u.Door,!0));break;case u.Lava:U.gems-=10,Be(f),ut(n,a),await Oe(f,!0);break;case u.Pit:ut(n,a),U.gems=-1,await Oe(f);break;case u.Tome:_.map.setType(31,6,u.Stairs),Nt(31,6,u.Stairs),Be(f),await Oe(f),await Ee("Congratulations, Adventurer, you finally did it!!!");break;case u.Tunnel:{const p=_.player.get(rt),d=p.x,S=p.y;ut(n,a),await oc(n,a,d,S),await Oe(f,!0);break}case u.IBlock:oi(),_.map.setType(n,a,u.Block),ze(n,a),await Oe(f,!0);break;case u.IWall:oi(),_.map.setType(n,a,u.Wall),ze(n,a),await Oe(f,!0);break;case u.IDoor:oi(),_.map.setType(n,a,u.Door),ze(n,a),await Oe(f,!0);break;case u.Generator:Fi(),Be(f),await Oe(f,!0);break;case u.MBlock:Fi(),Be(f),await Oe(f,!0);break;case u.Tablet:ut(n,a),Qt(),Be(f),await Oe(f,!0),await ic();break;case u.Statue:Fi(),await Oe(f);break;case u.OWall1:case u.OWall2:case u.OWall3:oi(),Be(u.Wall),await Oe(u.OWall1,!0);break;case u.Rock:await gc(n,a,e,t);break;case u.EWall:Be(f),U.gems--,ba(),await Oe(u.EWall,!0);break;case u.Message:await mc();break;case u.Amulet:ut(n,a),await ac();break;default:oi();break}}function ur(e,t){const i=_.map;for(let n=0;n<i.width;n++)for(let a=0;a<i.height;a++)i.getType(n,a)===e&&i.set(n,a,Br(t))}async function Jl(){const e=_.player.get(rt),t=e.x,i=e.y;ts(),await n(t-1,i-1,"\\"),await n(t-1,i,"-"),await n(t-1,i+1,"/"),await n(t,i+1,"❘"),await n(t+1,i+1,"\\"),await n(t+1,i,"-"),await n(t+1,i-1,"/"),await n(t,i-1,"❘");async function n(a,o,f){if(a<0||a>Ke||o<0||o>Je)return;const c=_.map.get(a,o),p=(c==null?void 0:c.type)||u.Floor;switch(un(a,o,f,Ot[Q.getUniformInt(0,15)]),c!=null&&c.has(Gi)&&(c==null||c.remove(Gi),ze(a,o)),p){case u.Slow:case u.Medium:case u.Fast:ii(a,o),Be(p);break;case u.Block:case u.Forest:case u.Tree:case u.Message:case u.MBlock:case u.ZBlock:case u.GBlock:{const d=U.whipPower;6*Math.random()<d?(p===u.MBlock&&ii(a,o),_.map.setType(a,o,u.Floor),ze(a,o),un(a,o,f,Ot[Q.getUniformInt(0,15)]),is()):On();break}case u.Invisible:case u.SpeedTime:case u.Trap:case u.Power:case u.K:case u.R:case u.O:case u.Z:_.map.setType(a,o,u.Floor),ns();break;case u.Rock:30*Math.random()<U.whipPower?(as(),_.map.setType(a,o,u.Floor)):On();break;case u.Statue:50*Math.random()<U.whipPower?(_.map.setType(a,o,u.Floor),Be(p),_.T[Xe.StatueGemDrain]=-1,await Ee("You've destroyed the Statue!  Your Gems are now safe.")):On();break;case u.Generator:Be(p),_.map.setType(a,o,u.Floor),_.genNum--;break}Et(),await Me(10)}}async function to(){const e=_.player.get(rt);for(let t=0;t<160;t++)t%5===0&&(Nt(e.x,e.y,u.Player,Q.getUniformInt(0,15),Q.getUniformInt(0,8)),await Me()),de(t/2,80,10)}async function io(){await to();const e=_.player.get(rt);_.map.setType(e.x,e.y,u.Floor),ze(e.x,e.y);const t=Date.now();for(let i=0;i<700;i++){const n=Q.getUniformInt(0,Ke),a=Q.getUniformInt(0,Je),o=_.map.getType(n,a);if(js.indexOf(o)>-1&&(Nt(n,a,"☺",Q.getUniformInt(0,15),Q.getUniformInt(0,7)),await rs(),Nt(n,a,o)),Date.now()-t>1500)break}ut(..._.map.findRandomEmptySpace())}async function Ql(){Ae(hi/2-7,0,"You have died.",z.Black,z.Red),await Ee("Press any key to continue."),Ze.done=!0}async function ec(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await Ee("Are you sure you want to quit? (Y/N)");e.toLowerCase()==="y"&&(Ze.done=!0)}async function tc(){await Ee("Press any key to resume")}async function ic(){const e=_.tabletMessage;e&&(typeof e=="string"?await Ee(e):typeof e=="function"&&await e())}async function zc(){await Ee("On the Ancient Tablet is a short Mantra, a prayer..."),await Ee("You take a deep breath and speak the words aloud...")}async function nc(){await fi(),await Me(200),await fi(),await Me(200),await fi(),await Ee("Oh no, something strange is happening!"),await Ee("You are magically transported from Kroz!");const e=U.gems=isFinite(U.gems)?U.gems:150,t=U.whips=isFinite(U.whips)?U.whips:20,i=U.teleports=isFinite(U.teleports)?U.teleports:10,n=U.keys=isFinite(U.keys)?U.keys:5;await Ee("Your Gems are worth 100 points each...");for(let a=0;a<e;a++)U.gems--,U.score+=10,Et(),await de(a*8+100,20);await Ee("Your Whips are worth 100 points each...");for(let a=0;a<t;a++)U.whips--,U.score+=10,Et(),await de(a*8+100,20);await Ee("Your Teleport Scrolls are worth 200 points each...");for(let a=0;a<i;a++)U.teleports--,U.score+=20,Et(),await de(a*8+100,20);await Ee("Your Keys are worth 10,000 points each....");for(let a=0;a<n;a++)U.keys--,U.score+=1e3,Et(),await de(a*8+100,20);ni(z.Blue),Ae(25,3,"ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ",z.White,z.Blue),Ae(10,5,Ft`
        Carefully, you place the ancient tome on your table and open
        to the first page.  You read the book intently, quickly
        deciphering the archaic writings.

        You learn of Lord Dullwit, the once powerful and benevolent
        ruler of Kroz, who sought wealth and education for his people.
        The magnificent KINGDOM OF KROZ was once a great empire, until
        it was overthrown by an evil Wizard, who wanted the riches of
        Kroz for himself.

        Using magic beyond understanding, the Wizard trapped Lord
        Dullwit and his people in a chamber so deep in Kroz that any
        hope of escape was fruitless.

        The Wizard then built hundreds of deadly chambers that would
        stop anyone from ever rescuing the good people of Kroz.
        Once again your thoughts becomes clear:  To venture into the
        depths once more and set free the people of Kroz.
       `,z.White,z.Blue),await Ee("Press any key, Adventurer."),Ze.done=!0}async function fr(e,t,i){for(e+=i;e>=0&&e<=Ke;){const n=_.map.getType(e,t);if(typeof n!="number"||el.includes(n))break;de(e+30,10,100);for(let a=1;a<6;a++)un(e,t,"─",Q.getUniformInt(0,16)),await Me(1);tl.includes(n)||(await os(),(n===u.Slow||n===u.Medium||n===u.Fast)&&await ii(e,t),_.map.setType(e,t,u.Floor)),ze(e,t),e+=i}Lt()}async function ac(){await Qt(),await ss(),Be(u.Amulet),await Ee("You have found the Amulet of Yendor -- 25,000 points!"),await Ee("It seems that Kroz and Rogue share the same underground!)"),await Ee("Your quest for the treasure of Kroz must still continue...")}async function rc(e,t){ls();let i=0;for(;i<=4;++i){de(100-i*10/4,4*10,100);const c=Math.max(e-i,Bt),p=Math.min(e+i,hi),d=Math.max(t-i,Vt),S=Math.min(t+i,Wi);for(let B=c;B<=p;B++)for(let X=d;X<=S;X++){un(B,X,"█",z.LightRed);const w=_.map.getType(B,X)??u.Floor;Sa.includes(w)&&w>=1&&w<=4&&(Be(w),ii(B,X))}await cs()}await Me(100),i=4;const n=Math.max(e-i,Bt),a=Math.min(e+i,hi),o=Math.max(t-i,Vt),f=Math.min(t+i,Wi);for(let c=n;c<=a;c++)for(let p=o;p<=f;p++){const d=_.map.getType(c,p)??u.Floor;Sa.includes(d)&&_.map.setType(c,p,u.Floor)}Lt()}async function oc(e,t,i,n){await Me(350),await fi(),await Me(500),_.map.setType(e,t,u.Tunnel),ze(e,t);let a=e,o=t;for(let p=0;p<1e4;p++){const d=Q.getUniformInt(0,Ke),S=Q.getUniformInt(0,Je);if((_.map.getType(d,S)??u.Floor)===u.Tunnel&&(d!==a||S!==o)){a=d,o=S,ut(a,o);break}}_.map.setType(e,t,u.Tunnel),ze(e,t);let f=i,c=n;for(let p=0;p<100;p++){const d=Q.getUniformInt(-1,1),S=Q.getUniformInt(-1,1);if(a+d<0||a+d>Ke||o+S<0||o+S>Je)continue;const B=_.map.getType(a+d,o+S)??u.Floor;if(Qs.includes(B)){f=a+d,c=o+S;break}}ut(f,c),_.map.setType(a,o,u.Tunnel),ze(a,o)}async function sc(){await us(),await Me(50);for(let e=0;e<50;e++){do{const t=Q.getUniformInt(0,Ke),i=Q.getUniformInt(0,Je),n=_.map.getType(t,i);if($s.includes(n)){_.map.setType(t,i,u.Rock),ze(t,i);break}}while(Math.random()>.01);await hs()}await fs()}async function lc(){let e=0,t=0;for(;e<500&&t<40;){e++;const i=Q.getUniformInt(0,_.entities.length),n=_.entities[i];if(!n)continue;const a=n.get(rt);a.x===-1||a.y===-1||n.type!==u.Slow&&n.type!==u.Medium&&n.type!==u.Fast||(await ii(a.x,a.y),await Me(20),t++)}U.score+=Math.floor(t/3+2),Lt(),Et()}async function cc(){_.entities.reduce((t,i)=>i.type===u.Slow?t+1:t,0)<945&&await Vr(45)}async function uc(){for(let e=0;e<Ze.difficulty*2+5;e++){let t=!1;do{const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je);_.map.getType(i,n)===u.Floor&&(t=!0,_.map.setType(i,n,u.Gem),ze(i,n),await ds(),await Me(90))}while(!t&&Math.random()>.01)}}async function fc(){for(let e=0;e<=Ke;e++)for(let t=0;t<=Je;t++)if(_.map.getType(e,t)===u.ZBlock){ps();for(let i=20;i>0;i--)Nt(e,t,u.Block,Q.getUniformInt(0,15)),await Me(1);_.map.setType(e,t,u.Floor),ze(e,t)}else _.map.getType(e,t)===u.BlockSpell&&(_.map.setType(e,t,u.Floor),ze(e,t))}async function hc(e){e===u.K&&_.bonus===0&&(_.bonus=1),e===u.R&&_.bonus===1&&(_.bonus=2),e===u.O&&_.bonus===2&&(_.bonus=3),e===u.Z&&_.bonus===3&&(await Vo(),Be(e),await Oe(e))}async function dc(e){let t=u.OWall1;e===u.OSpell2&&(t=u.OWall2),e===u.OSpell3&&(t=u.OWall3);for(let i=0;i<=Ke;i++)for(let n=0;n<=Je;n++)if(_.map.getType(i,n)===t){for(let o=60;o>0;o--)Nt(i,n,Q.getItem(["▄","▌","▐","▀"]),Q.getUniformInt(0,14)),de(o*40,5,10),o%5===0&&await Me(1);_.map.setType(i,n,u.Floor),ze(i,n)}}async function pc(e){const t=e-u.CSpell1+u.CWall1;for(let i=0;i<=Ke;i++)for(let n=0;n<=Je;n++)if(_.map.getType(i,n)===t){for(let o=60;o>0;o--)Nt(i,n,Q.getItem(["▄","▌","▐","▀"]),Q.getUniformInt(0,14)),de(o*40,5,10),o%5===0&&await Me(1);_.map.setType(i,n,u.Wall),ze(i,n)}}async function gc(e,t,i,n){let a=!1;const o=_.player.get(rt),f=o.x+i*2,c=o.y+n*2;if((f<0||f>Ke||c<0||c>Je)&&(a=!0),!a){const p=_.map.get(f,c);p||(a=!0);const d=p.type;async function S(B=!1){a=!1,await wa(),B&&ii(f,c),_.map.setType(f,c,u.Rock),ut(e,t),Lt(),await Oe(u.Rock,!0)}Ks.includes(d)?await S():Vs.includes(d)?(await S(),await Qt()):mn.includes(d)?(await S(!0),Be(d),await gs()):d===u.EWall?(await S(),_.map.setType(f,c,u.Floor),ms(),await Ee("The Boulder is vaporized!")):Js.includes(d)&&(a=!1,await wa(),ut(e,t),Nt(f,c,u.Rock),await _s(),Lt(),await Oe(u.Rock,!0))}a&&await Fi()}async function mc(){await ys(),await Ee("You notice a secret message carved into the old tree..."),await Ee('"Goodness of Heart Overcomes Adversity."'),await Ee("Reveal that you found this message to Scott Miller..."),await Ee('And receive a "MASTER KROZ CERTIFICATE" to hang on your wall!!'),await Ee("Only the first 100 players to report this..."),await Ee("Will be awarded the certificate.  Congratulations!")}async function _c(e,t,i){let n=u.Floor;switch(i){case u.TBlock:n=u.Block;break;case u.TRock:n=u.Rock;break;case u.TGem:n=u.Gem;break;case u.TBlind:n=u.Invisible;break;case u.TWhip:n=u.Whip;break;case u.TGold:n=u.Nugget;break;case u.TTree:n=u.Tree;break}for(let o=0;o<10;o++)await a(!1,Q.getUniformInt(0,7),Q.getUniformInt(0,7)),await de((o+25)*o*2,20,10);return a(!0);async function a(o,f,c){for(let p=-1;p<=1;p++)for(let d=-1;d<=1;d++){if(p===0&&d===0)continue;const S=_.map.getType(e+p,t+d);Xs.includes(S)&&(Nt(e+p,t+d,n,f,c),o&&_.map.setType(e+p,t+d,n)),await Me(5)}}}async function yc(){for(let e=0;e<75;e++){let t=!1;do{const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je),a=_.map.getType(i,n);a===u.Block&&(_.map.setType(i,n,u.IBlock),ze(i,n),t=!0),a===u.Wall&&(_.map.setType(i,n,u.IWall),ze(i,n),t=!0)}while(!t&&Q.getUniformInt(0,200)!==0)}}async function vc(e,t,i){switch(e){case u.SlowTime:_.T[Xe.SpeedTime]=0,_.T[Xe.FreezeTime]=0,_.T[Xe.SlowTime]=nn[Xe.SlowTime],Be(e),await Oe(e,!0);break;case u.SpeedTime:_.T[Xe.SlowTime]=0,_.T[Xe.SpeedTime]=nn[Xe.SpeedTime],Be(e),await Oe(e,!0);break;case u.Invisible:_.T[Xe.Invisible]=nn[Xe.Invisible],_.player.add(ei),ze(t,i),Be(e),await Oe(e,!0);break;case u.Trap:Be(e),await Oe(e,!0),await io();break;case u.Bomb:await rc(t,i),await Oe(e,!0);break;case u.Freeze:_.T[Xe.FreezeTime]=nn[Xe.FreezeTime],await Oe(e,!0);break;case u.Quake:await sc(),await Oe(e,!0);break;case u.Trap2:ur(e,u.Floor);break;case u.Zap:await lc(),await Oe(e,!0);break;case u.Create:await cc(),Be(e),await Oe(e,!0);break;case u.ShowGems:Qt(),await uc(),await Oe(e,!1);break;case u.BlockSpell:await fc(),await Oe(e,!0);break;case u.WallVanish:await yc(),await Oe(e);break;case u.K:case u.R:case u.O:case u.Z:Qt(),await hc(e);break;case u.OSpell1:case u.OSpell2:case u.OSpell3:await dc(e),await Oe(e,!0);break;case u.CSpell1:case u.CSpell2:case u.CSpell3:await pc(e),await Oe(e,!0);break;case u.Trap3:case u.Trap4:case u.Trap5:case u.Trap6:case u.Trap7:case u.Trap8:case u.Trap9:case u.Trap10:case u.Trap11:case u.Trap12:case u.Trap13:ur(e,u.Floor);break;case u.TBlock:case u.TRock:case u.TGem:case u.TBlind:case u.TWhip:case u.TGold:case u.TTree:await _c(t,i,e);break;case u.ShootRight:await fr(t,i,1);break;case u.ShootLeft:await fr(t,i,-1);break}}function ut(e,t){fi();const i=_.player,n=i.get(rt);_.map.setType(n.x,n.y,n.replacement),ze(n.x,n.y);const a=_.map.getType(e,t);n.replacement=[u.CWall1,u.CWall2,u.CWall3,u.Rope].includes(a)?a:u.Floor,_.map.set(e,t,i),n.x=e,n.y=t,ze(n.x,n.y)}function wc(e){switch(e){case u.Player:return Rt;case u.Slow:return Rt/4;case u.Medium:return Rt/3;case u.Fast:return Rt/2;case u.MBlock:return Rt/2}}class Xi{constructor(t){it(this,"speed");this.type=t,this.speed=wc(this.type)}getSpeed(){return this.type===u.Player?_.T[Xe.SlowTime]>0?10:1:_.T[Xe.SpeedTime]>0?Rt:this.speed}}let Wt;const bc=new Xi(u.Player),Tc=new Xi(u.Slow),xc=new Xi(u.Medium),Sc=new Xi(u.Fast),kc=new Xi(u.MBlock);function Ec(){return Wt=new Ss.Speed,Wt.add(bc,!0),Wt.add(Tc,!0),Wt.add(xc,!0),Wt.add(Sc,!0),Wt.add(kc,!0),Wt}async function Oc(){const e=Wt.next();if(!e)return;const t=e.type;if(t!==u.Player&&!(_.T[Xe.FreezeTime]>0))for(const i of _.entities)i.type===t&&await Ac(i)}async function Ac(e){const t=e.get(rt);if(!t.isDead()){if(_.map.getType(t.x,t.y)!==e.type){cn(e);return}if(e.has(kr)){let i=0,n=0;const a=_.player.get(rt);a.x<t.x&&(i=-1),a.x>t.x&&(i=1),a.y<t.y&&(n=-1),a.y>t.y&&(n=1),Rc(e,i,n)}}}function Rc(e,t,i){var c,p,d;const n=e.get(rt),a=n.x+t,o=n.y+i;if(a<0||a>Ke||o<0||o>Je)return;const f=_.map.get(a,o);if(f){if((c=e.get(Ar))!=null&&c.has(f.type)){Qt(),Bn(e,a,o);return}if((p=f.get(ui))!=null&&p.by(e.type)){Bn(e,a,o);return}if((d=e.get(Rr))!=null&&d.has(f.type)){_.map.setType(n.x,n.y,u.Floor),_.map.setType(a,o,u.Floor),cn(e),Be(f.type),de(800,18),de(400,20);return}if(e.has(Hi)&&f.type===u.Player){const S=e.get(Hi).damage;U.gems-=S,_.map.setType(n.x,n.y,u.Floor),cn(e),Be(f.type);return}Bn(e,n.x,n.y)}}function Bn(e,t,i){if(e.has(ln)&&e.has(qt)){const a=e.get(qt),o=e.get(ln);a.ch=o.getFrame()}const n=e.get(rt);e.type===u.MBlock&&(t!==n.x||i!==n.y)&&e.remove(ei),_.map.setType(n.x,n.y,u.Floor),_.map.set(t,i,e),n.moveTo(t,i)}async function Ic(){for(let t=0;t<_.T.length;t++)_.T[t]=Math.max(0,_.T[t]-1);_.T[Xe.Invisible]>0?_.player.add(ei):_.player.remove(ei),_.T[Xe.StatueGemDrain]>0&&Q.getUniformInt(0,18)===0&&(U.gems--,await de(3800,40),Et());const e=_.entities.reduce((t,i)=>i.type===u.Slow?t+1:t,0);if(_.genNum>0&&e<995&&Q.getUniformInt(0,17)===0&&await Vr(1),_.magicEwalls&&Q.getUniformInt(0,7)===0){for(let t=0;t<100;t++){const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je);if(_.map.getType(i,n)===u.CWall1){_.map.setType(i,n,u.EWall),ze(i,n);break}}for(let t=0;t<100;t++){const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je);if(_.map.getType(i,n)===u.EWall){_.map.setType(i,n,u.CWall1),ze(i,n);break}}}if(_.evapoRate>0&&Q.getUniformInt(0,9)===0)for(let t=0;t<_.evapoRate;t++){const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je);_.map.getType(i,n)===u.River&&(_.map.setType(i,n,u.Floor),ze(i,n))}if(_.lavaFlow&&Q.getUniformInt(0,9)===0)for(let t=0;t<_.lavaRate;t++){const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je),a=_.map.getType(i,n);if([0,1,2,3,4,5,7,8,9,10,11,15,16,18,19,20,21,26,27,28,32,33,34,35,37,38,39,41,42,43,44,45,47,48,49,50,51,57,60,64,67,68,69,70,71,72,73,74,77,78,79,80,81,82,83].includes(a)){let o=!1;_.map.getType(i+1,n)===u.Lava&&(o=!0),_.map.getType(i-1,n)===u.Lava&&(o=!0),_.map.getType(i,n+1)===u.Lava&&(o=!0),_.map.getType(i,n-1)===u.Lava&&(o=!0),o&&(_.map.setType(i,n,u.Lava),ze(i,n))}}if(_.treeRate>0&&Q.getUniformInt(0,9)===0)for(let t=0;t<_.treeRate;t++){const i=Q.getUniformInt(0,Ke),n=Q.getUniformInt(0,Je),a=_.map.getType(i,n);if([0,16,27,28,32,33,37,39].includes(a)){let o=!1;if((_.map.getType(i+1,n)===u.Tree||_.map.getType(i+1,n)===u.Forest)&&(o=!0),(_.map.getType(i-1,n)===u.Tree||_.map.getType(i-1,n)===u.Forest)&&(o=!0),(_.map.getType(i,n+1)===u.Tree||_.map.getType(i,n+1)===u.Forest)&&(o=!0),(_.map.getType(i,n-1)===u.Tree||_.map.getType(i,n-1)===u.Forest)&&(o=!0),o){const f=Q.getUniformInt(0,3)===0?u.Tree:u.Forest;_.map.setType(i,n,f),ze(i,n)}}}}function Lc(){const e=jo();document.getElementById("app").appendChild(e),Ro()}async function $n(){ni(z.Black),Nl(),await ql(),await Xl(),await Zl(),await _n(),Zn(),await to(),eo(),await Ee("Press any key to begin this level."),_r(),Zn(),await Mc()}async function Mc(){Ec();let e=16*Ze.clockScale,t=0,i=0;const n=async a=>{if(U.gems<0){await Ql(),$n();return}if(Ze.done){$n();return}t+=a-i,i=a,t>e&&(t%=e,await Kl(),await Oc(),await Ic(),Lt(),_r()),eo(),e=16*Ze.clockScale,requestAnimationFrame(n)};requestAnimationFrame(n)}function hr(){Lc(),$n()}try{document.fonts.ready.then(hr)}catch{window.addEventListener("DOMContentLoaded",hr)}export{z as C,rt as P,u as T,Ke as X,Je as Y,zc as a,ze as d,Ee as f,_ as l,de as p,ot as r,U as s,Vl as t};
