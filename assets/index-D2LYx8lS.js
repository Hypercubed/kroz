var Qi=Object.defineProperty;var Ji=(e,t,i)=>t in e?Qi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var re=(e,t,i)=>Ji(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();var nt={exports:{}},en=nt.exports,oi;function tn(){return oi||(oi=1,function(e,t){(function(i,n){e.exports=n()})(en,function(){var i=function(){function n(_){return c.appendChild(_.dom),_}function o(_){for(var b=0;b<c.children.length;b++)c.children[b].style.display=b===_?"block":"none";s=_}var s=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(_){_.preventDefault(),o(++s%c.children.length)},!1);var X=(performance||Date).now(),h=X,u=0,d=n(new i.Panel("FPS","#0ff","#002")),m=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var y=n(new i.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:c,addPanel:n,showPanel:o,begin:function(){X=(performance||Date).now()},end:function(){u++;var _=(performance||Date).now();if(m.update(_-X,200),_>h+1e3&&(d.update(1e3*u/(_-h),100),h=_,u=0,y)){var b=performance.memory;y.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return _},update:function(){X=this.end()},domElement:c,setMode:o}};return i.Panel=function(n,o,s){var c=1/0,X=0,h=Math.round,u=h(window.devicePixelRatio||1),d=80*u,m=48*u,y=3*u,_=2*u,b=3*u,D=15*u,Y=74*u,F=30*u,C=document.createElement("canvas");C.width=d,C.height=m,C.style.cssText="width:80px;height:48px";var k=C.getContext("2d");return k.font="bold "+9*u+"px Helvetica,Arial,sans-serif",k.textBaseline="top",k.fillStyle=s,k.fillRect(0,0,d,m),k.fillStyle=o,k.fillText(n,y,_),k.fillRect(b,D,Y,F),k.fillStyle=s,k.globalAlpha=.9,k.fillRect(b,D,Y,F),{dom:C,update:function(q,Z){c=Math.min(c,q),X=Math.max(X,q),k.fillStyle=s,k.globalAlpha=1,k.fillRect(0,0,d,D),k.fillStyle=o,k.fillText(h(q)+" "+n+" ("+h(c)+"-"+h(X)+")",y,_),k.drawImage(C,b+u,D,Y-u,F,b,D,Y-u,F),k.fillRect(b+Y-u,D,u,F),k.fillStyle=s,k.globalAlpha=.9,k.fillRect(b+Y-u,D,u,h((1-q/Z)*F))}}},i})}(nt)),nt.exports}tn();const Ot=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},Xe=e=>Ot(e,"error"),nn=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,De=()=>({action:()=>{},after:()=>{},before:()=>{}}),Q={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},on={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){Xe(Q.INVALID_VALUE_NUMBER);return}this[i]=n}else Xe(Q.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,o,s,c){o&&s%2===c?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&s%2===c&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let o=0;o<this.buttons;o++)i.buttons[o].pressed===!0?(this.pressed[`button${o}`]||(this.pressed[`button${o}`]=!0,this.buttonActions[o].before()),this.buttonActions[o].action()):this.pressed[`button${o}`]&&(delete this.pressed[`button${o}`],this.buttonActions[o].after());if(i.axes){const o=i.axes.length%2;for(let s=0;s<this.axes*2;s++){const c=i.axes[s+o].toFixed(4),X=Math.floor(s/2);this.axeValues[X][s%2]=c,this.triggerDirectionalAction("right",X,c>=this.axeThreshold[0],s,0),this.triggerDirectionalAction("left",X,c<=-this.axeThreshold[0],s,0),this.triggerDirectionalAction("down",X,c>=this.axeThreshold[0],s,1),this.triggerDirectionalAction("up",X,c<=-this.axeThreshold[0],s,1)}}}},associateEvent:function(i,n,o){if(i.match(/^button\d+$/)){const s=parseInt(i.match(/^button(\d+)$/)[1]);s>=0&&s<this.buttons?this.buttonActions[s][o]=n:Xe(Q.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][o]=n;else if(i==="select")this.buttonActions[8][o]=n;else if(i==="r1")this.buttonActions[5][o]=n;else if(i==="r2")this.buttonActions[7][o]=n;else if(i==="l1")this.buttonActions[4][o]=n;else if(i==="l2")this.buttonActions[6][o]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][o]=n:Xe(Q.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const s=i.match(/^(up|down|left|right)(\d+)$/),c=s[1],X=parseInt(s[2]);X>=0&&X<this.axes?this.axesActions[X][c][o]=n:Xe(Q.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const s=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][s][o]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=De();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:De(),left:De(),right:De(),up:De()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},we={gamepads:{},axeThreshold:[1],isReady:nn(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){Xe(Q.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const n=this.getGamepads(),o=Object.keys(n);for(let s=0;s<o.length;s++)n[o[s]].set("axeThreshold",this.axeThreshold)}}else Xe(Q.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys(we.gamepads);we.onBeforeCycle();for(let i=0;i<t.length;i++)we.gamepads[t[i]].checkStatus();we.onAfterCycle(),t.length>0&&e(we.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Ot(Q.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=on.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Ot(Q.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:Xe(Q.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:Xe(Q.UNKNOWN_EVENT);break}return this}};we.init();const ot=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},an=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return rn(Math.atan2(n,i))},sn=(e,t,i)=>{const n={x:0,y:0};return i=kt(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n},kt=e=>e*(Math.PI/180),rn=e=>e*(180/Math.PI),ln=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,wt=new Map,ai=e=>{wt.has(e)&&clearTimeout(wt.get(e)),wt.set(e,setTimeout(e,100))},at=(e,t,i)=>{const n=t.split(/[ ,]+/g);let o;for(let s=0;s<n.length;s+=1)o=n[s],e.addEventListener?e.addEventListener(o,i,!1):e.attachEvent&&e.attachEvent(o,i)},si=(e,t,i)=>{const n=t.split(/[ ,]+/g);let o;for(let s=0;s<n.length;s+=1)o=n[s],e.removeEventListener?e.removeEventListener(o,i):e.detachEvent&&e.detachEvent(o,i)},yi=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),ri=()=>{const e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},li=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},Dt=(e,t,i)=>{const n=bi(e);for(let o in n)if(n.hasOwnProperty(o))if(typeof t=="string")n[o]=t+" "+i;else{let s="";for(let c=0,X=t.length;c<X;c+=1)s+=t[c]+" "+i+", ";n[o]=s.slice(0,-2)}return n},cn=(e,t)=>{const i=bi(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},bi=e=>{const t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},Mt=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Xn=(e,t)=>{const i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},xt=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},hn=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});var un="ontouchstart"in window,fn=!!window.PointerEvent,dn=!!window.MSPointerEvent,Le={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Se,Ue={};fn?Se=Le.pointer:dn?Se=Le.MSPointer:un?(Se=Le.touch,Ue=Le.mouse):Se=Le.mouse;function pe(){}pe.prototype.on=function(e,t){var i=this,n=e.split(/[ ,]+/g),o;i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)o=n[s],i._handlers_[o]=i._handlers_[o]||[],i._handlers_[o].push(t);return i};pe.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};pe.prototype.trigger=function(e,t){var i=this,n=e.split(/[ ,]+/g),o;i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)o=n[s],i._handlers_[o]&&i._handlers_[o].length&&i._handlers_[o].forEach(function(c){c.call(i,{type:o,target:i},t)})};pe.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=Xn(t.options,e))};pe.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},at(e,Se[t],i._domHandlers_[t]),Ue[t]&&at(e,Ue[t],i._domHandlers_[t]),i};pe.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},si(e,Se[t],i._domHandlers_[t]),Ue[t]&&si(e,Ue[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};function V(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=V.id,V.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}V.prototype=new pe;V.constructor=V;V.id=0;V.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};V.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=cn("borderRadius","50%"),i=Dt("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Mt(n.el,i),this.options.shape==="circle"&&Mt(n.back,t),Mt(n.front,t),this.applyStyles(n),this};V.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};V.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};V.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};V.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};V.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};V.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const i=t.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t};V.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",o={};o.front=Dt("transition",["transform"],n);var s={front:{}};s.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(o),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};V.prototype.restCallback=function(){var e=this,t={};t.front=Dt("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};V.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};V.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,n=Math.PI/2,o,s,c;if(t>i&&t<i*3&&!e.lockX?o="up":t>-i&&t<=i&&!e.lockY?o="left":t>-i*3&&t<=-i&&!e.lockX?o="down":e.lockY||(o="right"),e.lockY||(t>-n&&t<n?s="left":s="right"),e.lockX||(t>0?c="up":c="down"),e.force>this.options.threshold){var X={},h;for(h in this.direction)this.direction.hasOwnProperty(h)&&(X[h]=this.direction[h]);var u={};this.direction={x:s,y:c,angle:o},e.direction=this.direction;for(h in X)X[h]===this.direction[h]&&(u[h]=!0);if(u.x&&u.y&&u.angle)return e;(!u.x||!u.y)&&this.trigger("plain",e),u.x||this.trigger("plain:"+s,e),u.y||this.trigger("plain:"+c,e),u.angle||this.trigger("dir dir:"+o,e)}else this.resetDirection();return e};function B(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=B.id,B.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}B.prototype=new pe;B.constructor=B;B.id=0;B.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var n=0,o=t.length;n<o;n+=1)if(t[n].identifier===i)return t[n];return!1}};B.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};B.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};B.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,o={},s=i.options,c={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(e.x&&e.y)o={x:e.x-c.x,y:e.y-c.y};else if(e.top||e.right||e.bottom||e.left){var X=document.createElement("DIV");X.style.display="hidden",X.style.top=e.top,X.style.right=e.right,X.style.bottom=e.bottom,X.style.left=e.left,X.style.position="absolute",s.zone.appendChild(X);var h=X.getBoundingClientRect();s.zone.removeChild(X),o=e,e={x:h.left+n.x,y:h.top+n.y}}var u=new V(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(li(u.ui.el,o),li(u.ui.front,u.frontPosition)),i.nipples.push(u),i.trigger("added "+u.identifier+":added",u),i.manager.trigger("added "+u.identifier+":added",u),i.bindNipple(u),u};B.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};B.prototype.bindNipple=function(e){var t=this,i,n=function(o,s){i=o.type+" "+s.id+":"+o.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};B.prototype.pressureFn=function(e,t,i){var n=this,o=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==o&&(t.trigger("pressure",s),n.trigger("pressure "+t.identifier+":pressure",s),o=s)}).bind(n),100)};B.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=yi(e),t.updateBox();var o=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(c){if(Object.values(n.touches).findIndex(function(h){return h.identifier===c})<0){var X=[e[0]];X.identifier=c,t.processOnEnd(X)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return xt(e,o),t.manager.bindDocument(),!1};B.prototype.processOnStart=function(e){var t=this,i=t.options,n,o=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,c={x:e.pageX,y:e.pageY},X=t.getOrCreate(o,c);X.identifier!==o&&t.manager.removeIdentifier(X.identifier),X.identifier=o;var h=function(d){d.trigger("start",d),t.trigger("start "+d.id+":start",d),d.show(),s>0&&t.pressureFn(e,d,d.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(X))>=0&&t.idles.splice(n,1),t.actives.push(X),t.ids.push(X.identifier),i.mode!=="semi")h(X);else{var u=ot(c,X.position);if(u<=i.catchDistance)h(X);else{X.destroy(),t.processOnStart(e);return}}return X};B.prototype.getOrCreate=function(e,t){var i=this,n=i.options,o;return/(semi|static)/.test(n.mode)?(o=i.idles[0],o?(i.idles.splice(0,1),o):n.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(o=i.createNipple(t,e),o)};B.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),o=t.nipples.get(n),s=t.manager.scroll;if(!ln(e)){this.processOnEnd(e);return}if(!o){console.error("Found zombie joystick with ID "+n),t.manager.removeIdentifier(n);return}if(i.dynamicPage){var c=o.el.getBoundingClientRect();o.position={x:s.x+c.left,y:s.y+c.top}}o.identifier=n;var X=o.options.size/2,h={x:e.pageX,y:e.pageY};i.lockX&&(h.y=o.position.y),i.lockY&&(h.x=o.position.x);var u=ot(h,o.position),d=an(h,o.position),m=kt(d),y=u/X,_={distance:u,position:h},b,D;if(o.options.shape==="circle"?(b=Math.min(u,X),D=sn(o.position,b,d)):(D=hn(h,o.position,X),b=ot(D,o.position)),i.follow){if(u>X){let k=h.x-D.x,q=h.y-D.y;o.position.x+=k,o.position.y+=q,o.el.style.top=o.position.y-(t.box.top+s.y)+"px",o.el.style.left=o.position.x-(t.box.left+s.x)+"px",u=ot(h,o.position)}}else h=D,u=b;var Y=h.x-o.position.x,F=h.y-o.position.y;o.frontPosition={x:Y,y:F},i.dataOnly||(o.ui.front.style.transform="translate("+Y+"px,"+F+"px)");var C={identifier:o.identifier,position:h,force:y,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:m,degree:d},vector:{x:Y/X,y:-F/X},raw:_,instance:o,lockX:i.lockX,lockY:i.lockY};C=o.computeDirection(C),C.angle={radian:kt(180-d),degree:180-d},o.trigger("move",C),t.trigger("move "+o.id+":move",C)};B.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),o=t.nipples.get(n),s=t.manager.removeIdentifier(o.identifier);o&&(i.dataOnly||o.hide(function(){i.mode==="dynamic"&&(o.trigger("removed",o),t.trigger("removed "+o.id+":removed",o),t.manager.trigger("removed "+o.id+":removed",o),o.destroy())}),clearInterval(t.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),t.trigger("end "+o.id+":end",o),t.ids.indexOf(o.identifier)>=0&&t.ids.splice(t.ids.indexOf(o.identifier),1),t.actives.indexOf(o)>=0&&t.actives.splice(t.actives.indexOf(o),1),/(semi|static)/.test(i.mode)?t.idles.push(o):t.nipples.indexOf(o)>=0&&t.nipples.splice(t.nipples.indexOf(o),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};B.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};B.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};function z(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=ri(),t.config(e),t.prepareCollections();var i=function(){var o;t.collections.forEach(function(s){s.forEach(function(c){o=c.el.getBoundingClientRect(),c.position={x:t.scroll.x+o.left,y:t.scroll.y+o.top}})})};at(window,"resize",function(){ai(i)});var n=function(){t.scroll=ri()};return at(window,"scroll",function(){ai(n)}),t.collections}z.prototype=new pe;z.constructor=z;z.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return i=n.get(t),!i}),i}};z.prototype.create=function(e){return this.createCollection(e)};z.prototype.createCollection=function(e){var t=this,i=new B(t,e);return t.bindCollection(i),t.collections.push(i),i};z.prototype.bindCollection=function(e){var t=this,i,n=function(o,s){i=o.type+" "+s.id+":"+o.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};z.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};z.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};z.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};z.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};z.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};z.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};z.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};z.prototype.onAny=function(e,t){var i=this,n,o="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=yi(t);var s=function(X,h,u){u.ids.indexOf(h)>=0&&(u[o](X),X._found_=!0)},c=function(X){n=i.getIdentifier(X),xt(i.collections,s.bind(null,X,n)),X._found_||i.removeIdentifier(n)};return xt(t,c),!1};z.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};z.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};const ci=new z,yt={create:function(e){return ci.create(e)},factory:ci},Ne="The Forgotton Adventures of Kroz",rt=80,he=25,xe=1,Te=rt-16,We=1,Ke=he-2,W=63,I=22,v=" ",oe=1,pn=5;var Ee={},Pe={},Xi;function Rn(){if(Xi)return Pe;Xi=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.MiniSignal=void 0;const e=Symbol("SIGNAL");function t(n){return typeof n=="object"&&e in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...o){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let s=this._head;if(s==null)return!1;for(this._dispatching=!0;s!=null;)s.fn(...o),s=s.next;return this._dispatching=!1,!0}add(o){if(typeof o!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:o}))}detach(o){if(!t(o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(o[e]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const s=this._refMap.get(o);return s?(this._refMap.delete(o),this._disconnectNode(s),this._destroyNode(s),this):this}detachAll(){let o=this._head;if(o==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;o!=null;)this._destroyNode(o),o=o.next;return this}_destroyNode(o){o.fn=void 0,o.prev=void 0}_disconnectNode(o){o===this._head?(this._head=o.next,o.next==null&&(this._tail=void 0)):o===this._tail&&(this._tail=o.prev,this._tail!=null&&(this._tail.next=void 0)),o.prev!=null&&(o.prev.next=o.next),o.next!=null&&(o.next.prev=o.prev)}_addNode(o){return this._head==null?(this._head=o,this._tail=o):(this._tail.next=o,o.prev=this._tail,this._tail=o),o}_createRef(o){const s={[e]:this._symbol};return this._refMap.set(s,o),s}_getRef(o){return this._refMap.get(o)}}return Pe.MiniSignal=i,Pe}var hi;function gn(){return hi||(hi=1,function(e){var t=Ee.__createBinding||(Object.create?function(n,o,s,c){c===void 0&&(c=s);var X=Object.getOwnPropertyDescriptor(o,s);(!X||("get"in X?!o.__esModule:X.writable||X.configurable))&&(X={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(n,c,X)}:function(n,o,s,c){c===void 0&&(c=s),n[c]=o[s]}),i=Ee.__exportStar||function(n,o){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),i(Rn(),e)}(Ee)),Ee}var Lt=gn();function O(e=0){return new Promise(t=>{setTimeout(()=>t(),e)})}function ui(e,t,i){return Math.min(Math.max(e,t),i)}const Tt=new Lt.MiniSignal,le=new Lt.MiniSignal,ce=new Lt.MiniSignal;let ve=null;var E=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.NextLevelCheat=12]="NextLevelCheat",e[e.PrevLevel=13]="PrevLevel",e[e.Teleport=14]="Teleport",e[e.ResetFound=15]="ResetFound",e[e.HideFound=16]="HideFound",e[e.Pause=17]="Pause",e[e.Quit=18]="Quit",e[e.Save=19]="Save",e[e.Restore=20]="Restore",e[e.SlowerClock=21]="SlowerClock",e[e.FasterClock=22]="FasterClock",e))(E||{});const ae={},G={},lt={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:14,T:14,")":10,"+":15,"-":16,"(":12,PageDown:null,PageUp:null,p:17,P:17,Escape:18,s:19,S:19,r:20,R:20,F11:21,F12:22},H={button0:"w",button1:"t",button4:null,button5:null,button8:"s",button9:"p",button16:"Escape",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",button12:"ArrowUp",button13:"ArrowDown",button14:"ArrowLeft",button15:"ArrowRight"};function mn(){ve||we.on("connect",e=>{if(!ve){ve=e,ve.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(H))i&&(ve.before(t,()=>le.dispatch(i)),ve.after(t,()=>ce.dispatch(i)))}})}let bt=null,vt=null,_t=null;const wn="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;function Mn(){bt||!wn||(document.querySelectorAll(".touch_zone").forEach(e=>{e.style.display="block"}),bt=yt.create({zone:document.querySelector(".touch_zone--bottom-left"),mode:"dynamic",threshold:.5,dynamicPage:!0,position:{left:"50px",bottom:"50px"},restOpacity:.3}),bt.on("move end",(e,t)=>{const{x:n,y:o}=t.vector||{x:0,y:0};n>.5?le.dispatch(H.right):n<-.5?le.dispatch(H.left):(ce.dispatch(H.right),ce.dispatch(H.left)),o>.5?le.dispatch(H.up):o<-.5?le.dispatch(H.down):(ce.dispatch(H.up),ce.dispatch(H.down))}),vt=yt.create({zone:document.querySelector(".touch_zone--bottom-right"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{left:"50px",bottom:"50px"}}),vt.on("start",()=>le.dispatch(H.button0)),vt.on("end",()=>ce.dispatch(H.button0)),_t=yt.create({zone:document.querySelector(".touch_zone--top-right"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{right:"50px",top:"50px"}}),_t.on("start",()=>le.dispatch(H.button1)),_t.on("end",()=>ce.dispatch(H.button1)))}function yn(e){e.repeat||(lt[e.key]&&e.preventDefault(),le.dispatch(e.key))}function bn(e){lt[e.key]&&e.preventDefault(),ce.dispatch(e.key)}le.add(e=>{ae[e]=3;const t=lt[e];t&&(G[t]=3)});ce.add(e=>{(ae[e]||0)&3&&Tt.dispatch(e),ae[e]&=-2,ae[e]|=4;const t=lt[e];t&&(G[t]&=-2,G[t]|=4)});function vn(){mn(),Mn(),window.addEventListener("keydown",yn),window.addEventListener("keyup",bn)}function Qe(){for(const e in ae)ae[e]&&(ae[e]=0)}function Et(){for(const e in G)Object.prototype.hasOwnProperty.call(G,e)&&delete G[e];for(const e in ae)Object.prototype.hasOwnProperty.call(ae,e)&&delete ae[e]}function vi(){for(const e in G){const t=e;if(!G[t])continue;const i=!!(G[t]&2);G[t]&=-15,i&&(G[t]|=8)}}function ie(e){return!!(G[e]&3)&&!(G[e]&8)}function j(e){return!!(G[e]&4)}async function $e(){return Et(),new Promise(e=>{const t=Tt.add(i=>{Tt.detach(t),e(i)})})}async function Pt(e,t=50){const i=$e();do await(e==null?void 0:e());while(!await Promise.race([i,O(t)]));return i}class Bt{getContainer(){return null}setOptions(t){this._options=t}}class At extends Bt{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const n=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let n=this._ctx.canvas,o=n.getBoundingClientRect();return t-=o.left,i-=o.top,t*=n.width/o.width,i*=n.height/o.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function Vt(e,t){return(e%t+t)%t}class _i extends At{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[n,o,s,c,X]=t,h=[(n+1)*this._spacingX,o*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),i&&(this._ctx.fillStyle=X,this._fill(h[0],h[1])),!s)return;this._ctx.fillStyle=c;let u=[].concat(s);for(let d=0;d<u.length;d++)this._ctx.fillText(u[d],h[0],Math.ceil(h[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=Math.floor(t/this._spacingX)-1,o=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,o]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,o=i/(2+1.5*(this._options.height-1)),s=Math.min(n,o),c=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let X=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=c;let h=X/100;s=Math.floor(s)+1;let u=2*s/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(u)-1}_normalizedEventToPosition(t,i){let n;this._options.transpose?(t+=i,i=t-i,t-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let o=n/this._options.height;return i=Math.floor(i/o),Vt(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let n=this._hexSize,o=this._options.border;const s=this._ctx;s.beginPath(),this._options.transpose?(s.moveTo(t-n+o,i),s.lineTo(t-n/2+o,i+this._spacingX-o),s.lineTo(t+n/2-o,i+this._spacingX-o),s.lineTo(t+n-o,i),s.lineTo(t+n/2-o,i-this._spacingX+o),s.lineTo(t-n/2+o,i-this._spacingX+o),s.lineTo(t-n+o,i)):(s.moveTo(t,i-n+o),s.lineTo(t+this._spacingX-o,i-n/2+o),s.lineTo(t+this._spacingX-o,i+n/2-o),s.lineTo(t,i+n-o),s.lineTo(t-this._spacingX+o,i+n/2-o),s.lineTo(t-this._spacingX+o,i-n/2+o),s.lineTo(t,i-n+o)),s.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,o;t.transpose?(n="height",o="width"):(n="width",o="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[o]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class Ge extends At{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){Ge.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,n,o,s,c]=t,X=""+o+s+c,h;if(X in this._canvasCache)h=this._canvasCache[X];else{let u=this._options.border;h=document.createElement("canvas");let d=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,d.fillStyle=c,d.fillRect(u,u,h.width-u,h.height-u),o){d.fillStyle=s,d.font=this._ctx.font,d.textAlign="center",d.textBaseline="middle";let m=[].concat(o);for(let y=0;y<m.length;y++)d.fillText(m[y],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[X]=h}this._ctx.drawImage(h,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,i){let[n,o,s,c,X]=t;if(i){let u=this._options.border;this._ctx.fillStyle=X,this._ctx.fillRect(n*this._spacingX+u,o*this._spacingY+u,this._spacingX-u,this._spacingY-u)}if(!s)return;this._ctx.fillStyle=c;let h=[].concat(s);for(let u=0;u<h.length;u++)this._ctx.fillText(h[u],(n+.5)*this._spacingX,Math.ceil((o+.5)*this._spacingY))}computeSize(t,i){let n=Math.floor(t/this._spacingX),o=Math.floor(i/this._spacingY);return[n,o]}computeFontSize(t,i){let n=Math.floor(t/this._options.width),o=Math.floor(i/this._options.height),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let c=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let h=c/100*o/n;return h>1&&(o=Math.floor(o/h)),Math.floor(o/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}Ge.cache=!1;class Yi extends At{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[n,o,s,c,X]=t,h=this._options.tileWidth,u=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*h,o*u,h,u):(this._ctx.fillStyle=X,this._ctx.fillRect(n*h,o*u,h,u))),!s)return;let d=[].concat(s),m=[].concat(c),y=[].concat(X);for(let _=0;_<d.length;_++){let b=this._options.tileMap[d[_]];if(!b)throw new Error(`Char "${d[_]}" not found in tileMap`);if(this._options.tileColorize){let D=this._colorCanvas,Y=D.getContext("2d");Y.globalCompositeOperation="source-over",Y.clearRect(0,0,h,u);let F=m[_],C=y[_];Y.drawImage(this._options.tileSet,b[0],b[1],h,u,0,0,h,u),F!="transparent"&&(Y.fillStyle=F,Y.globalCompositeOperation="source-atop",Y.fillRect(0,0,h,u)),C!="transparent"&&(Y.fillStyle=C,Y.globalCompositeOperation="destination-over",Y.fillRect(0,0,h,u)),this._ctx.drawImage(D,n*h,o*u,h,u)}else this._ctx.drawImage(this._options.tileSet,b[0],b[1],h,u,n*h,o*u,h,u)}}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),o=Math.floor(i/this._options.tileHeight);return[n,o]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}const Je=23283064365386963e-26;class zt{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*Je,t=t*69069+1>>>0,this._s1=t*Je,t=t*69069+1>>>0,this._s2=t*Je,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*Je;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let n=Math.max(t,i),o=Math.min(t,i);return Math.floor(this.getUniform()*(n-o+1))+o}getNormal(t=0,i=1){let n,o,s;do n=2*this.getUniform()-1,o=2*this.getUniform()-1,s=n*n+o*o;while(s>1||s==0);let c=n*Math.sqrt(-2*Math.log(s)/s);return t+c*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],n=t.slice();for(;n.length;){let o=n.indexOf(this.getItem(n));i.push(n.splice(o,1)[0])}return i}getWeightedValue(t){let i=0;for(let c in t)i+=t[c];let n=this.getUniform()*i,o,s=0;for(o in t)if(s+=t[o],n<s)return o;return o}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new zt().setState(this.getState())}}const p=new zt().setSeed(Date.now());function Si(e){let t,i;if(e in Yt)t=Yt[e];else{if(e.charAt(0)=="#"){let o=(e.match(/[0-9a-f]/gi)||[]).map(s=>parseInt(s,16));if(o.length==3)t=o.map(s=>s*17);else{for(let s=0;s<3;s++)o[s+1]+=16*o[s],o.splice(s,1);t=o}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):t=[0,0,0];Yt[e]=t}return t.slice()}const Yt={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class $i extends Bt{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const n=this._gl,o=this._options;let[s,c,X,h,u]=t,d=n.canvas.height-(c+1)*o.tileHeight;if(n.scissor(s*o.tileWidth,d,o.tileWidth,o.tileHeight),i&&(o.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...et(u)),n.clear(n.COLOR_BUFFER_BIT)),!X)return;let m=[].concat(X),y=[].concat(u),_=[].concat(h);n.uniform2fv(this._uniforms.targetPosRel,[s,c]);for(let b=0;b<m.length;b++){let D=this._options.tileMap[m[b]];if(!D)throw new Error(`Char "${m[b]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,o.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,D),o.tileColorize&&(n.uniform4fv(this._uniforms.tint,et(_[b])),n.uniform4fv(this._uniforms.bg,et(y[b]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...et(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),o=Math.floor(i/this._options.tileHeight);return[n,o]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let n=this._gl.canvas,o=n.getBoundingClientRect();return t-=o.left,i-=o.top,t*=n.width/o.width,i*=n.height/o.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=$n(t,Yn,Sn);return t.useProgram(i),On(t),_n.forEach(n=>this._uniforms[n]=t.getUniformLocation(i,n)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){kn(this._gl,t)}}const _n=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],Yn=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),Sn=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function $n(e,t,i){const n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"");const o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(o)||"");const s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(s)||"");return s}function On(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function kn(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let St={};function et(e){if(!(e in St)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=Si(e).map(i=>i/255),t.push(1);St[e]=t}return St[e]}function xn(e){return`\x1B[0;48;5;${Wt(e)}m\x1B[2J`}function Tn(e,t){return`\x1B[0;38;5;${Wt(e)};48;5;${Wt(t)}m`}function Wn(e,t){return`\x1B[${t+1};${e+1}H`}function Wt(e){const n=.0234375;let o=Si(e),s=Math.floor(o[0]*n),c=Math.floor(o[1]*n),X=Math.floor(o[2]*n);return s*36+c*6+X*1+16}class Oi extends Bt{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],n=this.computeSize();this._offset=n.map((o,s)=>Math.floor((o-i[s])/2))}clear(){process.stdout.write(xn(this._options.bg))}draw(t,i){let[n,o,s,c,X]=t,h=this._offset[0]+n,u=this._offset[1]+o,d=this.computeSize();if(h<0||h>=d[0]||u<0||u>=d[1]||((h!==this._cursor[0]||u!==this._cursor[1])&&(process.stdout.write(Wn(h,u)),this._cursor[0]=h,this._cursor[1]=u),i&&(s||(s=" ")),!s))return;let m=Tn(c,X);if(m!==this._lastColor&&(process.stdout.write(m),this._lastColor=m),s!="	"){let y=[].concat(s);process.stdout.write(y[0])}this._cursor[0]++,this._cursor[0]>=d[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const Fn=/%([bc]){([^}]*)}/g,Fe=0,Ae=1,ki=2,xi=3;function Cn(e,t){let i=[],n=0;e.replace(Fn,function(s,c,X,h){let u=e.substring(n,h);return u.length&&i.push({type:Fe,value:u}),i.push({type:c=="c"?ki:xi,value:X.trim()}),n=h+s.length,""});let o=e.substring(n);return o.length&&i.push({type:Fe,value:o}),In(i,t)}function In(e,t){t||(t=1/0);let i=0,n=0,o=-1;for(;i<e.length;){let c=e[i];if(c.type==Ae&&(n=0,o=-1),c.type!=Fe){i++;continue}for(;n==0&&c.value.charAt(0)==" ";)c.value=c.value.substring(1);let X=c.value.indexOf(`
`);if(X!=-1){c.value=tt(e,i,X,!0);let h=c.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();c.value=h.join("")}if(!c.value.length){e.splice(i,1);continue}if(n+c.value.length>t){let h=-1;for(;;){let u=c.value.indexOf(" ",h+1);if(u==-1||n+u>t)break;h=u}if(h!=-1)c.value=tt(e,i,h,!0);else if(o!=-1){let u=e[o],d=u.value.lastIndexOf(" ");u.value=tt(e,o,d,!0),i=o}else c.value=tt(e,i,t-n,!1)}else n+=c.value.length,c.value.indexOf(" ")!=-1&&(o=i);i++}e.push({type:Ae});let s=null;for(let c=0;c<e.length;c++){let X=e[c];switch(X.type){case Fe:s=X;break;case Ae:if(s){let h=s.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();s.value=h.join("")}s=null;break}}return e.pop(),e}function tt(e,t,i,n){let o={type:Ae},s={type:Fe,value:e[t].value.substring(i+(n?1:0))};return e.splice(t+1,0,o,s),e[t].value.substring(0,i)}let Dn=80,Ln=25;const En={hex:_i,rect:Ge,tile:Yi,"tile-gl":$i,term:Oi},Pn={width:Dn,height:Ln,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class Me{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},Pn,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,n){let o=[this._options.bg,this._options.fg];this.draw(t,i,null,null,o[n%o.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=En[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let n=Math.floor(t/this._options.width),o=Math.floor(i/this._options.height);return[n,o]}eventToPosition(t){let i,n;return"touches"in t?(i=t.touches[0].clientX,n=t.touches[0].clientY):(i=t.clientX,n=t.clientY),this._backend.eventToPosition(i,n)}draw(t,i,n,o,s){o||(o=this._options.fg),s||(s=this._options.bg);let c=`${t},${i}`;this._data[c]=[t,i,n,o,s],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[c]=!0)}drawOver(t,i,n,o,s){const c=`${t},${i}`,X=this._data[c];X?(X[2]=n||X[2],X[3]=o||X[3],X[4]=s||X[4]):this.draw(t,i,n,o,s)}drawText(t,i,n,o){let s=null,c=null,X=t,h=i,u=1;o||(o=this._options.width-t);let d=Cn(n,o);for(;d.length;){let m=d.shift();switch(m.type){case Fe:let y=!1,_=!1,b=!1,D=!1;for(let Y=0;Y<m.value.length;Y++){let F=m.value.charCodeAt(Y),C=m.value.charAt(Y);if(this._options.layout==="term"){let k=F>>8;if(k===17||k>=46&&k<=159||k>=172&&k<=215||F>=43360&&F<=43391){this.draw(X+0,h,C,s,c),this.draw(X+1,h,"	",s,c),X+=2;continue}}b=F>65280&&F<65377||F>65500&&F<65512||F>65518,y=C.charCodeAt(0)==32||C.charCodeAt(0)==12288,D&&!b&&!y&&X++,b&&!_&&X++,this.draw(X++,h,C,s,c),_=y,D=b}break;case ki:s=m.value||null;break;case xi:c=m.value||null;break;case Ae:X=t,h++,u++;break}}return u}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let n=this._data[t];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}Me.Rect=Ge;Me.Hex=_i;Me.Tile=Yi;Me.TileGL=$i;Me.Term=Oi;var l=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(l||{});const ee={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};let A;function Bn(){Me.Rect.cache=!0,A=new Me({width:rt,height:he,fontFamily:"IBM_VGA, monospace",bg:ee[l.Black],fg:ee[l.White],fontSize:64});const e=A.drawOver;A.drawOver=function(t,i,n,o,s){e.call(this,t,i,n,o,s),this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[`${t},${i}`]=!0)}}function N(e,t,i=A.getOptions().fg,n=A.getOptions().bg){const o=Math.floor((rt-t.length)/2);$(o,e,t,i,n)}function ye(e=A.getOptions().bg){typeof e=="number"&&(e=ee[e]),A.setOptions({bg:e}),A.clear()}function Ut(e,t=A.getOptions().bg){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=ee[e]),typeof t=="number"&&(t=ee[t]),[e,t]}function Oe(e,t,i,n=A.getOptions().fg,o=A.getOptions().bg){[n,o]=Ut(n,o),A.draw(e,t,i,n,o)}function An(e,t,i,n=A.getOptions().fg,o=A.getOptions().bg){[n,o]=Ut(n,o),A.drawOver(e,t,i,n,o)}function $(e,t,i,n=A.getOptions().fg,o=A.getOptions().bg){return typeof n=="number"&&n>15&&(n=Date.now()%500<250?n:o),typeof o=="number"&&(o=ee[o%16]),typeof n=="number"&&(n=ee[n%16]),A.drawText(e,t,`%c{${n}}%b{${o}}`+i)}function Vn(){return A||Bn(),A.getContainer()}const ct={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((n,o)=>t.getChannelData(o).set(n)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,n=0,o=0,s=.1,c=0,X=1,h=0,u=0,d=0,m=0,y=0,_=0,b=0,D=0,Y=0,F=1,C=0,k=0,q=0){let Z=Math.PI*2,pt=ji=>ji<0?-1:1,K=this.sampleRate,Vi=h*=500*Z/K/K,Zt=i*=(1+t*2*Math.random()-t)*Z/K,Rt=[],Re=0,zi=0,U=0,Ie=1,Ui=0,Ni=0,te=0,gt,be,Ki=2,jt=Z*Math.abs(q)*2/K,mt=Math.cos(jt),Qt=Math.sin(jt)/2/Ki,je=1+Qt,Gi=-2*mt/je,Hi=(1-Qt)/je,Jt=(1+pt(q)*mt)/2/je,qi=-(pt(q)+mt)/je,Zi=Jt,ei=0,ti=0,ii=0,ni=0;for(n=n*K+9,C*=K,o*=K,s*=K,Y*=K,u*=500*Z/K**3,b*=Z/K,d*=Z/K,m*=K,y=y*K|0,e*=this.volume,be=n+C+o+s+Y|0;U<be;Rt[U++]=te*e)++Ni%(D*100|0)||(te=c?c>1?c>2?c>3?Math.sin(Re*Re):Math.max(Math.min(Math.tan(Re),1),-1):1-(2*Re/Z%2+2)%2:1-4*Math.abs(Math.round(Re/Z)-Re/Z):Math.sin(Re),te=(y?1-k+k*Math.sin(Z*U/y):1)*pt(te)*Math.abs(te)**X*(U<n?U/n:U<n+C?1-(U-n)/C*(1-F):U<n+C+o?F:U<be-Y?(be-U-Y)/s*F:0),te=Y?te/2+(Y>U?0:(U<be-Y?1:(be-U)/Y)*Rt[U-Y|0]/2/e):te,q&&(te=ni=Zi*ei+qi*(ei=ti)+Jt*(ti=te)-Hi*ii-Gi*(ii=ni))),gt=(i+=h+=u)*Math.cos(b*zi++),Re+=gt+gt*_*Math.sin(U**5),Ie&&++Ie>m&&(i+=d,Zt+=d,Ie=0),y&&!(++Ui%y)&&(i=Zt,h=Vi,Ie=Ie||1);return Rt},getNote:function(e=0,t=440){return t*2**(e/12)}};ct.volume=.005;function R(e,t,i=1){return ct.play(i,0,e,0,t/1e3,0),O(t)}async function ne(){for(let e=1;e<=65;e++)R(p.getUniformInt(1e3,2e3),1);await O(0)}async function Be(){for(let e=150;e>=35;e--)await R(e,1)}async function fi(){await R(400,120,5),await O(10),await R(700,120,5),await O(10)}async function ke(){for(let e=1;e<=23;e++)R(p.getUniformInt(350,900),120);await O(120);for(let e=1;e<=30;e++)R(p.getUniformInt(150,200),50)}async function zn(){for(let e=10;e<=90;e++)await R(e,15,100)}async function di(){for(let e=150;e>35;e--)await R(e,16,50)}const Un=ct.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function _e(){ct.playSamples(Un)}async function pi(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=p.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)R(p.getUniformInt(0,4e3)+3e3,16,10)}else await O(p.getUniformInt(0,29))}async function Nn(){for(let e=10;e<45;e++)for(let t=1;t<13;t++)await R(e*e*t,t+1,100)}async function Kn(e){await R(200+200*e,25,100)}async function Gn(){await R(2e3,40,10)}async function Hn(){await R(Math.random()*129+30,150,100)}async function qn(){await R(70,50*8,100)}async function Zn(){for(let e=330;e>20;e--)R(90,10,.5)}async function jn(){await R(400,50)}async function Qn(){await R(130,50)}async function $t(){R(130,25),await R(90,50)}async function Jn(){await R(20,10,100)}async function eo(){await R(300,10,10)}async function to(){for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await R(e*e*t,t+1,100)}async function io(){for(let e=70;e<=600;e++)R(e*2,3,10),e%10===0&&await O(1)}async function no(){await R(30,10,10),await O(20)}async function oo(){for(let e=0;e<2500;e++)R(p.getUniformInt(0,e),5,100),e%25===0&&await O()}async function ao(){for(let e=2500;e>50;e--)R(p.getUniformInt(0,e),5,100),e%25===0&&await O()}async function so(){for(let e=0;e<50;e++)R(p.getUniformInt(0,200),50,100);await O(50)}async function ro(){await R(p.getUniformInt(110,1310),7,100)}async function lo(){await R(200,60,100)}async function co(){await R(600,20)}async function Xo(){await R(90,10,10)}async function ho(){for(let e=130;e>5;e--)await R(e*8,16,100)}async function uo(){for(let e=20;e<8e3;e++)R(e,1,100);await O(100)}async function fo(){for(let e=5;e<70;e++)R(e*8,1);await O(50)}var a=(e=>(e[e.Border=-1]="Border",e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(a||{});const fe={[-1]:"▒",0:v,1:"Ä",2:"Ö",3:"Ω",4:"▓",5:"⌠",6:"≡",7:"C",8:"Φ",9:"♦",10:"¡",11:"↑",12:"î",13:"∞",14:"█",15:"Θ",16:"∙",17:"≈",18:"○",19:"█",20:"♣",21:"¥",22:"▓",23:"░",24:"■",25:"∩",26:"ƒ",27:"☼",28:v,29:v,30:v,31:v,32:v,33:v,34:"▲",35:"▼",36:"♠",37:v,38:"▓",39:v,40:"☻",41:v,42:"■",43:"▓",44:v,45:"?",46:"☺",47:v,48:"K",49:"R",50:"O",51:"Z",52:"█",53:"█",54:"█",55:v,56:v,57:v,58:"⌂",59:"⌂",60:"⌂",61:v,62:v,63:v,64:"▓",65:"O",66:"X",67:v,68:v,69:v,70:v,71:v,72:v,73:v,74:v,75:"│",76:"↓",77:"↓",78:"↓",79:"↓",80:"↓",81:"♀",82:"→",83:"←",224:v,225:v,226:v,227:v,228:v,229:v,230:v,231:v,252:"♣"},po={" ":0,1:1,2:2,3:3,X:4,W:5,L:6,C:7,S:8,"+":9,I:10,T:11,K:12,D:13,"#":14,F:15,".":16,R:17,Q:18,"/":19,"\\":20,"♣":20,B:21,V:22,"=":23,A:24,U:25,Z:26,"*":27,E:28,";":29,":":30,"`":31,"-":32,"@":33,"%":34,"]":35,G:36,")":37,M:38,"(":39,P:40,"&":41,"!":42,O:43,H:44,"?":45,">":46,N:47,"<":48,"[":49,"|":50,'"':51,4:52,5:53,6:54,7:55,8:56,9:57,ñ:58,ò:59,ó:60,ô:61,õ:62,ö:63,Y:64,0:65,"~":66,$:67,"‘":68,"’":69,"“":70,"”":71,"•":72,"–":73,"—":74,"³":75,"¹":76,º:77,"»":78,"¼":79,"½":80,ƒ:81,"¯":82,"®":83,à:224,á:225,â:226,ã:227,ä:228,å:229,æ:230,ç:231,ü:252},T={[-1]:[l.LightBlue,l.Black],0:[l.Black,l.Black],1:[l.LightRed,null],2:[l.LightBlue,null],3:[l.Green,null],4:[l.Brown,null],5:[l.HighIntensityWhite,null],6:[l.Black|16,l.White],7:[l.Yellow,l.Red],8:[l.LightCyan,null],9:[l.Blue,null],10:[l.Green,null],11:[l.LightMagenta,null],12:[l.LightRed,null],13:[l.Cyan,l.Magenta],14:[l.Brown,l.Brown],15:[l.LightCyan,null],16:[l.White,null],17:[l.LightBlue,l.Blue],18:[l.HighIntensityWhite,null],19:[l.Green,l.Green],20:[l.Brown,l.Green],21:[l.HighIntensityWhite,null],22:[l.LightRed,l.Red],23:[l.White,null],24:[l.HighIntensityWhite|32,l.Magenta],25:[l.HighIntensityWhite,null],26:[l.LightCyan,null],27:[l.Yellow,null],28:[l.HighIntensityWhite,null],29:[null,null],30:[null,null],31:[null,null],32:[null,null],34:[l.LightRed,null],35:[l.HighIntensityWhite,null],36:[l.Yellow|16,null],38:[l.Brown,null],33:[null,null],37:[null,null],39:[null,null],67:[null,null],224:[null,null],225:[null,null],226:[null,null],227:[null,null],228:[null,null],229:[null,null],230:[null,null],231:[null,null],40:[l.Yellow,l.Black],41:[null,null],42:[l.LightBlue,null],43:[l.Brown,null],44:[null,null],45:[l.HighIntensityWhite,null],46:[l.HighIntensityWhite|16,null],48:[l.Yellow,null],49:[l.Yellow,null],50:[l.Yellow,null],51:[l.Yellow,null],52:[l.Brown,l.Brown],53:[l.Brown,l.Brown],54:[l.White,l.White],55:[null,null],56:[null,null],57:[null,null],58:[l.LightCyan,null],59:[l.LightCyan,null],60:[l.LightCyan,null],61:[null,null],62:[null,null],63:[null,null],64:[l.White,l.Black],65:[l.White,null],66:[l.LightRed,l.Red],68:[null,null],69:[null,null],70:[null,null],71:[null,null],72:[null,null],73:[null,null],74:[null,null],47:[l.HighIntensityWhite,null],75:[l.White,null],76:[l.White,null],77:[l.White,null],78:[l.White,null],79:[l.White,null],80:[l.White,null],82:[l.White,null],83:[l.White,null],81:[l.HighIntensityWhite|16,null],252:[l.Brown,l.Green]},Ro={[-1]:"An Electrified Wall blocks your way.",4:"A Breakable Wall blocks your way",5:"You have found a Whip",6:"Stairs take you to the next lower level.",7:"`You found gems and whips inside the chest!",8:"You activated a Slow Time spell.",9:"Gems give you both points and strength.",10:"Oh no, a temporary Blindness Potion!",11:"You found a Teleport scroll.",12:"Use Keys to unlock doors.",13:"The Door opens!  (One of your Keys is used.)",14:"A Solid Wall blocks your way.",17:"You cannot travel through Water.",15:"You activated a Speed Creature spell.",16:"You activated a Teleport trap!",18:"A Power Ring--your whip is now a little stronger!",20:"A tree blocks your way.",19:"You cannot travel through forest terrain.",21:"You activated a Magic Bomb!",22:"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)",23:"* SPLAT!! *",24:"The Sacred Tome of Kroz is finally yours--50,000 points!",25:"You passed through a secret Tunnel!",26:"You have activated a Freeze Creature spell!",27:"You found a Gold Nugget...500 points!",28:"Oh no, you set off an Earthquake trap!",29:"An Invisible Crumbled Wall blocks your way.",31:"An Invisible Door blocks your way.",34:"A Creature Zap Spell!",35:"A Creature Creation Trap!",36:"You have discovered a Creature Generator!",38:"A Moving Wall blocks your way.",41:"Yah Hoo! You discovered a Reveal Gems Scroll!",42:"You found an Ancient Tablet of Wisdom...2,500 points!",44:"You triggered Exploding Walls!",45:"You found a Pouch containing Gems!",46:"Statues are very dangerous...they drain your Gems!",47:"Yikes!  A trap has made many of the wall sections invisible!",51:"Super Kroz Bonus -- 10,000 points!",52:"A Solid Wall blocks your way.",58:"Magic has been released is this chamber!",59:"Magic has been released is this chamber!",60:"Magic has been released is this chamber!",61:"New Walls have magically appeared!",62:"New Walls have magically appeared!",63:"New Walls have magically appeared!",65:"You pushed a big Boulder!",66:"You hit a Electrified Wall!  You lose one Gem.",75:"You grabbed a Rope.",81:"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"},Nt=[3,2,1],Ti=[5,9,11],go=[8,10,15,26],He=[33,37,39,67,224,225,226,227,228,229,230,231],Wi=[16,...He],mo=[29,30,31],Fi=[48,49,50,51],wo=[52,53,54],Xt=[55,56,57],Mo=[58,59,60],Kt=[61,62,63],qe=[68,69,70,71,72,73,74],yo=[76,77,78,79,80],Ri=[...Nt,4,...mo,43,64,38,...qe,13,...Wi,19,28,32,35,36,45,...Fi],bo=[0,...Nt,...Ti,...go,7,...Wi,32],vo=[0,32,...He,41,44,47,...Xt,...Kt,...qe],_o=[0,32,...He,41,47,...qe],Yo=[0,32,41,44,47,...Xt,...Kt,...qe,...He],So=[...Ti,7,8,10,12,16,18,21,26,27,34,35,42,45,...Fi,...Mo,...yo,82,83],$o=[6,23],Oo=[0,32,...He,...Xt],ko=[4,6,13,14,22,25,31,36,38,42,43,46,...wo,64,65,66,81],xo=[0,17,23,28,29,30,32,33,37,39,67,41,44,47,...Xt,...Kt,...qe,75],gi={7:1/20,8:1/35,12:1/25,15:1/10,18:1/15,21:1/40,28:1/15,47:1/20},To=structuredClone(fe),Wo=structuredClone(T);function Fo(){Object.assign(fe,To),Object.assign(T,Wo)}const Co=`
          ¯         ñò=óW:C*+TKQ]&ü%SFZIARE/.♣      ®  #1#1#1#1#
 #######                                               # # # # #
  3 3  # #chest C C    ®              ¯    # # wall### # # # # #
   3   # ##nugg * *    ®   ñ444999ö   ¯    R R river## # # # # #
¯ 3 3  # ###gem + +    ®   ò555888õ   ¯    / / forest# # # # # #
 ####### showge & &    ®   ó666777ô   ¯    ♣ ♣ tree### #X#X#X#X#
         ##tele T T    ®   ::::####   ¯    V V lava### #2#2#2#2#
         ###key K K    ®              ¯    = = pit#### # # # # #
         #power Q Q    ®              ¯    X X block## # # # # #
 ####### ##whip W W    ®              ¯    ~ ~ ewall## # # # # #
  2 2  # create ] ]    ®      P       -                # # # # #
   2   #                                               #X#X#X#X#
¯ 2 2  #                  XXXXXXXXXXX     0 0 0        #3#3#3#3#
 ####### messag ü ü    ®  XXXXXXXXXXX ¯  0 0 0  rock## # # # # #
         ###zap % %    ®  XXXXXXXXXXX ¯  R~LB=V        # # # # #
         ##slow S S    ®  XXXXXXXXXXX ¯   <[|"  kroz## # # # # #
         #speed F F    ®  XXXXXXXXXXX ¯    D D  door## # # # # #
 ####### #freez Z Z    ®       B      ¯    U U  tunnel #X#X#X#X#
  1 1  # ###inv I I    ®  ###bomb####                  #########
   1   # tablet ! !    ®  #X]1 2 3AX# ¯    . .  traps#
¯ 1 1  # #amule ƒ ƒ    ®  XXXXXXXXXXX ¯    & &  show##  S
 ####### ##tome A A    ®  XDZ/EWLCSVX ¯    E E  quake#    F
                       ®  XXXXXXXXXXX ¯    T T              Z
`,Io={id:"Debug",map:Co,tabletMessage:"This is a debug level"},Do=`
//♣///////♣///♣////////♣////////♣//#the#lost#adventures#of#kroz#
//♣//////////////♣//♣////////♣////////♣///♣/♣♣/♣♣/♣/♣♣/♣♣♣♣♣♣♣/♣
♣###your#hut###////♣///♣/////////♣/////♣/♣♣//♣♣/♣♣/♣♣♣♣♣♣♣♣♣♣♣♣♣
/##           D---/////////♣//♣///♣//♣/♣/♣/♣/♣/♣/♣/♣♣♣♣♣♣♣###♣♣♣
/##  P ####  ##///-♣//♣//♣/----♣///♣////♣//♣//RRR/♣♣♣♣♣♣♣##L##♣♣
/##      K#**##/♣♣/-//--/♣-♣//♣--♣//♣//♣////RRRRR//♣♣♣♣♣♣♣#0#♣♣♣
♣##############/////--♣/--//♣////-///////♣////RRRRRRR/♣♣♣♣#!#♣♣♣
////♣♣///♣/♣♣///♣//♣//////////♣//♣---♣//♣////RRRRRR/♣♣/♣♣♣♣-♣♣♣♣
/♣//////♣/////♣////////♣///♣/////////--/////♣///RRRRR♣♣♣♣♣♣♣-♣♣♣
///////♣////////♣///////////////♣/////♣---/////RRRRR/♣/♣♣♣♣♣♣-♣♣
////♣/////♣♣♣//♣////♣/////♣//////♣////////-//♣/♣/RRRRRR♣/♣♣♣-♣♣♣
/////////♣♣♣♣♣///♣////♣////////♣///♣///////-//♣///RRRR♣//♣/-♣/♣/
♣//////♣//♣♣////♣////////♣//♣//////////♣///-♣////RRRRRR♣♣/♣-/♣/♣
//♣♣//////♣/###storage###///////♣--//♣♣///-////RRRRRRRRR/♣/♣-/♣/
////////♣///##WWW-WWW-W##/♣////--//-//♣♣/-///♣RRRRRRRRR/♣/♣/-/♣/
/♣////////♣/##W-WWW-WW---------//♣//-----//♣///RRRRRRRR♣♣//♣-♣//
♣/////♣/////#############♣///♣-/♣♣♣/♣/♣♣/♣////RRRRRRRR//♣/♣/-//♣
///♣////♣//////♣♣////♣////♣///-////♣/♣♣/♣///♣RRRRRRR/♣/♣//♣-/♣//
/♣///♣/////♣////♣///♣//♣//♣////------♣///♣////♣////♣//--/♣-♣♣//♣
♣//♣///♣/♣//♣/♣/♣///♣//♣/♣///♣////♣//------♣/♣//♣///♣-♣/--//♣/♣/
/♣///♣////♣//♣///♣////♣///♣//♣/♣////♣///♣/♣-----/♣♣/-/♣//♣/♣//♣/
♣//♣////♣/♣///♣//♣///♣/♣///♣//♣/////♣///♣/////♣/----♣♣//♣///♣//♣
#by#scott#miller#♣///♣/////♣/♣////♣////♣////♣//♣//♣/♣//♣/♣♣///♣ü
`,Lo={id:"Lost1",map:Do,tabletMessage:"Once again you uncover the hidden tunnel leading to Kroz!"},Eo=`
XXXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXXXX### P ###X
XXXXX##XXXXXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXXXXXXXXXXXXXX##  ##XX
XXXXXXXXXXXXXXX&-XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXX#XXXXX#  #XX
#XXXXXXXXXXXXXXXX-XXXX--XXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXX  XXXX
XXXXXXXXX#XXXXXXXX-XX-XX-XXXXXXX#XXXXXXXXXXXXXXXXXXXXX##   #XXXX
XXX#XXXXXXXXXXX#XXX--XX#X--XXXXXXXXX#XXXXX#XXXX##XXXX##  ##XXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXX##XX##XXXXXX
XXXXXXXXXXX##XXXXXXXXXXXXX#XX-XXXXXXXXXXXXXXXXXXXXX##  ##XXXX##X
XXXXX#XXXXXXXXXXXX#XXXXXXXXXXX--XXXX##XXXXXX#XXXXX##  ##XXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXX-#XXXXXXXXXXXXX      XXXX#XXXXXX
XXXXX##XXXXXX#XXXXXXX#XXXXXXXXXX#X##XXXXX       XXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXX##XXX#   0    XXXXXXXX!XXXXXXXXXXXXX
XXXXXXXXXXXXXX#XXXXXXX===XXXXXXX#  XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXX#XXXXXXXXXXXX=======XXXXX  XXXXXXXX#XXXXX#XXXXXXXXXX##XXX
XXXXXXXXXXXXXXXXX=========       XX=====XXXXXXXXXXXXX#XXXXXXXXXX
XX#XXXXXXX##XXX==========  ===========XXXXXXXXXXXXXXXXX#XXXXXXXX
XXXXXXXXXXXXXX==========  ===========XXXXXXXXX##XXXXXXXXXXXXXXXX
XXXX#XXXXXXX             ===========XX#XXXXXXXXXXXXXXXXXXXXX#XXX
XXXXXXXX    XX#XXXX================XXXXXXXX#XXXXXX#XXXXXXXXXXXXX
XXX     XX#XXXXXXXXXX===========XXXXXXXXXXXXXXXXXXXX##the#secret
XXXXXXXXXXXXXXXXXX#XXXXXX=====XXXXXXXXXX#XXXXXXXXXXX#tunnel#into
X  XX#XXXXXX##XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXX#the#kingdom
LLXXXXXX#XXXXXXXXXXXXX#XXXXXXXXXXXXXX#4XXXXXX##XXXXX#####of#kroz
`;async function Po(){r.map.hideType(a.Gem),r.map.hideType(a.Stairs)}const Bo={id:"Lost2",map:Eo,onLevelStart:Po,tabletMessage:"Warning to all Adventurers:  No one returns from Kroz!"},Ao=`
                                   1                        1  &
 ####shop####         1                                       ‘ 
 ##++++++++##                            1                      
 ##++++++++##                                 ##4444444444444444
 #####OO#####                                 ##   1   1   1  1 
                          ###spells###        ## 1 1  1  1   1  
     1                    ##ñEF‘Tò @##     1  ##    1   1  1  1 
                          ##I@ ‘S  T##        ##11   1 1    1   
                     1    ##ZóT‘  ] ##        ##   1   1 1  1 1 
                          #########X##        ## 1   1  1  1 1  
@@         1                                  ##1 1    1  1    1
1@W                            P              ## 1  1 1 1  1 1 1
1@W                                           ##1  11  1 1   1  
1@W   1                                     1 ##  1   1     1   
1@W                 1                         ##1    1  1  1  1 
1@W                                     #.#OXX## 1 1  1   1    1
1@W          ###lair#of#kroz###         #.#XOX##1    1  1   1 1 
1@W          77------------ôK##         #.#XXO##  1 1  1   1   1
1@W          ####1111111111####         #.#XOX## 1 1  1 1 1   1 
1@W    1      Z##############           #H#X!X##1  1 1  1  1 1  
1@W                                     ######## 1   1 1  1   1 
1@@@@@@@@@@@@@@@                  ########@       1   1   1 1  1
111111111111111@                1 ##LLWWWD@         1   1    1 1
`;async function Vo(){r.map.hideType(a.Gem)}const zo={id:"Lost4",map:Ao,onLevelStart:Vo,tabletMessage:"Adventurer, try the top right corner if you desire."},Uo=`
66666666666666666666----------------------------66WW---I-------K
-----------D D D-----66666666666666666666666666(6666666666666---
-666666666666666666-((((((((((((((((22222222222(-----------666-6
-666666666666666666-66((((((((((((((22222222222(6-66666666-----6
-66666666666066WYY6-66VVVVVVVVVVVVVVVVVVVVVVVVV66-66666666666666
------------0B6WYY--66T-W-W-*-W-W-C-W-W-*-W-W-T66-66666666663666
-66666666666066WYY6666666666666666666666666666666’66666666636666
-MMMMM6666666666666666666666666666666666666666666-66666666366666
-MMMMM............................3!66222222266----$$$$$$$666666
-MMMMM6666666666666666666666666666666622222266~~~~~~~~~~~~-66666
-MMMMM666666666666666666666666666666662222266------------~~-6666
-MMMMM............................3H66222266-~~~~~~~~~~~~-~~-666
-MMMMM6666666666666666666666666666666622266-~~----------~~-~~-66
-66666666666666666666666666666666666@@@@66-~~-~~~~~~~~~~-~~-~~-6
----666-OWOWOWOWOWOWOWOWOWO 66666666@66@666-~~-~~K’-----~~-~~-66
-66-666-6666666666666666666 66666666@66-6666-~~-~~~~~~~~~-~~-666
-66F666-666T-3)K)3-T66           666@66-66666-~~---------~~-666C
-66F666-666T-3)))3-T66     G     666-66-666666-~~~~~~~~~~~-6666-
-66666---666666-666666           666-66-6633666-----------666333
-66YYYYYYYYY666-66666666666-66666666-66-66--6666666666666-666-66
--     P    666-66+------66-66-------66----Y--D-D-D-LL 66-666-66
666---------666-66666666-66-66Y66666-66666666666666666666-666-66
666222222222666-------------66---Z66--------------------------66`,No={id:"Lost11",map:Uo,tabletMessage:"The tunnel below contains a magic spell."},Ko=`
K----------------------------YYY!YYY---------------------------K
-66666666666666666666666666666666666666666666666666666666666666-
-66ñ                           —+          DTDTDTDTLL 66   -"66-
-66                                        6666666666666   --66-
-6666666666666666666666666666666666                          66-
-66<-     )                   66 ..                          66-
-66--     #############       66 66      ##$$$$$$$$$$$##     66-
-66      ##11111111111##      66 66      ###MMMMMMMMM###     66-
-66     ##1111111111111(      66 66      ####MMMMMMM####     66-
-66     ##1111111111111(      66(66      ##W##MMMMM##W##     66-
-66      ##11111111111(       66 66      ##WW##MMM##WW##     66-
-44)))))))############(       66P66      ##WWW##&##WWW##     55-
-66      )11111111111##       66 66      ##....###....##     66-
-66     )1111111111111##      66 66      ##     #     ##     66-
-66     )1111111111111##      66 66      ##     —     ##     66-
-66     ##11111111111##       66 66      ##           ##     66-
-66      #############        66 66      ##]]]]]]]]]]]##   --66-
-66                           .. 66                        -[66-
-66                           666666666666666666666666666666666-
-66--   6666666666666         +—                             66-
-66|-   66 LLWDWDWDWD                                       ò66-
-66666666666666666666666666666666666666666666666666666666666666-
K----------------------------3333333---------------------------K`;async function Go(){r.map.hideType(a.Create),r.map.hideType(a.MBlock)}const Ho={id:"Lost18",map:Ko,onLevelStart:Go,tabletMessage:'Adventurer, check the "Valley of the M"!'},qo=`
<33333333333333333333333333333333333333333333333333333333333333[
3                                                              3
3                                                              3
3                                                              3
3           YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY           3
3           YC     F        F   Z         W    F òKY           3
3           Y          W           F     F       òòY           3
3           Y    F            òòòòò          F   F Y           3
3           YW         F      ò   ò  F             Y           3
3           Y                 ò P ò             W  Y           3
3           Y    W F      F   òF  ò   F    F       Y           3
3           Y                 òòòòò   W        F   Y           3
3           Y F              F                     Y           3
3           Yòò       F   W       F       F      F Y           3
3           YKò F               Z           W     CY           3
3           YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY           3
3                                                              3
3                                                              3
3                                                              3
"33333333333333333333333333333333333333333333333333333333333333|
5##############################444#############################5
--~~-~--~-~--~~-~~--~--~-D-D-++-L-WW-D-D-~--~--~-~~-~--~~-~~-~--
-~--~-~~-~-~~--~--~~-~~--D-D-++ñLñWW-D-D--~~-~~-~--~-~~--~--~-~-`;async function Zo(){r.map.hideType(a.OWall1),r.map.hideType(a.OWall2),r.map.hideType(a.OWall3)}const jo={id:"Lost20",map:qo,onLevelStart:Zo},Qo=`
::::::::::::::::::::::::::::::::::::::::::::::::####amulet####::
:###########::::::::::::::::::::::::::::::::::::#55]-----]---#::
:#         #::::::::::::::::::::::::::::::::::::#ƒ5----]--L-ò#::
:#    P   HOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO::::::#55-]------]-#::
:#K        #::::::O::::::::::::-:::::::::O::::::###D##########::
:###########::::::O::::::::::::-:::::::::O:::::::::O::::::::::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::-----:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::::::-:::::
:::::::::::OOOOOOOO::::::::::::-::::#####D###::::::O::::::-:::::
:::::::::::O:::::::::::::::::::-::::#K;     #::::::OOOOO::-:::::
:::::::::::O:::::::::::::::::::-::::#;;     #::::::::::O::-:::::
:::::######D#############::::::-::::# W     #::::::::::O::-:::::
:::::#!---...----T---I--#::::::-::::#       #::::::::::O::-:::::
:::::#----K----F---’---ñ#::::::-::::#     * #::::::::::O::-:::::
:::::#-S---I----------Z-#::::::-::::#       #::::::::::O::-:::::
:::::####################::::::-::::#   W   #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#       #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#4444444#::::::::::O::-:::::
::::::::::::::::::::::::+++::::-::::#K;-----DOOOOOOOOOOOOOOOOO::
###rogue###:::::::::::::+++-----::::#########:::::::::::::::::::
#was#hereÃ#:::::::::::::::::::::::::::::::::::::::::::::::::::::
`;async function Jo(){r.map.hideType(a.Create),r.map.hideType(a.Gem)}async function ea(){await g(`No one has ever made it to the ${f.levelIndex} level!`),await g("You have shown exceptional skills to reach this far..."),await g("Therefore I grant you the power to see...");for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)r.map.getType(e,t)===a.IWall&&(await R(e*t,1,10),r.map.setType(e,t,a.OWall3),x(e,t));await g("Behold...your path awaits...")}const ta={id:"Lost26",map:Qo,onLevelStart:Jo,tabletMessage:ea},ia="Lost30",na=`
1111144       ##C######locksmith#shoppe######C##         RRRRRRR
1111144       ##]##K#K#K#K#K#-3-3#K#K#K#K#K##]##        RRRRRRRñ
1111144          ##:::::::::######::::::::;##         RRRRRRRCYY
1111144          ##------------------------##     666RRRRRRRR66 
1111144          #############--#############     6666666666666 
1111144                                           HOOOOOOOOH    
1111144                                        6666666666666    
1111144                                        66RRRRRRR6666    
1111144                                        RRRRRRR          
1111144                                      RRRRRR           YY
1111144               P                    RRRRRR             YZ
1111144                                 RRRRRRRRRR            YY
1111144                              RRRRR333RRRRR              
1111144                             RRR3333333RRRRR             
@@@@@##                           RRR3333333333RRRRR            
MMMMM##                           RRR333333333RRRRR             
)))))##                          RRR33333333RRRRR               
MMMMM##                        RRRR333333RRRRRRR        DDDDDDDD
(((((##                       RRRR3LL3RRRRRRRR          DDDDDDDD
MMMMM##                      RRRRRRRRRRRRRR             DDDDDDDD
$$$$$##                     RRRRRRRRRRRR                DDDD7777
MMMMM##                     RRRRRRRR                    DDDD77ôô
]]K]]##“                   RRRRRRK]                     DDDD77ô!
`;async function oa(){r.map.hideType(a.Create)}async function aa(){await dt(),await g('"If goodness is in my heart, that which flows shall..."');for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)r.map.getType(e,t)===a.River&&(await R(e*t,50,10),r.map.setType(e,t,a.Nugget),x(e,t));await g('"...Turn to Gold!"')}const sa={id:ia,map:na,onLevelStart:oa,tabletMessage:aa};class me{constructor(t,i={}){re(this,"replacement",a.Floor);re(this,"ch",v);re(this,"fg",T[a.Floor][0]);re(this,"bg",T[a.Floor][1]);re(this,"x",0);re(this,"y",0);this.type=t;const{x:n,y:o}=i;let{ch:s,fg:c,bg:X}=i;c===null&&(c=T[a.Floor][0]),X===null&&(X=T[a.Floor][1]),typeof t=="string"?(s??(s=t.toLocaleUpperCase()),c??(c=l.HighIntensityWhite),X??(X=l.Brown)):(s??(s=fe[t]),c??(c=T[t][0]??T[a.Floor][0]),X??(X=T[t][1]??T[a.Floor][1])),this.ch=s??v,this.fg=c,this.bg=X,this.x=n??0,this.y=o??0}}const ra=`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~W-----------E----~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~------------E----~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~----~~~~~~~~~----~~~~~~~~~~W---E------------------P
~~~~~~~~~~~~~----~~~~~~~~~----~~~~~~~~~~----E-------------------
~~~~~~~~~~~~~----~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~----~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~W------------~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~-------------~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~W---~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~--------------<~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~W-------------[~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~~---|~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~~---"~~~~~~~~~
~~~~---W~~~~~~~~~~~~~~~~~~----~~~~~~~~~~~~~~~~~~~~~----~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~-----------------------------~~~~~~~~~
~~~~----~~~~~~~~~~~~~~~~~~W-------------------------W--~~~~~~~~~
~~~~LLLL~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
`;async function la(){for(let e=0;e<=W;e++)for(let t=0;t<=I;t++){const i=r.map.get(e,t);i&&r.map.set(e,t,new me(i.type,{x:e,y:t,ch:i.ch,fg:null,bg:null}))}}const ca={id:"Lost34",map:ra,onLevelStart:la},Xa=`
###########klose#enkounters#of#the#krazy#kubikal#kindÃ##########
3                               P                              3
##-##############:########:#######:###########:##############:##
XXXXXXXXX##~W~W~W~W~##‘-M----M.--$$$$$$$$$-9/-/♣--♣-|##---’ò’---
---------##*~*~*~*~*##-‘.-”M-”-##$$$$$$$$$##♣--/-♣-/♣##YYYYYYYYY
MMMMMMMMM##~W~W~W~W~##M--‘-.-M-##111111111##-/-♣/--/-##(((((((((
)))))))))##*~*~*~*~*##.”-.-”-.”##222222222##/♣--♣-♣-/##(((((((((
C))))))))--~W~W~W~W~##ó.-”--‘-M##333333333##ü-//-♣-/-9-(((((((((
###################-################################9##55555555-
“-“-“-“-“##YYYYYYYYY##222222222------0---W##RRRRRRRRR##MMMMMMMMM
-----------YYYYYYYYY##@@@@@@@@@##---000---##RXXXXXXXR##MMMMMMMMM
XXXXXXXXX##YYYYYYYYY##@@@@@@@@@##--00G00--##RXXXKXXXR##MMMMMMMMM
---------##YYYYYYYYY##@@XXX@@@@##---000---##RXXXXXXXR##MMMMMMMMM
’’’’’’’’’##YYYYYYYYK##@@XZX@@@@##----0---W##RRRRRRRRR##MMMMMMMMK
-#####################-##########ô##################H##Z########
~-~[~-~-~##WWW......à1:1:1:1:1:##-773C7--7##=--=I==-=##ááááááY0"
-~-~-~-~-##WWW......##1:1:1:1:1##7-777-77-##!==-=--==##ááááááY00
~-~-~-~-~##.........##:1:1:1:1:##-77--77-7##=======-=##ááááááYYY
-~-~-~-~-##.........##1:1:1:1:1##7-7-77-77##-==-=-==I##ááááááááá
K-~-~-~-~-à..<......##:1:1:1:1ñ##77-7777---I=--=-=--=##222222222
############################################################44##
LL---V--V-VV-V--VV---D-----D--’--D--”--D--66333333333333333-WWWW
LL--V-VV-V--V-VV--V--D-----D--”--D--’--D--66YYYYYYYYYYYYYYYYYYYY
`;async function ha(){await dt(),await g('"Barriers of water, like barriers in life, can always be..."');for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)r.map.getType(e,t)===a.River&&(await R(e*t,50,10),r.map.setType(e,t,a.Block),x(e,t));await g('"...Overcome!"')}const ua={id:"Lost42",map:Xa,tabletMessage:ha},fa=`
----------àHT66-;K-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX)-- 66111ñ111--
-66666666666666-66))))))))))))))))))))))))))))))))66 6611111116-
----------66----662222222222222222222222222222222266 6611111116‘
66ààààà66-66-66-66((((((((((((((((((((((((((((((((66 66666-6666-
661111166-66”66--(22222222222222222222222222222222--       YY®6<
666666666-66-666666666666666666666666666666666666666 66666-66666
----•--------66666>;S---622222222222222222222222662YWY2666-66666
I6666666666666666666666-6@@@@@@@@@@@@@@@@@@@@@@@662YPY266W6666//
O:OO:::O:OO:66’-–-’66K@@@@                      662YWY26W666///♣
:O::O:O:O::O66-LLL-666666@@@@@@@@@@@@@@@@@@@@   6666 666666//♣"♣
:::::O::::O:66DDDDD6666662222222222222222222@        66666//♣♣♣♣
:OOO::::O::O66DDDDD6666666666666666666666666666666666666///♣♣♣♣♣
O:::O:OO:O:O664444466666666666666666666666666666---6666///♣♣♣U♣♣
:O[66O66::O:6666666-1-1-1-1-1-1-1-1-1-1-1-1-1-1--U-666///♣♣♣♣♣♣♣
RRRR6-6RRRRRRR6666666666666666666666666666666666---66////♣♣♣♣♣♣♣
RRRR6-6RRRRRRRRRRRRRRRRRRRRRRRRRQX.X.X.X.X.X.X.X6666////♣♣♣♣♣♣♣♣
?]]66-66]]RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR66-66♣
-------------------$$$$$$$$•RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR6-6RR
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$•RRRRR6-6RR
WWWWWWWWWW$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$66-66+
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM|MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
`,da={id:"Lost70",map:fa},pa=`
###<@@@@@@@@@@@@@@@@@@@@@@@@@#one#@@@@@@@@@@@@@@@@@@@@@@@@@FK###
Kö###@@@@@@@@@@@@@@@@@@@@@@@@@;!:@@@@@@@@@@@@@@@@@@@@@@@@@@###$[
öö((###@@@@@@@@@@@@@@@@@@@@@@@:::@@@@@@@@@@@@@@@@@@@@@@@@###$$$$
((((((###@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$$$$$$
(((((((2###222222222222222222222222222222222222222222###2$$$$$$$
(((((((2((###@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$$2$$$$$$$
(((((((2((((###@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$$$$2$$$$$$$
(((((((2((((((###@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$$$$$$2$$$$$$$
DD##(((2((((((((###@@@@@@@@@@@@@@@@@@@@@@@@@@###$$$$$$$$2$$$####
DD#f(((2(((((((((##############77##############$$$$$$$$$2$$$##CC
DD#o(((2((((((((ö##2------------------------2##ô$$$$$$$$2$$$t#àà
DD#u(((2((((((((ö----------F---P----S--------88ô$$$$$$$$2$$$w#MM
&&#r(((2((((((((ö##2------------------------2##ô$$$$$$$$2$$$o#MM
LL##(((2(((((((((##############99##############$$$$$$$$$2$$$##MM
####(((2((((((((###)))))))))))õõõõ)))))))))))###$$$$$$$$2$$$##àà
(((((((2((((((###))))))))))))))))))))))))))))))###$$$$$$2$$$$$$$
(((((((2((((###))))))))))))))))))))))))))))))))))###$$$$2$$$$$$$
(((((((2((###))))))))))))))))))))))))))))))))))))))###$$2$$$$$$$
(((((((2###))))))))))))))))))))))))))))))))))))))))))###2$$$$$$$
((((((###2222222222222222222222222222222222222222222222###$$$$$$
((((###))))))))))))))))))))))))))))))))))))))))))))))))))###$$ôô
"(###))))))))))))))))))))))))))))))))))))))))))))))))))))))###ôK
###Kõ)))))))))))))))))))))))#three#))))))))))))))))))))))))F|###
`,Ra={id:"Lost46",map:pa,tabletMessage:"Follow the sequence if you wish to be successful."},ga=`
##################RRRRRRRRRRR#the#swamp#RRRRRRR-♣♣ü♣♣♣♣/♣♣♣♣♣♣♣C
LL–D‘D“D--VVVV--44----------------------------RR-♣♣♣♣♣♣♣♣♣♣♣♣♣♣♣
LL‘D”D‘D--VVVV--44--RRRRRRRRRRRRRRRRRRRRRRRR--RRR-/♣♣♣♣♣♣♣♣♣U♣♣♣
##################RRRR-------------------------RRR-♣♣♣♣/♣♣♣♣♣♣♣♣
RRRRRRRRRRRRRRRRRRRRRR--RRRRRRRRRRRRRRRRRRRRK))RRRR--♣♣♣♣♣♣♣♣♣♣♣
R-----RRR-------R----)))RR)))))))3)3)3)3)3)3)3)3)3RRR--♣♣♣♣♣♣♣♣♣
R-RRR“RR-RRRRRRR-RRR-RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR--/♣♣♣/♣ü
R-RR-RR-RRR♣♣♣RRR-RRR--------------------------•-------RR--♣♣♣♣♣
R-RRRR-RR♣♣♣K♣♣RRR-RR-RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR--♣♣♣
R-RRR-RRRR♣♣♣♣♣♣RRR-RR------------Z-8’-999999999999ö--RRRRRRR--♣
R-RR-RRRR♣♣♣♣♣♣ü♣RR-RRR-RRRRRRRRRRRRR8-111111111111RRR-----RRRR-
R---RRRRRR-♣♣♣RRRR-RRRRRFRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR-RRRR
RRRR-RRRRR-RRRRRR-RRRS(((((+((((((((((((((((((K++(3RRRRRRRRR-RRR
RRRRR-RRRRããRRRR-RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR*R.R*RRR-RR
RRRRRRTRRR1R-RR-RRR@@@@@@@RRRRRRRRRRRRRRRRRR-----------’-óRRRñRR
###RRRRRR11RR--RRRR@@RRRRFRR-66----H----------RRRRRRR*R.R*RRRRRR
77###RRR111RR--RR*F@@@22@WRR-RR-RRORRRRRRRRRRRRRRRRRRRRRRRRRRR  
7777###RR11RR--RR*F@@@22@WRR-RR-RRORR                          P
77777###RR1RR--RR*F@@@22@WRR-RR-RRORR  RRRRRRRRR-RRRRRRRRRRRRR  
77!777###RRRR--RR*F@@@22@WRR-RR-RR>RRFSRRRRRRRRRàRRRRRRRRRRRRRRR
7777777##RRRR--RR*F@@@22@WRR-RR-RRRRRàààààààààà3333333333Càààààà
77777777##RRR--RRRRFFRRRRRRR-RR-RRRRRRRRRRRRRRRRRRRRRRRRRRRRRR--
U7777777##RRR----------------RR---------------------------------
`,ma={id:"Lost48",map:ga},wa=`
‘  ]  ‘]‘   ]‘‘] ”]]–  ‘‘‘]‘‘” ] – ‘    ‘]‘‘         –]‘”‘] ‘---
 ‘– ‘] ‘ ”‘] ‘– ‘ ]‘ ‘‘ ]”‘–] ‘ ‘ ‘ ]‘‘” ]– ‘‘]‘‘–]‘” ‘]‘‘ ‘ -P-
  –‘‘]‘ ”‘] –‘ ‘] ‘ ‘‘]”ñ –‘] ‘‘‘]‘–”]‘‘ ‘ ]‘‘    –] ‘”‘] ‘‘‘---
–‘ ‘]”‘‘]‘ ‘–]‘ ‘” ]‘‘‘]–‘ ‘]‘   ”‘]‘‘–  ] ‘‘ ‘]”‘  ‘]‘–‘] ‘‘”]‘
‘]–  ‘‘]‘‘” ]‘ –‘]‘‘  ‘]‘” ‘]–‘‘] ‘‘‘] ”‘– ]‘‘   ‘]‘‘”]‘–‘]  ‘‘‘
‘‘–]” ‘‘]‘‘‘ ]‘ –”  ]‘  ‘‘] ‘‘‘] –‘”  ]‘‘‘ ]‘‘–]” ‘‘]   ‘‘‘]‘ –‘
”‘‘] ‘‘‘  ]–‘  ”] ‘‘‘]‘‘ –]‘ ‘‘ ]”‘ ‘]‘‘–]‘ ‘”]‘‘ ‘] ‘–‘ ]‘‘”] ‘
‘]‘ –‘  ]‘ ‘”]‘‘ ‘]–  ‘‘] ‘”‘  ]‘‘ ‘–]‘‘”]‘‘  ‘]‘‘  –]  ‘”‘]‘‘‘ 
–‘ ]‘ ”‘]‘‘     ‘]‘ –‘ ]”‘ ‘]‘‘–] ‘‘     ‘]”‘‘ ]‘‘–]‘ ‘”]‘  ‘‘ ]
‘ –] ‘‘‘ ]”‘‘]‘–‘] ‘‘”] ‘‘‘ ]–‘‘ ]‘ ‘”]‘‘ ‘–]‘‘ ‘‘]” ‘‘]‘ –‘ ]‘ 
 ‘” ]‘‘ ‘ – ] ‘ ‘‘] ‘”‘] ‘–‘ó]‘‘ ‘]‘ ”‘]–‘ ‘]‘‘ò‘]” ‘–]‘‘ ‘] ‘ ‘
]  ”–‘ ]‘‘ ‘ ] ‘   ‘–]”‘‘   ]‘‘‘]   ‘–”]‘‘‘    ]‘‘‘]     ‘–”] ‘‘
#####444############follow#the#bread#crumbs#####################
àààà#555#&àààààààààààààààààààààààààààààààààààààààà@MMMMMMMMK##LL
àààà66666ààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##“‘
àààààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##\`\`
àààààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##‘“
ààààààààààààààààààààààààà!àààààààààààààààààààààààà@MMMMMMMMM##\`\`
àààààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##“‘
àààààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##--
àààààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##--
00àààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM##--
K0àààààààààààààààààààààààààààààààààààààààààààààààà@MMMMMMMMM66--
`;async function Ma(){r.map.updateEntities(a.Floor,{ch:".",fg:l.White,bg:l.Black}),r.map.hideType(a.Create),r.map.hideType(a.MBlock)}const ya={id:"Lost52",map:wa,onLevelStart:Ma,tabletMessage:"Up 4 steps, then left 16 steps."},ba=`
##########K]K-WWWWñD          00%00         D’D”D‘&&LL##########
##VVVVVV############          00000    .    ############VVVVVV##
##VVVVVV44                                            44VVVVVV##
##VVVVVV44      .      .                        .     44VVVVVV##
#####44444                               )            44444#####
MMMM(                           P  .                       )MMMM
MMMM(                   (                                  )MMMM
MMMM(         .                                   (        )MMMM
MMMM(                                 .                    )MMMM
MMMM(                      44444444444                 .   )MMMM
MMMM(                      44VVVVVVV44                     )MMMM
CMMM(   .                  44VVVGVVV44       .             )MMMC
MMMM(          )       .   44VVVVVVV44                     )MMMM
MMMM(                      44444444444                     )MMMM
MMMM(                                           )          )MMMM
MMMM(                                   .                  )MMMM
MMMM(     .       .                                .       )MMMM
MMMM(                                                      )MMMM
#####44444                     .            .         44444#####
##VVVVVV44         (                     (            44VVVVVV##
##VVVVVV44                 )                          44VVVVVV##
##VVVVVV############          00000  .      ############VVVVVV##
##########K]-WWWWWWñ          00C00         D-D--K-K]K##########
`;async function va(){r.map.hideType(a.Create),r.map.hideType(a.MBlock),r.map.hideType(a.OWall1),r.map.hideType(a.OWall2),r.map.hideType(a.OWall3),r.map.hideType(a.Trap)}const _a={id:"Lost59",map:ba,onLevelStart:va},Ya=`
     U--2--U--2--U--2--U--2--U--55-====-===--=====-===--==--=--=
 #######-#####-#####-#####-#######=-==-=-=-==--==-=-=-==--==-==-
 ######-B-###-B-###-B-###-B-######==--===-=====--===W==========-
 ########chamber#of#horror########======================-------=
 ##22222222222222222222222222##ó##=---=-=-=-==--==--=---========
 ##22222222222222222222222222222##-===-=-=-=--==-=-=-=====-----=
 ##22222222222222222222222########=-============-=-===----=====-
 ##2222222222222222222222266"0LL##-==-=-=-W-====-==---======---=
 ####-############################=--=-=-===-===-========---====
      ##---##ãOOOOOOOOO33333333!##=========-====-====----===-===
########---##H####################==----====-====-”--========--ò
<F  22##111##ãã333333##3333333-[##=-====-==-============--======
FF  22##âââ##ãã333333##3333333--##-===-==-==------=====-==-=--==
    22##YYY##ãã333333##333333333##-==-=-==-=======-===-====-==-=
 P  22##ááá##ã#########444444444##=--==-==W======-===-========-=
    22##111##        ##         ##=====-===------===-==---=-===-
    22##ààà######### ##   ##‘   ##=--==-============-=-===-=---=
    22##             ##   ‘##   ##-==W==-=====---===-==--=======
    22##   ~~~~~  ## ##   ##–   ##=-==-==-===-===--==-===W=----=
    22##   ~~%~~  ## ##   •##   ##==-==-==---==-===--==-==-====-
    22##   ~~0~~  ## ##   ##‘   ##===-=-======-=--====-=-=====-=
    22##ô  ~~0~~  ## ##   ‘##   ##=-=-==-=-==-==-=--==-=-==-===-
      77ô  ~~     ##      ##“   44-=-====-=--==|====--===--=---=
`;function Sa(){r.map.updateEntities(a.Fast,{ch:"☺"})}async function $a(){await g("Walls that block your progress shall be removed..."),r.map.setType(r.player.x,r.player.y,a.OSpell1),Pi(0,0)}const Oa={id:"Lost61",map:Ya,onLevelStart:Sa,tabletMessage:$a},ka=`
3333333333333333333333333333333333333333333333333333##C33à)))Fàó
4444444444444444444444444444444444444444444444444444##333à))F)àà
LL@@@@;@@@@@@@F@@;@@@@@@@@F@@@;@@@@@@@@@F@@@@@@@@@@@##333à))))F)
LL@;@@@@F@@;@@@@@@@@F@@;@@@@F@@@@@F@@@;@@@@@F@@@;@F@##333à)F))))
#########################@@@;@@@F@@;@@F@@@@F@@@F@@@@##333à)))F))
  æ        ááá      YY>##&@@@@F@;@@@F@@@F@@;@F@”””””##333à)F))))
88~  ææ##-##3á      YYY#########################ññññ##333à))))F)
Mõ~  æ3## ##3á              D‘‘F‘‘D77777777777##6666#####àFFFFFF
Mõ~  æ3##S##3ááááááááááá P  #######77777777777##ããããâ33##Tàààààà
Mõ~  æ3##F##33333333333á   +##’K’##77777777777##ããããâââ####YYY##
Mõ~ææææ#######################(((##77777777777--ããããããããããâããããã
Mõ~    ä333333333WWWä  ää999##’’’###############################
Mõ~    ääääääääääääää  ##MMM##(((##33333333333333333333333333333
Mõ~                   ’##MOM##(((##33333333333333333333333333333
Mõ~           —     #####OMO##’’’##33333333333333333333333333333
Mõ~               ää##K##MOM##(((##(((((((((((((((((((((((((((((
Mõ~   —          ää3##ä##OMO##((((((((((((((((((((((((((((((((((
Mõ~             ää33##-##MOM##(YY++YY((YYYYY+((+YYYY+(YYYYYYY(((
XX~            ää333##-##OMO##(YY+YY+((YY++YY((YY++YY(++++YY+(((
XX~ çççççç —  ää3333##’##MOM##(YYYY++((YYYYY+((YY++YY(+++YY++(((
XX~ ç3333ç    ä3333C##-##OUO##(YYYY++((YY+YY+((YY++YY(++YY+++(((
XX~ ##################-#######(YY+YY+((YY++YY((YY++YY(+YY++++(((
X!~     ççççç          äää~H##(YY++YY((YY++YY((+YYYY+(YYYYYYY((U
`;function xa(){r.map.updateEntities(a.Fast,{ch:"☺"})}async function Ta(){await dt(),await g('"Tnarg yna rerutnevda ohw sevivrus siht raf..."');for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)r.map.getType(e,t)===a.CWall1&&(await R(e*t,50,10),r.map.setType(e,t,a.Nugget),x(e,t));await g('"...Dlog!"')}const Wa={id:"Lost64",map:ka,onLevelStart:xa,tabletMessage:Ta},Fa=`
ñö22222229       &#the#sacred#chamber#of#kroz#&2      82222222õò
öö22222999      F       $®$$$$$$$$$$$¯$ 2    .    F   88822222õõ
22222999     2• .   ”   $$$333333333$$$         •    2  88822222
222999   ”   ###        $$3=========3$$   ]    ###        888222
2999   .     #K#       $$3==úúúùúúú==3$$       #ó# .        8882
99   F  ]    #K#  2   $$3==úúùVVVùúú==3$$   2  #2#    ”    2  88
RRRRRRR      #0#      $3==úùïúVAVúïùú==3$      #2#       RRRRRRR
22222RR.     #0# .    $3==úùùúVVVúùùú==3$ .    #2#  2   .RR22222
22222RR  2   #0#      $$3==úúùú6úùúú==3$$      #2#       RR22222
22222RR      #D#   2   $$3==úúù&ùúú==3$$    ‘  #D#     2 RR22222
22222RR                 $$3==úú0úú==3$$                  RR22222
22222RR     2        ]   $3==úúGúú==3$    ”    .   2   . RR22222
22222RR  .     ”     .   $$3==úDú==3$$                ]  RR22222
22222RR    F              $$3=====3$$   2      2    ”    RR22222
RRRRRRR 2         2        $$33333$$       ]      F     2RRRRRRR
444444444444444’            $$$$$$$   .      .  H444444444444444
77777777777777###   ‘ .        P           2   ###YYYYYYYYYYYYYY
77777777777777#U#       2                      #U#YYXXXXXXXXXXXX
77777777777777#-#  2       .   T      2        #0#YYXXYYYYYYYYYY
77777777777777#<#   ]          ” 2       ”    2#0#YYXXYYOOOOOOOO
77777777777777#[#        2  5555555 N     .    #0#YYXXYYOOYYYYYY
77777777777777#|#          55DDDDD55 2      F  #0#YYXXYYOOYYXXXX
K777777777777C#"#E  2     555D]!]D555     2    40#CYXXYYOOYYXX]K
`;async function Ca(){r.magicEwalls=!0,r.evapoRate=22,r.map.hideType(a.Create)}async function Ia(){await dt(),await g('"Ttocs Rellim Setalutargnoc Uoy!"'),await g("Your palms sweat as the words echo through the chamber...");for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)r.map.getType(e,t)===a.Pit&&(await R(e*t,50,10),r.map.setType(e,t,a.Rock),x(e,t));await g("...Your eyes widen with anticipation!")}const Da={id:"Lost75",map:Fa,onLevelStart:Ca,tabletMessage:Ia},La=`
W W W W             2 2 2 2 2  C  2 2 2 2 2              W W W W
XXXXXXXXXXXXXXXXXXX###########   ###########XXXXXXXXXXXXXXXXXXXX
 1           1                               1                  
                                    1            XX         1   
       1            1                           XXXX            
#        XX                    +                 XX            #
##      XXXX  1                +          1          1        ##
T##      XX               2    +    2                        ##T
T1##                       W   +   W                        ##1T
T########X                 WX     XW             1    X########T
.        X                2WX  P  XW2                 X        .
T########X         1       WX     XW                  X########T
T1##                       W   +   W         1              ##1T
T##                       2    +    2                        ##T
##   1                         +                      XX      ##
#       XX      1              +                 1   XXXX     1#
       XXXX                 ##   ##                   XX        
1       XX                 ##     ##     1        1           1 
                    1#######       ########                     
    1         ########11111  +++++  111111########              
WW     ########+++++        #######         WWWWW########1    WW
########¯                    2 2 2                     C########
L2  +  X      #kingdom#of#kroz#ii#by#scott#miller#      X  +  2L`,Ea={id:"Kingdom1",map:La,tabletMessage:"Once again you uncover the hidden tunnel leading to Kroz!"},Pa=`
’                                                           .   
  2#############################K############################   
   ##‘  2    2   2 2    2   2  ###  2  2   2    2    2    2##   
  2##+#2   2   2    2  2 2   2  2 2  2   2 2   2   2    2  ##   
   ##+#   2  2    2   2   2   2    2    2  2    2    2   2 ##   
  2##+# 2    2  2   2  2 2 2 2  2 2  2 2 2   2    2   2   2##   
   ##+#2   2  2   2                            2   2   2   ## W 
  2##+#  2   2   2   XXXXXXXXXXXXXXXXXXXXXXX  2    2  2   2##@@@
   ##+#2   2  2   2  XXXXXXXXXXXXXXXXXXXXXXX    2   2  2   ##   
  2##+# 2   2  2 2   XXXXXXXXXXXXXXXXXXXXXXX   2  2   2  2 ##   
   ##+#   2 2 2   2  XXXXXX    -+-    XXXXXX  2 2    2  2  ##   
  2##+#2   2   2 2   XXXXXX1   -P-   1XXXXXX  2  2 2   2 2 ##   
   ##+#  2  2  2  2  XXXXXX    -+-    XXXXXX   2  2 2     2##   
  2##+# 2 2  2  2    XXXXXXXXXXXXXXXXXXXXXXX  2   2   2 2  ##   
   ##+#2 2    2   2  XXXXXXXXXXXXXXXXXXXXXXX    2  2   2 2 ##   
  2##+# 2  2  2  2   XXXXXXXXXXXXXXXXXXXXXXX   2    2 2 2  ##   
   ##+#  2  2 2   2                           2  2   2   2 ##   
  2##+#2   2    2   2 2  2  2  2 2  2 2  2  2   2   2  2  2##   
   ##+# 2    2  2  2 2  2   2   2   2  2  2    2    2   2  ##   
  2##3#   2   2   2   2   2   2   2   2 2    2    2   2   2##@@@
   ##T#2   2     2  2  2 2   2 ###   2   2 2  2    2   2   ##222
   #############################S#######################XXX##@@@
                                                          I##LLL`,Ba={id:"Kingdom2",map:Pa,tabletMessage:"Warning to all Adventurers:  No one returns from Kroz!"},Aa=`
-..............................3#1#2#3##------;------------;----
-##############################-##1#2#3#-######################-
-#.....----......- I#S###### ##K###1#2#3-#///////1///////////1//
-#.-..-....-....-.# # I####1# ######1#2#-#♣1♣♣♣♣♣♣♣♣♣♣♣♣♣1♣♣♣♣♣♣
-#-.-..-..-.....-.# # # ### ## ##1###1#2-#/////1////////////////
-#-.-.-..-..---..-# # ## # ##1## # ###1#-#CCC♣♣♣♣♣♣♣♣♣1♣♣♣♣♣♣1♣♣
-#-.-..-.-.-..-..-# # ### ####  ### K##1-#CCC/////1//////1/////K
-#-..--...-....--.# # ##################-#######################
-#-################                                           à 
---3333333333-CC### #F######################XXXXXXXX###à####-##+
################## ###------------------®###############2###-##+
big#######     ## ####22222222222222222#-##-----------###2##-##K
trouble## RRRRR  #######################-##-####U####-####2####+
######## RRRKRRRR #########$;$$$$$$3$T##-##-----------#####2###3
+++++### RR 2 2 RR ####Z###$############-############‘##Q###2###
++T++## RR 2 P  2RR ### #-U--------------###TT.TT####----####2##
+++++## RR2   2 RR ####1#-####################;###############2#
#O#O#### RR 2  2RR #3## #C####3#3#3#3#3#3#3#3#3#3#3#3#3#3#3#3##D
#X#X##### RRR2CRR ##3## # ###@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@###D
#X#X###### RRRRRR ##3## #3##@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##K#D
-----; #### RRR  ### ## ###@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#D
-----# #####   # ##W W# ##@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##@#D
22222#      #####       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#L`,Va={id:"Kingdom4",map:Aa,tabletMessage:"Adventurer, try the top right corner if you desire."},za=`
---###########RRRRR##W        ############W////1/C//♣//♣♣♣♣♣♣♣♣♣
-U---------Z###RRRRR##7######   ##KKô   Z##-//////♣///1/♣♣♣♣♣♣U♣
---###########RRRRR##7####### P ######## ###-////////♣///♣♣1♣♣♣♣
@#############RRRRR#7####                ####-///♣/////////♣♣♣♣♣
@2#------.###RRRRR##7#W3; ############## #####-////1//♣//1///♣♣♣
@##;-;###.##RRRRR##7##W3; #WWWWWWWWWWW## #2####--//////////♣///♣
@2#-;;##..##RRRRR##7##W3; ######-####### ##2#####-/////♣/////1//
@##;-;##..-##RRRRR##7#### #11111111111## ###2##2##-/////1/////♣/
@2#;;-##..#D##RRRRR##7##T #11111111111## #2##2##2##--///////♣///
@##;;;##..#D###RRRRR##7####11111111111## ##2##2##2###---///////1
@2#-;;##..#KK###RRRRR##7###11111111111## ###)##)##)#####--////♣/
@##-;;##..#KK##RRRRRRR#7###11111B11111----)))))))))))#####---///
@2#;;;##22####RRRR#RRR##7##11111111111##############)########--/
@##;;-##22###RRRR###RRR##7#11111111111#?#•#---#*YYYY-63333####D#
@2#;-;##22##RRRR##L##RRR#7#11111111111#O#T#-#-#*YYYY-63333---#D#
@##;;;##22#RRRR##DD##RRR#7#11111111111#O#-4-#-#*YYYY-63333-#-4-#
@2#;-;##-##RRRR#DDD#RRR##7###########-#O#-#-#-#*YYYY-63333-#-#-#
@##;;-##C#RRRR##DDD##RRR##7###+++++##-#O#-#-#-#*YYYY-63333-#-#-#
@2#;;;##H##RRRR#DDDD##RRR##7##+++++##-#O#-#-#-#*YYYY-63333-#-#-#
@##;-;####RRRR##44444##RRR##7###.####-#O#-#-#-#*YYYY-63333-#-#-#
@2#-;;###RRRR##ñññññññ##RRR#7###.#K-#-#O#-#-#-#*YYYY-63333-#-#-#
@###-###RRRR##X--------#RRR##ô##.#--#-#-#---#-######-#####-#---#
-----##RRRR##%X---U----##RRR#K##--------#111#--------------#111#`;async function Ua(){r.map.hideType(a.OWall1),r.map.hideType(a.OWall2),r.map.hideType(a.OWall3)}const Na={id:"Kingdom6",map:za,tabletMessage:"A strange magical gravity force is tugging you downward!",onLevelStart:Ua},Ka=`
LLL##U##@@@@@@@@@@@|000---0000000000000000-0--00000000VVV000Y-0V
\`\`\`##-##@00000000000000---0000222222220---0000-00000000000--Y-0V
\`\`\`##K##@@022222222K000---0000-0000000000-0000-0)))))YYYW-W0Y-0V
\`\`\`##6##@@@222222222000---000U*******00000000000)))0000000000-00
\`\`\`##6##@@@222222222000---000000000000000000000000222222--000---
\`\`\`##6##@@0222222222000---(((((((((((((((ñ(((((000222222-C00000-
333##6##@00000000000000---00004444444444444444(0000000000000000-
333##6##3CCC....0---------00022222222222222222(K(---------------
$$$##6##000000000000000---00000000000000000000000000000000000000
   0--00000000000000000---000000000000000000000===============--
 P 00-00+02222222220--------------------------0="===-=--===-==-=
$$$00-00+02222222220-00---0000000000000000000-0==I=-=-==-=-=-==-
 ! 00-00+02222222220-00-Z-0000000000000000000-0=H==-===T==-==--=
00000-00[02222B22220-00---00----03333333CC----0==I==-===-==-====
0--00-00+02222222220-00---00-0000000000000000-0===--==-==-==--==
-0000-00+02222222220-00---00-0000000000000000-0==-===-=-=-====-=
00000-00+02222222220W00---00-----0--------000-0=-==--==-=-=--=T=
0--00-00000000000000000---000000000001110-000-0==T-===-===-==-==
00000-00000000000000000---000000000001110-00000=======-=========
--000----------------- ---0WWWWWWWWK01110-000-000000000000000000
00000-00000000000000000---000-00000001110-000K--<000OO000OOOOOó*
--000-000000~~~0000000#---#00-00000000000-000000000000OOOO000000
00C000000********3000##VVV##0-------------00000000bouldervilleÃ0`,Ga={id:"Kingdom12",map:Ka,tabletMessage:"The lava will block a slow Adventurer's path!"},Ha=`
LXXX2    2     2        2   2  2  2   2    2 2    2  2    2    +
+XXX  2     2      2        2          2  2    2     2      XXX 
 XXX2   2      2       2  2     2   2       2      2  2  2  XTX 
+XXX          2  2           2         2  2     2   2       XXX 
 XXX   2   2         2   2     2    2      2  2        2     2  
+XXX 2                                                          
 XXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  2  2 
+XXX2    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
 XXX  2  XXX2                    W                   2XXX 2     
+XXX   2 XXX  2                FFFFF               2  XXX   2 2 
 XXX2 2  XXX                   F111F                  XXX       
+XXX2    XXX+   3  3        W  F1P1F  W       3  3   +XXX  2    
XXXX   2 XXX                   F111F                  XXX 2    2
WXXX 2   XXX  2                FFFFF               2  XXX   2   
WXXX2    XXX2                    W                   2XXX    2  
WXXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX 2     
WXXX   2 XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
WXXX2                                                      2    
WXXX    2   2      2   2     2    2   2    2    2      2      2 
XXXX 2    2   2 2    2    2     2       2     2     2     2 XXX 
XXXX2  2    2  2  2      2    2     2  2  2  2    2         XTX 
XXXX 2   2 2    2   2  2    2   2       2       2   2   2   XXX 
CXXX   2    2  2 2    2 2     2    2  2  2   2    2  2    2    +`,qa={id:"Caverns2",map:Ha},Za=`
WFP I        C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
XX############################################################CC
             C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
  ##############################################################
  #     1        +              1     +                  X      
 1#I##################################################   #   #  
  #X #XX    X    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#1  #   #+ 
  # X#XX XX X XX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#   # 1 #  
+ #X #X +XX  +X  XXLX  W + + + + + T + + + + + W   XX#   #   # 1
  # X#X XXXXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  X# 1 #+  #  
1 #X #X   X     +XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX X#   #   #  
  # X#XXX X ####################################### X#  +#1  #  
  #X #XXXIX     1   +    1   +   1  +               X#   #   #  
  # X#X   ###################################XXX######  1#   #  
  #X #X #####################################XXX######   #   #1 
 1# X#X     1 +1 +1 +1 +1 +1++++                     #+  #  1#  
  #X ########################################XXX#### #   #   # +
  # XXXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXWWWXXX# # 1 #  +#  
  # XXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXX#1#   #1  #  
 +# ################################################ #   #   # 1
  #    1+++1            C           1+++1            #       #  
1 ############################################################  
         1       +            1         +               1       `,ja={id:"Caverns4",map:Za},ht=[Io,Lo,Bo,zo,qa,ja,Ea,Ba,Va,Na,No,Ga,Ho,jo,ta,sa,ca,ua,Ra,ma,ya,_a,Oa,Wa,da,Da];function Qa(e){const t=e.split(`
`).filter(i=>i.length>0);for(let i=0;i<t.length;i++){const n=t[i];for(let o=0;o<n.length;o++){const s=n.charAt(o)??v,c=po[s];switch(r.map.setType(o,i,c??s),s){case"Ã":r.map.setType(o,i,"!");break;case"´":r.map.setType(o,i,".");break;case"µ":r.map.setType(o,i,"?");break;case"¶":r.map.setType(o,i,"'");break;case"·":r.map.setType(o,i,",");break;case"¸":r.map.setType(o,i,":");break;case"ú":r.map.setType(o,i,"·");break;case"ù":r.map.setType(o,i,"∙");break;case"ï":r.map.setType(o,i,"∩");break}switch(gi[c]&&Math.random()<gi[c]&&r.map.set(o,i,new me(c,{x:o,y:i,ch:fe[a.Chance],fg:T[a.Chance][0],bg:T[a.Chance][1]})),c){case a.Player:r.player.x=o,r.player.y=i,r.map.set(o,i,r.player);break;case a.Slow:case a.Medium:case a.Fast:case a.MBlock:{const X=new me(c,{x:o,y:i});r.entities.push(X),r.map.set(o,i,X);break}case a.Generator:r.genNum++;break;case a.Statue:r.T[P.StatueGemDrain]=32e3;break}}}T[a.Gem]=[p.getUniformInt(1,15),null],T[a.Border]=[p.getUniformInt(8,15),p.getUniformInt(1,8)]}async function ut(){var t;rs();const e=ht[f.levelIndex];r.tabletMessage=e.tabletMessage,Fo(),Qa(e.map),(t=e==null?void 0:e.onLevelStart)==null||t.call(e),ls(),Ct(),await g("Press any key to begin this level.")}async function Ci(){Et(),f.levelIndex=Vt(f.levelIndex+1,ht.length),f.levelIndex%10===0&&await ds(),await ut()}async function Ja(){Et(),f.levelIndex=Vt(f.levelIndex-1,ht.length),await ut()}class es{constructor(t=W+1,i=I+1){re(this,"PF",[]);this.width=t,this.height=i}get(t,i){var n,o;return t<0||t>=this.width||i<0||i>=this.height?null:(o=(n=this.PF)==null?void 0:n[t])==null?void 0:o[i]}set(t,i,n){var o;t<0||t>=this.width||i<0||i>=this.height||((o=this.PF)[t]??(o[t]=[]),this.PF[t][i]=n)}getType(t,i){var o;if(t<0||t>=this.width||i<0||i>=this.height)return a.Border;const n=(o=this.get(t,i))==null?void 0:o.type;return typeof n=="string"?n:n??a.Floor}setType(t,i,n){const o=new me(n,{x:t,y:i});this.set(t,i,o)}findRandomEmptySpace(){for(;;){const t=p.getUniformInt(0,W),i=p.getUniformInt(0,I);if(this.getType(t,i)===a.Floor)return[t,i]}}replaceEntities(t,i){for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.getType(n,o)===t&&((typeof i=="string"||typeof i=="number")&&(i=new me(i,{x:n,y:o})),this.set(n,o,i))}updateEntities(t,i){for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++){const s=this.get(n,o);(s==null?void 0:s.type)===t&&Object.assign(s,i)}}hideType(t){for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++){const o=this.get(i,n);(o==null?void 0:o.type)===t&&(o.ch=fe[a.Floor],o.fg=T[a.Floor][0],o.bg=T[a.Floor][1])}}}class mi{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:n,timestamp:o})=>({key:i+t,value:n,timestamp:o}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const n=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(n)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let n=0;n<this.len();n++)t==this.heap[n].value&&(i=n);if(i===null)return!1;if(this.len()>1){let n=this.heap.pop();return n.value!=t&&(this.heap[i]=n,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const n=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=n}minNode(t){const i=t.filter(this.existNode.bind(this));let n=i[0];for(const o of i)this.lessThan(this.heap[o],this.heap[n])&&(n=o);return n}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),n=this.rightChildNode(t);if(!this.existNode(i))return;const o=this.minNode([t,i,n]);o!=t&&(this.swap(t,o),this.updateDown(o))}debugPrint(){console.log(this.heap)}}class ts{constructor(){this._time=0,this._events=new mi}getTime(){return this._time}clear(){return this._events=new mi,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:n}=i;return n}}remove(t){return this._events.remove(t)}}let Gt=class{constructor(){this._queue=new ts,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),n=this._repeat.indexOf(t);return n!=-1&&this._repeat.splice(n,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class is extends Gt{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class ns extends Gt{add(t,i,n){return this._queue.add(t,n!==void 0?n:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}class os extends Gt{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,n){return this._queue.add(t,n||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}const as={Simple:is,Speed:ns,Action:os};var P=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e[e.StatueGemDrain=9]="StatueGemDrain",e))(P||{});function ft(){return{levelIndex:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2}}function Ht(){return{bonus:0,genNum:0,magicEwalls:!1,evapoRate:0,treeRate:0,lavaRate:0,lavaFlow:!1,level:null,player:new me(a.Player),entities:[],map:new es,replacement:a.Floor,T:[0,0,0,0,0,0,0,0,0,0],tabletMessage:void 0}}function Ii(){return{difficulty:8,clockScale:pn,paused:!1,done:!1,foundSet:new Set}}const f=ft(),r=Ht(),L=Ii(),Di=ft(),Ft=ft();function ss(){Object.assign(f,ft()),Object.assign(r,Ht()),Object.assign(L,Ii())}function rs(){Object.assign(r,Ht())}function ls(){Object.assign(Di,f)}async function cs(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await g("Are you sure you want to SAVE? (Y/N)");e.toLowerCase()==="y"&&(Object.assign(Ft,Di),localStorage.setItem("Kroz--saveState--v1",JSON.stringify(Ft)))}async function Xs(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await g("Are you sure you want to RESTORE? (Y/N)");if(e.toLowerCase()==="y"){let t=Ft;const i=localStorage.getItem("Kroz--saveState--v1");if(i)try{t=JSON.parse(i)}catch(n){console.error(n)}Object.assign(f,t),await ut()}}function S(e){switch(e){case a.Border:f.score>f.levelIndex&&(f.score-=f.levelIndex/2);break;case a.Slow:case a.Medium:case a.Fast:f.score+=e;break;case a.Block:case a.ZBlock:case a.GBlock:case a.Wall:case a.River:case a.Tree:case a.Forest:case a.MBlock:case a.OWall1:case a.OWall2:case a.OWall3:case a.EWall:f.score>2&&(f.score-=2);break;case a.Whip:case a.SlowTime:case a.Bomb:f.score++;break;case a.Stairs:f.score+=f.levelIndex*5;break;case a.Chest:f.score+=10+Math.floor(f.levelIndex/2);break;case a.Gem:f.score+=Math.floor(f.levelIndex/2)+1;break;case a.Invisible:f.score+=25;break;case a.Nugget:f.score+=50;break;case a.Door:f.score+=10;break;case a.Teleport:case a.Freeze:f.score+=2;break;case a.SpeedTime:case a.Power:f.score+=5;break;case a.Trap:f.score>5&&(f.score-=5);break;case a.Lava:f.score>100&&(f.score+=100);break;case a.Tome:f.score+=5e3;break;case a.Tablet:f.score+=f.levelIndex+250;break;case a.Chance:f.score+=100;break;case a.Statue:f.score+=10;break;case a.Amulet:f.score+=2500;break;case a.Z:f.score+=1e3;break}J()}async function Ce(e,t){const i=r.map.getType(e,t);if(r.map.setType(e,t,a.Floor),x(e,t),i===a.Slow||i===a.Medium||i===a.Fast)for(let n=0;n<r.entities.length;n++){const o=r.entities[n];o.x===e&&o.y===t&&await Ve(o)}}async function Ve(e){typeof e.type=="number"&&e.type<4&&await Kn(e.type),e.x=-1,e.y=-1}async function Li(e=1){for(let t=0;t<e;t++){let i=!1;do{const n=p.getUniformInt(0,W),o=p.getUniformInt(0,I);r.map.getType(n,o)===a.Floor&&(r.entities.push(new me(a.Slow,{x:n,y:o})),r.map.setType(n,o,a.Slow),await fo(),i=!0),se()}while(!i&&p.getUniformInt(0,50)!==0)}}function ue(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.from(typeof e=="string"?[e]:e);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var o=n.reduce(function(X,h){var u=h.match(/\n([\t ]+|(?!\s).)/g);return u?X.concat(u.map(function(d){var m,y;return(y=(m=d.match(/[\t ]/g))===null||m===void 0?void 0:m.length)!==null&&y!==void 0?y:0})):X},[]);if(o.length){var s=new RegExp(`
[	 ]{`+Math.min.apply(Math,o)+"}","g");n=n.map(function(X){return X.replace(s,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var c=n[0];return t.forEach(function(X,h){var u=c.match(/(?:^|\n)( *)$/),d=u?u[1]:"",m=X;typeof X=="string"&&X.includes(`
`)&&(m=String(X).split(`
`).map(function(y,_){return _===0?y:""+d+y}).join(`
`)),c+=m+n[h+1]}),c}function hs(){$(70,0,"Score",l.Yellow,l.Blue),$(70,3,"Level",l.Yellow,l.Blue),$(70,6,"Gems",l.Yellow,l.Blue),$(70,9,"Whips",l.Yellow,l.Blue),$(68,12,"Teleports",l.Yellow,l.Blue),$(70,15,"Keys",l.Yellow,l.Blue);const[t,i]=Ut(l.HighIntensityWhite,l.Blue);$(69,18,"OPTIONS",t,l.Red),$(69,19,`%c{${t}}W%c{}hip`,l.White,i),$(69,20,`%c{${t}}T%c{}eleport`,l.White,i),$(69,21,`%c{${t}}P%c{}ause`,l.White,i),$(69,22,`%c{${t}}Q%c{}uit`,l.White,i),$(69,23,`%c{${t}}S%c{}ave`,l.White,i),$(69,24,`%c{${t}}R%c{}estore`,l.White,i)}function J(){const e=f.whipPower>2?`${f.whips}+${f.whipPower-2}`:f.whips.toString(),t=4,i=7,n=!L.paused&&f.gems<10?l.Red|16:l.Red,o=69;$(o,1,Ye((f.score*10).toString(),t+1,i),l.Red,l.Grey),$(o,4,Ye(f.levelIndex.toString(),t,i),l.Red,l.Grey),$(o,7,Ye(f.gems.toString(),t+1,i),n,l.Grey),$(o,10,Ye(e,t,i),l.Red,l.Grey),$(o,13,Ye(f.teleports.toString(),t,i),l.Red,l.Grey),$(o,16,Ye(f.keys.toString(),t,i),l.Red,l.Grey)}function qt(){const e=fe[a.Border],[t,i]=T[a.Border];for(let n=xe-1;n<=Te+1;n++)Oe(n,0,e,t,i),Oe(n,Ke+1,e,t,i);for(let n=We-1;n<=Ke+1;n++)Oe(0,n,e,t,i),Oe(Te+1,n,e,t,i)}async function us(){return ye(l.Black),N(20,Ne,l.Yellow),N(21,"Original Level Design (C) 1990 Scott Miller",l.Yellow),N(he-1,"Press any key to continue.",l.HighIntensityWhite),Pt(async()=>{$(5,5,ue`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `,p.getUniformInt(1,15)),await O(500)})}async function fs(){ye(l.Black),N(0,Ne,l.Yellow,l.Black),N(1,"INSTRUCTIONS",l.HighIntensityWhite,l.Black),N(2,"------------",l.HighIntensityWhite,l.Black),$(0,5,ue`
    The dungeons contain dozens of treasures,  spells,  traps and other mysteries.
  Touching an object for the first time will reveal a little of its identity,  but
  it will be left to you to decide how best to use it or avoid it.                
    When a creature touches you it will vanish,  taking with it a few of your gems
  that you have collected. If you have no gems then the creature will instead take
  your life!  Whips can be used to kill nearby creatures, but they are better used
  to smash through crumbled walls and forest terrain.`,l.LightBlue,l.Black),$(3,13,ue`
    You can use these        u i o    7 8 9
    cursor keys to            \\|/      \\|/     w or 5: Whip
    move your man,           j- -k    4- -6         T: Teleport
    and the four              /|\\      /|\\
    normal cursor keys       n m ,    1 2 3`,l.LightBlue,l.Black),$(0,19,ue`
    It's a good idea to save (S) your game at every new level,  therefore,  if you
    die you can easily restore (R) the game at that level and try again.`,l.LightBlue,l.Black),N(22,"Have fun and good-luck...",l.HighIntensityWhite,l.Black),N(he-1,"Press any key to continue.",l.HighIntensityWhite,l.Black),await $e()}async function ds(){ye(l.Black),N(1,Ne,l.Yellow),$(2,4,ue`
    Kroz is a series of Roguelike video games created by Scott Miller and 
    published by Apogee Software in the late 1980s and early 1990s.  In March
    2009, the whole Kroz series was released as freeware by Apogee, and the
    source code was released as free software under the GPL license.`,l.White),N(he-1,"Press any key to continue.",l.HighIntensityWhite,l.Black),await $e(),Qe(),$(2,9,ue`
    This is a re-implementation the original Kroz series of games in typescript 
    playable in the browser.  The source code completly open-source.  If you
    enjoy this game you are asked by the author to please add a star to the
    github repo at https://github.com/Hypercubed/kroz.`,l.White),N(he-1,"Press any key to continue.",l.HighIntensityWhite,l.Black),await $e(),Qe(),$(2,15,ue`
    Better yet, contribute to the game yourself; or maybe fork it and add your
    own levels.  That might make a nice 7DRL challenge entry
    (https://7drl.com/).`,l.White),N(he-1,"Press any key to continue.",l.HighIntensityWhite,l.Black),await $e(),Qe(),$(10,20,"Thank you and enjoy the game.  -- Hypercubed"),N(he-1,"Press any key to continue.",l.HighIntensityWhite,l.Black),await $e(),Qe()}function Ye(e,t,i){return e.padStart(t,v).padEnd(i,v)}function se(){for(let e=0;e<r.map.width;e++)for(let t=0;t<r.map.height;t++){const i=r.map.get(e,t)||new me(a.Floor,{x:e,y:t});i.type!==a.Player&&(i.type===a.Slow||i.type===a.Medium||i.type===a.Fast||x(e,t,i))}for(let e=0;e<r.entities.length;e++){const t=r.entities[e];t.x===-1||t.y===-1||x(t.x,t.y,t)}x(r.player.x,r.player.y,r.player)}function x(e,t,i){if(i??(i=r.map.get(e,t)),!i)return;let n=i.ch;i.type===a.Player&&r.T[P.Invisible]>0&&(n=v),Oe(e+xe,t+We,n,i.fg,i.bg)}function de(e,t,i,n,o){var c,X;i??(i=r.map.getType(e,t));let s;switch(ps(i)?(s=fe[i]??i??fe[a.Floor],n??(n=((c=T[i])==null?void 0:c[0])??T[a.Floor][0]),o??(o=((X=T[i])==null?void 0:X[1])??T[a.Floor][1])):i>="a"&&i<="z"||["!","·","∙","∩"].includes(i)?(s=i.toUpperCase(),n=n??l.HighIntensityWhite,o=o??l.Brown):s=i,i){case a.Stairs:n=typeof n=="number"&&!L.paused?n|16:n;break}Oe(e+xe,t+We,s,n,o)}function st(e,t,i,n){var c;const o=r.map.getType(e,t);let s;o>="a"&&o<="z"||o==="!"?s=l.Brown:s=((c=T[o])==null?void 0:c[1])??T[a.Floor][1],An(e+xe,t+We,i,n,s)}async function M(e,t=!1){if(t){if(L.foundSet===!0||L.foundSet.has(e))return"";L.foundSet.add(e)}const i=Ro[e];return i?await g(i):""}async function g(e){if(!e)return"";const t=(Te-e.length)/2,i=Ke+1;L.paused=!0;const n=await Pt(()=>{$(t,i,e,p.getUniformInt(1,15),l.Black)});return qt(),L.paused=!1,n}function Ct(){ye(l.Blue),qt(),hs(),se(),J()}function Ei(){se(),J()}function ps(e){return typeof e=="number"}async function Rs(){ye(l.Blue),$(2,5,ue`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `,l.LightCyan,l.Blue),$(9,16,`Use the cursor keys to move yourself (%c{${ee[l.Yellow]}}☻%c{${ee[l.LightGreen]}}) through the caverns.`,l.LightGreen,l.Blue),N(17,"Use your whip (press W) to destroy all nearby creatures.",l.LightGreen,l.Blue),N(he-1,"Press any key to begin your decent into Kroz.",l.HighIntensityWhite,l.Blue);const e=rt/2-Ne.length/2;await Pt(async()=>{$(e,3,Ne,p.getUniformInt(0,16),l.Red),await O(500)})}const it={[P.SlowTime]:70*oe,[P.Invisible]:75*oe,[P.SpeedTime]:80*oe,[P.FreezeTime]:55*oe};async function gs(){if(j(E.NextLevel))return await Ci();if(j(E.PrevLevel))return await Ja();if(j(E.NextLevelCheat)){r.map.setType(r.player.x+1,r.player.y,a.Stairs),await Gn();return}if(j(E.FreeItems)){f.gems=150,f.whips=99,f.teleports=99,f.keys=9,J();return}if(j(E.SlowerClock)){L.clockScale=Math.min(20,L.clockScale+1),console.log("Clock Scale:",L.clockScale);return}if(j(E.FasterClock)){L.clockScale=Math.max(1,L.clockScale-1),console.log("Clock Scale:",L.clockScale);return}if(j(E.ResetFound)){L.foundSet=new Set,await g("Newly found object descriptions are reset.");return}if(j(E.HideFound)){L.foundSet=!0,await g("References to new objects will not be displayed.");return}if(j(E.Pause))return ys();if(j(E.Quit))return Ms();if(j(E.Save))return cs();if(j(E.Restore))return Xs();ie(E.Whip)&&(f.whips<1?fi():(f.whips--,await ms())),ie(E.Teleport)&&(f.teleports<1?await fi():(f.teleports--,await Ai()));let e=0,t=0;ie(E.North)&&t--,ie(E.South)&&t++,ie(E.West)&&e--,ie(E.East)&&e++,ie(E.Southeast)&&(e++,t++),ie(E.Southwest)&&(e--,t++),ie(E.Northeast)&&(e++,t--),ie(E.Northwest)&&(e--,t--),e=ui(e,-1,1),t=ui(t,-1,1),(e!==0||t!==0)&&await Pi(e,t)}async function Pi(e,t){const i=r.player.x+e,n=r.player.y+t;if(i<0||i>W||n<0||n>I){await pi(),S(a.Border),await M(a.Border,!0);return}const o=r.map.getType(i,n)||a.Floor;switch(o){case a.Floor:case a.Stop:w(i,n);break;case a.Slow:case a.Medium:case a.Fast:f.gems-=o,Ce(i,n),S(o),w(i,n);break;case a.Block:case a.ZBlock:case a.GBlock:S(o),await M(a.Block,!0);break;case a.Whip:ne(),f.whips++,S(o),w(i,n),await M(a.Whip,!0);break;case a.Stairs:if(w(i,n),f.levelIndex===ht.length-1){await vs();return}S(o),await M(a.Stairs,!0),ke(),await Ci();break;case a.Chest:{w(i,n);const s=p.getUniformInt(2,5),c=p.getUniformInt(2,L.difficulty+2);f.whips+=s,f.gems+=c,S(o),await g(`You found ${c} gems and ${s} whips inside the chest!`);break}case a.SlowTime:r.T[P.SpeedTime]=0,r.T[P.FreezeTime]=0,r.T[P.SlowTime]=it[P.SlowTime],S(o),w(i,n),await M(o,!0);break;case a.Gem:ne(),f.gems++,S(o),w(i,n),await M(o,!0);break;case a.Invisible:r.T[P.Invisible]=it[P.Invisible],S(o),w(i,n),await M(o,!0);break;case a.Teleport:f.teleports++,S(o),w(i,n),M(o,!0);break;case a.Key:ne(),f.keys++,w(i,n),await M(o,!0);break;case a.Door:f.keys<1?(Hn(),await O(100),await g("To pass the Door you need a Key.")):(f.keys--,S(o),await zn(),w(i,n),se(),await M(a.Door,!0));break;case a.Wall:case a.River:_e(),S(o),await M(o,!0);break;case a.SpeedTime:r.T[P.SlowTime]=0,r.T[P.SpeedTime]=it[P.SpeedTime],S(o),w(i,n),await M(o,!0);break;case a.Trap:S(o),w(i,n),await M(o,!0),await Ai();break;case a.Power:f.whipPower++,S(o),w(i,n),await M(o,!0);break;case a.Tree:case a.Forest:S(o),await Be(),await M(o,!0);break;case a.Bomb:{w(i,n),await Ys(i,n),await M(o,!0),qt();break}case a.Lava:f.gems-=10,S(o),w(i,n),await M(o,!0);break;case a.Pit:w(i,n),f.gems=-1,await M(o);break;case a.Tome:r.map.setType(31,6,a.Stairs),de(31,6,a.Stairs),S(o),await M(o),await g("Congratulations, Adventurer, you finally did it!!!");break;case a.Tunnel:{const s=r.player.x,c=r.player.y;w(i,n),await Ss(i,n,s,c),await M(o,!0);break}case a.Freeze:r.T[P.FreezeTime]=it[P.FreezeTime],w(i,n),await M(o,!0);break;case a.Nugget:ne(),w(i,n),S(o),await M(o,!0);break;case a.Quake:w(i,n),await $s(),await M(o,!0);break;case a.IBlock:_e(),r.map.setType(i,n,a.Block),x(i,n),await M(o,!0);break;case a.IWall:_e(),r.map.setType(i,n,a.Wall),x(i,n),await M(o,!0);break;case a.IDoor:_e(),r.map.setType(i,n,a.Door),x(i,n),await M(o,!0);break;case a.Trap2:w(i,n),r.map.replaceEntities(a.Trap2,a.Floor);break;case a.Zap:{w(i,n),await Os(),await M(o,!0);break}case a.Create:{w(i,n),await ks(),S(o),await M(o,!0);break}case a.Generator:Be(),S(o),await M(o,!0);break;case a.MBlock:Be(),S(o),await M(o,!0);break;case a.ShowGems:{w(i,n),ne(),await xs(),await M(o,!1);break}case a.Tablet:w(i,n),ne(),S(o),await M(o,!0),await bs();break;case a.BlockSpell:{w(i,n),await Ts(),await M(o,!0);break}case a.Chance:{S(o);const s=p.getUniformInt(14,18);f.gems+=s,w(i,n),await g(`You found a Pouch containing ${s} Gems!`);break}case a.Statue:Be(),await M(o);break;case a.WallVanish:w(i,n),await Es(),await M(o);break;case a.K:case a.R:case a.O:case a.Z:w(i,n),ne(),await Ws(o);break;case a.OWall1:case a.OWall2:case a.OWall3:_e(),S(a.Wall),await M(a.OWall1,!0);break;case a.CWall1:case a.CWall2:case a.CWall3:w(i,n);break;case a.OSpell1:case a.OSpell2:case a.OSpell3:{w(i,n),await Fs(o),await M(o,!0);break}case a.CSpell1:case a.CSpell2:case a.CSpell3:{w(i,n),await Cs(o),await M(o,!0);break}case a.Rock:{await Is(i,n,e,t);break}case a.EWall:S(o),f.gems--,pi(),await M(a.EWall,!0);break;case a.Trap3:case a.Trap4:case a.Trap5:case a.Trap6:case a.Trap7:case a.Trap8:case a.Trap9:case a.Trap10:case a.Trap11:case a.Trap12:case a.Trap13:w(i,n),r.map.replaceEntities(o,a.Floor);break;case a.TBlock:case a.TRock:case a.TGem:case a.TBlind:case a.TWhip:case a.TGold:case a.TTree:w(i,n),await Ls(i,n,o);break;case a.Rope:w(i,n),await M(a.Rope,!0);break;case a.Message:{await Ds();break}case a.ShootRight:w(i,n),await wi(i,n,1);break;case a.ShootLeft:w(i,n),await wi(i,n,-1);break;case a.DropRope:case a.DropRope2:case a.DropRope3:case a.DropRope4:case a.DropRope5:w(i,n);break;case a.Amulet:w(i,n),await _s();break;default:_e();break}}async function ms(){const e=r.player.x,t=r.player.y;qn(),await i(e-1,t-1,"\\"),await i(e-1,t,"-"),await i(e-1,t+1,"/"),await i(e,t+1,"❘"),await i(e+1,t+1,"\\"),await i(e+1,t,"-"),await i(e+1,t-1,"/"),await i(e,t-1,"❘");async function i(n,o,s){if(n<0||n>W||o<0||o>I)return;const c=r.map.getType(n,o);switch(st(n,o,s,ee[p.getUniformInt(0,15)]),c){case a.Slow:case a.Medium:case a.Fast:Ce(n,o),S(c);break;case a.Block:case a.Forest:case a.Tree:case a.Message:case a.MBlock:case a.ZBlock:case a.GBlock:{const X=f.whipPower;6*Math.random()<X?(c===a.MBlock&&Ce(n,o),r.map.setType(n,o,a.Floor),x(n,o),st(n,o,s,ee[p.getUniformInt(0,15)]),Zn()):$t();break}case a.Invisible:case a.SpeedTime:case a.Trap:case a.Power:case a.K:case a.R:case a.O:case a.Z:r.map.setType(n,o,a.Floor),jn();break;case a.Quake:case a.IBlock:case a.IWall:case a.IDoor:case a.Trap2:case a.Trap3:case a.Trap4:case a.ShowGems:case a.BlockSpell:case a.Trap5:case a.Trap6:case a.Trap7:case a.Trap8:case a.Trap9:case a.Trap10:case a.Trap11:case a.Trap12:case a.Trap13:case a.Stop:break;case a.Rock:30*Math.random()<f.whipPower?(Qn(),r.map.setType(n,o,a.Floor)):$t();break;case a.Statue:50*Math.random()<f.whipPower?(r.map.setType(n,o,a.Floor),S(c),r.T[P.StatueGemDrain]=-1,await g("You've destroyed the Statue!  Your Gems are now safe.")):$t();break;case a.Generator:S(c),r.map.setType(n,o,a.Floor),r.genNum--;break;case a.Wall:break}J(),await O(25)}}async function Bi(){for(let e=0;e<160;e++)e%5===0&&(de(r.player.x,r.player.y,a.Player,p.getUniformInt(0,15),p.getUniformInt(0,8)),await O()),R(e/2,80,10)}async function Ai(){await Bi(),r.map.setType(r.player.x,r.player.y,a.Floor),x(r.player.x,r.player.y);const e=Date.now();for(let t=0;t<700;t++){const i=p.getUniformInt(0,W),n=p.getUniformInt(0,I),o=r.map.getType(i,n);if(vo.indexOf(o)>-1&&(de(i,n,"☺",p.getUniformInt(0,15),p.getUniformInt(0,7)),await Jn(),de(i,n,o)),Date.now()-e>1500)break}w(...r.map.findRandomEmptySpace())}async function ws(){$(Te/2-7,0,"You have died.",l.Black,l.Red),await g("Press any key to continue."),L.done=!0}async function Ms(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await g("Are you sure you want to quit? (Y/N)");e.toLowerCase()==="y"&&(L.done=!0)}async function ys(){await g("Press any key to resume")}async function bs(){const e=r.tabletMessage;e&&(typeof e=="string"?await g(e):typeof e=="function"&&await e())}async function dt(){await g("On the Ancient Tablet is a short Mantra, a prayer..."),await g("You take a deep breath and speak the words aloud...")}async function vs(){await ke(),await O(200),await ke(),await O(200),await ke(),await g("Oh no, something strange is happening!"),await g("You are magically transported from Kroz!");const e=f.gems=isFinite(f.gems)?f.gems:150,t=f.whips=isFinite(f.whips)?f.whips:20,i=f.teleports=isFinite(f.teleports)?f.teleports:10,n=f.keys=isFinite(f.keys)?f.keys:5;await g("Your Gems are worth 100 points each...");for(let o=0;o<e;o++)f.gems--,f.score+=10,J(),await R(o*8+100,20);await g("Your Whips are worth 100 points each...");for(let o=0;o<t;o++)f.whips--,f.score+=10,J(),await R(o*8+100,20);await g("Your Teleport Scrolls are worth 200 points each...");for(let o=0;o<i;o++)f.teleports--,f.score+=20,J(),await R(o*8+100,20);await g("Your Keys are worth 10,000 points each....");for(let o=0;o<n;o++)f.keys--,f.score+=1e3,J(),await R(o*8+100,20);ye(l.Blue),$(25,3,"ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ",l.White,l.Blue),$(10,5,ue`
        Carefully, you place the ancient tome on your table and open
        to the first page.  You read the book intently, quickly
        deciphering the archaic writings.

        You learn of Lord Dullwit, the once powerful and benevolent
        ruler of Kroz, who sought wealth and education for his people.
        The magnificent KINGDOM OF KROZ was once a great empire, until
        it was overthrown by an evil Wizard, who wanted the riches of
        Kroz for himself.

        Using magic beyond understanding, the Wizard trapped Lord
        Dullwit and his people in a chamber so deep in Kroz that any
        hope of escape was fruitless.

        The Wizard then built hundreds of deadly chambers that would
        stop anyone from ever rescuing the good people of Kroz.
        Once again your thoughts becomes clear:  To venture into the
        depths once more and set free the people of Kroz.
       `,l.White,l.Blue),await g("Press any key, Adventurer."),L.done=!0}async function wi(e,t,i){for(e+=i;e>=0&&e<=W;){const n=r.map.getType(e,t);if(typeof n!="number"||ko.includes(n))break;R(e+30,10,100);for(let o=1;o<6;o++)st(e,t,"─",p.getUniformInt(0,16)),await O(1);xo.includes(n)||(await eo(),(n===a.Slow||n===a.Medium||n===a.Fast)&&await Ce(e,t),r.map.setType(e,t,a.Floor)),x(e,t),e+=i}se()}async function _s(){await ne(),await to(),S(a.Amulet),await g("You have found the Amulet of Yendor -- 25,000 points!"),await g("It seems that Kroz and Rogue share the same underground!)"),await g("Your quest for the treasure of Kroz must still continue...")}async function Ys(e,t){io();let i=0;for(;i<=4;++i){R(100-i*10/4,4*10,100);const X=Math.max(e-i,xe),h=Math.min(e+i,Te),u=Math.max(t-i,We),d=Math.min(t+i,Ke);for(let m=X;m<=h;m++)for(let y=u;y<=d;y++){st(m,y,"█",l.LightRed);const _=r.map.getType(m,y)??a.Floor;Ri.includes(_)&&_>=1&&_<=4&&(S(_),Ce(m,y))}await no()}await O(100),i=4;const n=Math.max(e-i,xe),o=Math.min(e+i,Te),s=Math.max(t-i,We),c=Math.min(t+i,Ke);for(let X=n;X<=o;X++)for(let h=s;h<=c;h++){const u=r.map.getType(X,h)??a.Floor;Ri.includes(u)&&r.map.setType(X,h,a.Floor)}se()}async function Ss(e,t,i,n){await O(350),await ke(),await O(500),r.map.setType(e,t,a.Tunnel),x(e,t);let o=e,s=t;for(let h=0;h<1e4;h++){const u=p.getUniformInt(0,W),d=p.getUniformInt(0,I);if((r.map.getType(u,d)??a.Floor)===a.Tunnel&&(u!==o||d!==s)){o=u,s=d,w(o,s);break}}r.map.setType(e,t,a.Tunnel),x(e,t);let c=i,X=n;for(let h=0;h<100;h++){const u=p.getUniformInt(-1,1),d=p.getUniformInt(-1,1);if(o+u<0||o+u>W||s+d<0||s+d>I)continue;const m=r.map.getType(o+u,s+d)??a.Floor;if(Oo.includes(m)){c=o+u,X=s+d;break}}w(c,X),r.map.setType(o,s,a.Tunnel),x(o,s)}async function $s(){await oo(),await O(50);for(let e=0;e<50;e++){do{const t=p.getUniformInt(0,W),i=p.getUniformInt(0,I),n=r.map.getType(t,i);if(bo.includes(n)){r.map.setType(t,i,a.Rock),x(t,i);break}}while(Math.random()>.01);await so()}await ao()}async function Os(){let e=0,t=0;for(;e<500&&t<40;){e++;const i=p.getUniformInt(0,r.entities.length),n=r.entities[i];!n||n.x===-1||n.y===-1||n.type!==a.Slow&&n.type!==a.Medium&&n.type!==a.Fast||(await Ce(n.x,n.y),await O(20),t++)}f.score+=Math.floor(t/3+2),se(),J()}async function ks(){r.entities.reduce((t,i)=>i.type===a.Slow?t+1:t,0)<945&&await Li(45)}async function xs(){for(let e=0;e<L.difficulty*2+5;e++){let t=!1;do{const i=p.getUniformInt(0,W),n=p.getUniformInt(0,I);r.map.getType(i,n)===a.Floor&&(t=!0,r.map.setType(i,n,a.Gem),x(i,n),await ro(),await O(90))}while(!t&&Math.random()>.01)}}async function Ts(){for(let e=0;e<=W;e++)for(let t=0;t<=I;t++)if(r.map.getType(e,t)===a.ZBlock){lo();for(let i=20;i>0;i--)de(e,t,a.Block,p.getUniformInt(0,15)),await O(1);r.map.setType(e,t,a.Floor),x(e,t)}else r.map.getType(e,t)===a.BlockSpell&&(r.map.setType(e,t,a.Floor),x(e,t))}async function Ws(e){e===a.K&&r.bonus===0&&(r.bonus=1),e===a.R&&r.bonus===1&&(r.bonus=2),e===a.O&&r.bonus===2&&(r.bonus=3),e===a.Z&&r.bonus===3&&(await Nn(),S(e),await M(e))}async function Fs(e){let t=a.OWall1;e===a.OSpell2&&(t=a.OWall2),e===a.OSpell3&&(t=a.OWall3);for(let i=0;i<=W;i++)for(let n=0;n<=I;n++)if(r.map.getType(i,n)===t){for(let s=60;s>0;s--)de(i,n,p.getItem(["▄","▌","▐","▀"]),p.getUniformInt(0,14)),R(s*40,5,10),s%5===0&&await O(1);r.map.setType(i,n,a.Floor),x(i,n)}}async function Cs(e){const t=e-a.CSpell1+a.CWall1;for(let i=0;i<=W;i++)for(let n=0;n<=I;n++)if(r.map.getType(i,n)===t){for(let s=60;s>0;s--)de(i,n,p.getItem(["▄","▌","▐","▀"]),p.getUniformInt(0,14)),R(s*40,5,10),s%5===0&&await O(1);r.map.setType(i,n,a.Wall),x(i,n)}}async function Is(e,t,i,n){let o=!1;const s=r.player.x+i*2,c=r.player.y+n*2;if((s<0||s>W||c<0||c>I)&&(o=!0),!o){const X=r.map.getType(s,c);async function h(){o=!1,await di(),r.map.setType(s,c,a.Rock),w(e,t),se(),await M(a.Rock,!0)}Yo.includes(X)?await h():So.includes(X)?(await h(),await ne()):Nt.includes(X)?(await h(),S(X),await co()):X===a.EWall?(await h(),r.map.setType(s,c,a.Floor),Xo(),await g("The Boulder is vaporized!")):$o.includes(X)&&(o=!1,await di(),w(e,t),de(s,c,a.Rock),await ho(),se(),await M(a.Rock,!0))}o&&await Be()}async function Ds(){await uo(),await g("You notice a secret message carved into the old tree..."),await g('"Goodness of Heart Overcomes Adversity."'),await g("Reveal that you found this message to Scott Miller..."),await g('And receive a "MASTER KROZ CERTIFICATE" to hang on your wall!!'),await g("Only the first 100 players to report this..."),await g("Will be awarded the certificate.  Congratulations!")}async function Ls(e,t,i){let n=a.Floor;switch(i){case a.TBlock:n=a.Block;break;case a.TRock:n=a.Rock;break;case a.TGem:n=a.Gem;break;case a.TBlind:n=a.Invisible;break;case a.TWhip:n=a.Whip;break;case a.TGold:n=a.Nugget;break;case a.TTree:n=a.Tree;break}for(let s=0;s<10;s++)await o(!1,p.getUniformInt(0,7),p.getUniformInt(0,7)),await R((s+25)*s*2,20,10);return o(!0);async function o(s,c,X){for(let h=-1;h<=1;h++)for(let u=-1;u<=1;u++){if(h===0&&u===0)continue;const d=r.map.getType(e+h,t+u);_o.includes(d)&&(de(e+h,t+u,n,c,X),s&&r.map.setType(e+h,t+u,n)),await O(5)}}}async function Es(){for(let e=0;e<75;e++){let t=!1;do{const i=p.getUniformInt(0,W),n=p.getUniformInt(0,I),o=r.map.getType(i,n);o===a.Block&&(r.map.setType(i,n,a.IBlock),x(i,n),t=!0),o===a.Wall&&(r.map.setType(i,n,a.IWall),x(i,n),t=!0)}while(!t&&p.getUniformInt(0,200)!==0)}}function w(e,t){ke();const i=r.player;r.map.setType(i.x,i.y,i.replacement),x(i.x,i.y);const n=r.map.getType(e,t);i.replacement=[a.CWall1,a.CWall2,a.CWall3,a.Rope].includes(n)?n:a.Floor,r.map.set(e,t,i),i.x=e,i.y=t,x(i.x,i.y)}function Ps(e){switch(e){case a.Player:return oe;case a.Slow:return oe/4;case a.Medium:return oe/3;case a.Fast:return oe/2;case a.MBlock:return oe/2}}class Ze{constructor(t){re(this,"speed");this.type=t,this.speed=Ps(this.type)}getSpeed(){return this.type===a.Player?r.T[P.SlowTime]>0?10:1:r.T[P.SpeedTime]>0?oe:this.speed}}let ge;const Bs=new Ze(a.Player),As=new Ze(a.Slow),Vs=new Ze(a.Medium),zs=new Ze(a.Fast),Us=new Ze(a.MBlock);function Ns(){return ge=new as.Speed,ge.add(Bs,!0),ge.add(As,!0),ge.add(Vs,!0),ge.add(zs,!0),ge.add(Us,!0),ge}async function Ks(){const e=ge.next();await qs(e.type)}async function Gs(e){if(e.x===-1||e.y===-1||r.map.getType(e.x,e.y)!==e.type){Ve(e);return}let t=0,i=0;r.player.x<e.x&&(t=-1),r.player.x>e.x&&(t=1),r.player.y<e.y&&(i=-1),r.player.y>e.y&&(i=1);const n=e.x+t,o=e.y+i;if(n<0||n>W||o<0||o>I)return;const s=r.map.getType(n,o);switch(s){case a.Floor:case a.TBlock:case a.TRock:case a.TGem:case a.TBlind:case a.TGold:case a.TWhip:case a.TTree:ze(e,n,o);break;case a.Block:case a.MBlock:case a.ZBlock:case a.GBlock:r.map.setType(e.x,e.y,a.Floor),r.map.setType(n,o,a.Floor),Ve(e),S(s),R(800,18),R(400,20);break;case a.Player:f.gems--,r.map.setType(e.x,e.y,a.Floor),Ve(e),S(s);break;case a.Whip:case a.Chest:case a.SlowTime:case a.Gem:case a.Invisible:case a.Teleport:case a.Key:case a.SpeedTime:case a.Trap:case a.Power:case a.Freeze:case a.Nugget:case a.K:case a.R:case a.O:case a.Z:case a.ShootRight:case a.ShootLeft:ne(),ze(e,n,o);break;default:ze(e,e.x,e.y);break}}async function Hs(e){if(e.x===-1||e.y===-1||r.map.getType(e.x,e.y)!==e.type){Ve(e);return}let t=0,i=0;r.player.x<e.x&&(t=-1),r.player.x>e.x&&(t=1),r.player.y<e.y&&(i=-1),r.player.y>e.y&&(i=1);const n=e.x+t,o=e.y+i;if(n<0||n>W||o<0||o>I)return;switch(r.map.getType(n,o)){case a.Floor:ze(e,n,o),e.ch=fe[a.Block],e.fg=T[a.Block][0]??T[a.Floor][0],e.bg=T[a.Block][1]??T[a.Floor][1];break;default:ze(e,e.x,e.y);break}}async function qs(e){if(e!==a.Player&&!(r.T[P.FreezeTime]>0))for(let t=0;t<r.entities.length;t++){const i=r.entities[t];e&&i.type!==e||i.x===-1||i.y===-1||(i.type===a.MBlock?await Hs(i):await Gs(i))}}function ze(e,t,i){e.type===a.Slow?e.ch=Math.random()>.5?"A":"Ä":e.type===a.Medium&&(e.ch=Math.random()>.5?"ö":"Ö"),r.map.setType(e.x,e.y,a.Floor),r.map.set(t,i,e),e.x=t,e.y=i}async function Zs(){for(let t=0;t<r.T.length;t++)r.T[t]=Math.max(0,r.T[t]-1);r.T[P.StatueGemDrain]>0&&p.getUniformInt(0,18)===0&&(f.gems--,await R(3800,40),J());const e=r.entities.reduce((t,i)=>i.type===a.Slow?t+1:t,0);if(r.genNum>0&&e<995&&p.getUniformInt(0,17)===0&&await Li(1),r.magicEwalls&&p.getUniformInt(0,7)===0){for(let t=0;t<100;t++){const i=p.getUniformInt(0,W),n=p.getUniformInt(0,I);if(r.map.getType(i,n)===a.CWall1){r.map.setType(i,n,a.EWall),x(i,n);break}}for(let t=0;t<100;t++){const i=p.getUniformInt(0,W),n=p.getUniformInt(0,I);if(r.map.getType(i,n)===a.EWall){r.map.setType(i,n,a.CWall1),x(i,n);break}}}if(r.evapoRate>0&&p.getUniformInt(0,9)===0){const t=p.getUniformInt(0,W),i=p.getUniformInt(0,I);r.map.getType(t,i)===a.River&&(r.map.setType(t,i,a.Floor),x(t,i))}}function js(){const e=Vn();document.getElementById("app").appendChild(e),vn()}async function It(){ye(l.Black),ss(),await us(),await Rs(),await fs(),ut(),Ct(),await Bi(),Ei(),await g("Press any key to begin this level."),vi(),Ct(),await Qs()}async function Qs(){Ns();let e=16*L.clockScale,t=0,i=0;const n=async o=>{if(f.gems<0){await ws(),It();return}if(L.done){It();return}t+=o-i,i=o,t>e&&(t%=e,await gs(),await Ks(),await Zs(),se(),vi()),Ei(),e=16*L.clockScale,requestAnimationFrame(n)};requestAnimationFrame(n)}function Mi(){js(),It()}try{document.fonts.ready.then(Mi)}catch{window.addEventListener("DOMContentLoaded",Mi)}
