var pt=Object.defineProperty;var ft=(e,t,i)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Be=(e,t,i)=>ft(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const X of o.addedNodes)X.tagName==="LINK"&&X.rel==="modulepreload"&&a(X)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const pe=23283064365386963e-26;class Ce{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*pe,t=t*69069+1>>>0,this._s1=t*pe,t=t*69069+1>>>0,this._s2=t*pe,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*pe;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let a=Math.max(t,i),s=Math.min(t,i);return Math.floor(this.getUniform()*(a-s+1))+s}getNormal(t=0,i=1){let a,s,o;do a=2*this.getUniform()-1,s=2*this.getUniform()-1,o=a*a+s*s;while(o>1||o==0);let X=a*Math.sqrt(-2*Math.log(o)/o);return t+X*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],a=t.slice();for(;a.length;){let s=a.indexOf(this.getItem(a));i.push(a.splice(s,1)[0])}return i}getWeightedValue(t){let i=0;for(let X in t)i+=t[X];let a=this.getUniform()*i,s,o=0;for(s in t)if(o+=t[s],a<o)return s;return s}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new Ce().setState(this.getState())}}const b=new Ce().setSeed(Date.now());class Ee{getContainer(){return null}setOptions(t){this._options=t}}class Ae extends Ee{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const a=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=a,this._updateSize(),this._ctx.font=a,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let a=this._ctx.canvas,s=a.getBoundingClientRect();return t-=s.left,i-=s.top,t*=a.width/s.width,i*=a.height/s.height,t<0||i<0||t>=a.width||i>=a.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function dt(e,t){return(e%t+t)%t}class He extends Ae{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[a,s,o,X,h]=t,c=[(a+1)*this._spacingX,s*this._spacingY+this._hexSize];if(this._options.transpose&&c.reverse(),i&&(this._ctx.fillStyle=h,this._fill(c[0],c[1])),!o)return;this._ctx.fillStyle=X;let u=[].concat(o);for(let y=0;y<u.length;y++)this._ctx.fillText(u[y],c[0],Math.ceil(c[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let a=Math.floor(t/this._spacingX)-1,s=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[a,s]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let a=2*t/((this._options.width+1)*Math.sqrt(3))-1,s=i/(2+1.5*(this._options.height-1)),o=Math.min(a,s),X=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let h=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=X;let c=h/100;o=Math.floor(o)+1;let u=2*o/(this._options.spacing*(1+c/Math.sqrt(3)));return Math.ceil(u)-1}_normalizedEventToPosition(t,i){let a;this._options.transpose?(t+=i,i=t-i,t-=i,a=this._ctx.canvas.width):a=this._ctx.canvas.height;let s=a/this._options.height;return i=Math.floor(i/s),dt(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let a=this._hexSize,s=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-a+s,i),o.lineTo(t-a/2+s,i+this._spacingX-s),o.lineTo(t+a/2-s,i+this._spacingX-s),o.lineTo(t+a-s,i),o.lineTo(t+a/2-s,i-this._spacingX+s),o.lineTo(t-a/2+s,i-this._spacingX+s),o.lineTo(t-a+s,i)):(o.moveTo(t,i-a+s),o.lineTo(t+this._spacingX-s,i-a/2+s),o.lineTo(t+this._spacingX-s,i+a/2-s),o.lineTo(t,i+a-s),o.lineTo(t-this._spacingX+s,i+a/2-s),o.lineTo(t-this._spacingX+s,i-a/2+s),o.lineTo(t,i-a+s)),o.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let a,s;t.transpose?(a="height",s="width"):(a="width",s="height"),this._ctx.canvas[a]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[s]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class le extends Ae{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){le.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,a,s,o,X]=t,h=""+s+o+X,c;if(h in this._canvasCache)c=this._canvasCache[h];else{let u=this._options.border;c=document.createElement("canvas");let y=c.getContext("2d");if(c.width=this._spacingX,c.height=this._spacingY,y.fillStyle=X,y.fillRect(u,u,c.width-u,c.height-u),s){y.fillStyle=o,y.font=this._ctx.font,y.textAlign="center",y.textBaseline="middle";let v=[].concat(s);for(let F=0;F<v.length;F++)y.fillText(v[F],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[h]=c}this._ctx.drawImage(c,i*this._spacingX,a*this._spacingY)}_drawNoCache(t,i){let[a,s,o,X,h]=t;if(i){let u=this._options.border;this._ctx.fillStyle=h,this._ctx.fillRect(a*this._spacingX+u,s*this._spacingY+u,this._spacingX-u,this._spacingY-u)}if(!o)return;this._ctx.fillStyle=X;let c=[].concat(o);for(let u=0;u<c.length;u++)this._ctx.fillText(c[u],(a+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(t,i){let a=Math.floor(t/this._spacingX),s=Math.floor(i/this._spacingY);return[a,s]}computeFontSize(t,i){let a=Math.floor(t/this._options.width),s=Math.floor(i/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let X=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let c=X/100*s/a;return c>1&&(s=Math.floor(s/c)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}le.cache=!1;let qe=class extends Ae{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[a,s,o,X,h]=t,c=this._options.tileWidth,u=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(a*c,s*u,c,u):(this._ctx.fillStyle=h,this._ctx.fillRect(a*c,s*u,c,u))),!o)return;let y=[].concat(o),v=[].concat(X),F=[].concat(h);for(let d=0;d<y.length;d++){let m=this._options.tileMap[y[d]];if(!m)throw new Error(`Char "${y[d]}" not found in tileMap`);if(this._options.tileColorize){let x=this._colorCanvas,S=x.getContext("2d");S.globalCompositeOperation="source-over",S.clearRect(0,0,c,u);let C=v[d],E=F[d];S.drawImage(this._options.tileSet,m[0],m[1],c,u,0,0,c,u),C!="transparent"&&(S.fillStyle=C,S.globalCompositeOperation="source-atop",S.fillRect(0,0,c,u)),E!="transparent"&&(S.fillStyle=E,S.globalCompositeOperation="destination-over",S.fillRect(0,0,c,u)),this._ctx.drawImage(x,a*c,s*u,c,u)}else this._ctx.drawImage(this._options.tileSet,m[0],m[1],c,u,a*c,s*u,c,u)}}computeSize(t,i){let a=Math.floor(t/this._options.tileWidth),s=Math.floor(i/this._options.tileHeight);return[a,s]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}};function Ve(e){let t,i;if(e in ke)t=ke[e];else{if(e.charAt(0)=="#"){let s=(e.match(/[0-9a-f]/gi)||[]).map(o=>parseInt(o,16));if(s.length==3)t=s.map(o=>o*17);else{for(let o=0;o<3;o++)s[o+1]+=16*s[o],s.splice(o,1);t=s}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(a=>parseInt(a)):t=[0,0,0];ke[e]=t}return t.slice()}const ke={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class Ze extends Ee{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const a=this._gl,s=this._options;let[o,X,h,c,u]=t,y=a.canvas.height-(X+1)*s.tileHeight;if(a.scissor(o*s.tileWidth,y,s.tileWidth,s.tileHeight),i&&(s.tileColorize?a.clearColor(0,0,0,0):a.clearColor(...fe(u)),a.clear(a.COLOR_BUFFER_BIT)),!h)return;let v=[].concat(h),F=[].concat(u),d=[].concat(c);a.uniform2fv(this._uniforms.targetPosRel,[o,X]);for(let m=0;m<v.length;m++){let x=this._options.tileMap[v[m]];if(!x)throw new Error(`Char "${v[m]}" not found in tileMap`);a.uniform1f(this._uniforms.colorize,s.tileColorize?1:0),a.uniform2fv(this._uniforms.tilesetPosAbs,x),s.tileColorize&&(a.uniform4fv(this._uniforms.tint,fe(d[m])),a.uniform4fv(this._uniforms.bg,fe(F[m]))),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...fe(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let a=Math.floor(t/this._options.tileWidth),s=Math.floor(i/this._options.tileHeight);return[a,s]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let a=this._gl.canvas,s=a.getBoundingClientRect();return t-=s.left,i-=s.top,t*=a.width/s.width,i*=a.height/s.height,t<0||i<0||t>=a.width||i>=a.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=yt(t,wt,mt);return t.useProgram(i),_t(t),gt.forEach(a=>this._uniforms[a]=t.getUniformLocation(i,a)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,a=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=a[0],t.canvas.height=a[1],t.viewport(0,0,a[0],a[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,a)}_updateTexture(t){bt(this._gl,t)}}const gt=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],wt=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),mt=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function yt(e,t,i){const a=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(a)||"");const s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(s)||"");const o=e.createProgram();if(e.attachShader(o,a),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o)||"");return o}function _t(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function bt(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let ve={};function fe(e){if(!(e in ve)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=Ve(e).map(i=>i/255),t.push(1);ve[e]=t}return ve[e]}function St(e){return`\x1B[0;48;5;${xe(e)}m\x1B[2J`}function kt(e,t){return`\x1B[0;38;5;${xe(e)};48;5;${xe(t)}m`}function vt(e,t){return`\x1B[${t+1};${e+1}H`}function xe(e){const a=.0234375;let s=Ve(e),o=Math.floor(s[0]*a),X=Math.floor(s[1]*a),h=Math.floor(s[2]*a);return o*36+X*6+h*1+16}class Qe extends Ee{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],a=this.computeSize();this._offset=a.map((s,o)=>Math.floor((s-i[o])/2))}clear(){process.stdout.write(St(this._options.bg))}draw(t,i){let[a,s,o,X,h]=t,c=this._offset[0]+a,u=this._offset[1]+s,y=this.computeSize();if(c<0||c>=y[0]||u<0||u>=y[1]||((c!==this._cursor[0]||u!==this._cursor[1])&&(process.stdout.write(vt(c,u)),this._cursor[0]=c,this._cursor[1]=u),i&&(o||(o=" ")),!o))return;let v=kt(X,h);if(v!==this._lastColor&&(process.stdout.write(v),this._lastColor=v),o!="	"){let F=[].concat(o);process.stdout.write(F[0])}this._cursor[0]++,this._cursor[0]>=y[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const Rt=/%([bc]){([^}]*)}/g,te=0,ne=1,je=2,Je=3;function xt(e,t){let i=[],a=0;e.replace(Rt,function(o,X,h,c){let u=e.substring(a,c);return u.length&&i.push({type:te,value:u}),i.push({type:X=="c"?je:Je,value:h.trim()}),a=c+o.length,""});let s=e.substring(a);return s.length&&i.push({type:te,value:s}),Wt(i,t)}function Wt(e,t){t||(t=1/0);let i=0,a=0,s=-1;for(;i<e.length;){let X=e[i];if(X.type==ne&&(a=0,s=-1),X.type!=te){i++;continue}for(;a==0&&X.value.charAt(0)==" ";)X.value=X.value.substring(1);let h=X.value.indexOf(`
`);if(h!=-1){X.value=de(e,i,h,!0);let c=X.value.split("");for(;c.length&&c[c.length-1]==" ";)c.pop();X.value=c.join("")}if(!X.value.length){e.splice(i,1);continue}if(a+X.value.length>t){let c=-1;for(;;){let u=X.value.indexOf(" ",c+1);if(u==-1||a+u>t)break;c=u}if(c!=-1)X.value=de(e,i,c,!0);else if(s!=-1){let u=e[s],y=u.value.lastIndexOf(" ");u.value=de(e,s,y,!0),i=s}else X.value=de(e,i,t-a,!1)}else a+=X.value.length,X.value.indexOf(" ")!=-1&&(s=i);i++}e.push({type:ne});let o=null;for(let X=0;X<e.length;X++){let h=e[X];switch(h.type){case te:o=h;break;case ne:if(o){let c=o.value.split("");for(;c.length&&c[c.length-1]==" ";)c.pop();o.value=c.join("")}o=null;break}}return e.pop(),e}function de(e,t,i,a){let s={type:ne},o={type:te,value:e[t].value.substring(i+(a?1:0))};return e.splice(t+1,0,s,o),e[t].value.substring(0,i)}let Ft=80,Pt=25;const Tt={hex:He,rect:le,tile:qe,"tile-gl":Ze,term:Qe},Ct={width:Ft,height:Pt,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class V{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},Ct,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,a){let s=[this._options.bg,this._options.fg];this.draw(t,i,null,null,s[a%s.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=Tt[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let a=Math.floor(t/this._options.width),s=Math.floor(i/this._options.height);return[a,s]}eventToPosition(t){let i,a;return"touches"in t?(i=t.touches[0].clientX,a=t.touches[0].clientY):(i=t.clientX,a=t.clientY),this._backend.eventToPosition(i,a)}draw(t,i,a,s,o){s||(s=this._options.fg),o||(o=this._options.bg);let X=`${t},${i}`;this._data[X]=[t,i,a,s,o],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[X]=!0)}drawOver(t,i,a,s,o){const X=`${t},${i}`,h=this._data[X];h?(h[2]=a||h[2],h[3]=s||h[3],h[4]=o||h[4]):this.draw(t,i,a,s,o)}drawText(t,i,a,s){let o=null,X=null,h=t,c=i,u=1;s||(s=this._options.width-t);let y=xt(a,s);for(;y.length;){let v=y.shift();switch(v.type){case te:let F=!1,d=!1,m=!1,x=!1;for(let S=0;S<v.value.length;S++){let C=v.value.charCodeAt(S),E=v.value.charAt(S);if(this._options.layout==="term"){let A=C>>8;if(A===17||A>=46&&A<=159||A>=172&&A<=215||C>=43360&&C<=43391){this.draw(h+0,c,E,o,X),this.draw(h+1,c,"	",o,X),h+=2;continue}}m=C>65280&&C<65377||C>65500&&C<65512||C>65518,F=E.charCodeAt(0)==32||E.charCodeAt(0)==12288,x&&!m&&!F&&h++,m&&!d&&h++,this.draw(h++,c,E,o,X),d=F,x=m}break;case je:o=v.value||null;break;case Je:X=v.value||null;break;case ne:h=t,c++,u++;break}}return u}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let a=this._data[t];a[4]!=this._options.bg&&(i=!0),this._backend.draw(a,i)}}V.Rect=le;V.Hex=He;V.Tile=qe;V.TileGL=Ze;V.Term=Qe;class De{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:a,timestamp:s})=>({key:i+t,value:a,timestamp:s}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const a=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(a)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let a=0;a<this.len();a++)t==this.heap[a].value&&(i=a);if(i===null)return!1;if(this.len()>1){let a=this.heap.pop();return a.value!=t&&(this.heap[i]=a,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a}minNode(t){const i=t.filter(this.existNode.bind(this));let a=i[0];for(const s of i)this.lessThan(this.heap[s],this.heap[a])&&(a=s);return a}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),a=this.rightChildNode(t);if(!this.existNode(i))return;const s=this.minNode([t,i,a]);s!=t&&(this.swap(t,s),this.updateDown(s))}debugPrint(){console.log(this.heap)}}class Et{constructor(){this._time=0,this._events=new De}getTime(){return this._time}clear(){return this._events=new De,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:a}=i;return a}}remove(t){return this._events.remove(t)}}let Ie=class{constructor(){this._queue=new Et,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),a=this._repeat.indexOf(t);return a!=-1&&this._repeat.splice(a,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class At extends Ie{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class It extends Ie{add(t,i,a){return this._queue.add(t,a!==void 0?a:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}let Ot=class extends Ie{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,a){return this._queue.add(t,a||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}};const Mt={Simple:At,Speed:It,Action:Ot},et=80,tt=25,ce=1,ie=et-16,he=1,Xe=tt-2,B=ie-ce,D=Xe-he,w=" ";var l=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(l||{});const H={0:"black",1:"blue",2:"green",3:"cyan",4:"red",5:"magenta",6:"brown",7:"#D3D3D3",8:"#808080",9:"#ADD8E6",10:"#90EE90",11:"#E0FFFF",12:"#FF474C",13:"#FFC0CB",14:"yellow",15:"white"};var r=(e=>(e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(r||{});const me={0:w,1:"Ä",2:"Ö",3:"Ω",4:"▓",5:"⌠",6:"≡",7:"C",8:"Φ",9:"♦",10:"¡",11:"↑",12:"î",13:"ì",14:"█",15:"Θ",16:"∙",17:"≈",18:"○",19:"█",20:"♣",21:"¥",22:"▓",23:"░",24:"■",25:"∩",26:"ƒ",27:"☼",28:w,29:"▲",30:w,31:w,32:w,33:w,34:"▲",35:"▼",36:"♠",37:w,38:"▓",39:w,40:"☻",41:w,42:"■",43:"▓",44:w,45:"?",46:"☺",47:w,48:"K",49:"R",50:"O",51:"Z",52:"█",53:"█",54:"█",55:w,56:w,57:w,58:w,59:w,60:w,61:w,62:w,63:w,64:"▓",65:"O",66:"X",67:w,68:w,69:w,70:w,71:w,72:w,73:w,74:w,75:"│",76:"↓",77:"↓",78:"↓",79:"↓",80:"↓",81:"♀",82:"→",83:"←",224:w,225:w,226:w,227:w,228:w,229:w,230:w,231:w,252:"♣"},Lt={" ":0,1:1,2:2,3:3,X:4,W:5,L:6,C:7,S:8,"+":9,I:10,T:11,K:12,D:13,"#":14,F:15,".":16,R:17,Q:18,"/":19,"\\":20,"♣":20,B:21,V:22,"=":23,A:24,U:25,Z:26,"*":27,E:28,";":29,":":30,"`":31,"-":32,"@":33,"%":34,"]":35,G:36,")":37,M:38,"(":39,P:40,"&":41,"!":42,O:43,H:44,"?":45,">":46,N:47,"<":48,"[":49,"|":50,'"':51,4:52,5:53,6:54,7:55,8:56,9:57,ñ:58,ò:59,ó:60,ô:61,õ:62,ö:63,Y:64,0:65,"~":66,$:67,"‘":68,"’":69,"“":70,"”":71,"•":72,"–":73,"—":74,"³":75,"¹":76,º:77,"»":78,"¼":79,"½":80,ƒ:81,"¯":82,"®":83,à:224,á:225,â:226,ã:227,ä:228,å:229,æ:230,ç:231,ü:252},O={0:[l.White,l.Black],1:[l.LightRed,null],2:[l.LightGreen,null],3:[l.Green,null],4:[l.Brown,null],5:[l.HighIntensityWhite,null],6:[l.Black|16,l.White],7:[l.Yellow,null],8:[l.Red,null],9:[l.Blue,null],10:[l.Green,null],11:[l.LightMagenta,null],12:[l.LightRed,null],13:[l.Magenta,l.Blue],14:[l.Brown,l.Brown],15:[l.LightCyan,null],16:[l.White,null],17:[l.LightBlue,l.Blue],18:[l.HighIntensityWhite,null],19:[l.Green,l.Green],20:[l.Brown,l.Green],21:[l.HighIntensityWhite,null],22:[l.LightRed,l.Red],23:[l.White,null],24:[l.HighIntensityWhite|32,l.Magenta],25:[l.HighIntensityWhite,null],26:[l.LightCyan,null],27:[l.Yellow,null],28:[l.HighIntensityWhite,null],29:[null,null],30:[null,null],31:[null,null],32:[null,null],34:[l.LightRed,null],35:[l.HighIntensityWhite,null],36:[l.Yellow|16,null],38:[l.Brown,null],33:[null,null],37:[null,null],39:[null,null],67:[null,null],224:[null,null],225:[null,null],226:[null,null],227:[null,null],228:[null,null],229:[null,null],230:[null,null],231:[null,null],40:[l.Yellow,l.Black],41:[null,null],42:[l.LightBlue,null],43:[l.Brown,null],44:[null,null],45:[l.HighIntensityWhite,null],46:[l.HighIntensityWhite,null],48:[l.White,null],49:[l.White,null],50:[l.White,null],51:[l.White,null],52:[l.Brown,l.Brown],53:[l.Brown,l.Brown],54:[l.White,l.Brown],55:[null,null],56:[null,null],57:[null,null],58:[l.LightCyan,null],59:[l.LightCyan,null],60:[l.LightCyan,null],61:[null,null],62:[null,null],63:[null,null],64:[l.White,null],65:[l.White,null],66:[l.LightRed,l.Red],68:[null,null],69:[null,null],70:[null,null],71:[null,null],72:[null,null],73:[null,null],74:[null,null],47:[l.HighIntensityWhite,null],75:[l.White,null],76:[l.White,null],77:[l.White,null],78:[l.White,null],79:[l.White,null],80:[l.White,null],82:[l.White,null],83:[l.White,null],81:[l.HighIntensityWhite,null],252:[l.Brown,l.Green]},it={4:"A Breakable Wall blocks your way",5:"You have found a Whip",6:"Stairs take you to the next lower level.",7:"`You found gems and whips inside the chest!",8:"You activated a Slow Time spell.",9:"Gems give you both points and strength.",10:"Oh no, a temporary Blindness Potion!",11:"You found a Teleport scroll.",12:"Use Keys to unlock doors.",13:"To pass the Door you need a Key.",14:"A Solid Wall blocks your way.",17:"You cannot travel through Water.",15:"You activated a Speed Creature spell.",16:"You activated a Teleport trap!",18:"A Power Ring--your whip is now a little stronger!",20:"A tree blocks your way.",19:"You cannot travel through forest terrain.",21:"You activated a Magic Bomb!",22:"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)",23:"* SPLAT!! *",24:"The Sacred Tome of Kroz is finally yours--50,000 points!",25:"You passed through a secret Tunnel!",26:"You have activated a Freeze Creature spell!",27:"You found a Gold Nugget...500 points!",28:"Oh no, you set off an Earthquake trap!",29:"An Invisible Crumbled Wall blocks your way.",31:"An Invisible Door blocks your way.",34:"A Creature Zap Spell!",35:"A Creature Creation Trap!",36:"You have discovered a Creature Generator!",38:"A Moving Wall blocks your way.",41:"Yah Hoo! You discovered a Reveal Gems Scroll!",42:"You found an Ancient Tablet of Wisdom...2,500 points!",44:"You triggered Exploding Walls!",45:"You found a Pouch containing Gems!",46:"Statues are very dangerous...they drain your Gems!",47:"Yikes!  A trap has made many of the wall sections invisible!",52:"A Solid Wall blocks your way.",58:"Magic has been released is this chamber!",61:"New Walls have magically appeared!",65:"You pushed a big Boulder!",66:"You hit a Electrified Wall!  You lose one Gem.",75:"You grabbed a Rope.",81:"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"};V.Rect.cache=!0;const q=new V({width:et,height:tt,fontFamily:"ModernDOS9x16, monospace",bg:"blue",fg:"white",fontSize:32}),P={x:0,y:0,bg:"black",fg:"white"};function K(e,t=P.y){P.x=e,P.y=t}function _e(e){typeof e=="number"&&(e=H[e]),P.bg=e}function oe(e){typeof e=="number"&&(e=H[e]),P.fg=e}function We(e){return q.drawText(P.x,P.y,`%c{${P.fg}}%b{${P.bg}}`+e)}function k(e){P.y+=We(e)}function Z(e,t,i){K(e,t),k(i)}function Oe(){q.clear()}function at(e,t){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=H[e]),typeof t=="number"&&(t=H[t]),[e,t]}function re(e,t,i,a=P.fg,s=P.bg){[a,s]=at(a,s),q.draw(e,t,i,a,s)}function Bt(e,t,i,a=P.fg,s=P.bg){var o;[a,s]=at(a,s),s=s??((o=q._data[`${e},${t}`])==null?void 0:o[4])??O[r.Floor],q.draw(e,t,i,a,s)}function N(e,t,i,a=P.fg,s=P.bg){typeof a=="number"&&a>15&&(a=Date.now()%500<250?a:s),typeof s=="number"&&(s=H[s%16]),typeof a=="number"&&(a=H[a%16]),q.drawText(e,t,`%c{${a}}%b{${s}}`+i)}function Dt(){return q.getContainer()}const Fe=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},L=e=>Fe(e,"error"),zt=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,ae=()=>({action:()=>{},after:()=>{},before:()=>{}}),I={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},Gt={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,a){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(a)||a<0||a>1)){L(I.INVALID_VALUE_NUMBER);return}this[i]=a}else L(I.INVALID_PROPERTY)},vibrate:function(i=.75,a=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,a);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:a,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,a,s,o,X){s&&o%2===X?(this.pressed[`${i}${a}`]||(this.pressed[`${i}${a}`]=!0,this.axesActions[a][i].before()),this.axesActions[a][i].action()):this.pressed[`${i}${a}`]&&o%2===X&&(delete this.pressed[`${i}${a}`],this.axesActions[a][i].after())},checkStatus:function(){let i={};const a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(a.length){if(i=a[this.id],i.buttons)for(let s=0;s<this.buttons;s++)i.buttons[s].pressed===!0?(this.pressed[`button${s}`]||(this.pressed[`button${s}`]=!0,this.buttonActions[s].before()),this.buttonActions[s].action()):this.pressed[`button${s}`]&&(delete this.pressed[`button${s}`],this.buttonActions[s].after());if(i.axes){const s=i.axes.length%2;for(let o=0;o<this.axes*2;o++){const X=i.axes[o+s].toFixed(4),h=Math.floor(o/2);this.axeValues[h][o%2]=X,this.triggerDirectionalAction("right",h,X>=this.axeThreshold[0],o,0),this.triggerDirectionalAction("left",h,X<=-this.axeThreshold[0],o,0),this.triggerDirectionalAction("down",h,X>=this.axeThreshold[0],o,1),this.triggerDirectionalAction("up",h,X<=-this.axeThreshold[0],o,1)}}}},associateEvent:function(i,a,s){if(i.match(/^button\d+$/)){const o=parseInt(i.match(/^button(\d+)$/)[1]);o>=0&&o<this.buttons?this.buttonActions[o][s]=a:L(I.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][s]=a;else if(i==="select")this.buttonActions[8][s]=a;else if(i==="r1")this.buttonActions[5][s]=a;else if(i==="r2")this.buttonActions[7][s]=a;else if(i==="l1")this.buttonActions[4][s]=a;else if(i==="l2")this.buttonActions[6][s]=a;else if(i==="power")this.buttons>=17?this.buttonActions[16][s]=a:L(I.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const o=i.match(/^(up|down|left|right)(\d+)$/),X=o[1],h=parseInt(o[2]);h>=0&&h<this.axes?this.axesActions[h][X][s]=a:L(I.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const o=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][o][s]=a}return this},on:function(i,a){return this.associateEvent(i,a,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,a){return this.associateEvent(i,a,"after")},before:function(i,a){return this.associateEvent(i,a,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=ae();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:ae(),left:ae(),right:ae(),up:ae()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},$={gamepads:{},axeThreshold:[1],isReady:zt(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){L(I.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const a=this.getGamepads(),s=Object.keys(a);for(let o=0;o<s.length;o++)a[s[o]].set("axeThreshold",this.axeThreshold)}}else L(I.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys($.gamepads);$.onBeforeCycle();for(let i=0;i<t.length;i++)$.gamepads[t[i]].checkStatus();$.onAfterCycle(),t.length>0&&e($.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Fe(I.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=Gt.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Fe(I.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:L(I.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:L(I.UNKNOWN_EVENT);break}return this}};$.init();let be=!1,Q=null;var p=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.PrevLevel=12]="PrevLevel",e[e.Teleport=13]="Teleport",e))(p||{});const Pe={1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,10:!1,11:!1,12:!1,13:!1},J={1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,10:!1,11:!1,12:!1,13:!1},Nt={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:13,T:13,")":10,PageDown:12,PageUp:11},Ut={button0:9,button1:13,button4:12,button5:11,up:1,down:2,left:4,right:3,button12:1,button13:2,button14:4,button15:3};function Yt(){Q||$.on("connect",e=>{if(!Q){Q=e,Q.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(Ut))Q.before(t,()=>{be=!0,Pe[i]=!0}),Q.after(t,()=>{Pe[i]=!1})}})}function $t(e){be=!0;const t=Nt[e.key];t&&(e.preventDefault(),J[t]=!0)}function Kt(){Yt(),window.addEventListener("keydown",$t)}function ye(){be=!1;for(const e in J)J[e]=!1}function st(){return be}function Ht(){const e={};for(const t in J){const i=t;e[i]=J[i]||Pe[i],J[i]=!1}return e}const se=new(window.AudioContext||window.webkitAudioContext),qt=.005;function _(e,t,i=1){const a=se.createOscillator(),s=se.createGain();return a.type="sine",a.frequency.value=e,a.connect(s),s.connect(se.destination),a.start(),s.gain.setValueAtTime(i*qt,se.currentTime),s.gain.exponentialRampToValueAtTime(.001,se.currentTime+t/1e3),new Promise(o=>{setTimeout(()=>{a.stop(),o()},t)})}function T(e=0){return e<=0?new Promise(t=>{requestAnimationFrame(()=>t())}):new Promise(t=>{setTimeout(()=>t(),e)})}function Re(){for(let e=1;e<=65;e++)_(Math.random()*1e3+1e3,1e3)}async function ze(){for(let e=150;e>=35;e--)await _(e,1)}async function Ge(){await _(400,120,5),await T(10),await _(700,120,5),await T(10)}async function we(){for(let e=1;e<=23;e++)_(Math.random()*550+350,120);await T(120);for(let e=1;e<=30;e++)_(Math.random()*50+150,50)}async function Vt(){for(let e=10;e<=90;e++)await _(e,15,100)}async function Ne(){for(let e=1;e<65;e++)_(b.getUniformInt(0,1e3)+1e3,16,10);await T(50)}async function Ue(){for(let e=1;e<=2e3;e++)_(b.getUniformInt(0,e*2+200)+e,50)}async function Zt(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=b.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)_(b.getUniformInt(0,4e3)+3e3,16,10)}else await T(b.getUniformInt(0,29))}function rt(){oe(14),_e(l.Blue),Z(71,1,"Score"),Z(71,4,"Level"),Z(71,7,"Gems"),Z(71,10,"Whips"),Z(69,13,"Teleports"),Z(71,16,"Keys")}function M(){const e=n.whipPower>2?`${n.whips}+${n.whipPower-2}`:n.whips.toString(),t=4,i=8,a=!n.paused&&n.gems<10?l.Red|16:l.Red;N(70,2,j((n.score*10).toString(),t+1,i),l.Red,l.Grey),N(70,5,j(n.level.toString(),t,i),l.Red,l.Grey),N(70,8,j(n.gems.toString(),t,i),a,l.Grey),N(70,11,j(e,t,i),l.Red,l.Grey),N(70,14,j(n.teleports.toString(),t,i),l.Red,l.Grey),N(70,17,j(n.keys.toString(),t,i),l.Red,l.Grey)}function Ye(){Oe(),nt(),rt(),U(),M()}function nt(){oe(7),_e(0);for(let e=ce-1;e<=ie+1;e++)re(e,0,"▒"),re(e,Xe+1,"▒");for(let e=he-1;e<=Xe+1;e++)re(0,e,"▒"),re(ie+1,e,"▒")}async function f(e,t=!1){if(t){if(n.foundSet.has(e))return;n.foundSet.add(e)}if(typeof e=="number"&&(e=it[e]),!!e){for(n.paused=!0,rt(),ye();!st();)Qt(e,b.getUniformInt(1,15)),await T(50);nt(),ye(),n.paused=!1}}function Qt(e,t,i){if(typeof e=="number"&&(e=it[e]),!e)return;const a=(ie-e.length)/2,s=Xe+1;i=i??l.Black,t=t??l.HighIntensityWhite,N(a,s,e,t,i)}function j(e,t,i){return e.padStart(t,w).padEnd(i,w)}class ot{constructor(t,i,a){Be(this,"ch");this.type=t,this.x=i,this.y=a,this.x=i,this.y=a,this.ch=me[t]}move(t,i){this.type===r.Player?we():this.type===r.Slow?this.ch=Math.random()>.5?"A":"Ä":this.type===r.Medium&&(this.ch=Math.random()>.5?"ö":"Ö"),this.x=t,this.y=i}kill(){_(200+200*this.type,25,100),this.x=-1,this.y=-1}getChar(){return this.type===r.Player?n.T[Me.Invisible]>0?w:me[this.type]:this.ch}getSpeed(){switch(this.type){case r.Player:return 30;case r.Slow:return 10*ee();case r.Medium:return 20*ee();case r.Fast:return 30*ee()}}}const jt=`
         ######                                #######          
         ##whip W W W                  ~~~~~   ewall##          
   3 3   #chest C C C                  #####   wall###   2  2   
         ##nugg * * *                  RRRRR   river##          
   3 3   ###gem + + +                  /////   forest#   2  2   
         ##door D D D                  ♣♣♣♣♣   tree###          
   3 3   ##tele T T T                  VVVVV   lava###   2  2   
         ###key K K K                  =====   pit####          
         #power Q Q Q                  XXXXX   block##          
     ##########                                ############     
                                                                
                              P                                 
                                                                
   ############                                 ##########      
         ###zap % % %                   0 0 0   rock##          
         ##slow S S S                   < [ | " kroz##          
   1 1   #speed F F F                           ######   G  G   
         #freez Z Z Z        B B B      U U U   tunnel          
   1 1   ###inv I I I      XXbombXXX            ######   G  G   
         ######            XG1 2 3GX    . . .   traps#          
   1 1   #amule ƒ ƒ ƒ      DZ/EWLCSV    & & &   show##   G  G   
         ##tome A A A                   E E E   quake#          
         ######                         T T T   ######          
`,Jt=`
//♣///////♣///♣////////♣////////♣//#the#lost#adventures#of#kroz#
//♣//////////////♣//♣////////♣////////♣///♣/♣♣/♣♣/♣/♣♣/♣♣♣♣♣♣♣/♣
♣###your#hut###////♣///♣/////////♣/////♣/♣♣//♣♣/♣♣/♣♣♣♣♣♣♣♣♣♣♣♣♣
/##           D---/////////♣//♣///♣//♣/♣/♣/♣/♣/♣/♣/♣♣♣♣♣♣♣###♣♣♣
/##  P ####  ##///-♣//♣//♣/----♣///♣////♣//♣//RRR/♣♣♣♣♣♣♣##L##♣♣
/##      K#**##/♣♣/-//--/♣-♣//♣--♣//♣//♣////RRRRR//♣♣♣♣♣♣♣#0#♣♣♣
♣##############/////--♣/--//♣////-///////♣////RRRRRRR/♣♣♣♣#!#♣♣♣
////♣♣///♣/♣♣///♣//♣//////////♣//♣---♣//♣////RRRRRR/♣♣/♣♣♣♣-♣♣♣♣
/♣//////♣/////♣////////♣///♣/////////--/////♣///RRRRR♣♣♣♣♣♣♣-♣♣♣
///////♣////////♣///////////////♣/////♣---/////RRRRR/♣/♣♣♣♣♣♣-♣♣
////♣/////♣♣♣//♣////♣/////♣//////♣////////-//♣/♣/RRRRRR♣/♣♣♣-♣♣♣
/////////♣♣♣♣♣///♣////♣////////♣///♣///////-//♣///RRRR♣//♣/-♣/♣/
♣//////♣//♣♣////♣////////♣//♣//////////♣///-♣////RRRRRR♣♣/♣-/♣/♣
//♣♣//////♣/###storage###///////♣--//♣♣///-////RRRRRRRRR/♣/♣-/♣/
////////♣///##WWW-WWW-W##/♣////--//-//♣♣/-///♣RRRRRRRRR/♣/♣/-/♣/
/♣////////♣/##W-WWW-WW---------//♣//-----//♣///RRRRRRRR♣♣//♣-♣//
♣/////♣/////#############♣///♣-/♣♣♣/♣/♣♣/♣////RRRRRRRR//♣/♣/-//♣
///♣////♣//////♣♣////♣////♣///-////♣/♣♣/♣///♣RRRRRRR/♣/♣//♣-/♣//
/♣///♣/////♣////♣///♣//♣//♣////------♣///♣////♣////♣//--/♣-♣♣//♣
♣//♣///♣/♣//♣/♣/♣///♣//♣/♣///♣////♣//------♣/♣//♣///♣-♣/--//♣/♣/
/♣///♣////♣//♣///♣////♣///♣//♣/♣////♣///♣/♣-----/♣♣/-/♣//♣/♣//♣/
♣//♣////♣/♣///♣//♣///♣/♣///♣//♣/////♣///♣/////♣/----♣♣//♣///♣//♣
#by#scott#miller#♣///♣/////♣/♣////♣////♣////♣//♣//♣/♣//♣/♣♣///♣ü
`,ei=`
XXXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXXXX### P ###X
XXXXX##XXXXXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXXXXXXXXXXXXXX##  ##XX
XXXXXXXXXXXXXXX&-XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXX#XXXXX#  #XX
#XXXXXXXXXXXXXXXX-XXXX--XXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXX  XXXX
XXXXXXXXX#XXXXXXXX-XX-XX-XXXXXXX#XXXXXXXXXXXXXXXXXXXXX##   #XXXX
XXX#XXXXXXXXXXX#XXX--XX#X--XXXXXXXXX#XXXXX#XXXX##XXXX##  ##XXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXX##XX##XXXXXX
XXXXXXXXXXX##XXXXXXXXXXXXX#XX-XXXXXXXXXXXXXXXXXXXXX##  ##XXXX##X
XXXXX#XXXXXXXXXXXX#XXXXXXXXXXX--XXXX##XXXXXX#XXXXX##  ##XXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXX-#XXXXXXXXXXXXX      XXXX#XXXXXX
XXXXX##XXXXXX#XXXXXXX#XXXXXXXXXX#X##XXXXX       XXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXX##XXX#   0    XXXXXXXX!XXXXXXXXXXXXX
XXXXXXXXXXXXXX#XXXXXXX===XXXXXXX#  XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXX#XXXXXXXXXXXX=======XXXXX  XXXXXXXX#XXXXX#XXXXXXXXXX##XXX
XXXXXXXXXXXXXXXXX=========       XX=====XXXXXXXXXXXXX#XXXXXXXXXX
XX#XXXXXXX##XXX==========  ===========XXXXXXXXXXXXXXXXX#XXXXXXXX
XXXXXXXXXXXXXX==========  ===========XXXXXXXXX##XXXXXXXXXXXXXXXX
XXXX#XXXXXXX             ===========XX#XXXXXXXXXXXXXXXXXXXXX#XXX
XXXXXXXX    XX#XXXX================XXXXXXXX#XXXXXX#XXXXXXXXXXXXX
XXX     XX#XXXXXXXXXX===========XXXXXXXXXXXXXXXXXXXX##the#secret
XXXXXXXXXXXXXXXXXX#XXXXXX=====XXXXXXXXXX#XXXXXXXXXXX#tunnel#into
X  XX#XXXXXX##XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXX#the#kingdom
LLXXXXXX#XXXXXXXXXXXXX#XXXXXXXXXXXXXX#4XXXXXX##XXXXX#####of#kroz
`,ti=`
LXXX2    2     2        2   2  2  2   2    2 2    2  2    2    +
+XXX  2     2      2        2          2  2    2     2      XXX 
 XXX2   2      2       2  2     2   2       2      2  2  2  XTX 
+XXX          2  2           2         2  2     2   2       XXX 
 XXX   2   2         2   2     2    2      2  2        2     2  
+XXX 2                                                          
 XXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  2  2 
+XXX2    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
 XXX  2  XXX2                    W                   2XXX 2     
+XXX   2 XXX  2                FFFFF               2  XXX   2 2 
 XXX2 2  XXX                   F111F                  XXX       
+XXX2    XXX+   3  3        W  F1P1F  W       3  3   +XXX  2    
XXXX   2 XXX                   F111F                  XXX 2    2
WXXX 2   XXX  2                FFFFF               2  XXX   2   
WXXX2    XXX2                    W                   2XXX    2  
WXXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX 2     
WXXX   2 XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
WXXX2                                                      2    
WXXX    2   2      2   2     2    2   2    2    2      2      2 
XXXX 2    2   2 2    2    2     2       2     2     2     2 XXX 
XXXX2  2    2  2  2      2    2     2  2  2  2    2         XTX 
XXXX 2   2 2    2   2  2    2   2       2       2   2   2   XXX 
CXXX   2    2  2 2    2 2     2    2  2  2   2    2  2    2    +`,ii=`
                                   1                        1  &
 ####shop####         1                                       ‘ 
 ##++++++++##                            1                      
 ##++++++++##                                 ##4444444444444444
 #####OO#####                                 ##   1   1   1  1 
                          ###spells###        ## 1 1  1  1   1  
     1                    ##ñEF‘Tò @##     1  ##    1   1  1  1 
                          ##I@ ‘S  T##        ##11   1 1    1   
                     1    ##ZóT‘  ] ##        ##   1   1 1  1 1 
                          #########X##        ## 1   1  1  1 1  
@@         1                                  ##1 1    1  1    1
1@W                            P              ## 1  1 1 1  1 1 1
1@W                                           ##1  11  1 1   1  
1@W   1                                     1 ##  1   1     1   
1@W                 1                         ##1    1  1  1  1 
1@W                                     #.#OXX## 1 1  1   1    1
1@W          ###lair#of#kroz###         #.#XOX##1    1  1   1 1 
1@W          77------------ôK##         #.#XXO##  1 1  1   1   1
1@W          ####1111111111####         #.#XOX## 1 1  1 1 1   1 
1@W    1      Z##############           #H#X!X##1  1 1  1  1 1  
1@W                                     ######## 1   1 1  1   1 
1@@@@@@@@@@@@@@@                  ########@       1   1   1 1  1
111111111111111@                1 ##LLWWWD@         1   1    1 1
`,ai=`
WFP I        C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
XX############################################################CC
             C3+3+3+3+3+3+3+2+2+2+2+2+2+2+2+1+1+1+1+1+1+1+1 W   
  ##############################################################
  #     1        +              1     +                  X      
 1#I##################################################   #   #  
  #X #XX    X    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#1  #   #+ 
  # X#XX XX X XX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX#   # 1 #  
+ #X #X +XX  +X  XXLX  W + + + + + T + + + + + W   XX#   #   # 1
  # X#X XXXXXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  X# 1 #+  #  
1 #X #X   X     +XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX X#   #   #  
  # X#XXX X ####################################### X#  +#1  #  
  #X #XXXIX     1   +    1   +   1  +               X#   #   #  
  # X#X   ###################################XXX######  1#   #  
  #X #X #####################################XXX######   #   #1 
 1# X#X     1 +1 +1 +1 +1 +1++++                     #+  #  1#  
  #X ########################################XXX#### #   #   # +
  # XXXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXWWWXXX# # 1 #  +#  
  # XXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXCXXXXXXXXXX#1#   #1  #  
 +# ################################################ #   #   # 1
  #    1+++1            C           1+++1            #       #  
1 ############################################################  
         1       +            1         +               1       `,si=`
W W W W             2 2 2 2 2  C  2 2 2 2 2              W W W W
XXXXXXXXXXXXXXXXXXX###########   ###########XXXXXXXXXXXXXXXXXXXX
 1           1                               1                  
                                    1            XX         1   
       1            1                           XXXX            
#        XX                    +                 XX            #
##      XXXX  1                +          1          1        ##
T##      XX               2    +    2                        ##T
T1##                       W   +   W                        ##1T
T########X                 WX     XW             1    X########T
.        X                2WX  P  XW2                 X        .
T########X         1       WX     XW                  X########T
T1##                       W   +   W         1              ##1T
T##                       2    +    2                        ##T
##   1                         +                      XX      ##
#       XX      1              +                 1   XXXX     1#
       XXXX                 ##   ##                   XX        
1       XX                 ##     ##     1        1           1 
                    1#######       ########                     
    1         ########11111  +++++  111111########              
WW     ########+++++        #######         WWWWW########1    WW
########                     2 2 2                      ########
L2  +  X                                                X  +  2L`,Se=[jt,Jt,ei,ii,ti,ai,si],ge=1e3;var Me=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e))(Me||{});const n=Xt();function Xt(){return{player:new ot(r.Player,0,0),entities:[],PF:[],foundSet:new Set,T:[0,0,0,0,4,5,6,7,0,0],level:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2,actionActive:!1,paused:!1,done:!1}}function ri(){Object.assign(n,Xt())}async function Le(){const e=Se[n.level];li(e),n.T=n.T.map(()=>0),U(),M(),await f("Press any key to begin this level.")}async function lt(){n.level++,n.level%=Se.length,Le()}async function ni(){n.level--,n.level%=Se.length,Le()}async function oi(e){var X,h;if(e.x===-1||e.y===-1||n.PF[e.x][e.y]!==e.type){e.kill();return}let t=0,i=0;n.player.x<e.x&&(t=-1),n.player.x>e.x&&(t=1),n.player.y<e.y&&(i=-1),n.player.y>e.y&&(i=1);const a=e.x+t,s=e.y+i;if(a<0||a>=B||s<0||s>=D)return;const o=((h=(X=n.PF)==null?void 0:X[a])==null?void 0:h[s])??r.Floor;switch(o){case r.Block:case r.MBlock:case r.ZBlock:case r.GBlock:n.PF[e.x][e.y]=r.Floor,n.PF[a][s]=r.Floor,e.kill(),n.score+=o,_(800,18),_(400,20);break;case r.Floor:case r.TBlock:case r.TRock:case r.TGem:case r.TBlind:case r.TGold:case r.TWhip:case r.TTree:g(e,a,s);break;case r.Player:n.gems--,n.PF[e.x][e.y]=r.Floor,e.kill();break;default:g(e,e.x,e.y);break}}async function $e(e){e===r.Player&&await Xi();for(let t=0;t<n.entities.length;t++){const i=n.entities[t];e&&i.type!==e||i.x===-1||i.y===-1||await oi(i)}}async function Xi(){const e=Ht();if(e[p.FreeItems]&&await W(p.FreeItems),e[p.NextLevel]&&await W(p.NextLevel),e[p.PrevLevel]&&await W(p.PrevLevel),e[p.North]&&e[p.West])return await W(p.Northwest);if(e[p.North]&&e[p.East])return await W(p.Northeast);if(e[p.South]&&e[p.West])return await W(p.Southwest);if(e[p.South]&&e[p.East])return await W(p.Southeast);if(e[p.North])return await W(p.North);if(e[p.South])return await W(p.South);if(e[p.West])return await W(p.West);if(e[p.East])return await W(p.East);if(e[p.Southeast])return await W(p.Southeast);if(e[p.Southwest])return await W(p.Southwest);if(e[p.Northeast])return await W(p.Northeast);if(e[p.Northwest])return await W(p.Northwest);if(e[p.Whip])return await W(p.Whip);if(e[p.Teleport])return await W(p.Teleport)}async function W(e){if(n.actionActive)return;n.actionActive=!0;let t=!1;switch(e){case p.FreeItems:n.gems=1/0,n.whips=1/0,n.teleports=1/0,n.keys=1/0,M();break;case p.NextLevel:await lt();break;case p.PrevLevel:await ni();break;case p.North:await z(0,-1),t=!0;break;case p.South:await z(0,1),t=!0;break;case p.West:await z(-1,0),t=!0;break;case p.East:await z(1,0),t=!0;break;case p.Southeast:await z(1,1),t=!0;break;case p.Southwest:await z(-1,1),t=!0;break;case p.Northeast:await z(1,-1),t=!0;break;case p.Northwest:await z(-1,-1),t=!0;break;case p.Whip:n.whips<1?Ge():(n.whips--,await ci()),t=!0;break;case p.Teleport:n.teleports<1?await Ge():(n.teleports--,await ht()),t=!0;break}return n.actionActive=!1,t}function li(e){n.entities=[];const t=e.split(`
`).filter(i=>i.length>0);for(let i=0;i<t.length;i++){const a=t[i];for(let s=0;s<a.length;s++){const o=a.charAt(s)??w,X=Lt[o];switch(n.PF[s]=n.PF[s]||[],n.PF[s][i]=X??o,X){case r.Player:n.player.x=s,n.player.y=i;break;case r.Slow:case r.Medium:case r.Fast:n.entities.push(new ot(X,s,i));break}}}O[r.Floor][0]=l.White,O[r.Floor][1]=l.Black,O[r.Gem]=[b.getUniformInt(1,16),null]}async function z(e,t){var o,X,h,c,u,y,v,F;const i=n.player.x+e,a=n.player.y+t;if(i<0||i>B||a<0||a>D)return;const s=((X=(o=n.PF)==null?void 0:o[i])==null?void 0:X[a])||r.Floor;switch(s){case r.Floor:case r.Stop:g(n.player,i,a);break;case r.Slow:case r.Medium:case r.Fast:Te(i,a),g(n.player,i,a);break;case r.Block:R(s),await f(r.Block,!0);break;case r.Whip:Re(),n.whips++,R(s),g(n.player,i,a),await f(r.Whip,!0);break;case r.Stairs:if(n.level===Se.length-1){g(n.player,i,a),await ui();return}R(s),g(n.player,i,a),await f(r.Stairs,!0),lt();break;case r.Chest:if(n.keys>0){n.keys--;const d=b.getUniformInt(2,5),m=b.getUniformInt(2,5);n.whips+=d,n.gems+=m,R(s),g(n.player,i,a),await f(`You found ${m} gems and ${d} whips inside the chest!`)}break;case r.SlowTime:n.T[6]=0,n.T[4]=ge,R(s),g(n.player,i,a),await f(s,!0);break;case r.Gem:n.gems++,R(s),g(n.player,i,a),f(s,!0);break;case r.Invisible:n.T[5]=ge,R(s),g(n.player,i,a),await f(s,!0);break;case r.Teleport:n.teleports++,R(s),g(n.player,i,a),f(s,!0);break;case r.Key:Re(),n.keys++,g(n.player,i,a),await f(s,!0);break;case r.Door:n.keys<1?(_(Math.random()*129+30,150,100),await f(s)):(Vt(),n.keys--,R(s),g(n.player,i,a),await f("The Door opens!  (One of your Keys is used.)"));break;case r.Wall:Ue(),R(s),await f(s,!0);break;case r.River:R(s),await f(s,!0);break;case r.SpeedTime:n.T[4]=0,n.T[6]=ge,R(s),g(n.player,i,a),await f(s,!0);break;case r.Trap:R(s),g(n.player,i,a),await f(s,!0),await ht();break;case r.Power:n.whipPower++,R(s),g(n.player,i,a),await f(s,!0);break;case r.Tree:case r.Forest:R(s),await ze(),await f(s,!0);break;case r.Bomb:{g(n.player,i,a);const d=4,m=Math.max(n.player.x-d,ce),x=Math.min(n.player.x+d,ie),S=Math.max(n.player.y-d,he),C=Math.min(n.player.y+d,Xe);for(let E=m;E<=x;E++)for(let A=S;A<C;A++){const ue=((c=(h=n.PF)==null?void 0:h[E])==null?void 0:c[A])??r.Floor;[0,1,2,3,4,13,16,19,28,29,30,32,32,33,35,36,37,38,39,43,45,48,49,50,51,64,67,68,69,70,71,72,73,74,224,225,226,227,228,229,230,231].includes(ue)&&(ue>=1&&ue<=4&&Te(E,A),n.PF[E][A]=r.Floor)}await f(s,!0);break}case r.Lava:n.gems-=10,R(s),g(n.player,i,a),await f(s,!0);break;case r.Pit:g(n.player,i,a),n.gems=-1,await f(s);break;case r.Tome:R(s),await f(s),await f("Congratulations, Adventurer, you finally did it!!!");break;case r.Nugget:Re(),g(n.player,i,a),await f(s,!0);break;case r.Freeze:n.T[7]=ge,g(n.player,i,a),await f(s,!0);break;case r.Tunnel:g(n.player,i,a),await f(s,!0);break;case r.Quake:g(n.player,i,a);for(let d=0;d<2500;d++)_(b.getUniformInt(0,d),5,100),d%25===0&&await T();await T(50);for(let d=0;d<50;d++){do{const m=b.getUniformInt(0,B),x=b.getUniformInt(0,D),S=((y=(u=n.PF)==null?void 0:u[m])==null?void 0:y[x])??r.Floor;if([0,1,2,3,5,7,8,9,10,11,15,16,26,32,33,37,39,67,224,225,226,227,228,229,230,231].includes(S)){n.PF[m][x]=r.Rock,Y(m,x,r.Rock);break}}while(Math.random()>.01);for(let m=0;m<50;m++)_(b.getUniformInt(0,200),50,100);await T(50)}for(let d=2500;d>50;d--)_(b.getUniformInt(0,d),5,100),d%25===0&&await T();await f(s,!0);break;case r.IBlock:case r.IDoor:await f(s,!0);break;case r.Zap:{g(n.player,i,a);let d=0,m=0;for(;d<500&&m<40;){d++;const x=b.getUniformInt(0,n.entities.length),S=n.entities[x];!S||S.x===-1||S.y===-1||(n.PF[S.x][S.y]=r.Floor,m++)}n.score+=Math.floor(m/3+2),U(),M(),await f(s,!0);break}case r.Create:case r.Generator:R(s),g(n.player,i,a),await f(s,!0);break;case r.MBlock:R(s),await f(s,!0);break;case r.ShowGems:g(n.player,i,a),await f(s);break;case r.Tablet:case r.BlockSpell:R(s),g(n.player,i,a),await f(s,!0);break;case r.Chance:{R(s);const d=b.getUniformInt(14,18);n.gems+=d,g(n.player,i,a),await f(`You found a Pouch containing ${d} Gems!`);break}case r.Statue:g(n.player,i,a),await f(s);break;case r.WallVanish:g(n.player,i,a),await f(s);break;case r.K:case r.R:case r.O:case r.Z:g(n.player,i,a);break;case r.OWall1:case r.OWall2:case r.OWall3:Ue(),await f(r.OWall1,!0);break;case r.OSpell1:case r.OSpell2:case r.OSpell3:g(n.player,i,a),await f(r.OSpell1,!0);break;case r.CSpell1:case r.CSpell2:case r.CSpell3:g(n.player,i,a),await f(r.CSpell1,!0);break;case r.Rock:{let d=!1;const m=n.player.x+e*2,x=n.player.y+t*2;if((m<0||m>B||x<0||x>D)&&(d=!0),!d)switch(((F=(v=n.PF)==null?void 0:v[m])==null?void 0:F[x])??r.Floor){case r.Floor:d=!1,await Ne(),n.PF[m][x]=r.Rock,g(n.player,i,a),U(),await f(r.Rock,!0);break;case r.Stairs:d=!1,await Ne(),g(n.player,i,a),U(),await f(r.Rock,!0);break;default:d=!1;break}d&&await ze();break}case r.EWall:R(s),n.gems--,Zt(),await f(r.EWall,!0);break;case r.CWall1:case r.CWall2:case r.CWall3:g(n.player,i,a);break;case r.Trap2:case r.Trap3:case r.Trap4:case r.Trap5:case r.Trap6:case r.Trap7:case r.Trap8:case r.Trap9:case r.Trap10:case r.Trap11:case r.Trap12:case r.Trap13:g(n.player,i,a);break;case r.TBlind:case r.TBlock:case r.TGem:case r.TGold:case r.TRock:case r.TTree:case r.TWhip:g(n.player,i,a);break;case r.Rope:g(n.player,i,a),await f(r.Rope,!0);break;case r.Message:break;case r.ShootRight:break;case r.ShootLeft:break;case r.DropRope:case r.DropRope2:case r.DropRope3:case r.DropRope4:case r.DropRope5:g(n.player,i,a);break;case r.Amulet:g(n.player,i,a);break}}async function Te(e,t){var a,s;const i=((s=(a=n.PF)==null?void 0:a[e])==null?void 0:s[t])??r.Floor;if(n.PF[e][t]=r.Floor,i===r.Slow||i===r.Medium||i===r.Fast)for(let o=0;o<n.entities.length;o++){const X=n.entities[o];X.x===e&&X.y===t&&(n.gems+=X.type,await _(130,50),X.kill())}}function g(e,t,i){const a=e.x,s=e.y;e.move(t,i),n.PF[a][s]=r.Floor,n.PF[t][i]=e.type,U()}async function ci(){const e=n.player.x,t=n.player.y;_(70,50*8,100),t>0&&e>0&&await G(e-1,t-1,"\\"),e>0&&await G(e-1,t,"-"),t<D&&e>0&&await G(e-1,t+1,"/"),t<D&&await G(e,t+1,"❘"),t<D&&e<B&&await G(e+1,t+1,"\\"),e<B&&await G(e+1,t,"-"),t>0&&e<B&&await G(e+1,t-1,"/"),t>0&&await G(e,t-1,"❘")}async function ct(){for(let e=0;e<80;e++)Y(n.player.x,n.player.y,r.Player,b.getUniformInt(0,15),b.getUniformInt(0,8)),await T(1),_(e/2,1e3,30)}async function ht(){var e,t,i,a;await ct(),n.PF[n.player.x][n.player.y]=r.Floor,Y(n.player.x,n.player.y);for(let s=0;s<700;s++){const o=b.getUniformInt(0,B),X=b.getUniformInt(0,D),h=((t=(e=n.PF)==null?void 0:e[o])==null?void 0:t[X])??r.Floor;[r.Floor].indexOf(h)>-1&&(Y(o,X,"☺",b.getUniformInt(0,15),b.getUniformInt(0,7)),await _(20,10,100),Y(o,X,h))}for(;;){const s=b.getUniformInt(0,B),o=b.getUniformInt(0,D);if((((a=(i=n.PF)==null?void 0:i[s])==null?void 0:a[o])??r.Floor)===r.Floor){n.PF[s][o]=r.Player,n.player.x=s,n.player.y=o,U();break}}}function U(){for(let t=0;t<n.PF.length;t++)for(let i=0;i<n.PF[t].length;i++){const a=n.PF[t][i]||r.Floor;a!==r.Player&&(a===r.Slow||a===r.Medium||a===r.Fast||Y(t,i,n.PF[t][i]||r.Floor))}const e=O[r.Floor][1];for(let t=0;t<n.entities.length;t++){const i=n.entities[t];i.x===-1||i.y===-1||Y(i.x,i.y,i.getChar(),O[i.type][0],e)}Y(n.player.x,n.player.y,n.player.getChar(),O[n.player.type][0],e)}function Y(e,t,i=r.Floor,a,s){var X,h;let o;switch(typeof i=="number"?(o=me[i]??i??me[r.Floor],a=a??((X=O[i])==null?void 0:X[0])??O[r.Floor][0],s=s??((h=O[i])==null?void 0:h[1])??O[r.Floor][1]):i>="a"&&i<="z"?(o=i.toUpperCase(),a=a??l.HighIntensityWhite,s=s??l.Brown):o=i,i){case r.Stairs:a=typeof a=="number"&&!n.paused?a|16:a;break}re(e+ce,t+he,o,a,s)}async function G(e,t,i){var s,o;const a=((o=(s=n.PF)==null?void 0:s[e])==null?void 0:o[t])??r.Floor;switch(Bt(e+ce,t+he,i,H[b.getUniformInt(0,15)]),a){case r.Slow:case r.Medium:case r.Fast:Te(e,t);break;case r.Block:case r.Forest:case r.Tree:case r.Message:{const X=n.whipPower;6*Math.random()<X?(_(130,50),n.PF[e][t]=r.Floor):(_(130,25),_(90,50));break}case r.Invisible:case r.SpeedTime:case r.Trap:case r.Power:case r.Generator:case r.K:case r.R:case r.O:case r.Z:n.PF[e][t]=r.Floor,_(400,50);break;case r.Quake:case r.IBlock:case r.IWall:case r.IDoor:case r.Trap2:case r.Trap3:case r.Trap4:case r.ShowGems:case r.BlockSpell:case r.Trap5:case r.Trap6:case r.Trap7:case r.Trap8:case r.Trap9:case r.Trap10:case r.Trap11:case r.Trap12:case r.Trap13:case r.Stop:n.PF[e][t]=r.Floor;break;case r.Wall:case r.Statue:case r.Rock:case r.ZBlock:case r.GBlock:case r.MBlock:}M(),await T(10)}function R(e){switch(e){case r.Slow:case r.Medium:case r.Fast:n.score+=e;break;case r.Block:case r.Wall:case r.River:case r.Tree:case r.Forest:case r.MBlock:case r.OWall1:case r.OWall2:case r.OWall3:case r.EWall:n.score>2&&(n.score-=2);break;case r.Whip:case r.SlowTime:case r.Bomb:n.score++;break;case r.Stairs:n.score+=n.level*5;break;case r.Chest:n.score+=10+Math.floor(n.level/2);break;case r.Gem:n.score+=Math.floor(n.level/2)+1;break;case r.Invisible:n.score+=25;break;case r.Teleport:case r.Freeze:case r.Door:n.score+=2;break;case r.SpeedTime:case r.Power:n.score+=5;break;case r.Trap:n.score>5&&(n.score-=5);break;case r.Lava:n.score>100&&(n.score+=100);break;case r.Tome:n.score+=5e3;break;case r.Tablet:n.score+=n.level+2500;break;case r.Chance:n.score+=100;break}M()}async function hi(){N(ie/2-7,0,"You have died.",l.Black,l.Red),await f("Press any key to continue.",!1),n.done=!0}async function ui(){await we(),await T(200),await we(),await T(200),await we(),await f("Oh no, something strange is happening!"),await f("You are magically transported from Kroz!");const e=n.gems=isFinite(n.gems)?n.gems:150,t=n.whips=isFinite(n.whips)?n.whips:20,i=n.teleports=isFinite(n.teleports)?n.teleports:10,a=n.keys=isFinite(n.keys)?n.keys:5;await f("Your Gems are worth 100 points each...");for(let s=0;s<e;s++)n.gems--,n.score+=10,M(),await _(s*8+100,20);await f("Your Whips are worth 100 points each...");for(let s=0;s<t;s++)n.whips--,n.score+=10,M(),await _(s*8+100,20);await f("Your Teleport Scrolls are worth 200 points each...");for(let s=0;s<i;s++)n.teleports--,n.score+=20,M(),await _(s*8+100,20);await f("Your Keys are worth 10,000 points each....");for(let s=0;s<a;s++)n.keys--,n.score+=1e3,M(),await _(s*8+100,20);Oe(),K(25,3),_e(l.Blue),k("ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"),K(15,5),k("   Carefully, you place the ancient tome on your table and open"),k(" to the first page.  You read the book intently, quickly"),k(" deciphering the archaic writings."),k("   You learn of Lord Dullwit, the once powerful and benevolent"),k(" ruler of Kroz, who sought wealth and education for his people."),k(" The magnificent kingdom of Kroz was once a great empire, until"),k(" it was overthrown by an evil Wizard, who wanted the riches of"),k(" Kroz for himself."),k("   Using magic beyond understanding, the Wizard trapped Lord"),k(" Dullwit and his people in a chamber so deep in Kroz that any"),k(" hope of escape was fruitless."),k("   The Wizard then built hundreds of deadly chambers that would"),k(" stop anyone from ever rescuing the good people of Kroz."),k("   Once again your thoughts becomes clear:  To venture into the"),k(" depths once more and set free the people of Kroz, in:"),k(""),await f("Press any key, Adventurer."),n.done=!0}function ee(){return n.T[4]>0?.1:n.T[6]>0?100:1}const pi={type:r.Player,getSpeed:()=>30},fi={type:r.Slow,getSpeed:()=>10*ee()},di={type:r.Medium,getSpeed:()=>20*ee()},gi={type:r.Fast,getSpeed:()=>30*ee()};async function ut(){const e=new Mt.Speed;Kt(),await wi(),Le(),Ye(),await ct(),e.add(pi,!0),e.add(fi,!0),e.add(di,!0),e.add(gi,!0),Ye();const t=80;let i=0,a=0;const s=async o=>{if(n.gems<0){await hi(),Ke();return}if(n.done){Ke();return}if(i+=o-a,a=o,n.T=n.T.map(X=>X>0?X-1:0),i>t&&(i%=t,!n.paused)){const X=e.next();await $e(r.Player),n.T[Me.FreezeTime]<1&&await $e(X.type),U(),M()}requestAnimationFrame(s)};requestAnimationFrame(s)}async function wi(){for(_e(1),K(1,9),oe(11),k("  In your search for the priceless Amulet within the ancient Caverns of Kroz,"),k("  you have stumbled upon a secret passage leading deep into the Earth.   With"),k("  your worn lantern you descend into the misty depths,  sweat beading on your"),k("  forehead as you realize the peril that awaits.   If this is really the path"),k("  leading into the great underground caverns you'll find unimaginable wealth."),K(23),k("But only if you can reach it alive!"),K(27,25),oe(12),We("Press any key to continue."),ye();!st();)K(34,3),oe(b.getUniformInt(0,16)),We("CAVERNS OF KROZ"),await T(50),await T(100);ye()}function Ke(){Oe(),ri(),ut()}window.addEventListener("DOMContentLoaded",()=>{const e=Dt();document.getElementById("app").appendChild(e),ut()});
