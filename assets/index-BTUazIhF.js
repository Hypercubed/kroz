var pi=Object.defineProperty;var di=(e,t,i)=>t in e?pi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var mt=(e,t,i)=>di(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();const Ie=23283064365386963e-26;class tt{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*Ie,t=t*69069+1>>>0,this._s1=t*Ie,t=t*69069+1>>>0,this._s2=t*Ie,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*Ie;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let n=Math.max(t,i),a=Math.min(t,i);return Math.floor(this.getUniform()*(n-a+1))+a}getNormal(t=0,i=1){let n,a,o;do n=2*this.getUniform()-1,a=2*this.getUniform()-1,o=n*n+a*a;while(o>1||o==0);let l=n*Math.sqrt(-2*Math.log(o)/o);return t+l*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],n=t.slice();for(;n.length;){let a=n.indexOf(this.getItem(n));i.push(n.splice(a,1)[0])}return i}getWeightedValue(t){let i=0;for(let l in t)i+=t[l];let n=this.getUniform()*i,a,o=0;for(a in t)if(o+=t[a],n<o)return a;return a}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new tt().setState(this.getState())}}const x=new tt().setSeed(Date.now());class it{getContainer(){return null}setOptions(t){this._options=t}}class at extends it{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const n=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let n=this._ctx.canvas,a=n.getBoundingClientRect();return t-=a.left,i-=a.top,t*=n.width/a.width,i*=n.height/a.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function nt(e,t){return(e%t+t)%t}class At extends at{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[n,a,o,l,c]=t,h=[(n+1)*this._spacingX,a*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),i&&(this._ctx.fillStyle=c,this._fill(h[0],h[1])),!o)return;this._ctx.fillStyle=l;let u=[].concat(o);for(let w=0;w<u.length;w++)this._ctx.fillText(u[w],h[0],Math.ceil(h[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=Math.floor(t/this._spacingX)-1,a=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,a]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,a=i/(2+1.5*(this._options.height-1)),o=Math.min(n,a),l=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let c=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=l;let h=c/100;o=Math.floor(o)+1;let u=2*o/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(u)-1}_normalizedEventToPosition(t,i){let n;this._options.transpose?(t+=i,i=t-i,t-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let a=n/this._options.height;return i=Math.floor(i/a),nt(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let n=this._hexSize,a=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-n+a,i),o.lineTo(t-n/2+a,i+this._spacingX-a),o.lineTo(t+n/2-a,i+this._spacingX-a),o.lineTo(t+n-a,i),o.lineTo(t+n/2-a,i-this._spacingX+a),o.lineTo(t-n/2+a,i-this._spacingX+a),o.lineTo(t-n+a,i)):(o.moveTo(t,i-n+a),o.lineTo(t+this._spacingX-a,i-n/2+a),o.lineTo(t+this._spacingX-a,i+n/2-a),o.lineTo(t,i+n-a),o.lineTo(t-this._spacingX+a,i+n/2-a),o.lineTo(t-this._spacingX+a,i-n/2+a),o.lineTo(t,i-n+a)),o.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,a;t.transpose?(n="height",a="width"):(n="width",a="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[a]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class Me extends at{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){Me.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,n,a,o,l]=t,c=""+a+o+l,h;if(c in this._canvasCache)h=this._canvasCache[c];else{let u=this._options.border;h=document.createElement("canvas");let w=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,w.fillStyle=l,w.fillRect(u,u,h.width-u,h.height-u),a){w.fillStyle=o,w.font=this._ctx.font,w.textAlign="center",w.textBaseline="middle";let _=[].concat(a);for(let S=0;S<_.length;S++)w.fillText(_[S],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[c]=h}this._ctx.drawImage(h,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,i){let[n,a,o,l,c]=t;if(i){let u=this._options.border;this._ctx.fillStyle=c,this._ctx.fillRect(n*this._spacingX+u,a*this._spacingY+u,this._spacingX-u,this._spacingY-u)}if(!o)return;this._ctx.fillStyle=l;let h=[].concat(o);for(let u=0;u<h.length;u++)this._ctx.fillText(h[u],(n+.5)*this._spacingX,Math.ceil((a+.5)*this._spacingY))}computeSize(t,i){let n=Math.floor(t/this._spacingX),a=Math.floor(i/this._spacingY);return[n,a]}computeFontSize(t,i){let n=Math.floor(t/this._options.width),a=Math.floor(i/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let l=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let h=l/100*a/n;return h>1&&(a=Math.floor(a/h)),Math.floor(a/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}Me.cache=!1;let Ct=class extends at{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[n,a,o,l,c]=t,h=this._options.tileWidth,u=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*h,a*u,h,u):(this._ctx.fillStyle=c,this._ctx.fillRect(n*h,a*u,h,u))),!o)return;let w=[].concat(o),_=[].concat(l),S=[].concat(c);for(let v=0;v<w.length;v++){let y=this._options.tileMap[w[v]];if(!y)throw new Error(`Char "${w[v]}" not found in tileMap`);if(this._options.tileColorize){let C=this._colorCanvas,k=C.getContext("2d");k.globalCompositeOperation="source-over",k.clearRect(0,0,h,u);let f=_[v],p=S[v];k.drawImage(this._options.tileSet,y[0],y[1],h,u,0,0,h,u),f!="transparent"&&(k.fillStyle=f,k.globalCompositeOperation="source-atop",k.fillRect(0,0,h,u)),p!="transparent"&&(k.fillStyle=p,k.globalCompositeOperation="destination-over",k.fillRect(0,0,h,u)),this._ctx.drawImage(C,n*h,a*u,h,u)}else this._ctx.drawImage(this._options.tileSet,y[0],y[1],h,u,n*h,a*u,h,u)}}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),a=Math.floor(i/this._options.tileHeight);return[n,a]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}};function Lt(e){let t,i;if(e in je)t=je[e];else{if(e.charAt(0)=="#"){let a=(e.match(/[0-9a-f]/gi)||[]).map(o=>parseInt(o,16));if(a.length==3)t=a.map(o=>o*17);else{for(let o=0;o<3;o++)a[o+1]+=16*a[o],a.splice(o,1);t=a}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):t=[0,0,0];je[e]=t}return t.slice()}const je={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class Et extends it{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const n=this._gl,a=this._options;let[o,l,c,h,u]=t,w=n.canvas.height-(l+1)*a.tileHeight;if(n.scissor(o*a.tileWidth,w,a.tileWidth,a.tileHeight),i&&(a.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...Ae(u)),n.clear(n.COLOR_BUFFER_BIT)),!c)return;let _=[].concat(c),S=[].concat(u),v=[].concat(h);n.uniform2fv(this._uniforms.targetPosRel,[o,l]);for(let y=0;y<_.length;y++){let C=this._options.tileMap[_[y]];if(!C)throw new Error(`Char "${_[y]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,a.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,C),a.tileColorize&&(n.uniform4fv(this._uniforms.tint,Ae(v[y])),n.uniform4fv(this._uniforms.bg,Ae(S[y]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...Ae(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),a=Math.floor(i/this._options.tileHeight);return[n,a]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let n=this._gl.canvas,a=n.getBoundingClientRect();return t-=a.left,i-=a.top,t*=n.width/a.width,i*=n.height/a.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=Ri(t,wi,mi);return t.useProgram(i),yi(t),gi.forEach(n=>this._uniforms[n]=t.getUniformLocation(i,n)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){_i(this._gl,t)}}const gi=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],wi=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),mi=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function Ri(e,t,i){const n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"");const a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,i),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(a)||"");const o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o)||"");return o}function yi(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function _i(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let Qe={};function Ae(e){if(!(e in Qe)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=Lt(e).map(i=>i/255),t.push(1);Qe[e]=t}return Qe[e]}function bi(e){return`\x1B[0;48;5;${Je(e)}m\x1B[2J`}function Si(e,t){return`\x1B[0;38;5;${Je(e)};48;5;${Je(t)}m`}function vi(e,t){return`\x1B[${t+1};${e+1}H`}function Je(e){const n=.0234375;let a=Lt(e),o=Math.floor(a[0]*n),l=Math.floor(a[1]*n),c=Math.floor(a[2]*n);return o*36+l*6+c*1+16}class Dt extends it{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],n=this.computeSize();this._offset=n.map((a,o)=>Math.floor((a-i[o])/2))}clear(){process.stdout.write(bi(this._options.bg))}draw(t,i){let[n,a,o,l,c]=t,h=this._offset[0]+n,u=this._offset[1]+a,w=this.computeSize();if(h<0||h>=w[0]||u<0||u>=w[1]||((h!==this._cursor[0]||u!==this._cursor[1])&&(process.stdout.write(vi(h,u)),this._cursor[0]=h,this._cursor[1]=u),i&&(o||(o=" ")),!o))return;let _=Si(l,c);if(_!==this._lastColor&&(process.stdout.write(_),this._lastColor=_),o!="	"){let S=[].concat(o);process.stdout.write(S[0])}this._cursor[0]++,this._cursor[0]>=w[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const ki=/%([bc]){([^}]*)}/g,we=0,ke=1,Bt=2,$t=3;function xi(e,t){let i=[],n=0;e.replace(ki,function(o,l,c,h){let u=e.substring(n,h);return u.length&&i.push({type:we,value:u}),i.push({type:l=="c"?Bt:$t,value:c.trim()}),n=h+o.length,""});let a=e.substring(n);return a.length&&i.push({type:we,value:a}),Oi(i,t)}function Oi(e,t){t||(t=1/0);let i=0,n=0,a=-1;for(;i<e.length;){let l=e[i];if(l.type==ke&&(n=0,a=-1),l.type!=we){i++;continue}for(;n==0&&l.value.charAt(0)==" ";)l.value=l.value.substring(1);let c=l.value.indexOf(`
`);if(c!=-1){l.value=Ce(e,i,c,!0);let h=l.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();l.value=h.join("")}if(!l.value.length){e.splice(i,1);continue}if(n+l.value.length>t){let h=-1;for(;;){let u=l.value.indexOf(" ",h+1);if(u==-1||n+u>t)break;h=u}if(h!=-1)l.value=Ce(e,i,h,!0);else if(a!=-1){let u=e[a],w=u.value.lastIndexOf(" ");u.value=Ce(e,a,w,!0),i=a}else l.value=Ce(e,i,t-n,!1)}else n+=l.value.length,l.value.indexOf(" ")!=-1&&(a=i);i++}e.push({type:ke});let o=null;for(let l=0;l<e.length;l++){let c=e[l];switch(c.type){case we:o=c;break;case ke:if(o){let h=o.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();o.value=h.join("")}o=null;break}}return e.pop(),e}function Ce(e,t,i,n){let a={type:ke},o={type:we,value:e[t].value.substring(i+(n?1:0))};return e.splice(t+1,0,a,o),e[t].value.substring(0,i)}let Mi=80,Fi=25;const Wi={hex:At,rect:Me,tile:Ct,"tile-gl":Et,term:Dt},Pi={width:Mi,height:Fi,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class Xe{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},Pi,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,n){let a=[this._options.bg,this._options.fg];this.draw(t,i,null,null,a[n%a.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=Wi[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let n=Math.floor(t/this._options.width),a=Math.floor(i/this._options.height);return[n,a]}eventToPosition(t){let i,n;return"touches"in t?(i=t.touches[0].clientX,n=t.touches[0].clientY):(i=t.clientX,n=t.clientY),this._backend.eventToPosition(i,n)}draw(t,i,n,a,o){a||(a=this._options.fg),o||(o=this._options.bg);let l=`${t},${i}`;this._data[l]=[t,i,n,a,o],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[l]=!0)}drawOver(t,i,n,a,o){const l=`${t},${i}`,c=this._data[l];c?(c[2]=n||c[2],c[3]=a||c[3],c[4]=o||c[4]):this.draw(t,i,n,a,o)}drawText(t,i,n,a){let o=null,l=null,c=t,h=i,u=1;a||(a=this._options.width-t);let w=xi(n,a);for(;w.length;){let _=w.shift();switch(_.type){case we:let S=!1,v=!1,y=!1,C=!1;for(let k=0;k<_.value.length;k++){let f=_.value.charCodeAt(k),p=_.value.charAt(k);if(this._options.layout==="term"){let d=f>>8;if(d===17||d>=46&&d<=159||d>=172&&d<=215||f>=43360&&f<=43391){this.draw(c+0,h,p,o,l),this.draw(c+1,h,"	",o,l),c+=2;continue}}y=f>65280&&f<65377||f>65500&&f<65512||f>65518,S=p.charCodeAt(0)==32||p.charCodeAt(0)==12288,C&&!y&&!S&&c++,y&&!v&&c++,this.draw(c++,h,p,o,l),v=S,C=y}break;case Bt:o=_.value||null;break;case $t:l=_.value||null;break;case ke:c=t,h++,u++;break}}return u}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let n=this._data[t];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}Xe.Rect=Me;Xe.Hex=At;Xe.Tile=Ct;Xe.TileGL=Et;Xe.Term=Dt;class Rt{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:n,timestamp:a})=>({key:i+t,value:n,timestamp:a}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const n=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(n)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let n=0;n<this.len();n++)t==this.heap[n].value&&(i=n);if(i===null)return!1;if(this.len()>1){let n=this.heap.pop();return n.value!=t&&(this.heap[i]=n,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const n=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=n}minNode(t){const i=t.filter(this.existNode.bind(this));let n=i[0];for(const a of i)this.lessThan(this.heap[a],this.heap[n])&&(n=a);return n}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),n=this.rightChildNode(t);if(!this.existNode(i))return;const a=this.minNode([t,i,n]);a!=t&&(this.swap(t,a),this.updateDown(a))}debugPrint(){console.log(this.heap)}}class Yi{constructor(){this._time=0,this._events=new Rt}getTime(){return this._time}clear(){return this._events=new Rt,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:n}=i;return n}}remove(t){return this._events.remove(t)}}let st=class{constructor(){this._queue=new Yi,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),n=this._repeat.indexOf(t);return n!=-1&&this._repeat.splice(n,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class Ti extends st{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class Ii extends st{add(t,i,n){return this._queue.add(t,n!==void 0?n:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}let Ai=class extends st{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,n){return this._queue.add(t,n||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}};const Ci={Simple:Ti,Speed:Ii,Action:Ai};var Ee={exports:{}},Li=Ee.exports,yt;function Ei(){return yt||(yt=1,function(e,t){(function(i,n){e.exports=n()})(Li,function(){var i=function(){function n(v){return l.appendChild(v.dom),v}function a(v){for(var y=0;y<l.children.length;y++)l.children[y].style.display=y===v?"block":"none";o=v}var o=0,l=document.createElement("div");l.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",l.addEventListener("click",function(v){v.preventDefault(),a(++o%l.children.length)},!1);var c=(performance||Date).now(),h=c,u=0,w=n(new i.Panel("FPS","#0ff","#002")),_=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var S=n(new i.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:l,addPanel:n,showPanel:a,begin:function(){c=(performance||Date).now()},end:function(){u++;var v=(performance||Date).now();if(_.update(v-c,200),v>h+1e3&&(w.update(1e3*u/(v-h),100),h=v,u=0,S)){var y=performance.memory;S.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return v},update:function(){c=this.end()},domElement:l,setMode:a}};return i.Panel=function(n,a,o){var l=1/0,c=0,h=Math.round,u=h(window.devicePixelRatio||1),w=80*u,_=48*u,S=3*u,v=2*u,y=3*u,C=15*u,k=74*u,f=30*u,p=document.createElement("canvas");p.width=w,p.height=_,p.style.cssText="width:80px;height:48px";var d=p.getContext("2d");return d.font="bold "+9*u+"px Helvetica,Arial,sans-serif",d.textBaseline="top",d.fillStyle=o,d.fillRect(0,0,w,_),d.fillStyle=a,d.fillText(n,S,v),d.fillRect(y,C,k,f),d.fillStyle=o,d.globalAlpha=.9,d.fillRect(y,C,k,f),{dom:p,update:function(Y,W){l=Math.min(l,Y),c=Math.max(c,Y),d.fillStyle=o,d.globalAlpha=1,d.fillRect(0,0,w,C),d.fillStyle=a,d.fillText(h(Y)+" "+n+" ("+h(l)+"-"+h(c)+")",S,v),d.drawImage(p,y+u,C,k-u,f,y,C,k-u,f),d.fillRect(y+k-u,C,u,f),d.fillStyle=o,d.globalAlpha=.9,d.fillRect(y+k-u,C,u,h((1-Y/W)*f))}}},i})}(Ee)),Ee.exports}Ei();const et=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},ie=e=>et(e,"error"),Di=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,_e=()=>({action:()=>{},after:()=>{},before:()=>{}}),V={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},Bi={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){ie(V.INVALID_VALUE_NUMBER);return}this[i]=n}else ie(V.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,a,o,l){a&&o%2===l?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&o%2===l&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let a=0;a<this.buttons;a++)i.buttons[a].pressed===!0?(this.pressed[`button${a}`]||(this.pressed[`button${a}`]=!0,this.buttonActions[a].before()),this.buttonActions[a].action()):this.pressed[`button${a}`]&&(delete this.pressed[`button${a}`],this.buttonActions[a].after());if(i.axes){const a=i.axes.length%2;for(let o=0;o<this.axes*2;o++){const l=i.axes[o+a].toFixed(4),c=Math.floor(o/2);this.axeValues[c][o%2]=l,this.triggerDirectionalAction("right",c,l>=this.axeThreshold[0],o,0),this.triggerDirectionalAction("left",c,l<=-this.axeThreshold[0],o,0),this.triggerDirectionalAction("down",c,l>=this.axeThreshold[0],o,1),this.triggerDirectionalAction("up",c,l<=-this.axeThreshold[0],o,1)}}}},associateEvent:function(i,n,a){if(i.match(/^button\d+$/)){const o=parseInt(i.match(/^button(\d+)$/)[1]);o>=0&&o<this.buttons?this.buttonActions[o][a]=n:ie(V.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][a]=n;else if(i==="select")this.buttonActions[8][a]=n;else if(i==="r1")this.buttonActions[5][a]=n;else if(i==="r2")this.buttonActions[7][a]=n;else if(i==="l1")this.buttonActions[4][a]=n;else if(i==="l2")this.buttonActions[6][a]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][a]=n:ie(V.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const o=i.match(/^(up|down|left|right)(\d+)$/),l=o[1],c=parseInt(o[2]);c>=0&&c<this.axes?this.axesActions[c][l][a]=n:ie(V.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const o=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][o][a]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=_e();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:_e(),left:_e(),right:_e(),up:_e()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},le={gamepads:{},axeThreshold:[1],isReady:Di(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){ie(V.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const n=this.getGamepads(),a=Object.keys(n);for(let o=0;o<a.length;o++)n[a[o]].set("axeThreshold",this.axeThreshold)}}else ie(V.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys(le.gamepads);le.onBeforeCycle();for(let i=0;i<t.length;i++)le.gamepads[t[i]].checkStatus();le.onAfterCycle(),t.length>0&&e(le.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(et(V.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=Bi.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;et(V.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:ie(V.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:ie(V.UNKNOWN_EVENT);break}return this}};le.init();const $e="The Forgotton Adventures of Kroz",Ne=80,Fe=25,We=1,me=Ne-16,Pe=1,Oe=Fe-2,$=me-We,z=Oe-Pe,b=" ",q=1;var be={},Se={},_t;function $i(){if(_t)return Se;_t=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.MiniSignal=void 0;const e=Symbol("SIGNAL");function t(n){return typeof n=="object"&&e in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...a){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let o=this._head;if(o==null)return!1;for(this._dispatching=!0;o!=null;)o.fn(...a),o=o.next;return this._dispatching=!1,!0}add(a){if(typeof a!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:a}))}detach(a){if(!t(a))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(a[e]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const o=this._refMap.get(a);return o?(this._refMap.delete(a),this._disconnectNode(o),this._destroyNode(o),this):this}detachAll(){let a=this._head;if(a==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;a!=null;)this._destroyNode(a),a=a.next;return this}_destroyNode(a){a.fn=void 0,a.prev=void 0}_disconnectNode(a){a===this._head?(this._head=a.next,a.next==null&&(this._tail=void 0)):a===this._tail&&(this._tail=a.prev,this._tail!=null&&(this._tail.next=void 0)),a.prev!=null&&(a.prev.next=a.next),a.next!=null&&(a.next.prev=a.prev)}_addNode(a){return this._head==null?(this._head=a,this._tail=a):(this._tail.next=a,a.prev=this._tail,this._tail=a),a}_createRef(a){const o={[e]:this._symbol};return this._refMap.set(o,a),o}_getRef(a){return this._refMap.get(a)}}return Se.MiniSignal=i,Se}var bt;function zi(){return bt||(bt=1,function(e){var t=be.__createBinding||(Object.create?function(n,a,o,l){l===void 0&&(l=o);var c=Object.getOwnPropertyDescriptor(a,o);(!c||("get"in c?!a.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(n,l,c)}:function(n,a,o,l){l===void 0&&(l=o),n[l]=a[o]}),i=be.__exportStar||function(n,a){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,n,o)};Object.defineProperty(e,"__esModule",{value:!0}),i($i(),e)}(be)),be}var Gi=zi();function I(e=0){return e<=0?new Promise(t=>{requestAnimationFrame(()=>t())}):new Promise(t=>{setTimeout(()=>t(),e)})}function St(e,t,i){return Math.min(Math.max(e,t),i)}const ze=new Gi.MiniSignal;let fe=null;var E=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.PrevLevel=12]="PrevLevel",e[e.Teleport=13]="Teleport",e[e.ResetFound=14]="ResetFound",e[e.HideFound=15]="HideFound",e[e.Pause=16]="Pause",e[e.Quit=17]="Quit",e[e.Save=18]="Save",e[e.Restore=19]="Restore",e))(E||{});const Z={},D={},zt={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:13,T:13,")":10,"+":14,"-":15,"(":11,PageDown:null,PageUp:null,p:16,P:16,Escape:17,s:18,S:18,r:19,R:19},Ni={button0:9,button1:13,button4:null,button5:null,up:1,down:2,left:4,right:3,button12:1,button13:2,button14:4,button15:3};function Ui(){fe||le.on("connect",e=>{if(!fe){fe=e,fe.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(Ni))i&&(fe.before(t,()=>{Z[t]=D[i]=3}),fe.after(t,()=>{(Z[t]||0)&3&&ze.dispatch(t),Z[t]&=-2,Z[t]|=4,D[i]&=-2,D[i]|=4}))}})}function Ki(e){if(e.repeat)return;const t=zt[e.key];Z[e.key]=3,t&&(e.preventDefault(),D[t]=3)}function Vi(e){(Z[e.key]||0)&3&&ze.dispatch(e.key),Z[e.key]&=-2,Z[e.key]|=4;const t=zt[e.key];t&&(e.preventDefault(),D[t]&=-2,D[t]|=4)}function Hi(){Ui(),window.addEventListener("keydown",Ki),window.addEventListener("keyup",Vi)}function rt(){for(const e in D)Object.prototype.hasOwnProperty.call(D,e)&&delete D[e];for(const e in Z)Object.prototype.hasOwnProperty.call(Z,e)&&delete Z[e]}function Gt(){for(const e in D){const t=e;if(!D[t])continue;const i=!!(D[t]&2);D[t]&=-15,i&&(D[t]|=8)}}function J(e){return!!(D[e]&3)&&!(D[e]&8)}function re(e){return!!(D[e]&4)}async function Nt(){return rt(),new Promise(e=>{const t=ze.add(i=>{ze.detach(t),e(i)})})}async function ot(e,t=50){const i=Nt();do await(e==null?void 0:e());while(!await Promise.race([i,I(t)]));return i}var X=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(X||{});const U={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};var s=(e=>(e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(s||{});const Ge={0:b,1:"Ä",2:"Ö",3:"Ω",4:"▓",5:"⌠",6:"≡",7:"C",8:"Φ",9:"♦",10:"¡",11:"↑",12:"î",13:"ì",14:"█",15:"Θ",16:"∙",17:"≈",18:"○",19:"█",20:"♣",21:"¥",22:"▓",23:"░",24:"■",25:"∩",26:"ƒ",27:"☼",28:b,29:"▲",30:b,31:b,32:b,33:b,34:"▲",35:"▼",36:"♠",37:b,38:"▓",39:b,40:"☻",41:b,42:"■",43:"▓",44:b,45:"?",46:"☺",47:b,48:"K",49:"R",50:"O",51:"Z",52:"█",53:"█",54:"█",55:b,56:b,57:b,58:"⌂",59:"⌂",60:"⌂",61:b,62:b,63:b,64:"▓",65:"O",66:"X",67:b,68:b,69:b,70:b,71:b,72:b,73:b,74:b,75:"│",76:"↓",77:"↓",78:"↓",79:"↓",80:"↓",81:"♀",82:"→",83:"←",224:b,225:b,226:b,227:b,228:b,229:b,230:b,231:b,252:"♣"},qi={" ":0,1:1,2:2,3:3,X:4,W:5,L:6,C:7,S:8,"+":9,I:10,T:11,K:12,D:13,"#":14,F:15,".":16,R:17,Q:18,"/":19,"\\":20,"♣":20,B:21,V:22,"=":23,A:24,U:25,Z:26,"*":27,E:28,";":29,":":30,"`":31,"-":32,"@":33,"%":34,"]":35,G:36,")":37,M:38,"(":39,P:40,"&":41,"!":42,O:43,H:44,"?":45,">":46,N:47,"<":48,"[":49,"|":50,'"':51,4:52,5:53,6:54,7:55,8:56,9:57,ñ:58,ò:59,ó:60,ô:61,õ:62,ö:63,Y:64,0:65,"~":66,$:67,"‘":68,"’":69,"“":70,"”":71,"•":72,"–":73,"—":74,"³":75,"¹":76,º:77,"»":78,"¼":79,"½":80,ƒ:81,"¯":82,"®":83,à:224,á:225,â:226,ã:227,ä:228,å:229,æ:230,ç:231,ü:252},G={0:[X.White,X.Black],1:[X.LightRed,null],2:[X.LightGreen,null],3:[X.Green,null],4:[X.Brown,null],5:[X.HighIntensityWhite,null],6:[X.Black|16,X.White],7:[X.Yellow,X.Red],8:[X.Red,null],9:[X.Blue,null],10:[X.Green,null],11:[X.LightMagenta,null],12:[X.LightRed,null],13:[X.Magenta,X.Blue],14:[X.Brown,X.Brown],15:[X.LightCyan,null],16:[X.White,null],17:[X.LightBlue,X.Blue],18:[X.HighIntensityWhite,null],19:[X.Green,X.Green],20:[X.Brown,X.Green],21:[X.HighIntensityWhite,null],22:[X.LightRed,X.Red],23:[X.White,null],24:[X.HighIntensityWhite|32,X.Magenta],25:[X.HighIntensityWhite,null],26:[X.LightCyan,null],27:[X.Yellow,null],28:[X.HighIntensityWhite,null],29:[null,null],30:[null,null],31:[null,null],32:[null,null],34:[X.LightRed,null],35:[X.HighIntensityWhite,null],36:[X.Yellow|16,null],38:[X.Brown,null],33:[null,null],37:[null,null],39:[null,null],67:[null,null],224:[null,null],225:[null,null],226:[null,null],227:[null,null],228:[null,null],229:[null,null],230:[null,null],231:[null,null],40:[X.Yellow,X.Black],41:[null,null],42:[X.LightBlue,null],43:[X.Brown,null],44:[null,null],45:[X.HighIntensityWhite,null],46:[X.HighIntensityWhite,null],48:[X.White,null],49:[X.White,null],50:[X.White,null],51:[X.White,null],52:[X.Brown,X.Brown],53:[X.Brown,X.Brown],54:[X.White,X.Brown],55:[null,null],56:[null,null],57:[null,null],58:[X.LightCyan,null],59:[X.LightCyan,null],60:[X.LightCyan,null],61:[null,null],62:[null,null],63:[null,null],64:[X.White,null],65:[X.White,null],66:[X.LightRed,X.Red],68:[null,null],69:[null,null],70:[null,null],71:[null,null],72:[null,null],73:[null,null],74:[null,null],47:[X.HighIntensityWhite,null],75:[X.White,null],76:[X.White,null],77:[X.White,null],78:[X.White,null],79:[X.White,null],80:[X.White,null],82:[X.White,null],83:[X.White,null],81:[X.HighIntensityWhite,null],252:[X.Brown,X.Green]},Zi={4:"A Breakable Wall blocks your way",5:"You have found a Whip",6:"Stairs take you to the next lower level.",7:"`You found gems and whips inside the chest!",8:"You activated a Slow Time spell.",9:"Gems give you both points and strength.",10:"Oh no, a temporary Blindness Potion!",11:"You found a Teleport scroll.",12:"Use Keys to unlock doors.",13:"To pass the Door you need a Key.",14:"A Solid Wall blocks your way.",17:"You cannot travel through Water.",15:"You activated a Speed Creature spell.",16:"You activated a Teleport trap!",18:"A Power Ring--your whip is now a little stronger!",20:"A tree blocks your way.",19:"You cannot travel through forest terrain.",21:"You activated a Magic Bomb!",22:"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)",23:"* SPLAT!! *",24:"The Sacred Tome of Kroz is finally yours--50,000 points!",25:"You passed through a secret Tunnel!",26:"You have activated a Freeze Creature spell!",27:"You found a Gold Nugget...500 points!",28:"Oh no, you set off an Earthquake trap!",29:"An Invisible Crumbled Wall blocks your way.",31:"An Invisible Door blocks your way.",34:"A Creature Zap Spell!",35:"A Creature Creation Trap!",36:"You have discovered a Creature Generator!",38:"A Moving Wall blocks your way.",41:"Yah Hoo! You discovered a Reveal Gems Scroll!",42:"You found an Ancient Tablet of Wisdom...2,500 points!",44:"You triggered Exploding Walls!",45:"You found a Pouch containing Gems!",46:"Statues are very dangerous...they drain your Gems!",47:"Yikes!  A trap has made many of the wall sections invisible!",51:"Super Kroz Bonus -- 10,000 points!",52:"A Solid Wall blocks your way.",58:"Magic has been released is this chamber!",59:"Magic has been released is this chamber!",60:"Magic has been released is this chamber!",61:"New Walls have magically appeared!",62:"New Walls have magically appeared!",63:"New Walls have magically appeared!",65:"You pushed a big Boulder!",66:"You hit a Electrified Wall!  You lose one Gem.",75:"You grabbed a Rope.",81:"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"},Ut=[3,2,1],Kt=[68,69,70,71,72,73,74],lt=[33,37,38,39,67,224,225,226,227,228,229,230,231],ji=[29,30,31],Qi=[5,9,11],Ji=[8,10,15,26],ea=[55,56,57],ta=[61,62,63],ia=[...Ut,4,...ji,43,64,...Kt,13,16,...lt,19,28,32,35,36,45,48,49,50,51],aa=[...Ut,...Qi,...Ji,7,16,...lt,32],na=[0,32,...lt,41,44,47,...ea,...ta,...Kt];let ne;const A={x:0,y:0,bg:"black",fg:"white"};function sa(){Xe.Rect.cache=!0,ne=new Xe({width:Ne,height:Fe,fontFamily:"IBM_VGA, monospace",bg:U[X.Blue],fg:U[X.White],fontSize:64})}function N(e,t=A.y){A.x=e,A.y=t}function Ye(e){typeof e=="number"&&(e=U[e]),A.bg=e}function Re(e){typeof e=="number"&&(e=U[e]),A.fg=e}function O(e,t=A.fg,i=A.bg){A.y+=H(A.x,A.y,e,t,i)}function ae(e,t=A.fg,i=A.bg){const n=Math.floor((Ne-e.length)/2);A.y+=H(n,A.y,e,t,i)}function pe(e,t,i){N(e,t),O(i)}function ce(e=A.bg){typeof e=="number"&&(e=U[e]),ne.setOptions({bg:e}),A.bg=e,ne.clear()}function Vt(e,t){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=U[e]),typeof t=="number"&&(t=U[t]),[e,t]}function ve(e,t,i,n=A.fg,a=A.bg){[n,a]=Vt(n,a),ne.draw(e,t,i,n,a)}function ra(e,t,i,n=A.fg,a=A.bg){var o;[n,a]=Vt(n,a),a=a??((o=ne._data[`${e},${t}`])==null?void 0:o[4])??G[s.Floor],ne.draw(e,t,i,n,a)}function H(e,t,i,n=A.fg,a=A.bg){return typeof n=="number"&&n>15&&(n=Date.now()%500<250?n:a),typeof a=="number"&&(a=U[a%16]),typeof n=="number"&&(n=U[n%16]),ne.drawText(e,t,`%c{${n}}%b{${a}}`+i)}function oa(){return ne||sa(),ne.getContainer()}const Ue={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((n,a)=>t.getChannelData(a).set(n)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,n=0,a=0,o=.1,l=0,c=1,h=0,u=0,w=0,_=0,S=0,v=0,y=0,C=0,k=0,f=1,p=0,d=0,Y=0){let W=Math.PI*2,te=fi=>fi<0?-1:1,L=this.sampleRate,he=h*=500*W/L/L,ct=i*=(1+t*2*Math.random()-t)*W/L,He=[],se=0,si=0,B=0,ye=1,ri=0,oi=0,Q=0,qe,ue,li=2,ht=W*Math.abs(Y)*2/L,Ze=Math.cos(ht),ut=Math.sin(ht)/2/li,Te=1+ut,Xi=-2*Ze/Te,ci=(1-ut)/Te,ft=(1+te(Y)*Ze)/2/Te,hi=-(te(Y)+Ze)/Te,ui=ft,pt=0,dt=0,gt=0,wt=0;for(n=n*L+9,p*=L,a*=L,o*=L,k*=L,u*=500*W/L**3,y*=W/L,w*=W/L,_*=L,S=S*L|0,e*=this.volume,ue=n+p+a+o+k|0;B<ue;He[B++]=Q*e)++oi%(C*100|0)||(Q=l?l>1?l>2?l>3?Math.sin(se*se):Math.max(Math.min(Math.tan(se),1),-1):1-(2*se/W%2+2)%2:1-4*Math.abs(Math.round(se/W)-se/W):Math.sin(se),Q=(S?1-d+d*Math.sin(W*B/S):1)*te(Q)*Math.abs(Q)**c*(B<n?B/n:B<n+p?1-(B-n)/p*(1-f):B<n+p+a?f:B<ue-k?(ue-B-k)/o*f:0),Q=k?Q/2+(k>B?0:(B<ue-k?1:(ue-B)/k)*He[B-k|0]/2/e):Q,Y&&(Q=wt=ui*pt+hi*(pt=dt)+ft*(dt=Q)-ci*gt-Xi*(gt=wt))),qe=(i+=h+=u)*Math.cos(y*si++),se+=qe+qe*v*Math.sin(B**5),ye&&++ye>_&&(i+=w,ct+=w,ye=0),S&&!(++ri%S)&&(i=ct,h=he,ye=ye||1);return He},getNote:function(e=0,t=440){return t*2**(e/12)}};Ue.volume=.005;function R(e,t,i=1){return Ue.play(i,0,e,0,t/1e3,0),I(t)}async function K(){for(let e=1;e<=65;e++)R(x.getUniformInt(1e3,2e3),1);await I(0)}async function vt(){for(let e=150;e>=35;e--)await R(e,1)}async function kt(){await R(400,120,5),await I(10),await R(700,120,5),await I(10)}async function De(){for(let e=1;e<=23;e++)R(x.getUniformInt(350,900),120);await I(120);for(let e=1;e<=30;e++)R(x.getUniformInt(150,200),50)}async function la(){for(let e=10;e<=90;e++)await R(e,15,100)}async function xt(){for(let e=150;e>35;e--)await R(e,16,50)}const Xa=Ue.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function de(){Ue.playSamples(Xa)}async function ca(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=x.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)R(x.getUniformInt(0,4e3)+3e3,16,10)}else await I(x.getUniformInt(0,29))}class Ht{constructor(t,i,n){mt(this,"ch");this.type=t,this.x=i,this.y=n,this.x=i,this.y=n,this.ch=Ge[t]}move(t,i){this.type===s.Player?De():this.type===s.Slow?this.ch=Math.random()>.5?"A":"Ä":this.type===s.Medium&&(this.ch=Math.random()>.5?"ö":"Ö"),this.x=t,this.y=i}async kill(){await R(200+200*this.type,25,100),this.x=-1,this.y=-1}getChar(){return this.type===s.Player?r.T[P.Invisible]>0?b:Ge[this.type]:this.ch}}var P=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e))(P||{});const r=jt(),qt={},Zt={};function jt(){return{player:new Ht(s.Player,0,0),entities:[],PF:[],foundSet:new Set,T:[0,0,0,0,4,5,6,7,0,0],levelIndex:1,level:null,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2,bonus:0,actionActive:!1,paused:!1,done:!1}}function Qt(){Object.assign(r,jt())}function ha(){Object.assign(qt,r)}function ua(){Object.assign(Zt,qt)}function fa(){Object.assign(r,Zt)}function xe(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.from(typeof e=="string"?[e]:e);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var a=n.reduce(function(c,h){var u=h.match(/\n([\t ]+|(?!\s).)/g);return u?c.concat(u.map(function(w){var _,S;return(S=(_=w.match(/[\t ]/g))===null||_===void 0?void 0:_.length)!==null&&S!==void 0?S:0})):c},[]);if(a.length){var o=new RegExp(`
[	 ]{`+Math.min.apply(Math,a)+"}","g");n=n.map(function(c){return c.replace(o,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var l=n[0];return t.forEach(function(c,h){var u=l.match(/(?:^|\n)( *)$/),w=u?u[1]:"",_=c;typeof c=="string"&&c.includes(`
`)&&(_=String(c).split(`
`).map(function(S,v){return v===0?S:""+w+S}).join(`
`)),l+=_+n[h+1]}),l}function pa(){Re(14),Ye(X.Blue);const e=70;pe(e,0,"Score"),pe(e,3,"Level"),pe(e,6,"Gems"),pe(e,9,"Whips"),pe(e-2,12,"Teleports"),pe(e,15,"Keys")}function j(){const e=r.whipPower>2?`${r.whips}+${r.whipPower-2}`:r.whips.toString(),t=4,i=7,n=!r.paused&&r.gems<10?X.Red|16:X.Red,a=69;H(a,1,ge((r.score*10).toString(),t+1,i),X.Red,X.Grey),H(a,4,ge(r.levelIndex.toString(),t,i),X.Red,X.Grey),H(a,7,ge(r.gems.toString(),t+1,i),n,X.Grey),H(a,10,ge(e,t,i),X.Red,X.Grey),H(a,13,ge(r.teleports.toString(),t,i),X.Red,X.Grey),H(a,16,ge(r.keys.toString(),t,i),X.Red,X.Grey)}function Jt(){Re(X.LightBlue),Ye(X.Black);for(let e=We-1;e<=me+1;e++)ve(e,0,"▒"),ve(e,Oe+1,"▒");for(let e=Pe-1;e<=Oe+1;e++)ve(0,e,"▒"),ve(me+1,e,"▒")}async function F(e){if(!e)return"";const t=(me-e.length)/2,i=Oe+1;r.paused=!0;const n=await ot(()=>{H(t,i,e,x.getUniformInt(1,15),X.Black)});return Jt(),r.paused=!1,n}async function da(){return ot(async()=>{Re(x.getUniformInt(1,15)),ce(X.Black),N(5,5),O(xe`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `),O(""),ae($e,X.Yellow),O(""),ae("Original Level Design (C) 1990 Scott Miller",X.Yellow),N(0,Fe-1),ae("Press any key to continue.",X.HighIntensityWhite),await I(500)})}async function ga(){ce(X.Black),N(0,0),ae($e,X.Yellow),ae("INSTRUCTIONS",X.HighIntensityWhite),ae("------------",X.HighIntensityWhite),O(""),Re(X.LightBlue),O(xe`
    The dungeons contain dozens of treasures,  spells,  traps and other mysteries.
  Touching an object for the first time will reveal a little of its identity,  but
  it will be left to you to decide how best to use it or avoid it.                
    When a creature touches you it will vanish,  taking with it a few of your gems
  that you have collected. If you have no gems then the creature will instead take
  your life!  Whips can be used to kill nearby creatures, but they are better used
  to smash through crumbled walls and forest terrain.`),O(""),N(3),O(xe`
    You can use these        u i o    7 8 9
    cursor keys to            \\|/      \\|/     w or 5: Whip
    move your man,           j- -k    4- -6         T: Teleport
    and the four              /|\\      /|\\
    normal cursor keys       n m ,    1 2 3`),N(0),O(""),O(xe`
    It's a good idea to save (S) your game at every new level,  therefore,  if you
    die you can easily restore (R) the game at that level and try again.`),N(2),O(""),O("Have fun and good-luck..."),N(0,Fe-1),ae("Press any key to continue.",X.HighIntensityWhite),await Nt()}function ge(e,t,i){return e.padStart(t,b).padEnd(i,b)}const wa="Debug",ma=`
                                                       #1#1#1#1#
 ####### ##whip W W W                  ~~~~~   ewall## # # # # #
  3 3  # #chest C C C                  #####   wall### # # # # #
   3   # ##nugg * * *   ñ4444499999ö   RRRRR   river## # # # # #
  3 3  # ###gem + + +   ò5555588888õ   /////   forest# # # # # #
 ####### ##door D D D   ó6666677777ô   ♣♣♣♣♣   tree### #X#X#X#X#
         ##tele T T T    :::::#####    VVVVV   lava### #2#2#2#2#
         ###key K K K                  =====   pit#### # # # # #
         #power Q Q Q                  XXXXX   block## # # # # #
 #######                                               # # # # #
  2 2  #                      P                        # # # # #
   2   #                                               #X#X#X#X#
  2 2  #                  XXXXXXXXXXX                  #3#3#3#3#
 #######                  XXXXXXXXXXX   0 0 0   rock## # # # # #
         ###zap % % %     XXXXXXXXXXX   R L =          # # # # #
         ##slow S S S     XXXXXXXXXXX   < [ | " kroz## # # # # #
         #speed F F F     XXXXXXXXXXX                  # # # # #
 ####### #freez Z Z Z          B        U U U   tunnel #X#X#X#X#
  1 1  # ###inv I I I     ###bomb####                  #########
   1   # tablet ! ! !     #XG1 2 3GX#   . . .   traps#          
  1 1  # #amule ƒ ƒ ƒ     XXXXXXXXXXX   & & &   show##  S       
 ####### ##tome A A A     XDZ/EWLCSVX   E E E   quake#    F     
                          XXXXXXXXXXX   T T T               Z   
`,Ra={id:wa,map:ma},ya="Lost1",_a=`
//♣///////♣///♣////////♣////////♣//#the#lost#adventures#of#kroz#
//♣//////////////♣//♣////////♣////////♣///♣/♣♣/♣♣/♣/♣♣/♣♣♣♣♣♣♣/♣
♣###your#hut###////♣///♣/////////♣/////♣/♣♣//♣♣/♣♣/♣♣♣♣♣♣♣♣♣♣♣♣♣
/##           D---/////////♣//♣///♣//♣/♣/♣/♣/♣/♣/♣/♣♣♣♣♣♣♣###♣♣♣
/##  P ####  ##///-♣//♣//♣/----♣///♣////♣//♣//RRR/♣♣♣♣♣♣♣##L##♣♣
/##      K#**##/♣♣/-//--/♣-♣//♣--♣//♣//♣////RRRRR//♣♣♣♣♣♣♣#0#♣♣♣
♣##############/////--♣/--//♣////-///////♣////RRRRRRR/♣♣♣♣#!#♣♣♣
////♣♣///♣/♣♣///♣//♣//////////♣//♣---♣//♣////RRRRRR/♣♣/♣♣♣♣-♣♣♣♣
/♣//////♣/////♣////////♣///♣/////////--/////♣///RRRRR♣♣♣♣♣♣♣-♣♣♣
///////♣////////♣///////////////♣/////♣---/////RRRRR/♣/♣♣♣♣♣♣-♣♣
////♣/////♣♣♣//♣////♣/////♣//////♣////////-//♣/♣/RRRRRR♣/♣♣♣-♣♣♣
/////////♣♣♣♣♣///♣////♣////////♣///♣///////-//♣///RRRR♣//♣/-♣/♣/
♣//////♣//♣♣////♣////////♣//♣//////////♣///-♣////RRRRRR♣♣/♣-/♣/♣
//♣♣//////♣/###storage###///////♣--//♣♣///-////RRRRRRRRR/♣/♣-/♣/
////////♣///##WWW-WWW-W##/♣////--//-//♣♣/-///♣RRRRRRRRR/♣/♣/-/♣/
/♣////////♣/##W-WWW-WW---------//♣//-----//♣///RRRRRRRR♣♣//♣-♣//
♣/////♣/////#############♣///♣-/♣♣♣/♣/♣♣/♣////RRRRRRRR//♣/♣/-//♣
///♣////♣//////♣♣////♣////♣///-////♣/♣♣/♣///♣RRRRRRR/♣/♣//♣-/♣//
/♣///♣/////♣////♣///♣//♣//♣////------♣///♣////♣////♣//--/♣-♣♣//♣
♣//♣///♣/♣//♣/♣/♣///♣//♣/♣///♣////♣//------♣/♣//♣///♣-♣/--//♣/♣/
/♣///♣////♣//♣///♣////♣///♣//♣/♣////♣///♣/♣-----/♣♣/-/♣//♣/♣//♣/
♣//♣////♣/♣///♣//♣///♣/♣///♣//♣/////♣///♣/////♣/----♣♣//♣///♣//♣
#by#scott#miller#♣///♣/////♣/♣////♣////♣////♣//♣//♣/♣//♣/♣♣///♣ü
`,ba={id:ya,map:_a},Sa=`
XXXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXXXX### P ###X
XXXXX##XXXXXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXXXXXXXXXXXXXX##  ##XX
XXXXXXXXXXXXXXX&-XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXX#XXXXX#  #XX
#XXXXXXXXXXXXXXXX-XXXX--XXXXXXXXXXXXXXXX##XXXXXXXXXXXXXXXX  XXXX
XXXXXXXXX#XXXXXXXX-XX-XX-XXXXXXX#XXXXXXXXXXXXXXXXXXXXX##   #XXXX
XXX#XXXXXXXXXXX#XXX--XX#X--XXXXXXXXX#XXXXX#XXXX##XXXX##  ##XXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXX##XX##XXXXXX
XXXXXXXXXXX##XXXXXXXXXXXXX#XX-XXXXXXXXXXXXXXXXXXXXX##  ##XXXX##X
XXXXX#XXXXXXXXXXXX#XXXXXXXXXXX--XXXX##XXXXXX#XXXXX##  ##XXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXX#XXXXXXX-#XXXXXXXXXXXXX      XXXX#XXXXXX
XXXXX##XXXXXX#XXXXXXX#XXXXXXXXXX#X##XXXXX       XXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXX##XXX#   0    XXXXXXXX!XXXXXXXXXXXXX
XXXXXXXXXXXXXX#XXXXXXX===XXXXXXX#  XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXX#XXXXXXXXXXXX=======XXXXX  XXXXXXXX#XXXXX#XXXXXXXXXX##XXX
XXXXXXXXXXXXXXXXX=========       XX=====XXXXXXXXXXXXX#XXXXXXXXXX
XX#XXXXXXX##XXX==========  ===========XXXXXXXXXXXXXXXXX#XXXXXXXX
XXXXXXXXXXXXXX==========  ===========XXXXXXXXX##XXXXXXXXXXXXXXXX
XXXX#XXXXXXX             ===========XX#XXXXXXXXXXXXXXXXXXXXX#XXX
XXXXXXXX    XX#XXXX================XXXXXXXX#XXXXXX#XXXXXXXXXXXXX
XXX     XX#XXXXXXXXXX===========XXXXXXXXXXXXXXXXXXXX##the#secret
XXXXXXXXXXXXXXXXXX#XXXXXX=====XXXXXXXXXX#XXXXXXXXXXX#tunnel#into
X  XX#XXXXXX##XXXXXXXXXXXXXXXXXX#XXXXXXXXXXXXXXXXXXX#the#kingdom
LLXXXXXX#XXXXXXXXXXXXX#XXXXXXXXXXXXXX#4XXXXXX##XXXXX#####of#kroz
`,va={id:"Lost2",map:Sa},ka=`
                                   1                        1  &
 ####shop####         1                                       ‘ 
 ##++++++++##                            1                      
 ##++++++++##                                 ##4444444444444444
 #####OO#####                                 ##   1   1   1  1 
                          ###spells###        ## 1 1  1  1   1  
     1                    ##ñEF‘Tò @##     1  ##    1   1  1  1 
                          ##I@ ‘S  T##        ##11   1 1    1   
                     1    ##ZóT‘  ] ##        ##   1   1 1  1 1 
                          #########X##        ## 1   1  1  1 1  
@@         1                                  ##1 1    1  1    1
1@W                            P              ## 1  1 1 1  1 1 1
1@W                                           ##1  11  1 1   1  
1@W   1                                     1 ##  1   1     1   
1@W                 1                         ##1    1  1  1  1 
1@W                                     #.#OXX## 1 1  1   1    1
1@W          ###lair#of#kroz###         #.#XOX##1    1  1   1 1 
1@W          77------------ôK##         #.#XXO##  1 1  1   1   1
1@W          ####1111111111####         #.#XOX## 1 1  1 1 1   1 
1@W    1      Z##############           #H#X!X##1  1 1  1  1 1  
1@W                                     ######## 1   1 1  1   1 
1@@@@@@@@@@@@@@@                  ########@       1   1   1 1  1
111111111111111@                1 ##LLWWWD@         1   1    1 1
`,xa={id:"Lost4",map:ka},Oa="Lost26",Ma=`
::::::::::::::::::::::::::::::::::::::::::::::::####amulet####::
:###########::::::::::::::::::::::::::::::::::::#55]-----]---#::
:#         #::::::::::::::::::::::::::::::::::::#ƒ5----]--L-ò#::
:#    P   HOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO::::::#55-]------]-#::
:#K        #::::::O::::::::::::-:::::::::O::::::###D##########::
:###########::::::O::::::::::::-:::::::::O:::::::::O::::::::::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::-----:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::+++:-:::::
::::::::::::::::::O::::::::::::-:::::::::O:::::::::O::::::-:::::
:::::::::::OOOOOOOO::::::::::::-::::#####D###::::::O::::::-:::::
:::::::::::O:::::::::::::::::::-::::#K;     #::::::OOOOO::-:::::
:::::::::::O:::::::::::::::::::-::::#;;     #::::::::::O::-:::::
:::::######D#############::::::-::::# W     #::::::::::O::-:::::
:::::#!---...----T---I--#::::::-::::#       #::::::::::O::-:::::
:::::#----K----F---’---ñ#::::::-::::#     * #::::::::::O::-:::::
:::::#-S---I----------Z-#::::::-::::#       #::::::::::O::-:::::
:::::####################::::::-::::#   W   #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#       #::::::::::O::-:::::
:::::::::::::::::::::::::::::::-::::#4444444#::::::::::O::-:::::
::::::::::::::::::::::::+++::::-::::#K;-----DOOOOOOOOOOOOOOOOO::
###rogue###:::::::::::::+++-----::::#########:::::::::::::::::::
#was#hereÃ#:::::::::::::::::::::::::::::::::::::::::::::::::::::
`,Fa={id:Oa,map:Ma},Wa="Lost30",Pa=`
1111144       ##C######locksmith#shoppe######C##         RRRRRRR
1111144       ##]##K#K#K#K#K#-3-3#K#K#K#K#K##]##        RRRRRRRñ
1111144          ##:::::::::######::::::::;##         RRRRRRRCYY
1111144          ##------------------------##     666RRRRRRRR66 
1111144          #############--#############     6666666666666 
1111144                                           HOOOOOOOOH    
1111144                                        6666666666666    
1111144                                        66RRRRRRR6666    
1111144                                        RRRRRRR          
1111144                                      RRRRRR           YY
1111144               P                    RRRRRR             YZ
1111144                                 RRRRRRRRRR            YY
1111144                              RRRRR333RRRRR              
1111144                             RRR3333333RRRRR             
@@@@@##                           RRR3333333333RRRRR            
MMMMM##                           RRR333333333RRRRR             
)))))##                          RRR33333333RRRRR               
MMMMM##                        RRRR333333RRRRRRR        DDDDDDDD
(((((##                       RRRR3LL3RRRRRRRR          DDDDDDDD
MMMMM##                      RRRRRRRRRRRRRR             DDDDDDDD
$$$$$##                     RRRRRRRRRRRR                DDDD7777
MMMMM##                     RRRRRRRR                    DDDD77ôô
]]K]]##“                   RRRRRRK]                     DDDD77ô!
`,Ya={id:Wa,map:Pa},Ta="Lost42",Ia=`
###########klose#enkounters#of#the#krazy#kubikal#kindÃ##########
3                               P                              3
##-##############:########:#######:###########:##############:##
XXXXXXXXX##~W~W~W~W~##‘-M----M.--$$$$$$$$$-9/-/♣--♣-|##---’ò’---
---------##*~*~*~*~*##-‘.-”M-”-##$$$$$$$$$##♣--/-♣-/♣##YYYYYYYYY
MMMMMMMMM##~W~W~W~W~##M--‘-.-M-##111111111##-/-♣/--/-##(((((((((
)))))))))##*~*~*~*~*##.”-.-”-.”##222222222##/♣--♣-♣-/##(((((((((
C))))))))--~W~W~W~W~##ó.-”--‘-M##333333333##ü-//-♣-/-9-(((((((((
###################-################################9##55555555-
“-“-“-“-“##YYYYYYYYY##222222222------0---W##RRRRRRRRR##MMMMMMMMM
-----------YYYYYYYYY##@@@@@@@@@##---000---##RXXXXXXXR##MMMMMMMMM
XXXXXXXXX##YYYYYYYYY##@@@@@@@@@##--00G00--##RXXXKXXXR##MMMMMMMMM
---------##YYYYYYYYY##@@XXX@@@@##---000---##RXXXXXXXR##MMMMMMMMM
’’’’’’’’’##YYYYYYYYK##@@XZX@@@@##----0---W##RRRRRRRRR##MMMMMMMMK
-#####################-##########ô##################H##Z########
~-~[~-~-~##WWW......à1:1:1:1:1:##-773C7--7##=--=I==-=##ááááááY0"
-~-~-~-~-##WWW......##1:1:1:1:1##7-777-77-##!==-=--==##ááááááY00
~-~-~-~-~##.........##:1:1:1:1:##-77--77-7##=======-=##ááááááYYY
-~-~-~-~-##.........##1:1:1:1:1##7-7-77-77##-==-=-==I##ááááááááá
K-~-~-~-~-à..<......##:1:1:1:1ñ##77-7777---I=--=-=--=##222222222
############################################################44##
LL---V--V-VV-V--VV---D-----D--’--D--”--D--66333333333333333-WWWW
LL--V-VV-V--V-VV--V--D-----D--”--D--’--D--66YYYYYYYYYYYYYYYYYYYY
`,Aa={id:Ta,map:Ia},Ca=`
ñö22222229       &#the#sacred#chamber#of#kroz#&2      82222222õò
öö22222999      F       $®$$$$$$$$$$$¯$ 2    .    F   88822222õõ
22222999     2• .   ”   $$$333333333$$$         •    2  88822222
222999   ”   ###        $$3=========3$$   ]    ###        888222
2999   .     #K#       $$3==úúúùúúú==3$$       #ó# .        8882
99   F  ]    #K#  2   $$3==úúùVVVùúú==3$$   2  #2#    ”    2  88
RRRRRRR      #0#      $3==úùïúVAVúïùú==3$      #2#       RRRRRRR
22222RR.     #0# .    $3==úùùúVVVúùùú==3$ .    #2#  2   .RR22222
22222RR  2   #0#      $$3==úúùú6úùúú==3$$      #2#       RR22222
22222RR      #D#   2   $$3==úúù&ùúú==3$$    ‘  #D#     2 RR22222
22222RR                 $$3==úú0úú==3$$                  RR22222
22222RR     2        ]   $3==úúGúú==3$    ”    .   2   . RR22222
22222RR  .     ”     .   $$3==úDú==3$$                ]  RR22222
22222RR    F              $$3=====3$$   2      2    ”    RR22222
RRRRRRR 2         2        $$33333$$       ]      F     2RRRRRRR
444444444444444’            $$$$$$$   .      .  H444444444444444
77777777777777###   ‘ .        P           2   ###YYYYYYYYYYYYYY
77777777777777#U#       2                      #U#YYXXXXXXXXXXXX
77777777777777#-#  2       .   T      2        #0#YYXXYYYYYYYYYY
77777777777777#<#   ]          ” 2       ”    2#0#YYXXYYOOOOOOOO
77777777777777#[#        2  5555555 N     .    #0#YYXXYYOOYYYYYY
77777777777777#|#          55DDDDD55 2      F  #0#YYXXYYOOYYXXXX
K777777777777C#"#E  2     555D]!]D555     2    40#CYXXYYOOYYXX]K
`,La={id:"Lost75",map:Ca},Ea="Kingdom1",Da="Welcome to Kroz II",Ba=`
W W W W             2 2 2 2 2  C  2 2 2 2 2              W W W W
XXXXXXXXXXXXXXXXXXX###########   ###########XXXXXXXXXXXXXXXXXXXX
 1           1                               1                  
                                    1            XX         1   
       1            1                           XXXX            
#        XX                    +                 XX            #
##      XXXX  1                +          1          1        ##
T##      XX               2    +    2                        ##T
T1##                       W   +   W                        ##1T
T########X                 WX     XW             1    X########T
.        X                2WX  P  XW2                 X        .
T########X         1       WX     XW                  X########T
T1##                       W   +   W         1              ##1T
T##                       2    +    2                        ##T
##   1                         +                      XX      ##
#       XX      1              +                 1   XXXX     1#
       XXXX                 ##   ##                   XX        
1       XX                 ##     ##     1        1           1 
                    1#######       ########                     
    1         ########11111  +++++  111111########              
WW     ########+++++        #######         WWWWW########1    WW
########¯                    2 2 2                     C########
L2  +  X      #kingdom#of#kroz#ii#by#scott#miller#      X  +  2L`,$a={id:Ea,name:Da,map:Ba},za="Caverns2",Ga=`
LXXX2    2     2        2   2  2  2   2    2 2    2  2    2    +
+XXX  2     2      2        2          2  2    2     2      XXX 
 XXX2   2      2       2  2     2   2       2      2  2  2  XTX 
+XXX          2  2           2         2  2     2   2       XXX 
 XXX   2   2         2   2     2    2      2  2        2     2  
+XXX 2                                                          
 XXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  2  2 
+XXX2    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
 XXX  2  XXX2                    W                   2XXX 2     
+XXX   2 XXX  2                FFFFF               2  XXX   2 2 
 XXX2 2  XXX                   F111F                  XXX       
+XXX2    XXX+   3  3        W  F1P1F  W       3  3   +XXX  2    
XXXX   2 XXX                   F111F                  XXX 2    2
WXXX 2   XXX  2                FFFFF               2  XXX   2   
WXXX2    XXX2                    W                   2XXX    2  
WXXX  2  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX 2     
WXXX   2 XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX    2  
WXXX2                                                      2    
WXXX    2   2      2   2     2    2   2    2    2      2      2 
XXXX 2    2   2 2    2    2     2       2     2     2     2 XXX 
XXXX2  2    2  2  2      2    2     2  2  2  2    2         XTX 
XXXX 2   2 2    2   2  2    2   2       2       2   2   2   XXX 
CXXX   2    2  2 2    2 2     2    2  2  2   2    2  2    2    +`,Na={id:za,map:Ga},Ke=[Ra,ba,va,xa,Na,$a,Fa,Ya,Aa,La],Le={[P.SlowTime]:70*q,[P.Invisible]:75*q,[P.SpeedTime]:80*q,[P.FreezeTime]:55*q};function Ve(){r.level=Ke[r.levelIndex],Qa(r.level.map),r.T=r.T.map(()=>0),ha(),ee(),j()}async function ei(){rt(),r.levelIndex=nt(r.levelIndex+1,Ke.length),Ve(),await F("Press any key to begin this level.")}async function Ua(){rt(),r.levelIndex=nt(r.levelIndex-1,Ke.length),Ve(),await F("Press any key to begin this level.")}async function Ka(){r.T=r.T.map(e=>e>0?e-1:0)}async function Va(e){var l,c;if(e.x===-1||e.y===-1||r.PF[e.x][e.y]!==e.type){e.kill();return}let t=0,i=0;r.player.x<e.x&&(t=-1),r.player.x>e.x&&(t=1),r.player.y<e.y&&(i=-1),r.player.y>e.y&&(i=1);const n=e.x+t,a=e.y+i;if(n<0||n>=$||a<0||a>=z)return;const o=((c=(l=r.PF)==null?void 0:l[n])==null?void 0:c[a])??s.Floor;switch(o){case s.Floor:case s.TBlock:case s.TRock:case s.TGem:case s.TBlind:case s.TGold:case s.TWhip:case s.TTree:g(e,n,a);break;case s.Block:case s.MBlock:case s.ZBlock:case s.GBlock:r.PF[e.x][e.y]=s.Floor,r.PF[n][a]=s.Floor,e.kill(),M(o),R(800,18),R(400,20);break;case s.Player:r.gems--,r.PF[e.x][e.y]=s.Floor,e.kill(),M(o);break;case s.Whip:case s.Chest:case s.SlowTime:case s.Gem:case s.Invisible:case s.Teleport:case s.Key:case s.SpeedTime:case s.Trap:case s.Power:case s.Freeze:case s.Nugget:case s.K:case s.R:case s.O:case s.Z:case s.ShootRight:case s.ShootLeft:K(),g(e,n,a);break;default:g(e,e.x,e.y);break}}async function Ha(e){if(e!==s.Player&&!(r.T[P.FreezeTime]>0))for(let t=0;t<r.entities.length;t++){const i=r.entities[t];e&&i.type!==e||i.x===-1||i.y===-1||await Va(i)}}async function qa(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await F("Are you sure you want to SAVE? (Y/N)");e.toLowerCase()==="y"&&ua()}async function Za(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await F("Are you sure you want to RESTORE? (Y/N)");e.toLowerCase()==="y"&&(fa(),Ve())}async function ja(){if(re(E.NextLevel))return await ei();if(re(E.PrevLevel))return await Ua();if(re(E.FreeItems)){r.gems=1/0,r.whips=1/0,r.teleports=1/0,r.keys=1/0,j();return}if(re(E.ResetFound)){r.foundSet=new Set;return}if(re(E.Pause))return nn();if(re(E.Quit))return an();if(re(E.Save))return qa();if(re(E.Restore))return Za();J(E.Whip)&&(r.whips<1?kt():(r.whips--,await en())),J(E.Teleport)&&(r.teleports<1?await kt():(r.teleports--,await ii()));let e=0,t=0;J(E.North)&&t--,J(E.South)&&t++,J(E.West)&&e--,J(E.East)&&e++,J(E.Southeast)&&(e++,t++),J(E.Southwest)&&(e--,t++),J(E.Northeast)&&(e++,t--),J(E.Northwest)&&(e--,t--),e=St(e,-1,1),t=St(t,-1,1),(e!==0||t!==0)&&await Ja(e,t)}function Qa(e){r.entities=[];const t=e.split(`
`).filter(i=>i.length>0);for(let i=0;i<t.length;i++){const n=t[i];for(let a=0;a<n.length;a++){const o=n.charAt(a)??b,l=qi[o];switch(r.PF[a]=r.PF[a]||[],r.PF[a][i]=l??o,l){case s.Player:r.player.x=a,r.player.y=i;break;case s.Slow:case s.Medium:case s.Fast:r.entities.push(new Ht(l,a,i));break}}}G[s.Floor][0]=X.White,G[s.Floor][1]=X.Black,G[s.Gem]=[x.getUniformInt(1,15),null]}async function Ja(e,t){var o,l,c,h,u,w,_,S,v,y,C,k;const i=r.player.x+e,n=r.player.y+t;if(i<0||i>$||n<0||n>z)return;const a=((l=(o=r.PF)==null?void 0:o[i])==null?void 0:l[n])||s.Floor;switch(a){case s.Floor:case s.Stop:g(r.player,i,n);break;case s.Slow:case s.Medium:case s.Fast:r.gems-=a,Be(i,n),M(a),g(r.player,i,n);break;case s.Block:case s.ZBlock:case s.GBlock:M(a),await m(s.Block,!0);break;case s.Whip:K(),r.whips++,M(a),g(r.player,i,n),await m(s.Whip,!0);break;case s.Stairs:if(r.levelIndex===Ke.length-1){g(r.player,i,n),await on();return}M(a),g(r.player,i,n),await m(s.Stairs,!0),ei();break;case s.Chest:if(r.keys>0){r.keys--;const f=x.getUniformInt(2,5),p=x.getUniformInt(2,5);r.whips+=f,r.gems+=p,M(a),g(r.player,i,n),await F(`You found ${p} gems and ${f} whips inside the chest!`)}break;case s.SlowTime:r.T[P.SpeedTime]=0,r.T[P.FreezeTime]=0,r.T[P.SlowTime]=Le[P.SlowTime],M(a),g(r.player,i,n),await m(a,!0);break;case s.Gem:K(),r.gems++,M(a),g(r.player,i,n),await m(a,!0);break;case s.Invisible:r.T[P.Invisible]=Le[P.Invisible],M(a),g(r.player,i,n),await m(a,!0);break;case s.Teleport:r.teleports++,M(a),g(r.player,i,n),m(a,!0);break;case s.Key:K(),r.keys++,g(r.player,i,n),await m(a,!0);break;case s.Door:r.keys<1?(R(Math.random()*129+30,150,100),await I(100),await m(a)):(r.keys--,M(a),await la(),g(r.player,i,n),await F("The Door opens!  (One of your Keys is used.)"));break;case s.Wall:de(),M(a),await m(a,!0);break;case s.River:M(a),await m(a,!0);break;case s.SpeedTime:r.T[P.SlowTime]=0,r.T[P.SpeedTime]=Le[P.SpeedTime],M(a),g(r.player,i,n),await m(a,!0);break;case s.Trap:M(a),g(r.player,i,n),await m(a,!0),await ii();break;case s.Power:r.whipPower++,M(a),g(r.player,i,n),await m(a,!0);break;case s.Tree:case s.Forest:M(a),await vt(),await m(a,!0);break;case s.Bomb:{g(r.player,i,n);const f=4,p=Math.max(r.player.x-f,We),d=Math.min(r.player.x+f,me),Y=Math.max(r.player.y-f,Pe),W=Math.min(r.player.y+f,Oe);for(let te=p;te<=d;te++)for(let L=Y;L<=W;L++){const he=((h=(c=r.PF)==null?void 0:c[te])==null?void 0:h[L])??s.Floor;ia.includes(he)&&(he>=1&&he<=4&&(M(he),await Be(te,L)),r.PF[te][L]=s.Floor)}await m(a,!0);break}case s.Lava:r.gems-=10,M(a),g(r.player,i,n),await m(a,!0);break;case s.Pit:g(r.player,i,n),r.gems=-1,await m(a);break;case s.Tome:r.PF[31][6]=s.Stairs,T(31,6,s.Stairs),M(a),await m(a),await F("Congratulations, Adventurer, you finally did it!!!");break;case s.Nugget:K(),g(r.player,i,n),M(a),await m(a,!0);break;case s.Freeze:r.T[P.FreezeTime]=Le[P.FreezeTime],g(r.player,i,n),await m(a,!0);break;case s.Tunnel:g(r.player,i,n),await m(a,!0);break;case s.Quake:g(r.player,i,n);for(let f=0;f<2500;f++)R(x.getUniformInt(0,f),5,100),f%25===0&&await I();await I(50);for(let f=0;f<50;f++){do{const p=x.getUniformInt(0,$),d=x.getUniformInt(0,z),Y=((w=(u=r.PF)==null?void 0:u[p])==null?void 0:w[d])??s.Floor;if(aa.includes(Y)){r.PF[p][d]=s.Rock,T(p,d,s.Rock);break}}while(Math.random()>.01);for(let p=0;p<50;p++)R(x.getUniformInt(0,200),50,100);await I(50)}for(let f=2500;f>50;f--)R(x.getUniformInt(0,f),5,100),f%25===0&&await I();await m(a,!0);break;case s.IWall:de(),r.PF[i][n]=s.Wall,T(i,n),await m(a,!0);break;case s.IBlock:de(),r.PF[i][n]=s.Block,T(i,n),await m(a,!0);break;case s.IDoor:de(),r.PF[i][n]=s.Door,T(i,n),await m(a,!0);break;case s.Zap:{g(r.player,i,n);let f=0,p=0;for(;f<500&&p<40;){f++;const d=x.getUniformInt(0,r.entities.length),Y=r.entities[d];!Y||Y.x===-1||Y.y===-1||(await Be(Y.x,Y.y),await I(20),p++)}r.score+=Math.floor(p/3+2),ee(),j(),await m(a,!0);break}case s.Create:case s.Generator:M(a),g(r.player,i,n),await m(a,!0);break;case s.MBlock:M(a),await m(a,!0);break;case s.ShowGems:g(r.player,i,n),await m(a);break;case s.Tablet:g(r.player,i,n),K(),M(a),await m(a,!0),await sn();break;case s.BlockSpell:{g(r.player,i,n);for(let f=0;f<=$;f++)for(let p=0;p<=z;p++)if(r.PF[f][p]===s.ZBlock){R(200,60,100);for(let d=20;d>0;d--)T(f,p,s.Block,x.getUniformInt(0,15)),await I(3);r.PF[f][p]=s.Floor,T(f,p)}else r.PF[f][p]===s.BlockSpell&&(r.PF[f][p]=s.Block,T(f,p));await m(a,!0);break}case s.Chance:{M(a);const f=x.getUniformInt(14,18);r.gems+=f,g(r.player,i,n),await F(`You found a Pouch containing ${f} Gems!`);break}case s.Statue:g(r.player,i,n),await m(a);break;case s.WallVanish:g(r.player,i,n),await m(a);break;case s.K:g(r.player,i,n),K(),r.bonus===0&&(r.bonus=1);break;case s.R:g(r.player,i,n),K(),r.bonus===1&&(r.bonus=2);break;case s.O:g(r.player,i,n),K(),r.bonus===2&&(r.bonus=3);break;case s.Z:if(g(r.player,i,n),K(),r.bonus===3){for(let f=10;f<45;f++)for(let p=1;p<13;p++)await R(f*f*p,p+1,100);M(a),m(a)}break;case s.OWall1:case s.OWall2:case s.OWall3:de(),await m(s.OWall1,!0);break;case s.OSpell1:case s.OSpell2:case s.OSpell3:{g(r.player,i,n);let f=s.OWall1;a===s.OSpell2&&(f=s.OWall2),a===s.OSpell3&&(f=s.OWall3);for(let p=0;p<=$;p++)for(let d=0;d<=z;d++)if((((S=(_=r.PF)==null?void 0:_[p])==null?void 0:S[d])??s.Floor)===f){for(let W=60;W>0;W--)T(p,d,x.getItem(["▄","▌","▐","▀"]),x.getUniformInt(0,14)),R(W*40,5,10),W%5===0&&await I(1);r.PF[p][d]=s.Floor,T(p,d,s.Floor)}await m(a,!0);break}case s.CSpell1:case s.CSpell2:case s.CSpell3:{g(r.player,i,n);const f=a-s.CSpell1+s.CWall1;for(let p=0;p<=$;p++)for(let d=0;d<=z;d++)if((((y=(v=r.PF)==null?void 0:v[p])==null?void 0:y[d])??s.Floor)===f){for(let W=60;W>0;W--)T(p,d,x.getItem(["▄","▌","▐","▀"]),x.getUniformInt(0,14)),R(W*40,5,10),W%5===0&&await I(1);r.PF[p][d]=s.Wall,T(p,d,s.Wall)}await m(a,!0);break}case s.Rock:{let f=!1;const p=r.player.x+e*2,d=r.player.y+t*2;if((p<0||p>$||d<0||d>z)&&(f=!0),!f)switch(((k=(C=r.PF)==null?void 0:C[p])==null?void 0:k[d])??s.Floor){case s.Floor:f=!1,await xt(),r.PF[p][d]=s.Rock,g(r.player,i,n),ee(),await m(s.Rock,!0);break;case s.Stairs:case s.Pit:f=!1,await xt(),g(r.player,i,n),ee(),T(p,d,s.Rock);for(let W=130;W>5;W--)await R(W*8,16,100);ee(),await m(s.Rock,!0);break;default:f=!1;break}f&&await vt();break}case s.EWall:M(a),r.gems--,ca(),await m(s.EWall,!0);break;case s.CWall1:case s.CWall2:case s.CWall3:g(r.player,i,n);break;case s.Trap2:case s.Trap3:case s.Trap4:case s.Trap5:case s.Trap6:case s.Trap7:case s.Trap8:case s.Trap9:case s.Trap10:case s.Trap11:case s.Trap12:case s.Trap13:g(r.player,i,n);break;case s.TBlind:case s.TBlock:case s.TGem:case s.TGold:case s.TRock:case s.TTree:case s.TWhip:g(r.player,i,n);break;case s.Rope:g(r.player,i,n),await m(s.Rope,!0);break;case s.Message:break;case s.ShootRight:break;case s.ShootLeft:break;case s.DropRope:case s.DropRope2:case s.DropRope3:case s.DropRope4:case s.DropRope5:g(r.player,i,n);break;case s.Amulet:g(r.player,i,n),await ln();break;default:de();break}}async function m(e,t=!1){if(t){if(r.foundSet.has(e))return"";r.foundSet.add(e)}const i=Zi[e];return i?await F(i):""}async function Be(e,t){var n,a;const i=((a=(n=r.PF)==null?void 0:n[e])==null?void 0:a[t])??s.Floor;if(r.PF[e][t]=s.Floor,i===s.Slow||i===s.Medium||i===s.Fast)for(let o=0;o<r.entities.length;o++){const l=r.entities[o];l.x===e&&l.y===t&&await l.kill()}ee()}let Ot=s.Floor;function g(e,t,i){const n=e.x,a=e.y;if(e.move(t,i),e.type===s.Player){r.PF[n][a]=Ot;const o=r.PF[t][i];Ot=[s.CWall1,s.CWall2,s.CWall3,s.Rope].includes(o)?o:s.Floor}else r.PF[n][a]=s.Floor;r.PF[t][i]=e.type,ee()}async function en(){Ye(G[s.Floor][1]);const e=r.player.x,t=r.player.y;R(70,50*8,100),t>0&&e>0&&await oe(e-1,t-1,"\\"),e>0&&await oe(e-1,t,"-"),t<z&&e>0&&await oe(e-1,t+1,"/"),t<z&&await oe(e,t+1,"❘"),t<z&&e<$&&await oe(e+1,t+1,"\\"),e<$&&await oe(e+1,t,"-"),t>0&&e<$&&await oe(e+1,t-1,"/"),t>0&&await oe(e,t-1,"❘")}async function ti(){for(let e=0;e<160;e++)e%5===0&&(T(r.player.x,r.player.y,s.Player,x.getUniformInt(0,15),x.getUniformInt(0,8)),await I()),R(e/2,80,10)}async function ii(){var e,t,i,n;await ti(),r.PF[r.player.x][r.player.y]=s.Floor,T(r.player.x,r.player.y);for(let a=0;a<700;a++){const o=x.getUniformInt(0,$),l=x.getUniformInt(0,z),c=((t=(e=r.PF)==null?void 0:e[o])==null?void 0:t[l])??s.Floor;na.indexOf(c)>-1&&(T(o,l,"☺",x.getUniformInt(0,15),x.getUniformInt(0,7)),await R(20,10,100),T(o,l,c))}for(;;){const a=x.getUniformInt(0,$),o=x.getUniformInt(0,z);if((((n=(i=r.PF)==null?void 0:i[a])==null?void 0:n[o])??s.Floor)===s.Floor){r.PF[a][o]=s.Player,r.player.x=a,r.player.y=o,ee();break}}}async function oe(e,t,i){var o,l,c;const n=((l=(o=r.PF)==null?void 0:o[e])==null?void 0:l[t])??s.Floor,a=((c=G[n])==null?void 0:c[1])??G[s.Floor][1];switch(ra(e+We,t+Pe,i,U[x.getUniformInt(0,15)],a),n){case s.Slow:case s.Medium:case s.Fast:Be(e,t),M(n);break;case s.Block:case s.Forest:case s.Tree:case s.Message:{const h=r.whipPower;6*Math.random()<h?(R(130,50),r.PF[e][t]=s.Floor):(R(130,25),R(90,50));break}case s.Invisible:case s.SpeedTime:case s.Trap:case s.Power:case s.Generator:case s.K:case s.R:case s.O:case s.Z:r.PF[e][t]=s.Floor,R(400,50);break;case s.Quake:case s.IBlock:case s.IWall:case s.IDoor:case s.Trap2:case s.Trap3:case s.Trap4:case s.ShowGems:case s.BlockSpell:case s.Trap5:case s.Trap6:case s.Trap7:case s.Trap8:case s.Trap9:case s.Trap10:case s.Trap11:case s.Trap12:case s.Trap13:case s.Stop:break;case s.Rock:30*Math.random()<r.whipPower?(R(130,50),r.PF[e][t]=s.Floor):(R(130,25),R(90,50));break;case s.MBlock:case s.ZBlock:case s.GBlock:{6*Math.random()<r.whipPower?(R(130,50),r.PF[e][t]=s.Floor):(R(130,25),R(90,50));break}case s.Wall:case s.Statue:break}j(),await I(10)}function ee(){for(let t=0;t<r.PF.length;t++)for(let i=0;i<r.PF[t].length;i++){const n=r.PF[t][i]||s.Floor;n!==s.Player&&(n===s.Slow||n===s.Medium||n===s.Fast||T(t,i,r.PF[t][i]||s.Floor))}const e=G[s.Floor][1];for(let t=0;t<r.entities.length;t++){const i=r.entities[t];i.x===-1||i.y===-1||T(i.x,i.y,i.getChar(),G[i.type][0],e)}T(r.player.x,r.player.y,r.player.getChar(),G[r.player.type][0],e)}function T(e,t,i=s.Floor,n,a){var l,c;let o;switch(typeof i=="number"?(o=Ge[i]??i??Ge[s.Floor],n=n??((l=G[i])==null?void 0:l[0])??G[s.Floor][0],a=a??((c=G[i])==null?void 0:c[1])??G[s.Floor][1]):i>="a"&&i<="z"?(o=i.toUpperCase(),n=n??X.HighIntensityWhite,a=a??X.Brown):o=i,i){case s.Stairs:n=typeof n=="number"&&!r.paused?n|16:n;break}ve(e+We,t+Pe,o,n,a)}function M(e){switch(e){case s.Slow:case s.Medium:case s.Fast:r.score+=e;break;case s.Block:case s.ZBlock:case s.GBlock:case s.Wall:case s.River:case s.Tree:case s.Forest:case s.MBlock:case s.OWall1:case s.OWall2:case s.OWall3:case s.EWall:r.score>2&&(r.score-=2);break;case s.Whip:case s.SlowTime:case s.Bomb:r.score++;break;case s.Stairs:r.score+=r.levelIndex*5;break;case s.Chest:r.score+=10+Math.floor(r.levelIndex/2);break;case s.Gem:r.score+=Math.floor(r.levelIndex/2)+1;break;case s.Invisible:r.score+=25;break;case s.Nugget:r.score+=50;break;case s.Door:r.score+=10;break;case s.Teleport:case s.Freeze:r.score+=2;break;case s.SpeedTime:case s.Power:r.score+=5;break;case s.Trap:r.score>5&&(r.score-=5);break;case s.Lava:r.score>100&&(r.score+=100);break;case s.Tome:r.score+=5e3;break;case s.Tablet:r.score+=r.levelIndex+250;break;case s.Chance:r.score+=100;break;case s.Amulet:r.score+=2500;break;case s.Z:r.score+=1e3;break}j()}async function tn(){H(me/2-7,0,"You have died.",X.Black,X.Red),await F("Press any key to continue."),r.done=!0}async function an(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await F("Are you sure you want to quit? (Y/N)");e.toLowerCase()==="y"&&(r.done=!0)}async function nn(){await F("Press any key to resume")}async function sn(){switch(r.level.id){case"Debug":case"Lost30":await Mt(),await F('"If goodness is in my heart, that which flows shall..."');for(let e=0;e<=$;e++)for(let t=0;t<=z;t++)r.PF[e][t]===s.River&&(await R(e*t,50,10),r.PF[e][t]=s.Nugget,T(e,t,s.Nugget));await F('"...Turn to Gold!"');break;case"Lost42":await Mt(),await F('"Barriers of water, like barriers in life, can always be..."');for(let e=0;e<=$;e++)for(let t=0;t<=z;t++)r.PF[e][t]===s.River&&(await R(e*t,50,10),r.PF[e][t]=s.Block,T(e,t,s.Block));await F('"...Overcome!"');break}}async function Mt(){await F("On the Ancient Tablet is a short Mantra, a prayer..."),await F("You take a deep breath and speak the words aloud...")}async function rn(){Ye(X.Blue),Re(X.LightCyan),ce(X.Blue),N(2,5),O(xe`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `),N(9,16),O(`Use the cursor keys to move yourself (%c{${U[X.Yellow]}}☻%c{${U[X.LightGreen]}}) through the caverns.`,X.LightGreen),ae("Use your whip (press W) to destroy all nearby creatures.",X.LightGreen),N(0,Fe-1),ae("Press any key to begin your decent into Kroz.",X.HighIntensityWhite);const e=Ne/2-$e.length/2;await ot(async()=>{H(e,3,$e,x.getUniformInt(0,16),X.Red),await I(500)})}async function on(){await De(),await I(200),await De(),await I(200),await De(),await F("Oh no, something strange is happening!"),await F("You are magically transported from Kroz!");const e=r.gems=isFinite(r.gems)?r.gems:150,t=r.whips=isFinite(r.whips)?r.whips:20,i=r.teleports=isFinite(r.teleports)?r.teleports:10,n=r.keys=isFinite(r.keys)?r.keys:5;await F("Your Gems are worth 100 points each...");for(let a=0;a<e;a++)r.gems--,r.score+=10,j(),await R(a*8+100,20);await F("Your Whips are worth 100 points each...");for(let a=0;a<t;a++)r.whips--,r.score+=10,j(),await R(a*8+100,20);await F("Your Teleport Scrolls are worth 200 points each...");for(let a=0;a<i;a++)r.teleports--,r.score+=20,j(),await R(a*8+100,20);await F("Your Keys are worth 10,000 points each....");for(let a=0;a<n;a++)r.keys--,r.score+=1e3,j(),await R(a*8+100,20);ce(X.Blue),N(25,3),Re(X.White),Ye(X.Blue),O("ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"),N(15,5),O("   Carefully, you place the ancient tome on your table and open"),O(" to the first page.  You read the book intently, quickly"),O(" deciphering the archaic writings."),O("   You learn of Lord Dullwit, the once powerful and benevolent"),O(" ruler of Kroz, who sought wealth and education for his people."),O(" The magnificent KINGDOM OF KROZ was once a great empire, until"),O(" it was overthrown by an evil Wizard, who wanted the riches of"),O(" Kroz for himself."),O("   Using magic beyond understanding, the Wizard trapped Lord"),O(" Dullwit and his people in a chamber so deep in Kroz that any"),O(" hope of escape was fruitless."),O("   The Wizard then built hundreds of deadly chambers that would"),O(" stop anyone from ever rescuing the good people of Kroz."),O("   Once again your thoughts becomes clear:  To venture into the"),O(" depths once more and set free the people of Kroz, in:"),O(""),await F("Press any key, Adventurer."),r.done=!0}async function ln(){await K();for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await R(e*e*t,t+1,100);M(s.Amulet),await F("You have found the Amulet of Yendor -- 25,000 points!"),await F("It seems that Kroz and Rogue share the same underground!)"),await F("Your quest for the treasure of Kroz must still continue...")}const Xt=q,Ft=q/4,Wt=q/3,Pt=q/2,Xn={type:s.Player,getSpeed:()=>1},cn={type:s.Slow,getSpeed:()=>r.T[P.SlowTime]>0?Ft/5:r.T[P.SpeedTime]>0?Xt:Ft},hn={type:s.Medium,getSpeed:()=>r.T[P.SlowTime]>0?Wt/5:r.T[P.SpeedTime]>0?Xt:Wt},un={type:s.Fast,getSpeed:()=>r.T[P.SlowTime]>0?Pt/5*q:r.T[P.SpeedTime]>0?Xt*q:Pt*q};function fn(){const e=oa();document.getElementById("app").appendChild(e),Hi()}async function ai(){ce(X.Black),Qt(),await da(),await rn(),await ga(),Ve(),Tt(),await ti(),ni(),await F("Press any key to begin this level."),Gt(),Tt(),await pn()}async function pn(){const e=new Ci.Speed;e.add(Xn,!0),e.add(cn,!0),e.add(hn,!0),e.add(un,!0);const t=16*8;let i=0,n=0;const a=async o=>{if(r.gems<0){await tn(),Yt();return}if(r.done){Yt();return}if(i+=o-n,n=o,i>t){i%=t,await Ka(),await ja(),Gt();const l=e.next();await Ha(l.type)}ni(),requestAnimationFrame(a)};requestAnimationFrame(a)}function Yt(){ce(X.Black),Qt(),ai()}function Tt(){ce(X.Blue),Jt(),pa(),ee(),j()}function ni(){ee(),j()}function It(){fn(),ai()}try{document.fonts.ready.then(It)}catch{window.addEventListener("DOMContentLoaded",It)}
