var vs=Object.defineProperty;var bs=(t,e,i)=>e in t?vs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Lt=(t,e,i)=>bs(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();function Es(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kn={exports:{}},xs=kn.exports,na;function Ts(){return na||(na=1,function(t,e){(function(i,n){t.exports=n()})(xs,function(){var i=function(){function n(p){return l.appendChild(p.dom),p}function r(p){for(var b=0;b<l.children.length;b++)l.children[b].style.display=b===p?"block":"none";a=p}var a=0,l=document.createElement("div");l.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",l.addEventListener("click",function(p){p.preventDefault(),r(++a%l.children.length)},!1);var s=(performance||Date).now(),f=s,c=0,h=n(new i.Panel("FPS","#0ff","#002")),m=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var w=n(new i.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:l,addPanel:n,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){c++;var p=(performance||Date).now();if(m.update(p-s,200),p>f+1e3&&(h.update(1e3*c/(p-f),100),f=p,c=0,w)){var b=performance.memory;w.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return p},update:function(){s=this.end()},domElement:l,setMode:r}};return i.Panel=function(n,r,a){var l=1/0,s=0,f=Math.round,c=f(window.devicePixelRatio||1),h=80*c,m=48*c,w=3*c,p=2*c,b=3*c,O=15*c,k=74*c,Y=30*c,H=document.createElement("canvas");H.width=h,H.height=m,H.style.cssText="width:80px;height:48px";var T=H.getContext("2d");return T.font="bold "+9*c+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=a,T.fillRect(0,0,h,m),T.fillStyle=r,T.fillText(n,w,p),T.fillRect(b,O,k,Y),T.fillStyle=a,T.globalAlpha=.9,T.fillRect(b,O,k,Y),{dom:H,update:function(x,D){l=Math.min(l,x),s=Math.max(s,x),T.fillStyle=a,T.globalAlpha=1,T.fillRect(0,0,h,O),T.fillStyle=r,T.fillText(f(x)+" "+n+" ("+f(l)+"-"+f(s)+")",w,p),T.drawImage(H,b+c,O,k-c,Y,b,O,k-c,Y),T.fillRect(b+k-c,O,c,Y),T.fillStyle=a,T.globalAlpha=.9,T.fillRect(b+k-c,O,c,f((1-x/D)*Y))}}},i})}(kn)),kn.exports}Ts();const mr=(t,e="log")=>{e==="error"?console&&typeof console.error=="function"&&console.error(t):console&&typeof console.info=="function"&&console.info(t)},We=t=>mr(t,"error"),Ss=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,Pi=()=>({action:()=>{},after:()=>{},before:()=>{}}),Re={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},Os={init:function(t){let e={id:t.index,buttons:t.buttons.length,axes:Math.floor(t.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:t.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){We(Re.INVALID_VALUE_NUMBER);return}this[i]=n}else We(Re.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,r,a,l){r&&a%2===l?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&a%2===l&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let r=0;r<this.buttons;r++)i.buttons[r].pressed===!0?(this.pressed[`button${r}`]||(this.pressed[`button${r}`]=!0,this.buttonActions[r].before()),this.buttonActions[r].action()):this.pressed[`button${r}`]&&(delete this.pressed[`button${r}`],this.buttonActions[r].after());if(i.axes){const r=i.axes.length%2;for(let a=0;a<this.axes*2;a++){const l=i.axes[a+r].toFixed(4),s=Math.floor(a/2);this.axeValues[s][a%2]=l,this.triggerDirectionalAction("right",s,l>=this.axeThreshold[0],a,0),this.triggerDirectionalAction("left",s,l<=-this.axeThreshold[0],a,0),this.triggerDirectionalAction("down",s,l>=this.axeThreshold[0],a,1),this.triggerDirectionalAction("up",s,l<=-this.axeThreshold[0],a,1)}}}},associateEvent:function(i,n,r){if(i.match(/^button\d+$/)){const a=parseInt(i.match(/^button(\d+)$/)[1]);a>=0&&a<this.buttons?this.buttonActions[a][r]=n:We(Re.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][r]=n;else if(i==="select")this.buttonActions[8][r]=n;else if(i==="r1")this.buttonActions[5][r]=n;else if(i==="r2")this.buttonActions[7][r]=n;else if(i==="l1")this.buttonActions[4][r]=n;else if(i==="l2")this.buttonActions[6][r]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][r]=n:We(Re.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const a=i.match(/^(up|down|left|right)(\d+)$/),l=a[1],s=parseInt(a[2]);s>=0&&s<this.axes?this.axesActions[s][l][r]=n:We(Re.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const a=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][a][r]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<e.buttons;i++)e.buttonActions[i]=Pi();for(let i=0;i<e.axes;i++)e.axesActions[i]={down:Pi(),left:Pi(),right:Pi(),up:Pi()},e.axeValues[i]=[0,0];return t.hapticActuators?typeof t.hapticActuators.pulse=="function"?(e.hapticActuator=t.hapticActuators,e.vibrationMode=0,e.vibration=!0):t.hapticActuators[0]&&typeof t.hapticActuators[0].pulse=="function"&&(e.hapticActuator=t.hapticActuators[0],e.vibrationMode=0,e.vibration=!0):t.vibrationActuator&&typeof t.vibrationActuator.playEffect=="function"&&(e.hapticActuator=t.vibrationActuator,e.vibrationMode=1,e.vibration=!0),e}},ii={gamepads:{},axeThreshold:[1],isReady:Ss(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(t){return this.gamepads[t]?this.gamepads[t]:null},set:function(t,e){if(["axeThreshold"].indexOf(t)>=0){if(t==="axeThreshold"&&(!parseFloat(e)||e<0||e>1)){We(Re.INVALID_VALUE_NUMBER);return}if(this[t]=e,t==="axeThreshold"){const n=this.getGamepads(),r=Object.keys(n);for(let a=0;a<r.length;a++)n[r[a]].set("axeThreshold",this.axeThreshold)}}else We(Re.INVALID_PROPERTY)},checkStatus:function(){const t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,e=Object.keys(ii.gamepads);ii.onBeforeCycle();for(let i=0;i<e.length;i++)ii.gamepads[e[i]].checkStatus();ii.onAfterCycle(),e.length>0&&t(ii.checkStatus)},init:function(){window.addEventListener("gamepadconnected",t=>{const e=t.gamepad||t.detail.gamepad;if(mr(Re.ON),window.gamepads||(window.gamepads={}),e){if(!window.gamepads[e.index]){window.gamepads[e.index]=e;const i=Os.init(e);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",t=>{const e=t.gamepad||t.detail.gamepad;mr(Re.OFF),e&&(delete window.gamepads[e.index],delete this.gamepads[e.index],this.onDisconnect(e.index))})},on:function(t,e){switch(t){case"connect":this.onConnect=e;break;case"disconnect":this.onDisconnect=e;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=e;break;case"afterCycle":case"aftercycle":this.onAfterCycle=e;break;default:We(Re.UNKNOWN_EVENT);break}return this},off:function(t){switch(t){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:We(Re.UNKNOWN_EVENT);break}return this}};ii.init();var Ci={},Mi={},ra;function Rs(){if(ra)return Mi;ra=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.MiniSignal=void 0;const t=Symbol("SIGNAL");function e(n){return typeof n=="object"&&t in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...r){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let a=this._head;if(a==null)return!1;for(this._dispatching=!0;a!=null;)a.fn(...r),a=a.next;return this._dispatching=!1,!0}add(r){if(typeof r!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:r}))}detach(r){if(!e(r))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(r[t]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const a=this._refMap.get(r);return a?(this._refMap.delete(r),this._disconnectNode(a),this._destroyNode(a),this):this}detachAll(){let r=this._head;if(r==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;r!=null;)this._destroyNode(r),r=r.next;return this}_destroyNode(r){r.fn=void 0,r.prev=void 0}_disconnectNode(r){r===this._head?(this._head=r.next,r.next==null&&(this._tail=void 0)):r===this._tail&&(this._tail=r.prev,this._tail!=null&&(this._tail.next=void 0)),r.prev!=null&&(r.prev.next=r.next),r.next!=null&&(r.next.prev=r.prev)}_addNode(r){return this._head==null?(this._head=r,this._tail=r):(this._tail.next=r,r.prev=this._tail,this._tail=r),r}_createRef(r){const a={[t]:this._symbol};return this._refMap.set(a,r),a}_getRef(r){return this._refMap.get(r)}}return Mi.MiniSignal=i,Mi}var aa;function As(){return aa||(aa=1,function(t){var e=Ci.__createBinding||(Object.create?function(n,r,a,l){l===void 0&&(l=a);var s=Object.getOwnPropertyDescriptor(r,a);(!s||("get"in s?!r.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return r[a]}}),Object.defineProperty(n,l,s)}:function(n,r,a,l){l===void 0&&(l=a),n[l]=r[a]}),i=Ci.__exportStar||function(n,r){for(var a in n)a!=="default"&&!Object.prototype.hasOwnProperty.call(r,a)&&e(r,n,a)};Object.defineProperty(t,"__esModule",{value:!0}),i(Rs(),t)}(Ci)),Ci}var wn=As();const Ln=(t,e)=>{const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},Is=(t,e)=>{const i=e.x-t.x,n=e.y-t.y;return Ls(Math.atan2(n,i))},ks=(t,e,i)=>{const n={x:0,y:0};return i=wr(i),n.x=t.x-e*Math.cos(i),n.y=t.y-e*Math.sin(i),n},wr=t=>t*(Math.PI/180),Ls=t=>t*(180/Math.PI),Ds=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,tr=new Map,oa=t=>{tr.has(t)&&clearTimeout(tr.get(t)),tr.set(t,setTimeout(t,100))},Fn=(t,e,i)=>{const n=e.split(/[ ,]+/g);let r;for(let a=0;a<n.length;a+=1)r=n[a],t.addEventListener?t.addEventListener(r,i,!1):t.attachEvent&&t.attachEvent(r,i)},sa=(t,e,i)=>{const n=e.split(/[ ,]+/g);let r;for(let a=0;a<n.length;a+=1)r=n[a],t.removeEventListener?t.removeEventListener(r,i):t.detachEvent&&t.detachEvent(r,i)},fo=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),la=()=>{const t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},ca=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},Pr=(t,e,i)=>{const n=uo(t);for(let r in n)if(n.hasOwnProperty(r))if(typeof e=="string")n[r]=e+" "+i;else{let a="";for(let l=0,s=e.length;l<s;l+=1)a+=e[l]+" "+i+", ";n[r]=a.slice(0,-2)}return n},Ps=(t,e)=>{const i=uo(t);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i},uo=t=>{const e={};return e[t]="",["webkit","Moz","o"].forEach(function(n){e[n+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},er=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},Cs=(t,e)=>{const i={};for(let n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:t.hasOwnProperty(n)&&(i[n]=t[n]);return i},yr=(t,e)=>{if(t.length)for(let i=0,n=t.length;i<n;i+=1)e(t[i]);else e(t)},Ms=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});var zs="ontouchstart"in window,Fs=!!window.PointerEvent,Ns=!!window.MSPointerEvent,zi={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},mi,un={};Fs?mi=zi.pointer:Ns?mi=zi.MSPointer:zs?(mi=zi.touch,un=zi.mouse):mi=zi.mouse;function $e(){}$e.prototype.on=function(t,e){var i=this,n=t.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var a=0;a<n.length;a+=1)r=n[a],i._handlers_[r]=i._handlers_[r]||[],i._handlers_[r].push(e);return i};$e.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};$e.prototype.trigger=function(t,e){var i=this,n=t.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var a=0;a<n.length;a+=1)r=n[a],i._handlers_[r]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(l){l.call(i,{type:r,target:i},e)})};$e.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=Cs(e.options,t))};$e.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},Fn(t,mi[e],i._domHandlers_[e]),un[e]&&Fn(t,un[e],i._domHandlers_[e]),i};$e.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},sa(t,mi[e],i._domHandlers_[e]),un[e]&&sa(t,un[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};function oe(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=oe.id,oe.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}oe.prototype=new $e;oe.constructor=oe;oe.id=0;oe.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};oe.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=Ps("borderRadius","50%"),i=Pr("transition","opacity",t),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},er(n.el,i),this.options.shape==="circle"&&er(n.back,e),er(n.front,e),this.applyStyles(n),this};oe.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};oe.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};oe.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};oe.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};oe.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};oe.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,n)}return e};oe.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",r={};r.front=Pr("transition",["transform"],n);var a={front:{}};a.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(r),i.applyStyles(a),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};oe.prototype.restCallback=function(){var t=this,e={};e.front=Pr("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};oe.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};oe.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,n=Math.PI/2,r,a,l;if(e>i&&e<i*3&&!t.lockX?r="up":e>-i&&e<=i&&!t.lockY?r="left":e>-i*3&&e<=-i&&!t.lockX?r="down":t.lockY||(r="right"),t.lockY||(e>-n&&e<n?a="left":a="right"),t.lockX||(e>0?l="up":l="down"),t.force>this.options.threshold){var s={},f;for(f in this.direction)this.direction.hasOwnProperty(f)&&(s[f]=this.direction[f]);var c={};this.direction={x:a,y:l,angle:r},t.direction=this.direction;for(f in s)s[f]===this.direction[f]&&(c[f]=!0);if(c.x&&c.y&&c.angle)return t;(!c.x||!c.y)&&this.trigger("plain",t),c.x||this.trigger("plain:"+a,t),c.y||this.trigger("plain:"+l,t),c.angle||this.trigger("dir dir:"+r,t)}else this.resetDirection();return t};function ae(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=ae.id,ae.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}ae.prototype=new $e;ae.constructor=ae;ae.id=0;ae.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var n=0,r=e.length;n<r;n+=1)if(e[n].identifier===i)return e[n];return!1}};ae.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};ae.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};ae.prototype.createNipple=function(t,e){var i=this,n=i.manager.scroll,r={},a=i.options,l={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(t.x&&t.y)r={x:t.x-l.x,y:t.y-l.y};else if(t.top||t.right||t.bottom||t.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=t.top,s.style.right=t.right,s.style.bottom=t.bottom,s.style.left=t.left,s.style.position="absolute",a.zone.appendChild(s);var f=s.getBoundingClientRect();a.zone.removeChild(s),r=t,t={x:f.left+n.x,y:f.top+n.y}}var c=new oe(i,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:e,position:t,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(ca(c.ui.el,r),ca(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};ae.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};ae.prototype.bindNipple=function(t){var e=this,i,n=function(r,a){i=r.type+" "+a.id+":"+r.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)};ae.prototype.pressureFn=function(t,e,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var a=t.force||t.pressure||t.webkitForce||0;a!==r&&(e.trigger("pressure",a),n.trigger("pressure "+e.identifier+":pressure",a),r=a)}).bind(n),100)};ae.prototype.onstart=function(t){var e=this,i=e.options,n=t;t=fo(t),e.updateBox();var r=function(a){e.actives.length<i.maxNumberOfNipples?e.processOnStart(a):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(l){if(Object.values(n.touches).findIndex(function(f){return f.identifier===l})<0){var s=[t[0]];s.identifier=l,e.processOnEnd(s)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(a))};return yr(t,r),e.manager.bindDocument(),!1};ae.prototype.processOnStart=function(t){var e=this,i=e.options,n,r=e.manager.getIdentifier(t),a=t.force||t.pressure||t.webkitForce||0,l={x:t.pageX,y:t.pageY},s=e.getOrCreate(r,l);s.identifier!==r&&e.manager.removeIdentifier(s.identifier),s.identifier=r;var f=function(h){h.trigger("start",h),e.trigger("start "+h.id+":start",h),h.show(),a>0&&e.pressureFn(t,h,h.identifier),e.processOnMove(t)};if((n=e.idles.indexOf(s))>=0&&e.idles.splice(n,1),e.actives.push(s),e.ids.push(s.identifier),i.mode!=="semi")f(s);else{var c=Ln(l,s.position);if(c<=i.catchDistance)f(s);else{s.destroy(),e.processOnStart(t);return}}return s};ae.prototype.getOrCreate=function(t,e){var i=this,n=i.options,r;return/(semi|static)/.test(n.mode)?(r=i.idles[0],r?(i.idles.splice(0,1),r):n.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(r=i.createNipple(e,t),r)};ae.prototype.processOnMove=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),r=e.nipples.get(n),a=e.manager.scroll;if(!Ds(t)){this.processOnEnd(t);return}if(!r){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(i.dynamicPage){var l=r.el.getBoundingClientRect();r.position={x:a.x+l.left,y:a.y+l.top}}r.identifier=n;var s=r.options.size/2,f={x:t.pageX,y:t.pageY};i.lockX&&(f.y=r.position.y),i.lockY&&(f.x=r.position.x);var c=Ln(f,r.position),h=Is(f,r.position),m=wr(h),w=c/s,p={distance:c,position:f},b,O;if(r.options.shape==="circle"?(b=Math.min(c,s),O=ks(r.position,b,h)):(O=Ms(f,r.position,s),b=Ln(O,r.position)),i.follow){if(c>s){let T=f.x-O.x,x=f.y-O.y;r.position.x+=T,r.position.y+=x,r.el.style.top=r.position.y-(e.box.top+a.y)+"px",r.el.style.left=r.position.x-(e.box.left+a.x)+"px",c=Ln(f,r.position)}}else f=O,c=b;var k=f.x-r.position.x,Y=f.y-r.position.y;r.frontPosition={x:k,y:Y},i.dataOnly||(r.ui.front.style.transform="translate("+k+"px,"+Y+"px)");var H={identifier:r.identifier,position:f,force:w,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:m,degree:h},vector:{x:k/s,y:-Y/s},raw:p,instance:r,lockX:i.lockX,lockY:i.lockY};H=r.computeDirection(H),H.angle={radian:wr(180-h),degree:180-h},r.trigger("move",H),e.trigger("move "+r.id+":move",H)};ae.prototype.processOnEnd=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),r=e.nipples.get(n),a=e.manager.removeIdentifier(r.identifier);r&&(i.dataOnly||r.hide(function(){i.mode==="dynamic"&&(r.trigger("removed",r),e.trigger("removed "+r.id+":removed",r),e.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(e.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),e.trigger("end "+r.id+":end",r),e.ids.indexOf(r.identifier)>=0&&e.ids.splice(e.ids.indexOf(r.identifier),1),e.actives.indexOf(r)>=0&&e.actives.splice(e.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?e.idles.push(r):e.nipples.indexOf(r)>=0&&e.nipples.splice(e.nipples.indexOf(r),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[a.id]=a.identifier))};ae.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};ae.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};function se(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=la(),e.config(t),e.prepareCollections();var i=function(){var r;e.collections.forEach(function(a){a.forEach(function(l){r=l.el.getBoundingClientRect(),l.position={x:e.scroll.x+r.left,y:e.scroll.y+r.top}})})};Fn(window,"resize",function(){oa(i)});var n=function(){e.scroll=la()};return Fn(window,"scroll",function(){oa(n)}),e.collections}se.prototype=new $e;se.constructor=se;se.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(n){return i=n.get(e),!i}),i}};se.prototype.create=function(t){return this.createCollection(t)};se.prototype.createCollection=function(t){var e=this,i=new ae(e,t);return e.bindCollection(i),e.collections.push(i),i};se.prototype.bindCollection=function(t){var e=this,i,n=function(r,a){i=r.type+" "+a.id+":"+r.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)};se.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};se.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};se.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};se.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};se.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};se.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};se.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};se.prototype.onAny=function(t,e){var i=this,n,r="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=fo(e);var a=function(s,f,c){c.ids.indexOf(f)>=0&&(c[r](s),s._found_=!0)},l=function(s){n=i.getIdentifier(s),yr(i.collections,a.bind(null,s,n)),s._found_||i.removeIdentifier(n)};return yr(e,l),!1};se.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};se.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const fa=new se,ir={create:function(t){return fa.create(t)},factory:fa},Bs=!1,Us=Bs,ho=window.matchMedia("(prefers-reduced-motion: reduce)")===!0||window.matchMedia("(prefers-reduced-motion: reduce)").matches===!0,_o="The Forgotten Adventures of Kroz",Ai=80,Ge=25,ri=1,bi=Ai-16,ai=1,Nn=Ge-2,Dt=63,Pt=22,an=1,Vs=8,Ws=.005,hn=!ho,Fi=" ";function zt(t=0){return new Promise(e=>{setTimeout(()=>e(),t)})}function ua(t,e,i){return Math.min(Math.max(t,e),i)}const Gs={8216:145,8217:146,8220:147,8221:148,8226:149,8211:150,8212:151,402:159},Hs={145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,159:402};function ha(t){const e=t.charCodeAt(0);return Gs[e]||e}function $s(t){const e=Hs[t]||t;return String.fromCharCode(e)}function wi(t){if(Array.isArray(t)){const e={};for(const i of t)e[i.name]=i.value;return e}return t}function _i(t,e,i,n){return t.padStart(e,n).padEnd(i,n)}function js(t){let e=t.length;for(;e!=0;){const i=Math.floor(Math.random()*e);e--,[t[e],t[i]]=[t[i],t[e]]}return t}function Ys(t,e){return t.replace(new RegExp(`(?![^\\n]{1,${e}}$)([^\\n]{1,${e}})\\s`,"g"),`$1
`)}const vr=new wn.MiniSignal,Ne=new wn.MiniSignal,Be=new wn.MiniSignal;let pi=null;var ie=(t=>(t[t.North=1]="North",t[t.South=2]="South",t[t.East=3]="East",t[t.West=4]="West",t[t.Northwest=5]="Northwest",t[t.Northeast=6]="Northeast",t[t.Southwest=7]="Southwest",t[t.Southeast=8]="Southeast",t[t.Whip=9]="Whip",t[t.FreeItems=10]="FreeItems",t[t.NextLevel=11]="NextLevel",t[t.NextLevelCheat=12]="NextLevelCheat",t[t.PrevLevel=13]="PrevLevel",t[t.Teleport=14]="Teleport",t[t.ResetFound=15]="ResetFound",t[t.HideFound=16]="HideFound",t[t.Pause=17]="Pause",t[t.Quit=18]="Quit",t[t.Save=19]="Save",t[t.Restore=20]="Restore",t[t.SlowerClock=21]="SlowerClock",t[t.FasterClock=22]="FasterClock",t))(ie||{});const Me={},de={},Wn={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:14,T:14,")":10,"+":15,"-":16,"(":12,PageDown:null,PageUp:null,p:17,P:17,q:18,Q:18,s:19,S:19,r:20,R:20,F11:21,F12:22},be={button0:"w",button1:"t",button2:"s",button3:"r",button4:null,button5:null,button6:"F11",button7:"F12",button8:"s",button9:"p",button16:"Escape",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",button12:"ArrowUp",button13:"ArrowDown",button14:"ArrowLeft",button15:"ArrowRight"};function qs(){pi||ii.on("connect",t=>{if(!pi){pi=t,pi.axeThreshold=[.5,.5];for(const[e,i]of Object.entries(be))i&&(pi.before(e,()=>Ne.dispatch(i)),pi.after(e,()=>Be.dispatch(i)))}})}let nr=null,rr=null,ar=null;const Zs="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;function Xs(){nr||!Zs||(document.querySelectorAll(".touch_zone").forEach(t=>{t.style.display="block"}),nr=ir.create({zone:document.querySelector(".touch_zone--axis"),mode:"dynamic",threshold:.5,dynamicPage:!0,position:{left:"50px",bottom:"50px"},restOpacity:.3}),nr.on("move end",(t,e)=>{if(e.force<.5)return;const i=.3,{x:n,y:r}=e.vector||{x:0,y:0};n>i&&!En(3)?Ne.dispatch(be.right):n<-i&&!En(4)?Ne.dispatch(be.left):Math.abs(n)<=i&&(Be.dispatch(be.right),Be.dispatch(be.left)),r>i&&!En(1)?Ne.dispatch(be.up):r<-i&&!En(2)?Ne.dispatch(be.down):Math.abs(r)<=i&&(Be.dispatch(be.up),Be.dispatch(be.down))}),rr=ir.create({zone:document.querySelector(".touch_zone--button-0"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{left:"50px",bottom:"50px"}}),rr.on("start",()=>Ne.dispatch(be.button0)),rr.on("end",()=>Be.dispatch(be.button0)),ar=ir.create({zone:document.querySelector(".touch_zone--button-1"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{right:"50px",top:"50px"}}),ar.on("start",()=>Ne.dispatch(be.button1)),ar.on("end",()=>Be.dispatch(be.button1)))}function Ks(t){t.repeat||(Wn[t.key]&&t.preventDefault(),Ne.dispatch(t.key))}function Js(t){Wn[t.key]&&t.preventDefault(),Be.dispatch(t.key)}Ne.add(t=>{Me[t]=3;const e=Wn[t];e&&(de[e]=3)});Be.add(t=>{(Me[t]||0)&3&&vr.dispatch(t),Me[t]&=-2,Me[t]|=4;const e=Wn[t];e&&(de[e]&=-2,de[e]|=4)});function Qs(){qs(),Xs(),window.addEventListener("keydown",Ks),window.addEventListener("keyup",Js)}function bn(){for(const t in Me)Me[t]&&(Me[t]=0)}function br(){for(const t in de)Object.prototype.hasOwnProperty.call(de,t)&&delete de[t];for(const t in Me)Object.prototype.hasOwnProperty.call(Me,t)&&delete Me[t]}function tl(){for(const t in de){const e=t;if(!de[e])continue;const i=!!(de[e]&2);de[e]&=-15,i&&(de[e]|=8)}}function En(t){return!!(de[t]&1)}function De(t){return!!(de[t]&3)&&!(de[t]&8)}function Pe(t){return!!(de[t]&4)}async function on(){return br(),new Promise(t=>{const e=vr.add(i=>{vr.detach(e),t(i)})})}async function Gn(t,e=50){const i=on();do await(t==null?void 0:t());while(!await Promise.race([i,zt(e)]));return i}class Cr{getContainer(){return null}setOptions(e){this._options=e}}class Mr extends Cr{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(e){requestAnimationFrame(e)}getContainer(){return this._ctx.canvas}setOptions(e){super.setOptions(e);const n=`${e.fontStyle?`${e.fontStyle} `:""} ${e.fontSize}px ${e.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const e=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=e}eventToPosition(e,i){let n=this._ctx.canvas,r=n.getBoundingClientRect();return e-=r.left,i-=r.top,e*=n.width/r.width,i*=n.height/r.height,e<0||i<0||e>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(e,i)}}function po(t,e){return(t%e+e)%e}class go extends Mr{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(e,i){let[n,r,a,l,s]=e,f=[(n+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&f.reverse(),i&&(this._ctx.fillStyle=s,this._fill(f[0],f[1])),!a)return;this._ctx.fillStyle=l;let c=[].concat(a);for(let h=0;h<c.length;h++)this._ctx.fillText(c[h],f[0],Math.ceil(f[1]))}computeSize(e,i){this._options.transpose&&(e+=i,i=e-i,e-=i);let n=Math.floor(e/this._spacingX)-1,r=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,r]}computeFontSize(e,i){this._options.transpose&&(e+=i,i=e-i,e-=i);let n=2*e/((this._options.width+1)*Math.sqrt(3))-1,r=i/(2+1.5*(this._options.height-1)),a=Math.min(n,r),l=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=l;let f=s/100;a=Math.floor(a)+1;let c=2*a/(this._options.spacing*(1+f/Math.sqrt(3)));return Math.ceil(c)-1}_normalizedEventToPosition(e,i){let n;this._options.transpose?(e+=i,i=e-i,e-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let r=n/this._options.height;return i=Math.floor(i/r),po(i,2)?(e-=this._spacingX,e=1+2*Math.floor(e/(2*this._spacingX))):e=2*Math.floor(e/(2*this._spacingX)),[e,i]}_fill(e,i){let n=this._hexSize,r=this._options.border;const a=this._ctx;a.beginPath(),this._options.transpose?(a.moveTo(e-n+r,i),a.lineTo(e-n/2+r,i+this._spacingX-r),a.lineTo(e+n/2-r,i+this._spacingX-r),a.lineTo(e+n-r,i),a.lineTo(e+n/2-r,i-this._spacingX+r),a.lineTo(e-n/2+r,i-this._spacingX+r),a.lineTo(e-n+r,i)):(a.moveTo(e,i-n+r),a.lineTo(e+this._spacingX-r,i-n/2+r),a.lineTo(e+this._spacingX-r,i+n/2-r),a.lineTo(e,i+n-r),a.lineTo(e-this._spacingX+r,i+n/2-r),a.lineTo(e-this._spacingX+r,i-n/2+r),a.lineTo(e,i-n+r)),a.fill()}_updateSize(){const e=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(e.spacing*(e.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,r;e.transpose?(n="height",r="width"):(n="width",r="height"),this._ctx.canvas[n]=Math.ceil((e.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((e.height-1)*this._spacingY+2*this._hexSize)}}class yn extends Mr{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(e){super.setOptions(e),this._canvasCache={}}draw(e,i){yn.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(e){let[i,n,r,a,l]=e,s=""+r+a+l,f;if(s in this._canvasCache)f=this._canvasCache[s];else{let c=this._options.border;f=document.createElement("canvas");let h=f.getContext("2d");if(f.width=this._spacingX,f.height=this._spacingY,h.fillStyle=l,h.fillRect(c,c,f.width-c,f.height-c),r){h.fillStyle=a,h.font=this._ctx.font,h.textAlign="center",h.textBaseline="middle";let m=[].concat(r);for(let w=0;w<m.length;w++)h.fillText(m[w],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[s]=f}this._ctx.drawImage(f,i*this._spacingX,n*this._spacingY)}_drawNoCache(e,i){let[n,r,a,l,s]=e;if(i){let c=this._options.border;this._ctx.fillStyle=s,this._ctx.fillRect(n*this._spacingX+c,r*this._spacingY+c,this._spacingX-c,this._spacingY-c)}if(!a)return;this._ctx.fillStyle=l;let f=[].concat(a);for(let c=0;c<f.length;c++)this._ctx.fillText(f[c],(n+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(e,i){let n=Math.floor(e/this._spacingX),r=Math.floor(i/this._spacingY);return[n,r]}computeFontSize(e,i){let n=Math.floor(e/this._options.width),r=Math.floor(i/this._options.height),a=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let l=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=a;let f=l/100*r/n;return f>1&&(r=Math.floor(r/f)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(e,i){return[Math.floor(e/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const e=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(e.spacing*i),this._spacingY=Math.ceil(e.spacing*e.fontSize),e.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=e.width*this._spacingX,this._ctx.canvas.height=e.height*this._spacingY}}yn.cache=!1;class mo extends Mr{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(e,i){let[n,r,a,l,s]=e,f=this._options.tileWidth,c=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*f,r*c,f,c):(this._ctx.fillStyle=s,this._ctx.fillRect(n*f,r*c,f,c))),!a)return;let h=[].concat(a),m=[].concat(l),w=[].concat(s);for(let p=0;p<h.length;p++){let b=this._options.tileMap[h[p]];if(!b)throw new Error(`Char "${h[p]}" not found in tileMap`);if(this._options.tileColorize){let O=this._colorCanvas,k=O.getContext("2d");k.globalCompositeOperation="source-over",k.clearRect(0,0,f,c);let Y=m[p],H=w[p];k.drawImage(this._options.tileSet,b[0],b[1],f,c,0,0,f,c),Y!="transparent"&&(k.fillStyle=Y,k.globalCompositeOperation="source-atop",k.fillRect(0,0,f,c)),H!="transparent"&&(k.fillStyle=H,k.globalCompositeOperation="destination-over",k.fillRect(0,0,f,c)),this._ctx.drawImage(O,n*f,r*c,f,c)}else this._ctx.drawImage(this._options.tileSet,b[0],b[1],f,c,n*f,r*c,f,c)}}computeSize(e,i){let n=Math.floor(e/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(e,i){return[Math.floor(e/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const e=this._options;this._ctx.canvas.width=e.width*e.tileWidth,this._ctx.canvas.height=e.height*e.tileHeight,this._colorCanvas.width=e.tileWidth,this._colorCanvas.height=e.tileHeight}}const xn=23283064365386963e-26;class zr{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(e){return e=e<1?1/e:e,this._seed=e,this._s0=(e>>>0)*xn,e=e*69069+1>>>0,this._s1=e*xn,e=e*69069+1>>>0,this._s2=e*xn,this._c=1,this}getUniform(){let e=2091639*this._s0+this._c*xn;return this._s0=this._s1,this._s1=this._s2,this._c=e|0,this._s2=e-this._c,this._s2}getUniformInt(e,i){let n=Math.max(e,i),r=Math.min(e,i);return Math.floor(this.getUniform()*(n-r+1))+r}getNormal(e=0,i=1){let n,r,a;do n=2*this.getUniform()-1,r=2*this.getUniform()-1,a=n*n+r*r;while(a>1||a==0);let l=n*Math.sqrt(-2*Math.log(a)/a);return e+l*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(e){return e.length?e[Math.floor(this.getUniform()*e.length)]:null}shuffle(e){let i=[],n=e.slice();for(;n.length;){let r=n.indexOf(this.getItem(n));i.push(n.splice(r,1)[0])}return i}getWeightedValue(e){let i=0;for(let l in e)i+=e[l];let n=this.getUniform()*i,r,a=0;for(r in e)if(a+=e[r],n<a)return r;return r}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(e){return this._s0=e[0],this._s1=e[1],this._s2=e[2],this._c=e[3],this}clone(){return new zr().setState(this.getState())}}const C=new zr().setSeed(Date.now());function wo(t){let e,i;if(t in or)e=or[t];else{if(t.charAt(0)=="#"){let r=(t.match(/[0-9a-f]/gi)||[]).map(a=>parseInt(a,16));if(r.length==3)e=r.map(a=>a*17);else{for(let a=0;a<3;a++)r[a+1]+=16*r[a],r.splice(a,1);e=r}}else(i=t.match(/rgb\(([0-9, ]+)\)/i))?e=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):e=[0,0,0];or[t]=e}return e.slice()}const or={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class yo extends Cr{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(e){typeof e=="string"?alert(e):e instanceof Error&&alert(e.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(e){requestAnimationFrame(e)}getContainer(){return this._gl.canvas}setOptions(e){super.setOptions(e),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(e,i){const n=this._gl,r=this._options;let[a,l,s,f,c]=e,h=n.canvas.height-(l+1)*r.tileHeight;if(n.scissor(a*r.tileWidth,h,r.tileWidth,r.tileHeight),i&&(r.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...Tn(c)),n.clear(n.COLOR_BUFFER_BIT)),!s)return;let m=[].concat(s),w=[].concat(c),p=[].concat(f);n.uniform2fv(this._uniforms.targetPosRel,[a,l]);for(let b=0;b<m.length;b++){let O=this._options.tileMap[m[b]];if(!O)throw new Error(`Char "${m[b]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,O),r.tileColorize&&(n.uniform4fv(this._uniforms.tint,Tn(p[b])),n.uniform4fv(this._uniforms.bg,Tn(w[b]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const e=this._gl;e.clearColor(...Tn(this._options.bg)),e.scissor(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}computeSize(e,i){let n=Math.floor(e/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(e,i){let n=this._gl.canvas,r=n.getBoundingClientRect();return e-=r.left,i-=r.top,e*=n.width/r.width,i*=n.height/r.height,e<0||i<0||e>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(e,i)}_initWebGL(){let e=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=e;let i=rl(e,il,nl);return e.useProgram(i),al(e),el.forEach(n=>this._uniforms[n]=e.getUniformLocation(i,n)),this._program=i,e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.SCISSOR_TEST),e}_normalizedEventToPosition(e,i){return[Math.floor(e/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const e=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];e.canvas.width=n[0],e.canvas.height=n[1],e.viewport(0,0,n[0],n[1]),e.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),e.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(e){ol(this._gl,e)}}const el=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],il=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),nl=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function rl(t,e,i){const n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,r),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(a)||"");return a}function al(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}function ol(t,e){let i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i}let sr={};function Tn(t){if(!(t in sr)){let e;if(t=="transparent")e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)e[i]=e[i]/255}else e=wo(t).map(i=>i/255),e.push(1);sr[t]=e}return sr[t]}function sl(t){return`\x1B[0;48;5;${Er(t)}m\x1B[2J`}function ll(t,e){return`\x1B[0;38;5;${Er(t)};48;5;${Er(e)}m`}function cl(t,e){return`\x1B[${e+1};${t+1}H`}function Er(t){const n=.0234375;let r=wo(t),a=Math.floor(r[0]*n),l=Math.floor(r[1]*n),s=Math.floor(r[2]*n);return a*36+l*6+s*1+16}class vo extends Cr{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(e){setTimeout(e,1e3/60)}setOptions(e){super.setOptions(e);let i=[e.width,e.height],n=this.computeSize();this._offset=n.map((r,a)=>Math.floor((r-i[a])/2))}clear(){process.stdout.write(sl(this._options.bg))}draw(e,i){let[n,r,a,l,s]=e,f=this._offset[0]+n,c=this._offset[1]+r,h=this.computeSize();if(f<0||f>=h[0]||c<0||c>=h[1]||((f!==this._cursor[0]||c!==this._cursor[1])&&(process.stdout.write(cl(f,c)),this._cursor[0]=f,this._cursor[1]=c),i&&(a||(a=" ")),!a))return;let m=ll(l,s);if(m!==this._lastColor&&(process.stdout.write(m),this._lastColor=m),a!="	"){let w=[].concat(a);process.stdout.write(w[0])}this._cursor[0]++,this._cursor[0]>=h[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(e,i){return[e,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const fl=/%([bc]){([^}]*)}/g,Ei=0,sn=1,bo=2,Eo=3;function ul(t,e){let i=[],n=0;t.replace(fl,function(a,l,s,f){let c=t.substring(n,f);return c.length&&i.push({type:Ei,value:c}),i.push({type:l=="c"?bo:Eo,value:s.trim()}),n=f+a.length,""});let r=t.substring(n);return r.length&&i.push({type:Ei,value:r}),hl(i,e)}function hl(t,e){e||(e=1/0);let i=0,n=0,r=-1;for(;i<t.length;){let l=t[i];if(l.type==sn&&(n=0,r=-1),l.type!=Ei){i++;continue}for(;n==0&&l.value.charAt(0)==" ";)l.value=l.value.substring(1);let s=l.value.indexOf(`
`);if(s!=-1){l.value=Sn(t,i,s,!0);let f=l.value.split("");for(;f.length&&f[f.length-1]==" ";)f.pop();l.value=f.join("")}if(!l.value.length){t.splice(i,1);continue}if(n+l.value.length>e){let f=-1;for(;;){let c=l.value.indexOf(" ",f+1);if(c==-1||n+c>e)break;f=c}if(f!=-1)l.value=Sn(t,i,f,!0);else if(r!=-1){let c=t[r],h=c.value.lastIndexOf(" ");c.value=Sn(t,r,h,!0),i=r}else l.value=Sn(t,i,e-n,!1)}else n+=l.value.length,l.value.indexOf(" ")!=-1&&(r=i);i++}t.push({type:sn});let a=null;for(let l=0;l<t.length;l++){let s=t[l];switch(s.type){case Ei:a=s;break;case sn:if(a){let f=a.value.split("");for(;f.length&&f[f.length-1]==" ";)f.pop();a.value=f.join("")}a=null;break}}return t.pop(),t}function Sn(t,e,i,n){let r={type:sn},a={type:Ei,value:t[e].value.substring(i+(n?1:0))};return t.splice(e+1,0,r,a),t[e].value.substring(0,i)}let xo=80,To=25;const Ue={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},dl={hex:go,rect:yn,tile:mo,"tile-gl":yo,term:vo},_l={width:xo,height:To,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class oi{constructor(e={}){this._data={},this._dirty=!1,this._options={},e=Object.assign({},_l,e),this.setOptions(e),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(e,i,n){let r=[this._options.bg,this._options.fg];this.draw(e,i,null,null,r[n%r.length])}clear(){this._data={},this._dirty=!0}setOptions(e){if(Object.assign(this._options,e),e.width||e.height||e.fontSize||e.fontFamily||e.spacing||e.layout){if(e.layout){let i=dl[e.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(e,i){return this._backend.computeSize(e,i)}computeFontSize(e,i){return this._backend.computeFontSize(e,i)}computeTileSize(e,i){let n=Math.floor(e/this._options.width),r=Math.floor(i/this._options.height);return[n,r]}eventToPosition(e){let i,n;return"touches"in e?(i=e.touches[0].clientX,n=e.touches[0].clientY):(i=e.clientX,n=e.clientY),this._backend.eventToPosition(i,n)}draw(e,i,n,r,a){r||(r=this._options.fg),a||(a=this._options.bg);let l=`${e},${i}`;this._data[l]=[e,i,n,r,a],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[l]=!0)}drawOver(e,i,n,r,a){const l=`${e},${i}`,s=this._data[l];s?(s[2]=n||s[2],s[3]=r||s[3],s[4]=a||s[4]):this.draw(e,i,n,r,a)}drawText(e,i,n,r){let a=null,l=null,s=e,f=i,c=1;r||(r=this._options.width-e);let h=ul(n,r);for(;h.length;){let m=h.shift();switch(m.type){case Ei:let w=!1,p=!1,b=!1,O=!1;for(let k=0;k<m.value.length;k++){let Y=m.value.charCodeAt(k),H=m.value.charAt(k);if(this._options.layout==="term"){let T=Y>>8;if(T===17||T>=46&&T<=159||T>=172&&T<=215||Y>=43360&&Y<=43391){this.draw(s+0,f,H,a,l),this.draw(s+1,f,"	",a,l),s+=2;continue}}b=Y>65280&&Y<65377||Y>65500&&Y<65512||Y>65518,w=H.charCodeAt(0)==32||H.charCodeAt(0)==12288,O&&!b&&!w&&s++,b&&!p&&s++,this.draw(s++,f,H,a,l),p=w,O=b}break;case bo:a=m.value||null;break;case Eo:l=m.value||null;break;case sn:s=e,f++,c++;break}}return c}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let e in this._data)this._draw(e,!1)}else for(let e in this._dirty)this._draw(e,!0);this._dirty=!1}}_draw(e,i){let n=this._data[e];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}oi.Rect=yn;oi.Hex=go;oi.Tile=mo;oi.TileGL=yo;oi.Term=vo;const Hn={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const e=this.x.createBuffer(t.length,t[0].length,this.sampleRate),i=this.x.createBufferSource();return t.map((n,r)=>e.getChannelData(r).set(n)),i.buffer=e,i.connect(this.x.destination),i.start(),i},buildSamples:function(t=1,e=.05,i=220,n=0,r=0,a=.1,l=0,s=1,f=0,c=0,h=0,m=0,w=0,p=0,b=0,O=0,k=0,Y=1,H=0,T=0,x=0){let D=Math.PI*2,N=Kt=>Kt<0?-1:1,$=this.sampleRate,nt=f*=500*D/$/$,K=i*=(1+e*2*Math.random()-e)*D/$,pt=[],wt=0,st=0,tt=0,E=1,I=0,z=0,W=0,j,at,G=2,ot=D*Math.abs(x)*2/$,ct=Math.cos(ot),Rt=Math.sin(ot)/2/G,St=1+Rt,ht=-2*ct/St,mt=(1-Rt)/St,Ft=(1+N(x)*ct)/2/St,Ht=-(N(x)+ct)/St,yt=Ft,At=0,vt=0,Ot=0,Ct=0;for(n=n*$+9,H*=$,r*=$,a*=$,k*=$,c*=500*D/$**3,b*=D/$,h*=D/$,m*=$,w=w*$|0,t*=this.volume,at=n+H+r+a+k|0;tt<at;pt[tt++]=W*t)++z%(O*100|0)||(W=l?l>1?l>2?l>3?Math.sin(wt*wt):Math.max(Math.min(Math.tan(wt),1),-1):1-(2*wt/D%2+2)%2:1-4*Math.abs(Math.round(wt/D)-wt/D):Math.sin(wt),W=(w?1-T+T*Math.sin(D*tt/w):1)*N(W)*Math.abs(W)**s*(tt<n?tt/n:tt<n+H?1-(tt-n)/H*(1-Y):tt<n+H+r?Y:tt<at-k?(at-tt-k)/a*Y:0),W=k?W/2+(k>tt?0:(tt<at-k?1:(at-tt)/k)*pt[tt-k|0]/2/t):W,x&&(W=Ct=yt*At+Ht*(At=vt)+Ft*(vt=W)-mt*Ot-ht*(Ot=Ct))),j=(i+=f+=c)*Math.cos(b*st++),wt+=j+j*p*Math.sin(tt**5),E&&++E>m&&(i+=h,K+=h,E=0),w&&!(++I%w)&&(i=K,f=nt,E=E||1);return pt},getNote:function(t=0,e=440){return e*2**(t/12)}};Hn.volume=Ws;function _t(t,e,i=1){return Hn.play(i,0,t,0,e/1e3,0),zt(e)}async function Fr(){for(let t=1;t<=65;t++)_t(C.getUniformInt(1e3,2e3),1);await zt(0)}async function So(){for(let t=150;t>=35;t--)await _t(t,1)}async function da(){await _t(400,120,5),await zt(10),await _t(700,120,5),await zt(10)}async function ln(){for(let t=1;t<=23;t++)_t(C.getUniformInt(350,900),120);await zt(120);for(let t=1;t<=30;t++)_t(C.getUniformInt(150,200),50)}async function pl(){for(let t=10;t<=90;t++)await _t(t,15,100)}async function gl(){for(let t=150;t>35;t--)await _t(t,16,50)}const ml=Hn.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function Oo(){Hn.playSamples(ml)}async function Ro(){for(let t=1;t<=25;t++)if(Math.random()>.5){const e=C.getUniformInt(0,59)+10;for(let i=1;i<=e;i++)_t(C.getUniformInt(0,4e3)+3e3,16,10)}else await zt(C.getUniformInt(0,29))}async function wl(){for(let t=8e3;t>=20;t--)_t(C.getUniformInt(0,t),1,30);await zt(300)}async function yl(){for(let t=10;t<45;t++)for(let e=1;e<13;e++)await _t(t*t*e,e+1,100)}async function vl(t){await _t(200+200*t,25,100)}async function bl(){await _t(2e3,40,10)}async function El(){await _t(Math.random()*129+30,150,100)}async function xl(){await _t(70,50*8,100)}async function Tl(){for(let t=330;t>20;t--)_t(90,10,.5)}async function Sl(){await _t(400,50)}async function Ol(){await _t(130,50)}async function Rl(){_t(130,25),await _t(90,50)}async function Al(){await _t(20,10,100)}async function Il(){await _t(300,10,10)}async function kl(){for(let t=45;t>=11;t--)for(let e=13;e>=1;e--)await _t(t*t*e,e+1,100)}async function Ll(){for(let t=70;t<=600;t++)_t(t*2,3,10),t%10===0&&await zt(1)}async function Dl(){await _t(30,10,10),await zt(20)}async function Pl(){for(let t=0;t<2500;t++)_t(C.getUniformInt(0,t),5,100),t%25===0&&await zt()}async function Cl(){for(let t=2500;t>50;t--)_t(C.getUniformInt(0,t),5,100),t%25===0&&await zt()}async function Ml(){for(let t=0;t<50;t++)_t(C.getUniformInt(0,200),50,100);await zt(50)}async function zl(){await _t(C.getUniformInt(110,1310),7,100)}async function Fl(){await _t(200,60,100)}async function Nl(){await _t(600,20)}async function Bl(){await _t(90,10,10)}async function Ul(){for(let t=130;t>5;t--)await _t(t*8,16,100)}async function Vl(){for(let t=20;t<8e3;t++)_t(t,1,100);await zt(100)}async function Wl(){for(let t=5;t<70;t++)_t(t*8,1);await zt(50)}let fi=class{constructor(e=xo,i=To){this._width=e,this._height=i}_fillMap(e){let i=[];for(let n=0;n<this._width;n++){i.push([]);for(let r=0;r<this._height;r++)i[n].push(e)}return i}};class Gl extends fi{create(e){let i=this._width-1,n=this._height-1;for(let r=0;r<=i;r++)for(let a=0;a<=n;a++){let l=r&&a&&r<i&&a<n;e(r,a,l?0:1)}return this}}class Ao extends fi{constructor(e,i){super(e,i),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class Io{}class Bn extends Io{constructor(e,i,n,r,a,l){super(),this._x1=e,this._y1=i,this._x2=n,this._y2=r,this._doors={},a!==void 0&&l!==void 0&&this.addDoor(a,l)}static createRandomAt(e,i,n,r,a){let l=a.roomWidth[0],s=a.roomWidth[1],f=C.getUniformInt(l,s);l=a.roomHeight[0],s=a.roomHeight[1];let c=C.getUniformInt(l,s);if(n==1){let h=i-Math.floor(C.getUniform()*c);return new this(e+1,h,e+f,h+c-1,e,i)}if(n==-1){let h=i-Math.floor(C.getUniform()*c);return new this(e-f,h,e-1,h+c-1,e,i)}if(r==1){let h=e-Math.floor(C.getUniform()*f);return new this(h,i+1,h+f-1,i+c,e,i)}if(r==-1){let h=e-Math.floor(C.getUniform()*f);return new this(h,i-c,h+f-1,i-1,e,i)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(e,i,n){let r=n.roomWidth[0],a=n.roomWidth[1],l=C.getUniformInt(r,a);r=n.roomHeight[0],a=n.roomHeight[1];let s=C.getUniformInt(r,a),f=e-Math.floor(C.getUniform()*l),c=i-Math.floor(C.getUniform()*s),h=f+l-1,m=c+s-1;return new this(f,c,h,m)}static createRandom(e,i,n){let r=n.roomWidth[0],a=n.roomWidth[1],l=C.getUniformInt(r,a);r=n.roomHeight[0],a=n.roomHeight[1];let s=C.getUniformInt(r,a),f=e-l-1,c=i-s-1,h=1+Math.floor(C.getUniform()*f),m=1+Math.floor(C.getUniform()*c),w=h+l-1,p=m+s-1;return new this(h,m,w,p)}addDoor(e,i){return this._doors[e+","+i]=1,this}getDoors(e){for(let i in this._doors){let n=i.split(",");e(parseInt(n[0]),parseInt(n[1]))}return this}clearDoors(){return this._doors={},this}addDoors(e){let i=this._x1-1,n=this._x2+1,r=this._y1-1,a=this._y2+1;for(let l=i;l<=n;l++)for(let s=r;s<=a;s++)l!=i&&l!=n&&s!=r&&s!=a||e(l,s)||this.addDoor(l,s);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(e,i){let n=this._x1-1,r=this._x2+1,a=this._y1-1,l=this._y2+1;for(let s=n;s<=r;s++)for(let f=a;f<=l;f++)if(s==n||s==r||f==a||f==l){if(!e(s,f))return!1}else if(!i(s,f))return!1;return!0}create(e){let i=this._x1-1,n=this._x2+1,r=this._y1-1,a=this._y2+1,l=0;for(let s=i;s<=n;s++)for(let f=r;f<=a;f++)s+","+f in this._doors?l=2:s==i||s==n||f==r||f==a?l=1:l=0,e(s,f,l)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class Nr extends Io{constructor(e,i,n,r){super(),this._startX=e,this._startY=i,this._endX=n,this._endY=r,this._endsWithAWall=!0}static createRandomAt(e,i,n,r,a){let l=a.corridorLength[0],s=a.corridorLength[1],f=C.getUniformInt(l,s);return new this(e,i,e+n*f,i+r*f)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(e,i){let n=this._startX,r=this._startY,a=this._endX-n,l=this._endY-r,s=1+Math.max(Math.abs(a),Math.abs(l));a&&(a=a/Math.abs(a)),l&&(l=l/Math.abs(l));let f=l,c=-a,h=!0;for(let p=0;p<s;p++){let b=n+p*a,O=r+p*l;if(i(b,O)||(h=!1),e(b+f,O+c)||(h=!1),e(b-f,O-c)||(h=!1),!h){s=p,this._endX=b-a,this._endY=O-l;break}}if(s==0||s==1&&e(this._endX+a,this._endY+l))return!1;let m=!e(this._endX+a+f,this._endY+l+c),w=!e(this._endX+a-f,this._endY+l-c);return this._endsWithAWall=e(this._endX+a,this._endY+l),!((m||w)&&this._endsWithAWall)}create(e){let i=this._startX,n=this._startY,r=this._endX-i,a=this._endY-n,l=1+Math.max(Math.abs(r),Math.abs(a));r&&(r=r/Math.abs(r)),a&&(a=a/Math.abs(a));for(let s=0;s<l;s++){let f=i+s*r,c=n+s*a;e(f,c,0)}return!0}createPriorityWalls(e){if(!this._endsWithAWall)return;let i=this._startX,n=this._startY,r=this._endX-i,a=this._endY-n;r&&(r=r/Math.abs(r)),a&&(a=a/Math.abs(a));let l=a,s=-r;e(this._endX+r,this._endY+a),e(this._endX+l,this._endY+s),e(this._endX-l,this._endY-s)}}class Hl extends Ao{constructor(e,i,n){super(e,i),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,n),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(e){let i=Date.now();for(;;){if(Date.now()-i>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(e)for(let n=0;n<this._width;n++)for(let r=0;r<this._height;r++)e(n,r,this._map[n][r]);return this}_generateRooms(){let e=this._width-2,i=this._height-2,n;do if(n=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break;while(n)}_generateRoom(){let e=0;for(;e<this._roomAttempts;){e++;let i=Bn.createRandom(this._width,this._height,this._options);if(i.isValid(this._isWallCallback,this._canBeDugCallback))return i.create(this._digCallback),this._rooms.push(i),i}return null}_generateCorridors(){let e=0;for(;e<this._corridorAttempts;){e++,this._corridors=[],this._map=this._fillMap(1);for(let i=0;i<this._rooms.length;i++){let n=this._rooms[i];n.clearDoors(),n.create(this._digCallback)}for(this._unconnected=C.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let i=C.getItem(this._connected);if(!i)break;let n=this._closestRoom(this._unconnected,i);if(!n)break;let r=this._closestRoom(this._connected,n);if(!r||!this._connectRooms(n,r))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(e,i){let n=1/0,r=i.getCenter(),a=null;for(let l=0;l<e.length;l++){let s=e[l],f=s.getCenter(),c=f[0]-r[0],h=f[1]-r[1],m=c*c+h*h;m<n&&(n=m,a=s)}return a}_connectRooms(e,i){let n=e.getCenter(),r=i.getCenter(),a=r[0]-n[0],l=r[1]-n[1],s,f,c,h,m,w,p;if(Math.abs(a)<Math.abs(l)?(c=l>0?2:0,h=(c+2)%4,m=i.getLeft(),w=i.getRight(),p=0):(c=a>0?1:3,h=(c+2)%4,m=i.getTop(),w=i.getBottom(),p=1),s=this._placeInWall(e,c),!s)return!1;if(s[p]>=m&&s[p]<=w){f=s.slice();let b=0;switch(h){case 0:b=i.getTop()-1;break;case 1:b=i.getRight()+1;break;case 2:b=i.getBottom()+1;break;case 3:b=i.getLeft()-1;break}f[(p+1)%2]=b,this._digLine([s,f])}else if(s[p]<m-1||s[p]>w+1){let b=s[p]-r[p],O=0;switch(h){case 0:case 1:O=b<0?3:1;break;case 2:case 3:O=b<0?1:3;break}if(h=(h+O)%4,f=this._placeInWall(i,h),!f)return!1;let k=[0,0];k[p]=s[p];let Y=(p+1)%2;k[Y]=f[Y],this._digLine([s,k,f])}else{let b=(p+1)%2;if(f=this._placeInWall(i,h),!f)return!1;let O=Math.round((f[b]+s[b])/2),k=[0,0],Y=[0,0];k[p]=s[p],k[b]=O,Y[p]=f[p],Y[b]=O,this._digLine([s,k,Y,f])}return e.addDoor(s[0],s[1]),i.addDoor(f[0],f[1]),p=this._unconnected.indexOf(e),p!=-1&&(this._unconnected.splice(p,1),this._connected.push(e)),p=this._unconnected.indexOf(i),p!=-1&&(this._unconnected.splice(p,1),this._connected.push(i)),!0}_placeInWall(e,i){let n=[0,0],r=[0,0],a=0;switch(i){case 0:r=[1,0],n=[e.getLeft(),e.getTop()-1],a=e.getRight()-e.getLeft()+1;break;case 1:r=[0,1],n=[e.getRight()+1,e.getTop()],a=e.getBottom()-e.getTop()+1;break;case 2:r=[1,0],n=[e.getLeft(),e.getBottom()+1],a=e.getRight()-e.getLeft()+1;break;case 3:r=[0,1],n=[e.getLeft()-1,e.getTop()],a=e.getBottom()-e.getTop()+1;break}let l=[],s=-2;for(let f=0;f<a;f++){let c=n[0]+f*r[0],h=n[1]+f*r[1];l.push(null),this._map[c][h]==1?s!=f-1&&(l[f]=[c,h]):(s=f,f&&(l[f-1]=null))}for(let f=l.length-1;f>=0;f--)l[f]||l.splice(f,1);return l.length?C.getItem(l):null}_digLine(e){for(let i=1;i<e.length;i++){let n=e[i-1],r=e[i],a=new Nr(n[0],n[1],r[0],r[1]);a.create(this._digCallback),this._corridors.push(a)}}_digCallback(e,i,n){this._map[e][i]=n,n==0&&this._dug++}_isWallCallback(e,i){return e<0||i<0||e>=this._width||i>=this._height?!1:this._map[e][i]==1}_canBeDugCallback(e,i){return e<1||i<1||e+1>=this._width||i+1>=this._height?!1:this._map[e][i]==1}}class $l extends fi{constructor(e,i,n={}){super(e,i),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(n),this._dirs=Ue[this._options.topology],this._map=this._fillMap(0)}randomize(e){for(let i=0;i<this._width;i++)for(let n=0;n<this._height;n++)this._map[i][n]=C.getUniform()<e?1:0;return this}setOptions(e){Object.assign(this._options,e)}set(e,i,n){this._map[e][i]=n}create(e){let i=this._fillMap(0),n=this._options.born,r=this._options.survive;for(let a=0;a<this._height;a++){let l=1,s=0;this._options.topology==6&&(l=2,s=a%2);for(let f=s;f<this._width;f+=l){let c=this._map[f][a],h=this._getNeighbors(f,a);(c&&r.indexOf(h)!=-1||!c&&n.indexOf(h)!=-1)&&(i[f][a]=1)}}this._map=i,e&&this._serviceCallback(e)}_serviceCallback(e){for(let i=0;i<this._height;i++){let n=1,r=0;this._options.topology==6&&(n=2,r=i%2);for(let a=r;a<this._width;a+=n)e(a,i,this._map[a][i])}}_getNeighbors(e,i){let n=0;for(let r=0;r<this._dirs.length;r++){let a=this._dirs[r],l=e+a[0],s=i+a[1];l<0||l>=this._width||s<0||s>=this._height||(n+=this._map[l][s]==1?1:0)}return n}connect(e,i,n){i||(i=0);let r=[],a={},l=1,s=[0,0];this._options.topology==6&&(l=2,s=[0,1]);for(let m=0;m<this._height;m++)for(let w=s[m%2];w<this._width;w+=l)if(this._freeSpace(w,m,i)){let p=[w,m];a[this._pointKey(p)]=p,r.push([w,m])}let f=r[C.getUniformInt(0,r.length-1)],c=this._pointKey(f),h={};for(h[c]=f,delete a[c],this._findConnected(h,a,[f],!1,i);Object.keys(a).length>0;){let m=this._getFromTo(h,a),w=m[0],p=m[1],b={};b[this._pointKey(w)]=w,this._findConnected(b,a,[w],!0,i),(this._options.topology==6?this._tunnelToConnected6:this._tunnelToConnected).call(this,p,w,h,a,i,n);for(let k in b){let Y=b[k];this._map[Y[0]][Y[1]]=i,h[k]=Y,delete a[k]}}e&&this._serviceCallback(e)}_getFromTo(e,i){let n=[0,0],r=[0,0],a,l=Object.keys(e),s=Object.keys(i);for(let f=0;f<5;f++){if(l.length<s.length){let c=l;r=e[c[C.getUniformInt(0,c.length-1)]],n=this._getClosest(r,i)}else{let c=s;n=i[c[C.getUniformInt(0,c.length-1)]],r=this._getClosest(n,e)}if(a=(n[0]-r[0])*(n[0]-r[0])+(n[1]-r[1])*(n[1]-r[1]),a<64)break}return[n,r]}_getClosest(e,i){let n=null,r=null;for(let a in i){let l=i[a],s=(l[0]-e[0])*(l[0]-e[0])+(l[1]-e[1])*(l[1]-e[1]);(r==null||s<r)&&(r=s,n=l)}return n}_findConnected(e,i,n,r,a){for(;n.length>0;){let l=n.splice(0,1)[0],s;this._options.topology==6?s=[[l[0]+2,l[1]],[l[0]+1,l[1]-1],[l[0]-1,l[1]-1],[l[0]-2,l[1]],[l[0]-1,l[1]+1],[l[0]+1,l[1]+1]]:s=[[l[0]+1,l[1]],[l[0]-1,l[1]],[l[0],l[1]+1],[l[0],l[1]-1]];for(let f=0;f<s.length;f++){let c=this._pointKey(s[f]);e[c]==null&&this._freeSpace(s[f][0],s[f][1],a)&&(e[c]=s[f],r||delete i[c],n.push(s[f]))}}}_tunnelToConnected(e,i,n,r,a,l){let s,f;i[0]<e[0]?(s=i,f=e):(s=e,f=i);for(let h=s[0];h<=f[0];h++){this._map[h][s[1]]=a;let m=[h,s[1]],w=this._pointKey(m);n[w]=m,delete r[w]}l&&s[0]<f[0]&&l(s,[f[0],s[1]]);let c=f[0];i[1]<e[1]?(s=i,f=e):(s=e,f=i);for(let h=s[1];h<f[1];h++){this._map[c][h]=a;let m=[c,h],w=this._pointKey(m);n[w]=m,delete r[w]}l&&s[1]<f[1]&&l([f[0],s[1]],[f[0],f[1]])}_tunnelToConnected6(e,i,n,r,a,l){let s,f;i[0]<e[0]?(s=i,f=e):(s=e,f=i);let c=s[0],h=s[1];for(;!(c==f[0]&&h==f[1]);){let m=2;h<f[1]?(h++,m=1):h>f[1]&&(h--,m=1),c<f[0]?c+=m:c>f[0]||f[1]%2?c-=m:c+=m,this._map[c][h]=a;let w=[c,h],p=this._pointKey(w);n[p]=w,delete r[p]}l&&l(i,e)}_freeSpace(e,i,n){return e>=0&&e<this._width&&i>=0&&i<this._height&&this._map[e][i]==n}_pointKey(e){return e[0]+"."+e[1]}}const jl={room:Bn,corridor:Nr};class Yl extends Ao{constructor(e,i,n={}){super(e,i),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(e){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let i=(this._width-2)*(this._height-2);this._firstRoom();let n=Date.now(),r;do{if(r=0,Date.now()-n>this._options.timeLimit)break;let l=this._findWall();if(!l)break;let s=l.split(","),f=parseInt(s[0]),c=parseInt(s[1]),h=this._getDiggingDirection(f,c);if(!h)continue;let m=0;do if(m++,this._tryFeature(f,c,h[0],h[1])){this._removeSurroundingWalls(f,c),this._removeSurroundingWalls(f-h[0],c-h[1]);break}while(m<this._featureAttempts);for(let w in this._walls)this._walls[w]>1&&r++}while(this._dug/i<this._options.dugPercentage||r);if(this._addDoors(),e)for(let a=0;a<this._width;a++)for(let l=0;l<this._height;l++)e(a,l,this._map[a][l]);return this._walls={},this._map=[],this}_digCallback(e,i,n){n==0||n==2?(this._map[e][i]=0,this._dug++):this._walls[e+","+i]=1}_isWallCallback(e,i){return e<0||i<0||e>=this._width||i>=this._height?!1:this._map[e][i]==1}_canBeDugCallback(e,i){return e<1||i<1||e+1>=this._width||i+1>=this._height?!1:this._map[e][i]==1}_priorityWallCallback(e,i){this._walls[e+","+i]=2}_firstRoom(){let e=Math.floor(this._width/2),i=Math.floor(this._height/2),n=Bn.createRandomCenter(e,i,this._options);this._rooms.push(n),n.create(this._digCallback)}_findWall(){let e=[],i=[];for(let a in this._walls)this._walls[a]==2?i.push(a):e.push(a);let n=i.length?i:e;if(!n.length)return null;let r=C.getItem(n.sort());return delete this._walls[r],r}_tryFeature(e,i,n,r){let a=C.getWeightedValue(this._features),s=jl[a].createRandomAt(e,i,n,r,this._options);return s.isValid(this._isWallCallback,this._canBeDugCallback)?(s.create(this._digCallback),s instanceof Bn&&this._rooms.push(s),s instanceof Nr&&(s.createPriorityWalls(this._priorityWallCallback),this._corridors.push(s)),!0):!1}_removeSurroundingWalls(e,i){let n=Ue[4];for(let r=0;r<n.length;r++){let a=n[r],l=e+a[0],s=i+a[1];delete this._walls[l+","+s],l=e+2*a[0],s=i+2*a[1],delete this._walls[l+","+s]}}_getDiggingDirection(e,i){if(e<=0||i<=0||e>=this._width-1||i>=this._height-1)return null;let n=null,r=Ue[4];for(let a=0;a<r.length;a++){let l=r[a],s=e+l[0],f=i+l[1];if(!this._map[s][f]){if(n)return null;n=l}}return n?[-n[0],-n[1]]:null}_addDoors(){let e=this._map;function i(n,r){return e[n][r]==1}for(let n=0;n<this._rooms.length;n++){let r=this._rooms[n];r.clearDoors(),r.addDoors(i)}}}function _a(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function pa(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}class ql extends fi{create(e){let i=this._fillMap(1),n=Math.ceil((this._width-2)/2),r=9/24,a=[],l=[];for(let f=0;f<n;f++)a.push(f),l.push(f);a.push(n-1);let s;for(s=1;s+3<this._height;s+=2)for(let f=0;f<n;f++){let c=2*f+1,h=s;i[c][h]=0,f!=a[f+1]&&C.getUniform()>r&&(_a(f,a,l),i[c+1][h]=0),f!=a[f]&&C.getUniform()>r?pa(f,a,l):i[c][h+1]=0}for(let f=0;f<n;f++){let c=2*f+1,h=s;i[c][h]=0,f!=a[f+1]&&(f==a[f]||C.getUniform()>r)&&(_a(f,a,l),i[c+1][h]=0),pa(f,a,l)}for(let f=0;f<this._width;f++)for(let c=0;c<this._height;c++)e(f,c,i[f][c]);return this}}class Zl extends fi{constructor(){super(...arguments),this._stack=[],this._map=[]}create(e){let i=this._width,n=this._height;this._map=[];for(let r=0;r<i;r++){this._map.push([]);for(let a=0;a<n;a++){let l=r==0||a==0||r+1==i||a+1==n;this._map[r].push(l?1:0)}}this._stack=[[1,1,i-2,n-2]],this._process();for(let r=0;r<i;r++)for(let a=0;a<n;a++)e(r,a,this._map[r][a]);return this._map=[],this}_process(){for(;this._stack.length;){let e=this._stack.shift();this._partitionRoom(e)}}_partitionRoom(e){let i=[],n=[];for(let c=e[0]+1;c<e[2];c++){let h=this._map[c][e[1]-1],m=this._map[c][e[3]+1];h&&m&&!(c%2)&&i.push(c)}for(let c=e[1]+1;c<e[3];c++){let h=this._map[e[0]-1][c],m=this._map[e[2]+1][c];h&&m&&!(c%2)&&n.push(c)}if(!i.length||!n.length)return;let r=C.getItem(i),a=C.getItem(n);this._map[r][a]=1;let l=[],s=[];l.push(s);for(let c=e[0];c<r;c++)this._map[c][a]=1,c%2&&s.push([c,a]);s=[],l.push(s);for(let c=r+1;c<=e[2];c++)this._map[c][a]=1,c%2&&s.push([c,a]);s=[],l.push(s);for(let c=e[1];c<a;c++)this._map[r][c]=1,c%2&&s.push([r,c]);s=[],l.push(s);for(let c=a+1;c<=e[3];c++)this._map[r][c]=1,c%2&&s.push([r,c]);let f=C.getItem(l);for(let c=0;c<l.length;c++){let h=l[c];if(h==f)continue;let m=C.getItem(h);this._map[m[0]][m[1]]=0}this._stack.push([e[0],e[1],r-1,a-1]),this._stack.push([r+1,e[1],e[2],a-1]),this._stack.push([e[0],a+1,r-1,e[3]]),this._stack.push([r+1,a+1,e[2],e[3]])}}class Xl extends fi{constructor(e,i,n=0){super(e,i),this._regularity=n,this._map=[]}create(e){let i=this._width,n=this._height,r=this._fillMap(1);i-=i%2?1:2,n-=n%2?1:2;let a=0,l=0,s=0,f=0,c=0,h=!1,m=[[0,0],[0,0],[0,0],[0,0]];do if(a=1+2*Math.floor(C.getUniform()*(i-1)/2),l=1+2*Math.floor(C.getUniform()*(n-1)/2),c||(r[a][l]=0),!r[a][l]){this._randomize(m);do{Math.floor(C.getUniform()*(this._regularity+1))==0&&this._randomize(m),h=!0;for(let w=0;w<4;w++)if(s=a+m[w][0]*2,f=l+m[w][1]*2,this._isFree(r,s,f,i,n)){r[s][f]=0,r[a+m[w][0]][l+m[w][1]]=0,a=s,l=f,h=!1,c++;break}}while(!h)}while(c+1<i*n/4);for(let w=0;w<this._width;w++)for(let p=0;p<this._height;p++)e(w,p,r[w][p]);return this._map=[],this}_randomize(e){for(let i=0;i<4;i++)e[i][0]=0,e[i][1]=0;switch(Math.floor(C.getUniform()*4)){case 0:e[0][0]=-1,e[1][0]=1,e[2][1]=-1,e[3][1]=1;break;case 1:e[3][0]=-1,e[2][0]=1,e[1][1]=-1,e[0][1]=1;break;case 2:e[2][0]=-1,e[3][0]=1,e[0][1]=-1,e[1][1]=1;break;case 3:e[1][0]=-1,e[0][0]=1,e[3][1]=-1,e[2][1]=1;break}}_isFree(e,i,n,r,a){return i<1||n<1||i>=r||n>=a?!1:e[i][n]}}let Kl=class extends fi{constructor(e,i,n){super(e,i),this.map=[],this.rooms=[],this.connectedCells=[],n=Object.assign({cellWidth:3,cellHeight:3},n),n.hasOwnProperty("roomWidth")||(n.roomWidth=this._calculateRoomSize(this._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=this._calculateRoomSize(this._height,n.cellHeight)),this._options=n}create(e){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),e)for(let i=0;i<this._width;i++)for(let n=0;n<this._height;n++)e(i,n,this.map[i][n]);return this}_calculateRoomSize(e,i){let n=Math.floor(e/i*.8),r=Math.floor(e/i*.25);return r<2&&(r=2),n<2&&(n=2),[r,n]}_initRooms(){for(let e=0;e<this._options.cellWidth;e++){this.rooms.push([]);for(let i=0;i<this._options.cellHeight;i++)this.rooms[e].push({x:0,y:0,width:0,height:0,connections:[],cellx:e,celly:i})}}_connectRooms(){let e=C.getUniformInt(0,this._options.cellWidth-1),i=C.getUniformInt(0,this._options.cellHeight-1),n,r,a,l=!1,s,f,c;do{c=[0,2,4,6],c=C.shuffle(c);do if(l=!1,n=c.pop(),r=e+Ue[8][n][0],a=i+Ue[8][n][1],!(r<0||r>=this._options.cellWidth)&&!(a<0||a>=this._options.cellHeight)){if(s=this.rooms[e][i],s.connections.length>0&&s.connections[0][0]==r&&s.connections[0][1]==a)break;f=this.rooms[r][a],f.connections.length==0&&(f.connections.push([e,i]),this.connectedCells.push([r,a]),e=r,i=a,l=!0)}while(c.length>0&&l==!1)}while(c.length>0)}_connectUnconnectedRooms(){let e=this._options.cellWidth,i=this._options.cellHeight;this.connectedCells=C.shuffle(this.connectedCells);let n,r,a;for(let l=0;l<this._options.cellWidth;l++)for(let s=0;s<this._options.cellHeight;s++)if(n=this.rooms[l][s],n.connections.length==0){let f=[0,2,4,6];f=C.shuffle(f),a=!1;do{let c=f.pop(),h=l+Ue[8][c][0],m=s+Ue[8][c][1];if(!(h<0||h>=e||m<0||m>=i)){if(r=this.rooms[h][m],a=!0,r.connections.length==0)break;for(let w=0;w<r.connections.length;w++)if(r.connections[w][0]==l&&r.connections[w][1]==s){a=!1;break}if(a)break}}while(f.length);a?n.connections.push([r.cellx,r.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let e=this._width,i=this._height,n=this._options.cellWidth,r=this._options.cellHeight,a=Math.floor(this._width/n),l=Math.floor(this._height/r),s,f,c=this._options.roomWidth,h=this._options.roomHeight,m,w,p;for(let b=0;b<n;b++)for(let O=0;O<r;O++){if(m=a*b,w=l*O,m==0&&(m=1),w==0&&(w=1),s=C.getUniformInt(c[0],c[1]),f=C.getUniformInt(h[0],h[1]),O>0)for(p=this.rooms[b][O-1];w-(p.y+p.height)<3;)w++;if(b>0)for(p=this.rooms[b-1][O];m-(p.x+p.width)<3;)m++;let k=Math.round(C.getUniformInt(0,a-s)/2),Y=Math.round(C.getUniformInt(0,l-f)/2);for(;m+k+s>=e;)k?k--:s--;for(;w+Y+f>=i;)Y?Y--:f--;m=m+k,w=w+Y,this.rooms[b][O].x=m,this.rooms[b][O].y=w,this.rooms[b][O].width=s,this.rooms[b][O].height=f;for(let H=m;H<m+s;H++)for(let T=w;T<w+f;T++)this.map[H][T]=0}}_getWallPosition(e,i){let n,r,a;return i==1||i==3?(n=C.getUniformInt(e.x+1,e.x+e.width-2),i==1?(r=e.y-2,a=r+1):(r=e.y+e.height+1,a=r-1),this.map[n][a]=0):(r=C.getUniformInt(e.y+1,e.y+e.height-2),i==2?(n=e.x+e.width+1,a=n-1):(n=e.x-2,a=n+1),this.map[a][r]=0),[n,r]}_drawCorridor(e,i){let n=i[0]-e[0],r=i[1]-e[1],a=e[0],l=e[1],s,f,c,h,m=[],w=Math.abs(n),p=Math.abs(r),b=C.getUniform(),O=b,k=1-b;for(f=n>0?2:6,c=r>0?4:0,w<p?(s=Math.ceil(p*O),m.push([c,s]),m.push([f,w]),s=Math.floor(p*k),m.push([c,s])):(s=Math.ceil(w*O),m.push([f,s]),m.push([c,p]),s=Math.floor(w*k),m.push([f,s])),this.map[a][l]=0;m.length>0;)for(h=m.pop();h[1]>0;)a+=Ue[8][h[0]][0],l+=Ue[8][h[0]][1],this.map[a][l]=0,h[1]=h[1]-1}_createCorridors(){let e=this._options.cellWidth,i=this._options.cellHeight,n,r,a,l,s;for(let f=0;f<e;f++)for(let c=0;c<i;c++){n=this.rooms[f][c];for(let h=0;h<n.connections.length;h++)r=n.connections[h],a=this.rooms[r[0]][r[1]],a.cellx>n.cellx?(l=2,s=4):a.cellx<n.cellx?(l=4,s=2):a.celly>n.celly?(l=3,s=1):(l=1,s=3),this._drawCorridor(this._getWallPosition(n,l),this._getWallPosition(a,s))}}};const Br={Arena:Gl,Uniform:Hl,Cellular:$l,Digger:Yl,EllerMaze:ql,DividedMaze:Zl,IceyMaze:Xl,Rogue:Kl},Ur=new wn.MiniSignal,Vr=new wn.MiniSignal;var g=(t=>(t[t.Border=-1]="Border",t[t.Floor=0]="Floor",t[t.Slow=1]="Slow",t[t.Medium=2]="Medium",t[t.Fast=3]="Fast",t[t.Block=4]="Block",t[t.Whip=5]="Whip",t[t.Stairs=6]="Stairs",t[t.Chest=7]="Chest",t[t.SlowTime=8]="SlowTime",t[t.Gem=9]="Gem",t[t.Invisible=10]="Invisible",t[t.Teleport=11]="Teleport",t[t.Key=12]="Key",t[t.Door=13]="Door",t[t.Wall=14]="Wall",t[t.SpeedTime=15]="SpeedTime",t[t.Trap=16]="Trap",t[t.River=17]="River",t[t.Power=18]="Power",t[t.Forest=19]="Forest",t[t.Tree=20]="Tree",t[t.Bomb=21]="Bomb",t[t.Lava=22]="Lava",t[t.Pit=23]="Pit",t[t.Tome=24]="Tome",t[t.Tunnel=25]="Tunnel",t[t.Freeze=26]="Freeze",t[t.Nugget=27]="Nugget",t[t.Quake=28]="Quake",t[t.IBlock=29]="IBlock",t[t.IWall=30]="IWall",t[t.IDoor=31]="IDoor",t[t.Stop=32]="Stop",t[t.Trap2=33]="Trap2",t[t.Zap=34]="Zap",t[t.Create=35]="Create",t[t.Generator=36]="Generator",t[t.Trap3=37]="Trap3",t[t.MBlock=38]="MBlock",t[t.Trap4=39]="Trap4",t[t.Player=40]="Player",t[t.ShowGems=41]="ShowGems",t[t.Tablet=42]="Tablet",t[t.ZBlock=43]="ZBlock",t[t.BlockSpell=44]="BlockSpell",t[t.Chance=45]="Chance",t[t.Statue=46]="Statue",t[t.WallVanish=47]="WallVanish",t[t.K=48]="K",t[t.R=49]="R",t[t.O=50]="O",t[t.Z=51]="Z",t[t.OWall1=52]="OWall1",t[t.OWall2=53]="OWall2",t[t.OWall3=54]="OWall3",t[t.CWall1=55]="CWall1",t[t.CWall2=56]="CWall2",t[t.CWall3=57]="CWall3",t[t.OSpell1=58]="OSpell1",t[t.OSpell2=59]="OSpell2",t[t.OSpell3=60]="OSpell3",t[t.CSpell1=61]="CSpell1",t[t.CSpell2=62]="CSpell2",t[t.CSpell3=63]="CSpell3",t[t.GBlock=64]="GBlock",t[t.Rock=65]="Rock",t[t.EWall=66]="EWall",t[t.Trap5=67]="Trap5",t[t.TBlock=68]="TBlock",t[t.TRock=69]="TRock",t[t.TGem=70]="TGem",t[t.TBlind=71]="TBlind",t[t.TWhip=72]="TWhip",t[t.TGold=73]="TGold",t[t.TTree=74]="TTree",t[t.Rope=75]="Rope",t[t.DropRope=76]="DropRope",t[t.DropRope2=77]="DropRope2",t[t.DropRope3=78]="DropRope3",t[t.DropRope4=79]="DropRope4",t[t.DropRope5=80]="DropRope5",t[t.Amulet=81]="Amulet",t[t.ShootRight=82]="ShootRight",t[t.ShootLeft=83]="ShootLeft",t[t.Trap6=224]="Trap6",t[t.Trap7=225]="Trap7",t[t.Trap8=226]="Trap8",t[t.Trap9=227]="Trap9",t[t.Trap10=228]="Trap10",t[t.Trap11=229]="Trap11",t[t.Trap12=230]="Trap12",t[t.Trap13=231]="Trap13",t[t.Message=252]="Message",t))(g||{});const si=[3,2,1],$n=[5,9,11,7],ko=[8,10,15,26],jn=[33,37,39,67,224,225,226,227,228,229,230,231],Jl=[16,...jn],Yn=[48,49,50,51],Lo=[55,56,57],Do=[58,59,60],Ql=[61,62,63],Wr=[68,69,70,71,72,73,74],tc=[0,...si,...$n,...ko,...Jl,32],ec=[0,32,...jn,41,47,...Wr],ic=[0,32,41,44,47,...Lo,...Ql,...Wr,...jn],Po=[...$n,8,10,12,16,18,21,26,27,34,35,42,45,...Yn,...Do,82,83],Co=[6,23],nc=[0,32,...jn,...Lo],rc=[0,68,69,70,71,73,72,74],ga=[5,7,8,9,10,11,12,15,16,18,26,27,...Yn,82,83],ac=[0,...si,4,...$n,...ko,16,18,19,20,21,27,28,32,33,34,35,37,38,39,41,42,43,44,45,47,...Yn,57,60,64,67,...Wr,77,78,79,80,81,82,83],oc=[0,16,27,28,32,33,37,39],sc="modulepreload",lc=function(t,e){return new URL(t,e).href},ma={},S=function(e,i,n){let r=Promise.resolve();if(i&&i.length>0){const l=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),f=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));r=Promise.allSettled(i.map(c=>{if(c=lc(c,n),c in ma)return;ma[c]=!0;const h=c.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!n)for(let b=l.length-1;b>=0;b--){const O=l[b];if(O.href===c&&(!h||O.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${m}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":sc,h||(p.as="script"),p.crossOrigin="",p.href=c,f&&p.setAttribute("nonce",f),document.head.appendChild(p),h)return new Promise((b,O)=>{p.addEventListener("load",b),p.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(l){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=l,window.dispatchEvent(s),!s.defaultPrevented)throw l}return r.then(l=>{for(const s of l||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},cc="DEBUG",fc=[async()=>(await S(async()=>{const{default:t}=await import("./debug.map-DK9F52t9.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./speed.map-CFFLLcYB.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./pushables.map-80zcdGsy.js");return{default:t}},[],import.meta.url)).default],uc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:fc,title:cc},Symbol.toStringTag,{value:"Module"})),hc="The Forgotten Adventures of Kroz",dc=[async()=>(await S(async()=>{const{default:t}=await import("./lost-1.map-D1yTvncC.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-2.map-CxjIlkLv.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-1.map-bbgHFSQt.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-2.map-OIewNMIc.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-3.map-BlopSxLF.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-2.map-Udp0FEdR.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-4.map-DglsmQ-V.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-4.map-hdSJGfNS.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-4.map-BZhiM-tX.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-6.map-BlbRtB9q.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-5.map-BfnrKWrw.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-7.map-DqPZ4i3R.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-7.map-BOh1Ho2Q.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-9.map-DK11ozqh.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-11.map-DVDKxKKN.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-12.map-Basy9Czf.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-11.map-CI9EzNAN.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-12.map-WDo0R1ta.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-12.map-BitNY2wh.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-16.map-CoC_Gk3j.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-14.map-CICTB-j-.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-16.map-CfN-tZ9O.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-18.map-fSnTLM13.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-18.map-DW6vjBSC.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-20.map-CJy3ZvkZ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-22.map-D8HaHpeq.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-26.map-CAoDjCfs.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-30.map-uLgOODcs.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-34.map-DyM-Pb4h.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-42.map-DHwjy8uu.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-46.map-CdrsBwn1.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-48.map-DHRSMCe-.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-52.map-VBB2taVO.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-59.map-CVDAaMq_.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-61.map-B2FKIWd4.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-64.map-Colf8OB4.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-70.map-BbBcXr8V.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-25.map-Bz2-wvWB.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-40.map-BEoq1flp.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-75.map-DitL5S_V.js");return{default:t}},[],import.meta.url)).default],_c=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:dc,title:hc},Symbol.toStringTag,{value:"Module"})),pc="Kingdom of Kroz II",Mo=[async()=>(await S(async()=>{const{default:t}=await import("./kingdom-1.map-bbgHFSQt.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-2.map-OIewNMIc.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-3.map-D8pEE0y1.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-4.map-BZhiM-tX.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-5.map-CiVjOqyy.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-6.map-BlbRtB9q.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-7.map-9LVauLNT.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-9.map-6QY3_ojZ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-10.map-u0dfNQ8o.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-11.map-1FX4WvRC.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-12.map-BitNY2wh.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-13.map-BNvly2WP.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-46.map-CdrsBwn1.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-15.map-D1QTKwR7.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-16.map-CoC_Gk3j.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-17.map-QT8Jo9P8.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-18.map-DW6vjBSC.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-19.map-CE42F0Sf.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-22.map-D8HaHpeq.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-21.map-BKH8cQo7.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-30.map-uLgOODcs.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-23.map-DVH3ZKVI.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./kingdom-25.map-Bz2-wvWB.js");return{default:t}},[],import.meta.url)).default],gc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Mo,title:pc},Symbol.toStringTag,{value:"Module"})),mc="Lost Adventures of Kroz",zo=[async()=>(await S(async()=>{const{default:t}=await import("./lost-1.map-C4CGCnx7.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-2.map-CxjIlkLv.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-3.map-D8pEE0y1.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-4.map-hdSJGfNS.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-5.map-CiVjOqyy.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-7.map-DiVu833T.js");return{default:t}},[],import.meta.url)).default,null,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-10.map-6QY3_ojZ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-11.map-DVDKxKKN.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-12.map-1FX4WvRC.js");return{default:t}},[],import.meta.url)).default,null,null,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-16.map-BgU741VA.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-17.map-3FH-e8Pb.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-18.map-DW6vjBSC.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-19.map-D2HlXgVQ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-20.map-CJy3ZvkZ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-21.map-CE42F0Sf.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-22.map-D8HaHpeq.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-23.map-BKH8cQo7.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-25.map-DVH3ZKVI.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-26.map-CAoDjCfs.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-27.map-CSbfE8xr.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-29.map-B-EjpzTM.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-30.map-uLgOODcs.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-31.map-q7sA-uLr.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-33.map-BTjQoNIy.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-34.map-DyM-Pb4h.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-35.map-ClPhob9j.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-36.map-BNHfCsXH.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-38.map-7GMt8H6h.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-39.map-A52lrswF.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-40.map-DHB2ja2T.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-41.map-Dqj435aK.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-42.map-DHwjy8uu.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-43.map-C9eajFxU.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-45.map-DHqfUw4F.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-46.map-CdrsBwn1.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-47.map-DeQJLYqT.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-48.map-DHRSMCe-.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-49.map-DwvgiNEx.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-50.map-QT8Jo9P8.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-51.map-DbkXgkgx.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-52.map-VBB2taVO.js");return{default:t}},[],import.meta.url)).default,null,null,null,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-57.map-dtlgnb2I.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-58.map-CpxaXTjj.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-59.map-CVDAaMq_.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-60.map-Df3xJj0b.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-61.map-B2FKIWd4.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-62.map-Dg4mU-JA.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-63.map-DXGGGjjR.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-64.map-Colf8OB4.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-65.map-VnlTl3Ne.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-67.map-C-VMrVb1.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-69.map-Czqur2HA.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-70.map-BbBcXr8V.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-71.map-BALwcbt1.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./lost-73.map-DXYMy74P.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-74.map-Bs1WZBTz.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./lost-75.map-DitL5S_V.js");return{default:t}},[],import.meta.url)).default],wc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:zo,title:mc},Symbol.toStringTag,{value:"Module"})),yc="The Caverns of Kroz",Fo=[async()=>(await S(async()=>{const{default:t}=await import("./caverns-1.map-C2cwH--9.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-2.map-Udp0FEdR.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-3.map-CKFK-1g8.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-4.map-DglsmQ-V.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-5.map-B4u_iWgg.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-6.map-abeVKcY6.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-7.map-BOh1Ho2Q.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-8.map-BO_yUCU4.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-9.map-DK11ozqh.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-10.map-i_EbAi3U.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-11.map-CI9EzNAN.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-12.map-WDo0R1ta.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-13.map-Dny_nCLr.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-14.map-CICTB-j-.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-15.map-Cw2HjKC-.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-16.map-CfN-tZ9O.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-17.map-DxCz95Th.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-18.map-fSnTLM13.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./caverns-19.map-UhTaXTxD.js");return{default:t}},[],import.meta.url)).default,null,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-22.map-duGVWDkU.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-24.map-BvxeotfJ.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-26.map-CAw9Bktb.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-28.map-BVoMh7sA.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-30.map-C7BR351z.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-32.map-CbK-OWbJ.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-34.map-CDu6ZP0b.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-36.map-CiAIXa5-.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-38.map-h6hg4-g5.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./caverns-40.map-BEoq1flp.js");return{default:t}},[],import.meta.url)).default],vc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Fo,title:yc},Symbol.toStringTag,{value:"Module"})),bc="The Underground Empire of Cruz",No=[async()=>(await S(async()=>{const{default:t}=await import("./cruz-1.map-DG9JAo5J.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-2.map-CGhciUzY.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-3.map-DWgQw5DG.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-4.map-C4BZwTXl.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-5.map-C2SPX2w-.js");return{default:t}},[],import.meta.url)).default,null,async()=>(await S(async()=>{const{default:t}=await import("./cruz-7.map-uA10CqeQ.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-8.map-Dt9OxfQV.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./cruz-9.map-BRPIdZ7V.js");return{default:t}},[],import.meta.url)).default],Ec=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:No,title:bc},Symbol.toStringTag,{value:"Module"})),xc="The Forgotten Adventures of Kroz",Tc=[async()=>(await S(async()=>{const{default:t}=await import("./start.map-CfWPfXGn.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./classics.map-Sh3jlarO.js");return{default:t}},[],import.meta.url)).default,async()=>(await S(async()=>{const{default:t}=await import("./instructions.map-CqtI9Cqo.js");return{default:t}},[],import.meta.url)).default],Sc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Tc,title:xc},Symbol.toStringTag,{value:"Module"})),Dn=Dt+1,Bo=Pt+1,On=Dn*Bo,Oc="[PF]",Rc="[DF]",Ac="[ST]";function Uo(t){const e=[];let i="",n=0;const r=t.split(/\r?\n/).filter(f=>f.length>0).map(f=>f.trimEnd());for(;n<r.length;)switch(r[n++].trim()){case Oc:a();break;case Rc:l();break;case Ac:s();break}for(let f=e.length;f<On;f++)e[f]||(e[f]=vn(g.Floor));return{id:"",data:e,startTrigger:i??void 0,properties:{}};function a(){for(let f=0;f<Bo;f++){const c=r[n++].trimEnd().padEnd(Dt+1," ");for(let h=0;h<Dn;h++){const m=c.charAt(h)??" ",w=ha(m);e.push(yi(w,h,f))}}}function l(){let f="";for(;n<r.length;){const h=r[n++];if(h.startsWith("[")){n--;break}const m=r[n++];for(let w=0;w<h.length;w+=3){const p=h.substring(w,w+3).trim(),b=p==="P"?1:+m.substring(w,w+3);f+=p.repeat(b)}}f.length<On&&(f+=" ".repeat(On-f.length));const c=js(f.split(""));for(let h=0;h<On;h++){const m=ha(c[h]),w=h%Dn,p=Math.floor(h/Dn);e[h]=yi(m,w,p)}}function s(){for(;n<r.length;){const f=r[n++];if(f.startsWith("[")){n--;break}i+=f+`
`}}}const Ic="Testing Procgen Maps";async function kc(t){return Uo(Dc(t))}function Lc(t){return++t}function Dc(t){let e="";const i=xr[t%xr.length];return Object.keys(i).forEach(n=>{e+=`##RNDGEN ${n} ${i[n]}
`}),`
    [ST]
    ##brogue
    ${e}
    Press any key to begin this level.
  `}const xr=[{Slow:80,Block:50,TBlock:9},{Slow:100,Whip:30,Gem:9,Teleport:2,GBlock:100,TBlock:5},{Slow:100,Gem:45,Tunnel:8,Nugget:100,Quake:3,Rock:100}],Pc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:xr,findNextLevel:Lc,readLevel:kc,title:Ic},Symbol.toStringTag,{value:"Module"}));var lr={},Ni={},wa;function Cc(){if(wa)return Ni;wa=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.GridOrientation=void 0;var t;return function(e){e.ORTHOGONAL="orthogonal",e.ISOMETRIC="isometric"}(t||(Ni.GridOrientation=t={})),Ni}var he={},Bi={},ya;function Gr(){if(ya)return Bi;ya=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.Encoding=void 0;var t;return function(e){e.CSV="csv",e.BASE64="base64"}(t||(Bi.Encoding=t={})),Bi}var va;function Vo(){if(va)return he;va=1,Object.defineProperty(he,"__esModule",{value:!0}),he.isGroup=he.isImageLayer=he.isObjectGroup=he.isUnencodedTileLayer=he.isEncodedTileLayer=he.isTileLayer=void 0;const t=Gr();function e(s){return s.type==="tilelayer"}he.isTileLayer=e;function i(s){return s.type==="tilelayer"&&s.encoding!==t.Encoding.CSV}he.isEncodedTileLayer=i;function n(s){return s.type==="tilelayer"&&(s.encoding==null||s.encoding===t.Encoding.CSV)}he.isUnencodedTileLayer=n;function r(s){return s.type==="objectgroup"}he.isObjectGroup=r;function a(s){return s.type==="imagelayer"}he.isImageLayer=a;function l(s){return s.type==="group"}return he.isGroup=l,he}var Ui={},ba;function Wo(){if(ba)return Ui;ba=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.Compression=void 0;var t;return function(e){e.NONE="",e.GZIP="gzip",e.ZLIB="zlib",e.ZSTD="zstd"}(t||(Ui.Compression=t={})),Ui}var Vi={},Wi={},Ea;function Mc(){if(Ea)return Wi;Ea=1,Wi.byteLength=s,Wi.toByteArray=c,Wi.fromByteArray=w;for(var t=[],e=[],i=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,a=n.length;r<a;++r)t[r]=n[r],e[n.charCodeAt(r)]=r;e[45]=62,e[95]=63;function l(p){var b=p.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var O=p.indexOf("=");O===-1&&(O=b);var k=O===b?0:4-O%4;return[O,k]}function s(p){var b=l(p),O=b[0],k=b[1];return(O+k)*3/4-k}function f(p,b,O){return(b+O)*3/4-O}function c(p){var b,O=l(p),k=O[0],Y=O[1],H=new i(f(p,k,Y)),T=0,x=Y>0?k-4:k,D;for(D=0;D<x;D+=4)b=e[p.charCodeAt(D)]<<18|e[p.charCodeAt(D+1)]<<12|e[p.charCodeAt(D+2)]<<6|e[p.charCodeAt(D+3)],H[T++]=b>>16&255,H[T++]=b>>8&255,H[T++]=b&255;return Y===2&&(b=e[p.charCodeAt(D)]<<2|e[p.charCodeAt(D+1)]>>4,H[T++]=b&255),Y===1&&(b=e[p.charCodeAt(D)]<<10|e[p.charCodeAt(D+1)]<<4|e[p.charCodeAt(D+2)]>>2,H[T++]=b>>8&255,H[T++]=b&255),H}function h(p){return t[p>>18&63]+t[p>>12&63]+t[p>>6&63]+t[p&63]}function m(p,b,O){for(var k,Y=[],H=b;H<O;H+=3)k=(p[H]<<16&16711680)+(p[H+1]<<8&65280)+(p[H+2]&255),Y.push(h(k));return Y.join("")}function w(p){for(var b,O=p.length,k=O%3,Y=[],H=16383,T=0,x=O-k;T<x;T+=H)Y.push(m(p,T,T+H>x?x:T+H));return k===1?(b=p[O-1],Y.push(t[b>>2]+t[b<<4&63]+"==")):k===2&&(b=(p[O-2]<<8)+p[O-1],Y.push(t[b>>10]+t[b>>4&63]+t[b<<2&63]+"=")),Y.join("")}return Wi}var Gi={},xa;function zc(){if(xa)return Gi;xa=1;var t=ArrayBuffer,e=Uint8Array,i=Uint16Array,n=Int16Array,r=Int32Array,a=function(E,I,z){if(e.prototype.slice)return e.prototype.slice.call(E,I,z);(I==null||I<0)&&(I=0),(z==null||z>E.length)&&(z=E.length);var W=new e(z-I);return W.set(E.subarray(I,z)),W},l=function(E,I,z,W){if(e.prototype.fill)return e.prototype.fill.call(E,I,z,W);for((z==null||z<0)&&(z=0),(W==null||W>E.length)&&(W=E.length);z<W;++z)E[z]=I;return E},s=function(E,I,z,W){if(e.prototype.copyWithin)return e.prototype.copyWithin.call(E,I,z,W);for((z==null||z<0)&&(z=0),(W==null||W>E.length)&&(W=E.length);z<W;)E[I++]=E[z++]};Gi.ZstdErrorCode={InvalidData:0,WindowSizeTooLarge:1,InvalidBlockType:2,FSEAccuracyTooHigh:3,DistanceTooFarBack:4,UnexpectedEOF:5};var f=["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"],c=function(E,I,z){var W=new Error(I||f[E]);if(W.code=E,Error.captureStackTrace&&Error.captureStackTrace(W,c),!z)throw W;return W},h=function(E,I,z){for(var W=0,j=0;W<z;++W)j|=E[I++]<<(W<<3);return j},m=function(E,I){return(E[I]|E[I+1]<<8|E[I+2]<<16|E[I+3]<<24)>>>0},w=function(E,I){var z=E[0]|E[1]<<8|E[2]<<16;if(z==3126568&&E[3]==253){var W=E[4],j=W>>5&1,at=W>>2&1,G=W&3,ot=W>>6;W&8&&c(0);var ct=6-j,Rt=G==3?4:G,St=h(E,ct,Rt);ct+=Rt;var ht=ot?1<<ot:j,mt=h(E,ct,ht)+(ot==1&&256),Ft=mt;if(!j){var Ht=1<<10+(E[5]>>3);Ft=Ht+(Ht>>3)*(E[5]&7)}Ft>2145386496&&c(1);var yt=new e((I==1?mt||Ft:I?0:Ft)+12);return yt[0]=1,yt[4]=4,yt[8]=8,{b:ct+ht,y:0,l:0,d:St,w:I&&I!=1?I:yt.subarray(12),e:Ft,o:new r(yt.buffer,0,3),u:mt,c:at,m:Math.min(131072,Ft)}}else if((z>>4|E[3]<<20)==25481893)return m(E,4)+8;c(0)},p=function(E){for(var I=0;1<<I<=E;++I);return I-1},b=function(E,I,z){var W=(I<<3)+4,j=(E[I]&15)+5;j>z&&c(3);for(var at=1<<j,G=at,ot=-1,ct=-1,Rt=-1,St=at,ht=new t(512+(at<<2)),mt=new n(ht,0,256),Ft=new i(ht,0,256),Ht=new i(ht,512,at),yt=512+(at<<1),At=new e(ht,yt,at),vt=new e(ht,yt+at);ot<255&&G>0;){var Ot=p(G+1),Ct=W>>3,Kt=(1<<Ot+1)-1,Ut=(E[Ct]|E[Ct+1]<<8|E[Ct+2]<<16)>>(W&7)&Kt,xt=(1<<Ot)-1,Wt=Kt-G-1,te=Ut&xt;if(te<Wt?(W+=Ot,Ut=te):(W+=Ot+1,Ut>xt&&(Ut-=Wt)),mt[++ot]=--Ut,Ut==-1?(G+=Ut,At[--St]=ot):G-=Ut,!Ut)do{var qt=W>>3;ct=(E[qt]|E[qt+1]<<8)>>(W&7)&3,W+=2,ot+=ct}while(ct==3)}(ot>255||G)&&c(0);for(var $t=0,le=(at>>1)+(at>>3)+3,Zt=at-1,Vt=0;Vt<=ot;++Vt){var bt=mt[Vt];if(bt<1){Ft[Vt]=-bt;continue}for(Rt=0;Rt<bt;++Rt){At[$t]=Vt;do $t=$t+le&Zt;while($t>=St)}}for($t&&c(0),Rt=0;Rt<at;++Rt){var it=Ft[At[Rt]]++,jt=vt[Rt]=j-p(it);Ht[Rt]=(it<<jt)-at}return[W+7>>3,{b:j,s:At,n:vt,t:Ht}]},O=function(E,I){var z=0,W=-1,j=new e(292),at=E[I],G=j.subarray(0,256),ot=j.subarray(256,268),ct=new i(j.buffer,268);if(at<128){var Rt=b(E,I+1,6),St=Rt[0],ht=Rt[1];I+=at;var mt=St<<3,Ft=E[I];Ft||c(0);for(var Ht=0,yt=0,At=ht.b,vt=At,Ot=(++I<<3)-8+p(Ft);Ot-=At,!(Ot<mt);){var Ct=Ot>>3;if(Ht+=(E[Ct]|E[Ct+1]<<8)>>(Ot&7)&(1<<At)-1,G[++W]=ht.s[Ht],Ot-=vt,Ot<mt)break;Ct=Ot>>3,yt+=(E[Ct]|E[Ct+1]<<8)>>(Ot&7)&(1<<vt)-1,G[++W]=ht.s[yt],At=ht.n[Ht],Ht=ht.t[Ht],vt=ht.n[yt],yt=ht.t[yt]}++W>255&&c(0)}else{for(W=at-127;z<W;z+=2){var Kt=E[++I];G[z]=Kt>>4,G[z+1]=Kt&15}++I}var Ut=0;for(z=0;z<W;++z){var xt=G[z];xt>11&&c(0),Ut+=xt&&1<<xt-1}var Wt=p(Ut)+1,te=1<<Wt,qt=te-Ut;for(qt&qt-1&&c(0),G[W++]=p(qt)+1,z=0;z<W;++z){var xt=G[z];++ot[G[z]=xt&&Wt+1-xt]}var $t=new e(te<<1),le=$t.subarray(0,te),Zt=$t.subarray(te);for(ct[Wt]=0,z=Wt;z>0;--z){var Vt=ct[z];l(Zt,z,Vt,ct[z-1]=Vt+ot[z]*(1<<Wt-z))}for(ct[0]!=te&&c(0),z=0;z<W;++z){var bt=G[z];if(bt){var it=ct[bt];l(le,z,it,ct[bt]=it+(1<<Wt-bt))}}return[I,{n:Zt,b:Wt,s:le}]},k=b(new e([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],Y=b(new e([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],H=b(new e([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],T=function(E,I){for(var z=E.length,W=new r(z),j=0;j<z;++j)W[j]=I,I+=1<<E[j];return W},x=new e(new r([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),D=T(x,0),N=new e(new r([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),$=T(N,3),nt=function(E,I,z){var W=E.length,j=I.length,at=E[W-1],G=(1<<z.b)-1,ot=-z.b;at||c(0);for(var ct=0,Rt=z.b,St=(W<<3)-8+p(at)-Rt,ht=-1;St>ot&&ht<j;){var mt=St>>3,Ft=(E[mt]|E[mt+1]<<8|E[mt+2]<<16)>>(St&7);ct=(ct<<Rt|Ft)&G,I[++ht]=z.s[ct],St-=Rt=z.n[ct]}(St!=ot||ht+1!=j)&&c(0)},K=function(E,I,z){var W=6,j=I.length,at=j+3>>2,G=at<<1,ot=at+G;nt(E.subarray(W,W+=E[0]|E[1]<<8),I.subarray(0,at),z),nt(E.subarray(W,W+=E[2]|E[3]<<8),I.subarray(at,G),z),nt(E.subarray(W,W+=E[4]|E[5]<<8),I.subarray(G,ot),z),nt(E.subarray(W),I.subarray(ot),z)},pt=function(E,I,z){var W,j=I.b,at=E[j],G=at>>1&3;I.l=at&1;var ot=at>>3|E[j+1]<<5|E[j+2]<<13,ct=(j+=3)+ot;if(G==1)return j>=E.length?void 0:(I.b=j+1,z?(l(z,E[j],I.y,I.y+=ot),z):l(new e(ot),E[j]));if(!(ct>E.length)){if(G==0)return I.b=ct,z?(z.set(E.subarray(j,ct),I.y),I.y+=ot,z):a(E,j,ct);if(G==2){var Rt=E[j],St=Rt&3,ht=Rt>>2&3,mt=Rt>>4,Ft=0,Ht=0;St<2?ht&1?mt|=E[++j]<<4|(ht&2&&E[++j]<<12):mt=Rt>>3:(Ht=ht,ht<2?(mt|=(E[++j]&63)<<4,Ft=E[j]>>6|E[++j]<<2):ht==2?(mt|=E[++j]<<4|(E[++j]&3)<<12,Ft=E[j]>>2|E[++j]<<6):(mt|=E[++j]<<4|(E[++j]&63)<<12,Ft=E[j]>>6|E[++j]<<2|E[++j]<<10)),++j;var yt=z?z.subarray(I.y,I.y+I.m):new e(I.m),At=yt.length-mt;if(St==0)yt.set(E.subarray(j,j+=mt),At);else if(St==1)l(yt,E[j++],At);else{var vt=I.h;if(St==2){var Ot=O(E,j);Ft+=j-(j=Ot[0]),I.h=vt=Ot[1]}else vt||c(0);(Ht?K:nt)(E.subarray(j,j+=Ft),yt.subarray(At),vt)}var Ct=E[j++];if(Ct){Ct==255?Ct=(E[j++]|E[j++]<<8)+32512:Ct>127&&(Ct=Ct-128<<8|E[j++]);var Kt=E[j++];Kt&3&&c(0);for(var Ut=[Y,H,k],xt=2;xt>-1;--xt){var Wt=Kt>>(xt<<1)+2&3;if(Wt==1){var te=new e([0,0,E[j++]]);Ut[xt]={s:te.subarray(2,3),n:te.subarray(0,1),t:new i(te.buffer,0,1),b:0}}else Wt==2?(W=b(E,j,9-(xt&1)),j=W[0],Ut[xt]=W[1]):Wt==3&&(I.t||c(0),Ut[xt]=I.t[xt])}var qt=I.t=Ut,$t=qt[0],le=qt[1],Zt=qt[2],Vt=E[ct-1];Vt||c(0);var bt=(ct<<3)-8+p(Vt)-Zt.b,it=bt>>3,jt=0,ge=(E[it]|E[it+1]<<8)>>(bt&7)&(1<<Zt.b)-1;it=(bt-=le.b)>>3;var ye=(E[it]|E[it+1]<<8)>>(bt&7)&(1<<le.b)-1;it=(bt-=$t.b)>>3;var d=(E[it]|E[it+1]<<8)>>(bt&7)&(1<<$t.b)-1;for(++Ct;--Ct;){var V=Zt.s[ge],Z=Zt.n[ge],et=$t.s[d],lt=$t.n[d],ut=le.s[ye],y=le.n[ye];it=(bt-=ut)>>3;var M=1<<ut,u=M+((E[it]|E[it+1]<<8|E[it+2]<<16|E[it+3]<<24)>>>(bt&7)&M-1);it=(bt-=N[et])>>3;var q=$[et]+((E[it]|E[it+1]<<8|E[it+2]<<16)>>(bt&7)&(1<<N[et])-1);it=(bt-=x[V])>>3;var Et=D[V]+((E[it]|E[it+1]<<8|E[it+2]<<16)>>(bt&7)&(1<<x[V])-1);if(it=(bt-=Z)>>3,ge=Zt.t[ge]+((E[it]|E[it+1]<<8)>>(bt&7)&(1<<Z)-1),it=(bt-=lt)>>3,d=$t.t[d]+((E[it]|E[it+1]<<8)>>(bt&7)&(1<<lt)-1),it=(bt-=y)>>3,ye=le.t[ye]+((E[it]|E[it+1]<<8)>>(bt&7)&(1<<y)-1),u>3)I.o[2]=I.o[1],I.o[1]=I.o[0],I.o[0]=u-=3;else{var X=u-(Et!=0);X?(u=X==3?I.o[0]-1:I.o[X],X>1&&(I.o[2]=I.o[1]),I.o[1]=I.o[0],I.o[0]=u):u=I.o[0]}for(var xt=0;xt<Et;++xt)yt[jt+xt]=yt[At+xt];jt+=Et,At+=Et;var Tt=jt-u;if(Tt<0){var J=-Tt,Gt=I.e+Tt;J>q&&(J=q);for(var xt=0;xt<J;++xt)yt[jt+xt]=I.w[Gt+xt];jt+=J,q-=J,Tt=0}for(var xt=0;xt<q;++xt)yt[jt+xt]=yt[Tt+xt];jt+=q}if(jt!=At)for(;At<yt.length;)yt[jt++]=yt[At++];else jt=yt.length;z?I.y+=jt:yt=a(yt,0,jt)}else if(z){if(I.y+=mt,At)for(var xt=0;xt<mt;++xt)yt[xt]=yt[At+xt]}else At&&(yt=a(yt,At));return I.b=ct,yt}c(2)}},wt=function(E,I){if(E.length==1)return E[0];for(var z=new e(I),W=0,j=0;W<E.length;++W){var at=E[W];z.set(at,j),j+=at.length}return z};function st(E,I){for(var z=[],W=+!I,j=0,at=0;E.length;){var G=w(E,W||I);if(typeof G=="object"){for(W?(I=null,G.w.length==G.u&&(z.push(I=G.w),at+=G.u)):(z.push(I),G.e=0);!G.l;){var ot=pt(E,G,I);ot||c(5),I?G.e=G.y:(z.push(ot),at+=ot.length,s(G.w,0,ot.length),G.w.set(ot,G.w.length-ot.length))}j=G.b+G.c*4}else j=G;E=E.subarray(j)}return wt(z,at)}Gi.decompress=st;var tt=function(){function E(I){this.ondata=I,this.c=[],this.l=0,this.z=0}return E.prototype.push=function(I,z){if(typeof this.s=="number"){var W=Math.min(I.length,this.s);I=I.subarray(W),this.s-=W}var j=I.length,at=j+this.l;if(!this.s){if(z){if(!at){this.ondata(new e(0),!0);return}at<5&&c(5)}else if(at<18){this.c.push(I),this.l=at;return}if(this.l&&(this.c.push(I),I=wt(this.c,at),this.c=[],this.l=0),typeof(this.s=w(I))=="number")return this.push(I,z)}if(typeof this.s!="number"){if(at<(this.z||3)){z&&c(5),this.c.push(I),this.l=at;return}if(this.l&&(this.c.push(I),I=wt(this.c,at),this.c=[],this.l=0),!this.z&&at<(this.z=I[this.s.b]&2?4:3+(I[this.s.b]>>3|I[this.s.b+1]<<5|I[this.s.b+2]<<13))){z&&c(5),this.c.push(I),this.l=at;return}else this.z=0;for(;;){var G=pt(I,this.s);if(G)this.ondata(G,!1),s(this.s.w,0,G.length),this.s.w.set(G,this.s.w.length-G.length);else{z&&c(5);var ot=I.subarray(this.s.b);this.s.b=0,this.c.push(ot),this.l+=ot.length;return}if(this.s.l){var ct=I.subarray(this.s.b);this.s=this.s.c*4,this.push(ct,z);return}}}else z&&c(5)},E}();return Gi.Decompress=tt,Gi}var Te={},Ke={},Se={},Je={},Ta;function Fc(){if(Ta)return Je;Ta=1;const t=4,e=0,i=1,n=2;function r(d){let V=d.length;for(;--V>=0;)d[V]=0}const a=0,l=1,s=2,f=3,c=258,h=29,m=256,w=m+1+h,p=30,b=19,O=2*w+1,k=15,Y=16,H=7,T=256,x=16,D=17,N=18,$=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),nt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),K=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),pt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wt=512,st=new Array((w+2)*2);r(st);const tt=new Array(p*2);r(tt);const E=new Array(wt);r(E);const I=new Array(c-f+1);r(I);const z=new Array(h);r(z);const W=new Array(p);r(W);function j(d,V,Z,et,lt){this.static_tree=d,this.extra_bits=V,this.extra_base=Z,this.elems=et,this.max_length=lt,this.has_stree=d&&d.length}let at,G,ot;function ct(d,V){this.dyn_tree=d,this.max_code=0,this.stat_desc=V}const Rt=d=>d<256?E[d]:E[256+(d>>>7)],St=(d,V)=>{d.pending_buf[d.pending++]=V&255,d.pending_buf[d.pending++]=V>>>8&255},ht=(d,V,Z)=>{d.bi_valid>Y-Z?(d.bi_buf|=V<<d.bi_valid&65535,St(d,d.bi_buf),d.bi_buf=V>>Y-d.bi_valid,d.bi_valid+=Z-Y):(d.bi_buf|=V<<d.bi_valid&65535,d.bi_valid+=Z)},mt=(d,V,Z)=>{ht(d,Z[V*2],Z[V*2+1])},Ft=(d,V)=>{let Z=0;do Z|=d&1,d>>>=1,Z<<=1;while(--V>0);return Z>>>1},Ht=d=>{d.bi_valid===16?(St(d,d.bi_buf),d.bi_buf=0,d.bi_valid=0):d.bi_valid>=8&&(d.pending_buf[d.pending++]=d.bi_buf&255,d.bi_buf>>=8,d.bi_valid-=8)},yt=(d,V)=>{const Z=V.dyn_tree,et=V.max_code,lt=V.stat_desc.static_tree,ut=V.stat_desc.has_stree,y=V.stat_desc.extra_bits,M=V.stat_desc.extra_base,u=V.stat_desc.max_length;let q,Et,X,Tt,J,Gt,F=0;for(Tt=0;Tt<=k;Tt++)d.bl_count[Tt]=0;for(Z[d.heap[d.heap_max]*2+1]=0,q=d.heap_max+1;q<O;q++)Et=d.heap[q],Tt=Z[Z[Et*2+1]*2+1]+1,Tt>u&&(Tt=u,F++),Z[Et*2+1]=Tt,!(Et>et)&&(d.bl_count[Tt]++,J=0,Et>=M&&(J=y[Et-M]),Gt=Z[Et*2],d.opt_len+=Gt*(Tt+J),ut&&(d.static_len+=Gt*(lt[Et*2+1]+J)));if(F!==0){do{for(Tt=u-1;d.bl_count[Tt]===0;)Tt--;d.bl_count[Tt]--,d.bl_count[Tt+1]+=2,d.bl_count[u]--,F-=2}while(F>0);for(Tt=u;Tt!==0;Tt--)for(Et=d.bl_count[Tt];Et!==0;)X=d.heap[--q],!(X>et)&&(Z[X*2+1]!==Tt&&(d.opt_len+=(Tt-Z[X*2+1])*Z[X*2],Z[X*2+1]=Tt),Et--)}},At=(d,V,Z)=>{const et=new Array(k+1);let lt=0,ut,y;for(ut=1;ut<=k;ut++)lt=lt+Z[ut-1]<<1,et[ut]=lt;for(y=0;y<=V;y++){let M=d[y*2+1];M!==0&&(d[y*2]=Ft(et[M]++,M))}},vt=()=>{let d,V,Z,et,lt;const ut=new Array(k+1);for(Z=0,et=0;et<h-1;et++)for(z[et]=Z,d=0;d<1<<$[et];d++)I[Z++]=et;for(I[Z-1]=et,lt=0,et=0;et<16;et++)for(W[et]=lt,d=0;d<1<<nt[et];d++)E[lt++]=et;for(lt>>=7;et<p;et++)for(W[et]=lt<<7,d=0;d<1<<nt[et]-7;d++)E[256+lt++]=et;for(V=0;V<=k;V++)ut[V]=0;for(d=0;d<=143;)st[d*2+1]=8,d++,ut[8]++;for(;d<=255;)st[d*2+1]=9,d++,ut[9]++;for(;d<=279;)st[d*2+1]=7,d++,ut[7]++;for(;d<=287;)st[d*2+1]=8,d++,ut[8]++;for(At(st,w+1,ut),d=0;d<p;d++)tt[d*2+1]=5,tt[d*2]=Ft(d,5);at=new j(st,$,m+1,w,k),G=new j(tt,nt,0,p,k),ot=new j(new Array(0),K,0,b,H)},Ot=d=>{let V;for(V=0;V<w;V++)d.dyn_ltree[V*2]=0;for(V=0;V<p;V++)d.dyn_dtree[V*2]=0;for(V=0;V<b;V++)d.bl_tree[V*2]=0;d.dyn_ltree[T*2]=1,d.opt_len=d.static_len=0,d.sym_next=d.matches=0},Ct=d=>{d.bi_valid>8?St(d,d.bi_buf):d.bi_valid>0&&(d.pending_buf[d.pending++]=d.bi_buf),d.bi_buf=0,d.bi_valid=0},Kt=(d,V,Z,et)=>{const lt=V*2,ut=Z*2;return d[lt]<d[ut]||d[lt]===d[ut]&&et[V]<=et[Z]},Ut=(d,V,Z)=>{const et=d.heap[Z];let lt=Z<<1;for(;lt<=d.heap_len&&(lt<d.heap_len&&Kt(V,d.heap[lt+1],d.heap[lt],d.depth)&&lt++,!Kt(V,et,d.heap[lt],d.depth));)d.heap[Z]=d.heap[lt],Z=lt,lt<<=1;d.heap[Z]=et},xt=(d,V,Z)=>{let et,lt,ut=0,y,M;if(d.sym_next!==0)do et=d.pending_buf[d.sym_buf+ut++]&255,et+=(d.pending_buf[d.sym_buf+ut++]&255)<<8,lt=d.pending_buf[d.sym_buf+ut++],et===0?mt(d,lt,V):(y=I[lt],mt(d,y+m+1,V),M=$[y],M!==0&&(lt-=z[y],ht(d,lt,M)),et--,y=Rt(et),mt(d,y,Z),M=nt[y],M!==0&&(et-=W[y],ht(d,et,M)));while(ut<d.sym_next);mt(d,T,V)},Wt=(d,V)=>{const Z=V.dyn_tree,et=V.stat_desc.static_tree,lt=V.stat_desc.has_stree,ut=V.stat_desc.elems;let y,M,u=-1,q;for(d.heap_len=0,d.heap_max=O,y=0;y<ut;y++)Z[y*2]!==0?(d.heap[++d.heap_len]=u=y,d.depth[y]=0):Z[y*2+1]=0;for(;d.heap_len<2;)q=d.heap[++d.heap_len]=u<2?++u:0,Z[q*2]=1,d.depth[q]=0,d.opt_len--,lt&&(d.static_len-=et[q*2+1]);for(V.max_code=u,y=d.heap_len>>1;y>=1;y--)Ut(d,Z,y);q=ut;do y=d.heap[1],d.heap[1]=d.heap[d.heap_len--],Ut(d,Z,1),M=d.heap[1],d.heap[--d.heap_max]=y,d.heap[--d.heap_max]=M,Z[q*2]=Z[y*2]+Z[M*2],d.depth[q]=(d.depth[y]>=d.depth[M]?d.depth[y]:d.depth[M])+1,Z[y*2+1]=Z[M*2+1]=q,d.heap[1]=q++,Ut(d,Z,1);while(d.heap_len>=2);d.heap[--d.heap_max]=d.heap[1],yt(d,V),At(Z,u,d.bl_count)},te=(d,V,Z)=>{let et,lt=-1,ut,y=V[0*2+1],M=0,u=7,q=4;for(y===0&&(u=138,q=3),V[(Z+1)*2+1]=65535,et=0;et<=Z;et++)ut=y,y=V[(et+1)*2+1],!(++M<u&&ut===y)&&(M<q?d.bl_tree[ut*2]+=M:ut!==0?(ut!==lt&&d.bl_tree[ut*2]++,d.bl_tree[x*2]++):M<=10?d.bl_tree[D*2]++:d.bl_tree[N*2]++,M=0,lt=ut,y===0?(u=138,q=3):ut===y?(u=6,q=3):(u=7,q=4))},qt=(d,V,Z)=>{let et,lt=-1,ut,y=V[0*2+1],M=0,u=7,q=4;for(y===0&&(u=138,q=3),et=0;et<=Z;et++)if(ut=y,y=V[(et+1)*2+1],!(++M<u&&ut===y)){if(M<q)do mt(d,ut,d.bl_tree);while(--M!==0);else ut!==0?(ut!==lt&&(mt(d,ut,d.bl_tree),M--),mt(d,x,d.bl_tree),ht(d,M-3,2)):M<=10?(mt(d,D,d.bl_tree),ht(d,M-3,3)):(mt(d,N,d.bl_tree),ht(d,M-11,7));M=0,lt=ut,y===0?(u=138,q=3):ut===y?(u=6,q=3):(u=7,q=4)}},$t=d=>{let V;for(te(d,d.dyn_ltree,d.l_desc.max_code),te(d,d.dyn_dtree,d.d_desc.max_code),Wt(d,d.bl_desc),V=b-1;V>=3&&d.bl_tree[pt[V]*2+1]===0;V--);return d.opt_len+=3*(V+1)+5+5+4,V},le=(d,V,Z,et)=>{let lt;for(ht(d,V-257,5),ht(d,Z-1,5),ht(d,et-4,4),lt=0;lt<et;lt++)ht(d,d.bl_tree[pt[lt]*2+1],3);qt(d,d.dyn_ltree,V-1),qt(d,d.dyn_dtree,Z-1)},Zt=d=>{let V=4093624447,Z;for(Z=0;Z<=31;Z++,V>>>=1)if(V&1&&d.dyn_ltree[Z*2]!==0)return e;if(d.dyn_ltree[9*2]!==0||d.dyn_ltree[10*2]!==0||d.dyn_ltree[13*2]!==0)return i;for(Z=32;Z<m;Z++)if(d.dyn_ltree[Z*2]!==0)return i;return e};let Vt=!1;const bt=d=>{Vt||(vt(),Vt=!0),d.l_desc=new ct(d.dyn_ltree,at),d.d_desc=new ct(d.dyn_dtree,G),d.bl_desc=new ct(d.bl_tree,ot),d.bi_buf=0,d.bi_valid=0,Ot(d)},it=(d,V,Z,et)=>{ht(d,(a<<1)+(et?1:0),3),Ct(d),St(d,Z),St(d,~Z),Z&&d.pending_buf.set(d.window.subarray(V,V+Z),d.pending),d.pending+=Z},jt=d=>{ht(d,l<<1,3),mt(d,T,st),Ht(d)},ge=(d,V,Z,et)=>{let lt,ut,y=0;d.level>0?(d.strm.data_type===n&&(d.strm.data_type=Zt(d)),Wt(d,d.l_desc),Wt(d,d.d_desc),y=$t(d),lt=d.opt_len+3+7>>>3,ut=d.static_len+3+7>>>3,ut<=lt&&(lt=ut)):lt=ut=Z+5,Z+4<=lt&&V!==-1?it(d,V,Z,et):d.strategy===t||ut===lt?(ht(d,(l<<1)+(et?1:0),3),xt(d,st,tt)):(ht(d,(s<<1)+(et?1:0),3),le(d,d.l_desc.max_code+1,d.d_desc.max_code+1,y+1),xt(d,d.dyn_ltree,d.dyn_dtree)),Ot(d),et&&Ct(d)},ye=(d,V,Z)=>(d.pending_buf[d.sym_buf+d.sym_next++]=V,d.pending_buf[d.sym_buf+d.sym_next++]=V>>8,d.pending_buf[d.sym_buf+d.sym_next++]=Z,V===0?d.dyn_ltree[Z*2]++:(d.matches++,V--,d.dyn_ltree[(I[Z]+m+1)*2]++,d.dyn_dtree[Rt(V)*2]++),d.sym_next===d.sym_end);return Je._tr_init=bt,Je._tr_stored_block=it,Je._tr_flush_block=ge,Je._tr_tally=ye,Je._tr_align=jt,Je}var cr,Sa;function Go(){return Sa||(Sa=1,cr=(e,i,n,r)=>{let a=e&65535|0,l=e>>>16&65535|0,s=0;for(;n!==0;){s=n>2e3?2e3:n,n-=s;do a=a+i[r++]|0,l=l+a|0;while(--s);a%=65521,l%=65521}return a|l<<16|0}),cr}var fr,Oa;function Ho(){if(Oa)return fr;Oa=1;const t=()=>{let n,r=[];for(var a=0;a<256;a++){n=a;for(var l=0;l<8;l++)n=n&1?3988292384^n>>>1:n>>>1;r[a]=n}return r},e=new Uint32Array(t());return fr=(n,r,a,l)=>{const s=e,f=l+a;n^=-1;for(let c=l;c<f;c++)n=n>>>8^s[(n^r[c])&255];return n^-1},fr}var ur,Ra;function Hr(){return Ra||(Ra=1,ur={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),ur}var hr,Aa;function li(){return Aa||(Aa=1,hr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),hr}var Ia;function Nc(){if(Ia)return Se;Ia=1;const{_tr_init:t,_tr_stored_block:e,_tr_flush_block:i,_tr_tally:n,_tr_align:r}=Fc(),a=Go(),l=Ho(),s=Hr(),{Z_NO_FLUSH:f,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:h,Z_FINISH:m,Z_BLOCK:w,Z_OK:p,Z_STREAM_END:b,Z_STREAM_ERROR:O,Z_DATA_ERROR:k,Z_BUF_ERROR:Y,Z_DEFAULT_COMPRESSION:H,Z_FILTERED:T,Z_HUFFMAN_ONLY:x,Z_RLE:D,Z_FIXED:N,Z_DEFAULT_STRATEGY:$,Z_UNKNOWN:nt,Z_DEFLATED:K}=li(),pt=9,wt=15,st=8,I=256+1+29,z=30,W=19,j=2*I+1,at=15,G=3,ot=258,ct=ot+G+1,Rt=32,St=42,ht=57,mt=69,Ft=73,Ht=91,yt=103,At=113,vt=666,Ot=1,Ct=2,Kt=3,Ut=4,xt=3,Wt=(o,L)=>(o.msg=s[L],L),te=o=>o*2-(o>4?9:0),qt=o=>{let L=o.length;for(;--L>=0;)o[L]=0},$t=o=>{let L,_,R,A=o.w_size;L=o.hash_size,R=L;do _=o.head[--R],o.head[R]=_>=A?_-A:0;while(--L);L=A,R=L;do _=o.prev[--R],o.prev[R]=_>=A?_-A:0;while(--L)};let Zt=(o,L,_)=>(L<<o.hash_shift^_)&o.hash_mask;const Vt=o=>{const L=o.state;let _=L.pending;_>o.avail_out&&(_=o.avail_out),_!==0&&(o.output.set(L.pending_buf.subarray(L.pending_out,L.pending_out+_),o.next_out),o.next_out+=_,L.pending_out+=_,o.total_out+=_,o.avail_out-=_,L.pending-=_,L.pending===0&&(L.pending_out=0))},bt=(o,L)=>{i(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,L),o.block_start=o.strstart,Vt(o.strm)},it=(o,L)=>{o.pending_buf[o.pending++]=L},jt=(o,L)=>{o.pending_buf[o.pending++]=L>>>8&255,o.pending_buf[o.pending++]=L&255},ge=(o,L,_,R)=>{let A=o.avail_in;return A>R&&(A=R),A===0?0:(o.avail_in-=A,L.set(o.input.subarray(o.next_in,o.next_in+A),_),o.state.wrap===1?o.adler=a(o.adler,L,A,_):o.state.wrap===2&&(o.adler=l(o.adler,L,A,_)),o.next_in+=A,o.total_in+=A,A)},ye=(o,L)=>{let _=o.max_chain_length,R=o.strstart,A,Q,dt=o.prev_length,rt=o.nice_match;const ue=o.strstart>o.w_size-ct?o.strstart-(o.w_size-ct):0,Nt=o.window,Jt=o.w_mask,me=o.prev,ee=o.strstart+ot;let Ee=Nt[R+dt-1],ve=Nt[R+dt];o.prev_length>=o.good_match&&(_>>=2),rt>o.lookahead&&(rt=o.lookahead);do if(A=L,!(Nt[A+dt]!==ve||Nt[A+dt-1]!==Ee||Nt[A]!==Nt[R]||Nt[++A]!==Nt[R+1])){R+=2,A++;do;while(Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&Nt[++R]===Nt[++A]&&R<ee);if(Q=ot-(ee-R),R=ee-ot,Q>dt){if(o.match_start=L,dt=Q,Q>=rt)break;Ee=Nt[R+dt-1],ve=Nt[R+dt]}}while((L=me[L&Jt])>ue&&--_!==0);return dt<=o.lookahead?dt:o.lookahead},d=o=>{const L=o.w_size;let _,R,A;do{if(R=o.window_size-o.lookahead-o.strstart,o.strstart>=L+(L-ct)&&(o.window.set(o.window.subarray(L,L+L-R),0),o.match_start-=L,o.strstart-=L,o.block_start-=L,o.insert>o.strstart&&(o.insert=o.strstart),$t(o),R+=L),o.strm.avail_in===0)break;if(_=ge(o.strm,o.window,o.strstart+o.lookahead,R),o.lookahead+=_,o.lookahead+o.insert>=G)for(A=o.strstart-o.insert,o.ins_h=o.window[A],o.ins_h=Zt(o,o.ins_h,o.window[A+1]);o.insert&&(o.ins_h=Zt(o,o.ins_h,o.window[A+G-1]),o.prev[A&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=A,A++,o.insert--,!(o.lookahead+o.insert<G)););}while(o.lookahead<ct&&o.strm.avail_in!==0)},V=(o,L)=>{let _=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,R,A,Q,dt=0,rt=o.strm.avail_in;do{if(R=65535,Q=o.bi_valid+42>>3,o.strm.avail_out<Q||(Q=o.strm.avail_out-Q,A=o.strstart-o.block_start,R>A+o.strm.avail_in&&(R=A+o.strm.avail_in),R>Q&&(R=Q),R<_&&(R===0&&L!==m||L===f||R!==A+o.strm.avail_in)))break;dt=L===m&&R===A+o.strm.avail_in?1:0,e(o,0,0,dt),o.pending_buf[o.pending-4]=R,o.pending_buf[o.pending-3]=R>>8,o.pending_buf[o.pending-2]=~R,o.pending_buf[o.pending-1]=~R>>8,Vt(o.strm),A&&(A>R&&(A=R),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+A),o.strm.next_out),o.strm.next_out+=A,o.strm.avail_out-=A,o.strm.total_out+=A,o.block_start+=A,R-=A),R&&(ge(o.strm,o.strm.output,o.strm.next_out,R),o.strm.next_out+=R,o.strm.avail_out-=R,o.strm.total_out+=R)}while(dt===0);return rt-=o.strm.avail_in,rt&&(rt>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=rt&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-rt,o.strm.next_in),o.strstart),o.strstart+=rt,o.insert+=rt>o.w_size-o.insert?o.w_size-o.insert:rt),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),dt?Ut:L!==f&&L!==m&&o.strm.avail_in===0&&o.strstart===o.block_start?Ct:(Q=o.window_size-o.strstart,o.strm.avail_in>Q&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,Q+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),Q>o.strm.avail_in&&(Q=o.strm.avail_in),Q&&(ge(o.strm,o.window,o.strstart,Q),o.strstart+=Q,o.insert+=Q>o.w_size-o.insert?o.w_size-o.insert:Q),o.high_water<o.strstart&&(o.high_water=o.strstart),Q=o.bi_valid+42>>3,Q=o.pending_buf_size-Q>65535?65535:o.pending_buf_size-Q,_=Q>o.w_size?o.w_size:Q,A=o.strstart-o.block_start,(A>=_||(A||L===m)&&L!==f&&o.strm.avail_in===0&&A<=Q)&&(R=A>Q?Q:A,dt=L===m&&o.strm.avail_in===0&&R===A?1:0,e(o,o.block_start,R,dt),o.block_start+=R,Vt(o.strm)),dt?Kt:Ot)},Z=(o,L)=>{let _,R;for(;;){if(o.lookahead<ct){if(d(o),o.lookahead<ct&&L===f)return Ot;if(o.lookahead===0)break}if(_=0,o.lookahead>=G&&(o.ins_h=Zt(o,o.ins_h,o.window[o.strstart+G-1]),_=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),_!==0&&o.strstart-_<=o.w_size-ct&&(o.match_length=ye(o,_)),o.match_length>=G)if(R=n(o,o.strstart-o.match_start,o.match_length-G),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=G){o.match_length--;do o.strstart++,o.ins_h=Zt(o,o.ins_h,o.window[o.strstart+G-1]),_=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart;while(--o.match_length!==0);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=Zt(o,o.ins_h,o.window[o.strstart+1]);else R=n(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(R&&(bt(o,!1),o.strm.avail_out===0))return Ot}return o.insert=o.strstart<G-1?o.strstart:G-1,L===m?(bt(o,!0),o.strm.avail_out===0?Kt:Ut):o.sym_next&&(bt(o,!1),o.strm.avail_out===0)?Ot:Ct},et=(o,L)=>{let _,R,A;for(;;){if(o.lookahead<ct){if(d(o),o.lookahead<ct&&L===f)return Ot;if(o.lookahead===0)break}if(_=0,o.lookahead>=G&&(o.ins_h=Zt(o,o.ins_h,o.window[o.strstart+G-1]),_=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=G-1,_!==0&&o.prev_length<o.max_lazy_match&&o.strstart-_<=o.w_size-ct&&(o.match_length=ye(o,_),o.match_length<=5&&(o.strategy===T||o.match_length===G&&o.strstart-o.match_start>4096)&&(o.match_length=G-1)),o.prev_length>=G&&o.match_length<=o.prev_length){A=o.strstart+o.lookahead-G,R=n(o,o.strstart-1-o.prev_match,o.prev_length-G),o.lookahead-=o.prev_length-1,o.prev_length-=2;do++o.strstart<=A&&(o.ins_h=Zt(o,o.ins_h,o.window[o.strstart+G-1]),_=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart);while(--o.prev_length!==0);if(o.match_available=0,o.match_length=G-1,o.strstart++,R&&(bt(o,!1),o.strm.avail_out===0))return Ot}else if(o.match_available){if(R=n(o,0,o.window[o.strstart-1]),R&&bt(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return Ot}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(R=n(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<G-1?o.strstart:G-1,L===m?(bt(o,!0),o.strm.avail_out===0?Kt:Ut):o.sym_next&&(bt(o,!1),o.strm.avail_out===0)?Ot:Ct},lt=(o,L)=>{let _,R,A,Q;const dt=o.window;for(;;){if(o.lookahead<=ot){if(d(o),o.lookahead<=ot&&L===f)return Ot;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=G&&o.strstart>0&&(A=o.strstart-1,R=dt[A],R===dt[++A]&&R===dt[++A]&&R===dt[++A])){Q=o.strstart+ot;do;while(R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&R===dt[++A]&&A<Q);o.match_length=ot-(Q-A),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=G?(_=n(o,1,o.match_length-G),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(_=n(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),_&&(bt(o,!1),o.strm.avail_out===0))return Ot}return o.insert=0,L===m?(bt(o,!0),o.strm.avail_out===0?Kt:Ut):o.sym_next&&(bt(o,!1),o.strm.avail_out===0)?Ot:Ct},ut=(o,L)=>{let _;for(;;){if(o.lookahead===0&&(d(o),o.lookahead===0)){if(L===f)return Ot;break}if(o.match_length=0,_=n(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,_&&(bt(o,!1),o.strm.avail_out===0))return Ot}return o.insert=0,L===m?(bt(o,!0),o.strm.avail_out===0?Kt:Ut):o.sym_next&&(bt(o,!1),o.strm.avail_out===0)?Ot:Ct};function y(o,L,_,R,A){this.good_length=o,this.max_lazy=L,this.nice_length=_,this.max_chain=R,this.func=A}const M=[new y(0,0,0,0,V),new y(4,4,8,4,Z),new y(4,5,16,8,Z),new y(4,6,32,32,Z),new y(4,4,16,16,et),new y(8,16,32,32,et),new y(8,16,128,128,et),new y(8,32,128,256,et),new y(32,128,258,1024,et),new y(32,258,258,4096,et)],u=o=>{o.window_size=2*o.w_size,qt(o.head),o.max_lazy_match=M[o.level].max_lazy,o.good_match=M[o.level].good_length,o.nice_match=M[o.level].nice_length,o.max_chain_length=M[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=G-1,o.match_available=0,o.ins_h=0};function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(j*2),this.dyn_dtree=new Uint16Array((2*z+1)*2),this.bl_tree=new Uint16Array((2*W+1)*2),qt(this.dyn_ltree),qt(this.dyn_dtree),qt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(at+1),this.heap=new Uint16Array(2*I+1),qt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*I+1),qt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Et=o=>{if(!o)return 1;const L=o.state;return!L||L.strm!==o||L.status!==St&&L.status!==ht&&L.status!==mt&&L.status!==Ft&&L.status!==Ht&&L.status!==yt&&L.status!==At&&L.status!==vt?1:0},X=o=>{if(Et(o))return Wt(o,O);o.total_in=o.total_out=0,o.data_type=nt;const L=o.state;return L.pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap===2?ht:L.wrap?St:At,o.adler=L.wrap===2?0:1,L.last_flush=-2,t(L),p},Tt=o=>{const L=X(o);return L===p&&u(o.state),L},J=(o,L)=>Et(o)||o.state.wrap!==2?O:(o.state.gzhead=L,p),Gt=(o,L,_,R,A,Q)=>{if(!o)return O;let dt=1;if(L===H&&(L=6),R<0?(dt=0,R=-R):R>15&&(dt=2,R-=16),A<1||A>pt||_!==K||R<8||R>15||L<0||L>9||Q<0||Q>N||R===8&&dt!==1)return Wt(o,O);R===8&&(R=9);const rt=new q;return o.state=rt,rt.strm=o,rt.status=St,rt.wrap=dt,rt.gzhead=null,rt.w_bits=R,rt.w_size=1<<rt.w_bits,rt.w_mask=rt.w_size-1,rt.hash_bits=A+7,rt.hash_size=1<<rt.hash_bits,rt.hash_mask=rt.hash_size-1,rt.hash_shift=~~((rt.hash_bits+G-1)/G),rt.window=new Uint8Array(rt.w_size*2),rt.head=new Uint16Array(rt.hash_size),rt.prev=new Uint16Array(rt.w_size),rt.lit_bufsize=1<<A+6,rt.pending_buf_size=rt.lit_bufsize*4,rt.pending_buf=new Uint8Array(rt.pending_buf_size),rt.sym_buf=rt.lit_bufsize,rt.sym_end=(rt.lit_bufsize-1)*3,rt.level=L,rt.strategy=Q,rt.method=_,Tt(o)},F=(o,L)=>Gt(o,L,K,wt,st,$),B=(o,L)=>{if(Et(o)||L>w||L<0)return o?Wt(o,O):O;const _=o.state;if(!o.output||o.avail_in!==0&&!o.input||_.status===vt&&L!==m)return Wt(o,o.avail_out===0?Y:O);const R=_.last_flush;if(_.last_flush=L,_.pending!==0){if(Vt(o),o.avail_out===0)return _.last_flush=-1,p}else if(o.avail_in===0&&te(L)<=te(R)&&L!==m)return Wt(o,Y);if(_.status===vt&&o.avail_in!==0)return Wt(o,Y);if(_.status===St&&_.wrap===0&&(_.status=At),_.status===St){let A=K+(_.w_bits-8<<4)<<8,Q=-1;if(_.strategy>=x||_.level<2?Q=0:_.level<6?Q=1:_.level===6?Q=2:Q=3,A|=Q<<6,_.strstart!==0&&(A|=Rt),A+=31-A%31,jt(_,A),_.strstart!==0&&(jt(_,o.adler>>>16),jt(_,o.adler&65535)),o.adler=1,_.status=At,Vt(o),_.pending!==0)return _.last_flush=-1,p}if(_.status===ht){if(o.adler=0,it(_,31),it(_,139),it(_,8),_.gzhead)it(_,(_.gzhead.text?1:0)+(_.gzhead.hcrc?2:0)+(_.gzhead.extra?4:0)+(_.gzhead.name?8:0)+(_.gzhead.comment?16:0)),it(_,_.gzhead.time&255),it(_,_.gzhead.time>>8&255),it(_,_.gzhead.time>>16&255),it(_,_.gzhead.time>>24&255),it(_,_.level===9?2:_.strategy>=x||_.level<2?4:0),it(_,_.gzhead.os&255),_.gzhead.extra&&_.gzhead.extra.length&&(it(_,_.gzhead.extra.length&255),it(_,_.gzhead.extra.length>>8&255)),_.gzhead.hcrc&&(o.adler=l(o.adler,_.pending_buf,_.pending,0)),_.gzindex=0,_.status=mt;else if(it(_,0),it(_,0),it(_,0),it(_,0),it(_,0),it(_,_.level===9?2:_.strategy>=x||_.level<2?4:0),it(_,xt),_.status=At,Vt(o),_.pending!==0)return _.last_flush=-1,p}if(_.status===mt){if(_.gzhead.extra){let A=_.pending,Q=(_.gzhead.extra.length&65535)-_.gzindex;for(;_.pending+Q>_.pending_buf_size;){let rt=_.pending_buf_size-_.pending;if(_.pending_buf.set(_.gzhead.extra.subarray(_.gzindex,_.gzindex+rt),_.pending),_.pending=_.pending_buf_size,_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A)),_.gzindex+=rt,Vt(o),_.pending!==0)return _.last_flush=-1,p;A=0,Q-=rt}let dt=new Uint8Array(_.gzhead.extra);_.pending_buf.set(dt.subarray(_.gzindex,_.gzindex+Q),_.pending),_.pending+=Q,_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A)),_.gzindex=0}_.status=Ft}if(_.status===Ft){if(_.gzhead.name){let A=_.pending,Q;do{if(_.pending===_.pending_buf_size){if(_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A)),Vt(o),_.pending!==0)return _.last_flush=-1,p;A=0}_.gzindex<_.gzhead.name.length?Q=_.gzhead.name.charCodeAt(_.gzindex++)&255:Q=0,it(_,Q)}while(Q!==0);_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A)),_.gzindex=0}_.status=Ht}if(_.status===Ht){if(_.gzhead.comment){let A=_.pending,Q;do{if(_.pending===_.pending_buf_size){if(_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A)),Vt(o),_.pending!==0)return _.last_flush=-1,p;A=0}_.gzindex<_.gzhead.comment.length?Q=_.gzhead.comment.charCodeAt(_.gzindex++)&255:Q=0,it(_,Q)}while(Q!==0);_.gzhead.hcrc&&_.pending>A&&(o.adler=l(o.adler,_.pending_buf,_.pending-A,A))}_.status=yt}if(_.status===yt){if(_.gzhead.hcrc){if(_.pending+2>_.pending_buf_size&&(Vt(o),_.pending!==0))return _.last_flush=-1,p;it(_,o.adler&255),it(_,o.adler>>8&255),o.adler=0}if(_.status=At,Vt(o),_.pending!==0)return _.last_flush=-1,p}if(o.avail_in!==0||_.lookahead!==0||L!==f&&_.status!==vt){let A=_.level===0?V(_,L):_.strategy===x?ut(_,L):_.strategy===D?lt(_,L):M[_.level].func(_,L);if((A===Kt||A===Ut)&&(_.status=vt),A===Ot||A===Kt)return o.avail_out===0&&(_.last_flush=-1),p;if(A===Ct&&(L===c?r(_):L!==w&&(e(_,0,0,!1),L===h&&(qt(_.head),_.lookahead===0&&(_.strstart=0,_.block_start=0,_.insert=0))),Vt(o),o.avail_out===0))return _.last_flush=-1,p}return L!==m?p:_.wrap<=0?b:(_.wrap===2?(it(_,o.adler&255),it(_,o.adler>>8&255),it(_,o.adler>>16&255),it(_,o.adler>>24&255),it(_,o.total_in&255),it(_,o.total_in>>8&255),it(_,o.total_in>>16&255),it(_,o.total_in>>24&255)):(jt(_,o.adler>>>16),jt(_,o.adler&65535)),Vt(o),_.wrap>0&&(_.wrap=-_.wrap),_.pending!==0?p:b)},di=o=>{if(Et(o))return O;const L=o.state.status;return o.state=null,L===At?Wt(o,k):p},Yt=(o,L)=>{let _=L.length;if(Et(o))return O;const R=o.state,A=R.wrap;if(A===2||A===1&&R.status!==St||R.lookahead)return O;if(A===1&&(o.adler=a(o.adler,L,_,0)),R.wrap=0,_>=R.w_size){A===0&&(qt(R.head),R.strstart=0,R.block_start=0,R.insert=0);let ue=new Uint8Array(R.w_size);ue.set(L.subarray(_-R.w_size,_),0),L=ue,_=R.w_size}const Q=o.avail_in,dt=o.next_in,rt=o.input;for(o.avail_in=_,o.next_in=0,o.input=L,d(R);R.lookahead>=G;){let ue=R.strstart,Nt=R.lookahead-(G-1);do R.ins_h=Zt(R,R.ins_h,R.window[ue+G-1]),R.prev[ue&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=ue,ue++;while(--Nt);R.strstart=ue,R.lookahead=G-1,d(R)}return R.strstart+=R.lookahead,R.block_start=R.strstart,R.insert=R.lookahead,R.lookahead=0,R.match_length=R.prev_length=G-1,R.match_available=0,o.next_in=dt,o.input=rt,o.avail_in=Q,R.wrap=A,p};return Se.deflateInit=F,Se.deflateInit2=Gt,Se.deflateReset=Tt,Se.deflateResetKeep=X,Se.deflateSetHeader=J,Se.deflate=B,Se.deflateEnd=di,Se.deflateSetDictionary=Yt,Se.deflateInfo="pako deflate (from Nodeca project)",Se}var Rn={},ka;function $o(){if(ka)return Rn;ka=1;const t=(e,i)=>Object.prototype.hasOwnProperty.call(e,i);return Rn.assign=function(e){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)t(n,r)&&(e[r]=n[r])}}return e},Rn.flattenChunks=e=>{let i=0;for(let r=0,a=e.length;r<a;r++)i+=e[r].length;const n=new Uint8Array(i);for(let r=0,a=0,l=e.length;r<l;r++){let s=e[r];n.set(s,a),a+=s.length}return n},Rn}var Hi={},La;function jo(){if(La)return Hi;La=1;let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t=!1}const e=new Uint8Array(256);for(let n=0;n<256;n++)e[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;e[254]=e[254]=1,Hi.string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let r,a,l,s,f,c=n.length,h=0;for(s=0;s<c;s++)a=n.charCodeAt(s),(a&64512)===55296&&s+1<c&&(l=n.charCodeAt(s+1),(l&64512)===56320&&(a=65536+(a-55296<<10)+(l-56320),s++)),h+=a<128?1:a<2048?2:a<65536?3:4;for(r=new Uint8Array(h),f=0,s=0;f<h;s++)a=n.charCodeAt(s),(a&64512)===55296&&s+1<c&&(l=n.charCodeAt(s+1),(l&64512)===56320&&(a=65536+(a-55296<<10)+(l-56320),s++)),a<128?r[f++]=a:a<2048?(r[f++]=192|a>>>6,r[f++]=128|a&63):a<65536?(r[f++]=224|a>>>12,r[f++]=128|a>>>6&63,r[f++]=128|a&63):(r[f++]=240|a>>>18,r[f++]=128|a>>>12&63,r[f++]=128|a>>>6&63,r[f++]=128|a&63);return r};const i=(n,r)=>{if(r<65534&&n.subarray&&t)return String.fromCharCode.apply(null,n.length===r?n:n.subarray(0,r));let a="";for(let l=0;l<r;l++)a+=String.fromCharCode(n[l]);return a};return Hi.buf2string=(n,r)=>{const a=r||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,r));let l,s;const f=new Array(a*2);for(s=0,l=0;l<a;){let c=n[l++];if(c<128){f[s++]=c;continue}let h=e[c];if(h>4){f[s++]=65533,l+=h-1;continue}for(c&=h===2?31:h===3?15:7;h>1&&l<a;)c=c<<6|n[l++]&63,h--;if(h>1){f[s++]=65533;continue}c<65536?f[s++]=c:(c-=65536,f[s++]=55296|c>>10&1023,f[s++]=56320|c&1023)}return i(f,s)},Hi.utf8border=(n,r)=>{r=r||n.length,r>n.length&&(r=n.length);let a=r-1;for(;a>=0&&(n[a]&192)===128;)a--;return a<0||a===0?r:a+e[n[a]]>r?a:r},Hi}var dr,Da;function Yo(){if(Da)return dr;Da=1;function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return dr=t,dr}var Pa;function Bc(){if(Pa)return Ke;Pa=1;const t=Nc(),e=$o(),i=jo(),n=Hr(),r=Yo(),a=Object.prototype.toString,{Z_NO_FLUSH:l,Z_SYNC_FLUSH:s,Z_FULL_FLUSH:f,Z_FINISH:c,Z_OK:h,Z_STREAM_END:m,Z_DEFAULT_COMPRESSION:w,Z_DEFAULT_STRATEGY:p,Z_DEFLATED:b}=li();function O(T){this.options=e.assign({level:w,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:p},T||{});let x=this.options;x.raw&&x.windowBits>0?x.windowBits=-x.windowBits:x.gzip&&x.windowBits>0&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let D=t.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(D!==h)throw new Error(n[D]);if(x.header&&t.deflateSetHeader(this.strm,x.header),x.dictionary){let N;if(typeof x.dictionary=="string"?N=i.string2buf(x.dictionary):a.call(x.dictionary)==="[object ArrayBuffer]"?N=new Uint8Array(x.dictionary):N=x.dictionary,D=t.deflateSetDictionary(this.strm,N),D!==h)throw new Error(n[D]);this._dict_set=!0}}O.prototype.push=function(T,x){const D=this.strm,N=this.options.chunkSize;let $,nt;if(this.ended)return!1;for(x===~~x?nt=x:nt=x===!0?c:l,typeof T=="string"?D.input=i.string2buf(T):a.call(T)==="[object ArrayBuffer]"?D.input=new Uint8Array(T):D.input=T,D.next_in=0,D.avail_in=D.input.length;;){if(D.avail_out===0&&(D.output=new Uint8Array(N),D.next_out=0,D.avail_out=N),(nt===s||nt===f)&&D.avail_out<=6){this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;continue}if($=t.deflate(D,nt),$===m)return D.next_out>0&&this.onData(D.output.subarray(0,D.next_out)),$=t.deflateEnd(this.strm),this.onEnd($),this.ended=!0,$===h;if(D.avail_out===0){this.onData(D.output);continue}if(nt>0&&D.next_out>0){this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;continue}if(D.avail_in===0)break}return!0},O.prototype.onData=function(T){this.chunks.push(T)},O.prototype.onEnd=function(T){T===h&&(this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg};function k(T,x){const D=new O(x);if(D.push(T,!0),D.err)throw D.msg||n[D.err];return D.result}function Y(T,x){return x=x||{},x.raw=!0,k(T,x)}function H(T,x){return x=x||{},x.gzip=!0,k(T,x)}return Ke.Deflate=O,Ke.deflate=k,Ke.deflateRaw=Y,Ke.gzip=H,Ke.constants=li(),Ke}var Qe={},xe={},_r,Ca;function Uc(){if(Ca)return _r;Ca=1;const t=16209,e=16191;return _r=function(n,r){let a,l,s,f,c,h,m,w,p,b,O,k,Y,H,T,x,D,N,$,nt,K,pt,wt,st;const tt=n.state;a=n.next_in,wt=n.input,l=a+(n.avail_in-5),s=n.next_out,st=n.output,f=s-(r-n.avail_out),c=s+(n.avail_out-257),h=tt.dmax,m=tt.wsize,w=tt.whave,p=tt.wnext,b=tt.window,O=tt.hold,k=tt.bits,Y=tt.lencode,H=tt.distcode,T=(1<<tt.lenbits)-1,x=(1<<tt.distbits)-1;t:do{k<15&&(O+=wt[a++]<<k,k+=8,O+=wt[a++]<<k,k+=8),D=Y[O&T];e:for(;;){if(N=D>>>24,O>>>=N,k-=N,N=D>>>16&255,N===0)st[s++]=D&65535;else if(N&16){$=D&65535,N&=15,N&&(k<N&&(O+=wt[a++]<<k,k+=8),$+=O&(1<<N)-1,O>>>=N,k-=N),k<15&&(O+=wt[a++]<<k,k+=8,O+=wt[a++]<<k,k+=8),D=H[O&x];i:for(;;){if(N=D>>>24,O>>>=N,k-=N,N=D>>>16&255,N&16){if(nt=D&65535,N&=15,k<N&&(O+=wt[a++]<<k,k+=8,k<N&&(O+=wt[a++]<<k,k+=8)),nt+=O&(1<<N)-1,nt>h){n.msg="invalid distance too far back",tt.mode=t;break t}if(O>>>=N,k-=N,N=s-f,nt>N){if(N=nt-N,N>w&&tt.sane){n.msg="invalid distance too far back",tt.mode=t;break t}if(K=0,pt=b,p===0){if(K+=m-N,N<$){$-=N;do st[s++]=b[K++];while(--N);K=s-nt,pt=st}}else if(p<N){if(K+=m+p-N,N-=p,N<$){$-=N;do st[s++]=b[K++];while(--N);if(K=0,p<$){N=p,$-=N;do st[s++]=b[K++];while(--N);K=s-nt,pt=st}}}else if(K+=p-N,N<$){$-=N;do st[s++]=b[K++];while(--N);K=s-nt,pt=st}for(;$>2;)st[s++]=pt[K++],st[s++]=pt[K++],st[s++]=pt[K++],$-=3;$&&(st[s++]=pt[K++],$>1&&(st[s++]=pt[K++]))}else{K=s-nt;do st[s++]=st[K++],st[s++]=st[K++],st[s++]=st[K++],$-=3;while($>2);$&&(st[s++]=st[K++],$>1&&(st[s++]=st[K++]))}}else if(N&64){n.msg="invalid distance code",tt.mode=t;break t}else{D=H[(D&65535)+(O&(1<<N)-1)];continue i}break}}else if(N&64)if(N&32){tt.mode=e;break t}else{n.msg="invalid literal/length code",tt.mode=t;break t}else{D=Y[(D&65535)+(O&(1<<N)-1)];continue e}break}}while(a<l&&s<c);$=k>>3,a-=$,k-=$<<3,O&=(1<<k)-1,n.next_in=a,n.next_out=s,n.avail_in=a<l?5+(l-a):5-(a-l),n.avail_out=s<c?257+(c-s):257-(s-c),tt.hold=O,tt.bits=k},_r}var pr,Ma;function Vc(){if(Ma)return pr;Ma=1;const t=15,e=852,i=592,n=0,r=1,a=2,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),s=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),f=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),c=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);return pr=(m,w,p,b,O,k,Y,H)=>{const T=H.bits;let x=0,D=0,N=0,$=0,nt=0,K=0,pt=0,wt=0,st=0,tt=0,E,I,z,W,j,at=null,G;const ot=new Uint16Array(t+1),ct=new Uint16Array(t+1);let Rt=null,St,ht,mt;for(x=0;x<=t;x++)ot[x]=0;for(D=0;D<b;D++)ot[w[p+D]]++;for(nt=T,$=t;$>=1&&ot[$]===0;$--);if(nt>$&&(nt=$),$===0)return O[k++]=1<<24|64<<16|0,O[k++]=1<<24|64<<16|0,H.bits=1,0;for(N=1;N<$&&ot[N]===0;N++);for(nt<N&&(nt=N),wt=1,x=1;x<=t;x++)if(wt<<=1,wt-=ot[x],wt<0)return-1;if(wt>0&&(m===n||$!==1))return-1;for(ct[1]=0,x=1;x<t;x++)ct[x+1]=ct[x]+ot[x];for(D=0;D<b;D++)w[p+D]!==0&&(Y[ct[w[p+D]]++]=D);if(m===n?(at=Rt=Y,G=20):m===r?(at=l,Rt=s,G=257):(at=f,Rt=c,G=0),tt=0,D=0,x=N,j=k,K=nt,pt=0,z=-1,st=1<<nt,W=st-1,m===r&&st>e||m===a&&st>i)return 1;for(;;){St=x-pt,Y[D]+1<G?(ht=0,mt=Y[D]):Y[D]>=G?(ht=Rt[Y[D]-G],mt=at[Y[D]-G]):(ht=96,mt=0),E=1<<x-pt,I=1<<K,N=I;do I-=E,O[j+(tt>>pt)+I]=St<<24|ht<<16|mt|0;while(I!==0);for(E=1<<x-1;tt&E;)E>>=1;if(E!==0?(tt&=E-1,tt+=E):tt=0,D++,--ot[x]===0){if(x===$)break;x=w[p+Y[D]]}if(x>nt&&(tt&W)!==z){for(pt===0&&(pt=nt),j+=N,K=x-pt,wt=1<<K;K+pt<$&&(wt-=ot[K+pt],!(wt<=0));)K++,wt<<=1;if(st+=1<<K,m===r&&st>e||m===a&&st>i)return 1;z=tt&W,O[z]=nt<<24|K<<16|j-k|0}}return tt!==0&&(O[j+tt]=x-pt<<24|64<<16|0),H.bits=nt,0},pr}var za;function Wc(){if(za)return xe;za=1;const t=Go(),e=Ho(),i=Uc(),n=Vc(),r=0,a=1,l=2,{Z_FINISH:s,Z_BLOCK:f,Z_TREES:c,Z_OK:h,Z_STREAM_END:m,Z_NEED_DICT:w,Z_STREAM_ERROR:p,Z_DATA_ERROR:b,Z_MEM_ERROR:O,Z_BUF_ERROR:k,Z_DEFLATED:Y}=li(),H=16180,T=16181,x=16182,D=16183,N=16184,$=16185,nt=16186,K=16187,pt=16188,wt=16189,st=16190,tt=16191,E=16192,I=16193,z=16194,W=16195,j=16196,at=16197,G=16198,ot=16199,ct=16200,Rt=16201,St=16202,ht=16203,mt=16204,Ft=16205,Ht=16206,yt=16207,At=16208,vt=16209,Ot=16210,Ct=16211,Kt=852,Ut=592,Wt=15,te=y=>(y>>>24&255)+(y>>>8&65280)+((y&65280)<<8)+((y&255)<<24);function qt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $t=y=>{if(!y)return 1;const M=y.state;return!M||M.strm!==y||M.mode<H||M.mode>Ct?1:0},le=y=>{if($t(y))return p;const M=y.state;return y.total_in=y.total_out=M.total=0,y.msg="",M.wrap&&(y.adler=M.wrap&1),M.mode=H,M.last=0,M.havedict=0,M.flags=-1,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new Int32Array(Kt),M.distcode=M.distdyn=new Int32Array(Ut),M.sane=1,M.back=-1,h},Zt=y=>{if($t(y))return p;const M=y.state;return M.wsize=0,M.whave=0,M.wnext=0,le(y)},Vt=(y,M)=>{let u;if($t(y))return p;const q=y.state;return M<0?(u=0,M=-M):(u=(M>>4)+5,M<48&&(M&=15)),M&&(M<8||M>15)?p:(q.window!==null&&q.wbits!==M&&(q.window=null),q.wrap=u,q.wbits=M,Zt(y))},bt=(y,M)=>{if(!y)return p;const u=new qt;y.state=u,u.strm=y,u.window=null,u.mode=H;const q=Vt(y,M);return q!==h&&(y.state=null),q},it=y=>bt(y,Wt);let jt=!0,ge,ye;const d=y=>{if(jt){ge=new Int32Array(512),ye=new Int32Array(32);let M=0;for(;M<144;)y.lens[M++]=8;for(;M<256;)y.lens[M++]=9;for(;M<280;)y.lens[M++]=7;for(;M<288;)y.lens[M++]=8;for(n(a,y.lens,0,288,ge,0,y.work,{bits:9}),M=0;M<32;)y.lens[M++]=5;n(l,y.lens,0,32,ye,0,y.work,{bits:5}),jt=!1}y.lencode=ge,y.lenbits=9,y.distcode=ye,y.distbits=5},V=(y,M,u,q)=>{let Et;const X=y.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new Uint8Array(X.wsize)),q>=X.wsize?(X.window.set(M.subarray(u-X.wsize,u),0),X.wnext=0,X.whave=X.wsize):(Et=X.wsize-X.wnext,Et>q&&(Et=q),X.window.set(M.subarray(u-q,u-q+Et),X.wnext),q-=Et,q?(X.window.set(M.subarray(u-q,u),0),X.wnext=q,X.whave=X.wsize):(X.wnext+=Et,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=Et))),0},Z=(y,M)=>{let u,q,Et,X,Tt,J,Gt,F,B,di,Yt,o,L,_,R=0,A,Q,dt,rt,ue,Nt,Jt,me;const ee=new Uint8Array(4);let Ee,ve;const ia=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($t(y)||!y.output||!y.input&&y.avail_in!==0)return p;u=y.state,u.mode===tt&&(u.mode=E),Tt=y.next_out,Et=y.output,Gt=y.avail_out,X=y.next_in,q=y.input,J=y.avail_in,F=u.hold,B=u.bits,di=J,Yt=Gt,me=h;t:for(;;)switch(u.mode){case H:if(u.wrap===0){u.mode=E;break}for(;B<16;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(u.wrap&2&&F===35615){u.wbits===0&&(u.wbits=15),u.check=0,ee[0]=F&255,ee[1]=F>>>8&255,u.check=e(u.check,ee,2,0),F=0,B=0,u.mode=T;break}if(u.head&&(u.head.done=!1),!(u.wrap&1)||(((F&255)<<8)+(F>>8))%31){y.msg="incorrect header check",u.mode=vt;break}if((F&15)!==Y){y.msg="unknown compression method",u.mode=vt;break}if(F>>>=4,B-=4,Jt=(F&15)+8,u.wbits===0&&(u.wbits=Jt),Jt>15||Jt>u.wbits){y.msg="invalid window size",u.mode=vt;break}u.dmax=1<<u.wbits,u.flags=0,y.adler=u.check=1,u.mode=F&512?wt:tt,F=0,B=0;break;case T:for(;B<16;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(u.flags=F,(u.flags&255)!==Y){y.msg="unknown compression method",u.mode=vt;break}if(u.flags&57344){y.msg="unknown header flags set",u.mode=vt;break}u.head&&(u.head.text=F>>8&1),u.flags&512&&u.wrap&4&&(ee[0]=F&255,ee[1]=F>>>8&255,u.check=e(u.check,ee,2,0)),F=0,B=0,u.mode=x;case x:for(;B<32;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.head&&(u.head.time=F),u.flags&512&&u.wrap&4&&(ee[0]=F&255,ee[1]=F>>>8&255,ee[2]=F>>>16&255,ee[3]=F>>>24&255,u.check=e(u.check,ee,4,0)),F=0,B=0,u.mode=D;case D:for(;B<16;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.head&&(u.head.xflags=F&255,u.head.os=F>>8),u.flags&512&&u.wrap&4&&(ee[0]=F&255,ee[1]=F>>>8&255,u.check=e(u.check,ee,2,0)),F=0,B=0,u.mode=N;case N:if(u.flags&1024){for(;B<16;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.length=F,u.head&&(u.head.extra_len=F),u.flags&512&&u.wrap&4&&(ee[0]=F&255,ee[1]=F>>>8&255,u.check=e(u.check,ee,2,0)),F=0,B=0}else u.head&&(u.head.extra=null);u.mode=$;case $:if(u.flags&1024&&(o=u.length,o>J&&(o=J),o&&(u.head&&(Jt=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Uint8Array(u.head.extra_len)),u.head.extra.set(q.subarray(X,X+o),Jt)),u.flags&512&&u.wrap&4&&(u.check=e(u.check,q,o,X)),J-=o,X+=o,u.length-=o),u.length))break t;u.length=0,u.mode=nt;case nt:if(u.flags&2048){if(J===0)break t;o=0;do Jt=q[X+o++],u.head&&Jt&&u.length<65536&&(u.head.name+=String.fromCharCode(Jt));while(Jt&&o<J);if(u.flags&512&&u.wrap&4&&(u.check=e(u.check,q,o,X)),J-=o,X+=o,Jt)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=K;case K:if(u.flags&4096){if(J===0)break t;o=0;do Jt=q[X+o++],u.head&&Jt&&u.length<65536&&(u.head.comment+=String.fromCharCode(Jt));while(Jt&&o<J);if(u.flags&512&&u.wrap&4&&(u.check=e(u.check,q,o,X)),J-=o,X+=o,Jt)break t}else u.head&&(u.head.comment=null);u.mode=pt;case pt:if(u.flags&512){for(;B<16;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(u.wrap&4&&F!==(u.check&65535)){y.msg="header crc mismatch",u.mode=vt;break}F=0,B=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),y.adler=u.check=0,u.mode=tt;break;case wt:for(;B<32;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}y.adler=u.check=te(F),F=0,B=0,u.mode=st;case st:if(u.havedict===0)return y.next_out=Tt,y.avail_out=Gt,y.next_in=X,y.avail_in=J,u.hold=F,u.bits=B,w;y.adler=u.check=1,u.mode=tt;case tt:if(M===f||M===c)break t;case E:if(u.last){F>>>=B&7,B-=B&7,u.mode=Ht;break}for(;B<3;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}switch(u.last=F&1,F>>>=1,B-=1,F&3){case 0:u.mode=I;break;case 1:if(d(u),u.mode=ot,M===c){F>>>=2,B-=2;break t}break;case 2:u.mode=j;break;case 3:y.msg="invalid block type",u.mode=vt}F>>>=2,B-=2;break;case I:for(F>>>=B&7,B-=B&7;B<32;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if((F&65535)!==(F>>>16^65535)){y.msg="invalid stored block lengths",u.mode=vt;break}if(u.length=F&65535,F=0,B=0,u.mode=z,M===c)break t;case z:u.mode=W;case W:if(o=u.length,o){if(o>J&&(o=J),o>Gt&&(o=Gt),o===0)break t;Et.set(q.subarray(X,X+o),Tt),J-=o,X+=o,Gt-=o,Tt+=o,u.length-=o;break}u.mode=tt;break;case j:for(;B<14;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(u.nlen=(F&31)+257,F>>>=5,B-=5,u.ndist=(F&31)+1,F>>>=5,B-=5,u.ncode=(F&15)+4,F>>>=4,B-=4,u.nlen>286||u.ndist>30){y.msg="too many length or distance symbols",u.mode=vt;break}u.have=0,u.mode=at;case at:for(;u.have<u.ncode;){for(;B<3;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.lens[ia[u.have++]]=F&7,F>>>=3,B-=3}for(;u.have<19;)u.lens[ia[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,Ee={bits:u.lenbits},me=n(r,u.lens,0,19,u.lencode,0,u.work,Ee),u.lenbits=Ee.bits,me){y.msg="invalid code lengths set",u.mode=vt;break}u.have=0,u.mode=G;case G:for(;u.have<u.nlen+u.ndist;){for(;R=u.lencode[F&(1<<u.lenbits)-1],A=R>>>24,Q=R>>>16&255,dt=R&65535,!(A<=B);){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(dt<16)F>>>=A,B-=A,u.lens[u.have++]=dt;else{if(dt===16){for(ve=A+2;B<ve;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(F>>>=A,B-=A,u.have===0){y.msg="invalid bit length repeat",u.mode=vt;break}Jt=u.lens[u.have-1],o=3+(F&3),F>>>=2,B-=2}else if(dt===17){for(ve=A+3;B<ve;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}F>>>=A,B-=A,Jt=0,o=3+(F&7),F>>>=3,B-=3}else{for(ve=A+7;B<ve;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}F>>>=A,B-=A,Jt=0,o=11+(F&127),F>>>=7,B-=7}if(u.have+o>u.nlen+u.ndist){y.msg="invalid bit length repeat",u.mode=vt;break}for(;o--;)u.lens[u.have++]=Jt}}if(u.mode===vt)break;if(u.lens[256]===0){y.msg="invalid code -- missing end-of-block",u.mode=vt;break}if(u.lenbits=9,Ee={bits:u.lenbits},me=n(a,u.lens,0,u.nlen,u.lencode,0,u.work,Ee),u.lenbits=Ee.bits,me){y.msg="invalid literal/lengths set",u.mode=vt;break}if(u.distbits=6,u.distcode=u.distdyn,Ee={bits:u.distbits},me=n(l,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,Ee),u.distbits=Ee.bits,me){y.msg="invalid distances set",u.mode=vt;break}if(u.mode=ot,M===c)break t;case ot:u.mode=ct;case ct:if(J>=6&&Gt>=258){y.next_out=Tt,y.avail_out=Gt,y.next_in=X,y.avail_in=J,u.hold=F,u.bits=B,i(y,Yt),Tt=y.next_out,Et=y.output,Gt=y.avail_out,X=y.next_in,q=y.input,J=y.avail_in,F=u.hold,B=u.bits,u.mode===tt&&(u.back=-1);break}for(u.back=0;R=u.lencode[F&(1<<u.lenbits)-1],A=R>>>24,Q=R>>>16&255,dt=R&65535,!(A<=B);){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(Q&&!(Q&240)){for(rt=A,ue=Q,Nt=dt;R=u.lencode[Nt+((F&(1<<rt+ue)-1)>>rt)],A=R>>>24,Q=R>>>16&255,dt=R&65535,!(rt+A<=B);){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}F>>>=rt,B-=rt,u.back+=rt}if(F>>>=A,B-=A,u.back+=A,u.length=dt,Q===0){u.mode=Ft;break}if(Q&32){u.back=-1,u.mode=tt;break}if(Q&64){y.msg="invalid literal/length code",u.mode=vt;break}u.extra=Q&15,u.mode=Rt;case Rt:if(u.extra){for(ve=u.extra;B<ve;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.length+=F&(1<<u.extra)-1,F>>>=u.extra,B-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=St;case St:for(;R=u.distcode[F&(1<<u.distbits)-1],A=R>>>24,Q=R>>>16&255,dt=R&65535,!(A<=B);){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(!(Q&240)){for(rt=A,ue=Q,Nt=dt;R=u.distcode[Nt+((F&(1<<rt+ue)-1)>>rt)],A=R>>>24,Q=R>>>16&255,dt=R&65535,!(rt+A<=B);){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}F>>>=rt,B-=rt,u.back+=rt}if(F>>>=A,B-=A,u.back+=A,Q&64){y.msg="invalid distance code",u.mode=vt;break}u.offset=dt,u.extra=Q&15,u.mode=ht;case ht:if(u.extra){for(ve=u.extra;B<ve;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}u.offset+=F&(1<<u.extra)-1,F>>>=u.extra,B-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){y.msg="invalid distance too far back",u.mode=vt;break}u.mode=mt;case mt:if(Gt===0)break t;if(o=Yt-Gt,u.offset>o){if(o=u.offset-o,o>u.whave&&u.sane){y.msg="invalid distance too far back",u.mode=vt;break}o>u.wnext?(o-=u.wnext,L=u.wsize-o):L=u.wnext-o,o>u.length&&(o=u.length),_=u.window}else _=Et,L=Tt-u.offset,o=u.length;o>Gt&&(o=Gt),Gt-=o,u.length-=o;do Et[Tt++]=_[L++];while(--o);u.length===0&&(u.mode=ct);break;case Ft:if(Gt===0)break t;Et[Tt++]=u.length,Gt--,u.mode=ct;break;case Ht:if(u.wrap){for(;B<32;){if(J===0)break t;J--,F|=q[X++]<<B,B+=8}if(Yt-=Gt,y.total_out+=Yt,u.total+=Yt,u.wrap&4&&Yt&&(y.adler=u.check=u.flags?e(u.check,Et,Yt,Tt-Yt):t(u.check,Et,Yt,Tt-Yt)),Yt=Gt,u.wrap&4&&(u.flags?F:te(F))!==u.check){y.msg="incorrect data check",u.mode=vt;break}F=0,B=0}u.mode=yt;case yt:if(u.wrap&&u.flags){for(;B<32;){if(J===0)break t;J--,F+=q[X++]<<B,B+=8}if(u.wrap&4&&F!==(u.total&4294967295)){y.msg="incorrect length check",u.mode=vt;break}F=0,B=0}u.mode=At;case At:me=m;break t;case vt:me=b;break t;case Ot:return O;case Ct:default:return p}return y.next_out=Tt,y.avail_out=Gt,y.next_in=X,y.avail_in=J,u.hold=F,u.bits=B,(u.wsize||Yt!==y.avail_out&&u.mode<vt&&(u.mode<Ht||M!==s))&&V(y,y.output,y.next_out,Yt-y.avail_out),di-=y.avail_in,Yt-=y.avail_out,y.total_in+=di,y.total_out+=Yt,u.total+=Yt,u.wrap&4&&Yt&&(y.adler=u.check=u.flags?e(u.check,Et,Yt,y.next_out-Yt):t(u.check,Et,Yt,y.next_out-Yt)),y.data_type=u.bits+(u.last?64:0)+(u.mode===tt?128:0)+(u.mode===ot||u.mode===z?256:0),(di===0&&Yt===0||M===s)&&me===h&&(me=k),me},et=y=>{if($t(y))return p;let M=y.state;return M.window&&(M.window=null),y.state=null,h},lt=(y,M)=>{if($t(y))return p;const u=y.state;return u.wrap&2?(u.head=M,M.done=!1,h):p},ut=(y,M)=>{const u=M.length;let q,Et,X;return $t(y)||(q=y.state,q.wrap!==0&&q.mode!==st)?p:q.mode===st&&(Et=1,Et=t(Et,M,u,0),Et!==q.check)?b:(X=V(y,M,u,u),X?(q.mode=Ot,O):(q.havedict=1,h))};return xe.inflateReset=Zt,xe.inflateReset2=Vt,xe.inflateResetKeep=le,xe.inflateInit=it,xe.inflateInit2=bt,xe.inflate=Z,xe.inflateEnd=et,xe.inflateGetHeader=lt,xe.inflateSetDictionary=ut,xe.inflateInfo="pako inflate (from Nodeca project)",xe}var gr,Fa;function Gc(){if(Fa)return gr;Fa=1;function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return gr=t,gr}var Na;function Hc(){if(Na)return Qe;Na=1;const t=Wc(),e=$o(),i=jo(),n=Hr(),r=Yo(),a=Gc(),l=Object.prototype.toString,{Z_NO_FLUSH:s,Z_FINISH:f,Z_OK:c,Z_STREAM_END:h,Z_NEED_DICT:m,Z_STREAM_ERROR:w,Z_DATA_ERROR:p,Z_MEM_ERROR:b}=li();function O(H){this.options=e.assign({chunkSize:1024*64,windowBits:15,to:""},H||{});const T=this.options;T.raw&&T.windowBits>=0&&T.windowBits<16&&(T.windowBits=-T.windowBits,T.windowBits===0&&(T.windowBits=-15)),T.windowBits>=0&&T.windowBits<16&&!(H&&H.windowBits)&&(T.windowBits+=32),T.windowBits>15&&T.windowBits<48&&(T.windowBits&15||(T.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let x=t.inflateInit2(this.strm,T.windowBits);if(x!==c)throw new Error(n[x]);if(this.header=new a,t.inflateGetHeader(this.strm,this.header),T.dictionary&&(typeof T.dictionary=="string"?T.dictionary=i.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"&&(T.dictionary=new Uint8Array(T.dictionary)),T.raw&&(x=t.inflateSetDictionary(this.strm,T.dictionary),x!==c)))throw new Error(n[x])}O.prototype.push=function(H,T){const x=this.strm,D=this.options.chunkSize,N=this.options.dictionary;let $,nt,K;if(this.ended)return!1;for(T===~~T?nt=T:nt=T===!0?f:s,l.call(H)==="[object ArrayBuffer]"?x.input=new Uint8Array(H):x.input=H,x.next_in=0,x.avail_in=x.input.length;;){for(x.avail_out===0&&(x.output=new Uint8Array(D),x.next_out=0,x.avail_out=D),$=t.inflate(x,nt),$===m&&N&&($=t.inflateSetDictionary(x,N),$===c?$=t.inflate(x,nt):$===p&&($=m));x.avail_in>0&&$===h&&x.state.wrap>0&&H[x.next_in]!==0;)t.inflateReset(x),$=t.inflate(x,nt);switch($){case w:case p:case m:case b:return this.onEnd($),this.ended=!0,!1}if(K=x.avail_out,x.next_out&&(x.avail_out===0||$===h))if(this.options.to==="string"){let pt=i.utf8border(x.output,x.next_out),wt=x.next_out-pt,st=i.buf2string(x.output,pt);x.next_out=wt,x.avail_out=D-wt,wt&&x.output.set(x.output.subarray(pt,pt+wt),0),this.onData(st)}else this.onData(x.output.length===x.next_out?x.output:x.output.subarray(0,x.next_out));if(!($===c&&K===0)){if($===h)return $=t.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(x.avail_in===0)break}}return!0},O.prototype.onData=function(H){this.chunks.push(H)},O.prototype.onEnd=function(H){H===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg};function k(H,T){const x=new O(T);if(x.push(H),x.err)throw x.msg||n[x.err];return x.result}function Y(H,T){return T=T||{},T.raw=!0,k(H,T)}return Qe.Inflate=O,Qe.inflate=k,Qe.inflateRaw=Y,Qe.ungzip=k,Qe.constants=li(),Qe}var Ba;function $c(){if(Ba)return Te;Ba=1;const{Deflate:t,deflate:e,deflateRaw:i,gzip:n}=Bc(),{Inflate:r,inflate:a,inflateRaw:l,ungzip:s}=Hc(),f=li();return Te.Deflate=t,Te.deflate=e,Te.deflateRaw=i,Te.gzip=n,Te.Inflate=r,Te.inflate=a,Te.inflateRaw=l,Te.ungzip=s,Te.constants=f,Te}var Ua;function jc(){if(Ua)return Vi;Ua=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.decodeTileLayer=void 0;const t=Mc(),e=zc(),i=$c(),n=Vo(),r=Wo(),a=Gr(),l={[a.Encoding.BASE64]:t.toByteArray},s={[r.Compression.NONE]:c=>c,[r.Compression.ZLIB]:i.inflate,[r.Compression.GZIP]:i.ungzip,[r.Compression.ZSTD]:e.decompress};function f(c){var p;if((0,n.isUnencodedTileLayer)(c))return c;const h=l[c.encoding],m=s[c.compression??r.Compression.NONE],w=b=>Array.from(new Uint32Array(b.buffer,b.byteOffset));return{...c,compression:r.Compression.NONE,encoding:a.Encoding.CSV,data:c.data!=null?w(m(h(c.data))):void 0,chunks:(p=c.chunks)==null?void 0:p.map(b=>({...b,data:w(m(h(b.data)))}))}}return Vi.decodeTileLayer=f,Vi}var $i={},Va;function Yc(){if(Va)return $i;Va=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.DrawOrder=void 0;var t;return function(e){e.TOPDOWN="topdown",e.INDEX="index"}(t||($i.DrawOrder=t={})),$i}var ji={},Wa;function qc(){if(Wa)return ji;Wa=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.MapOrientation=void 0;var t;return function(e){e.ORTHOGONAL="orthogonal",e.ISOMETRIC="isometric",e.STAGGERED="staggered",e.HEXAGONAL="hexagonal"}(t||(ji.MapOrientation=t={})),ji}var Yi={},Ga;function Zc(){if(Ga)return Yi;Ga=1,Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.MapRenderOrder=void 0;var t;return function(e){e.RIGHT_DOWN="right-down",e.RIGHT_UP="right-up",e.LEFT_DOWN="left-down",e.LEFT_UP="left-up"}(t||(Yi.MapRenderOrder=t={})),Yi}var qi={},Ha;function Xc(){if(Ha)return qi;Ha=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.StaggerAxis=void 0;var t;return function(e){e.X="x",e.Y="y"}(t||(qi.StaggerAxis=t={})),qi}var Zi={},$a;function Kc(){if($a)return Zi;$a=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.StaggerIndex=void 0;var t;return function(e){e.ODD="odd",e.EVEN="even"}(t||(Zi.StaggerIndex=t={})),Zi}var Xi={},ja;function Jc(){if(ja)return Xi;ja=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.PropertyType=void 0;var t;return function(e){e.STRING="string",e.INT="int",e.FLOAT="float",e.BOOL="bool",e.COLOR="color",e.FILE="file",e.OBJECT="object",e.CLASS="class"}(t||(Xi.PropertyType=t={})),Xi}var Ki={},Ya;function Qc(){if(Ya)return Ki;Ya=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.HorizontalAlign=void 0;var t;return function(e){e.CENTER="center",e.RIGHT="right",e.JUSTIFY="justify",e.LEFT="left"}(t||(Ki.HorizontalAlign=t={})),Ki}var Ji={},qa;function tf(){if(qa)return Ji;qa=1,Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.VerticalAlign=void 0;var t;return function(e){e.CENTER="center",e.BOTTOM="bottom",e.TOP="top"}(t||(Ji.VerticalAlign=t={})),Ji}var ti={},Za;function ef(){if(Za)return ti;Za=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.isTilesetRef=ti.isEmbeddedTileset=void 0;function t(i){return i.source==null}ti.isEmbeddedTileset=t;function e(i){return i.source!=null}return ti.isTilesetRef=e,ti}var Qi={},Xa;function nf(){if(Xa)return Qi;Xa=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.FillMode=void 0;var t;return function(e){e.STRETCH="stretch",e.PRESERVE_ASPECT_FIT="preserve-aspect-fit"}(t||(Qi.FillMode=t={})),Qi}var tn={},Ka;function rf(){if(Ka)return tn;Ka=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.ObjectAlignment=void 0;var t;return function(e){e.UNSPECIFIED="unspecified",e.TOPLEFT="topleft",e.TOP="top",e.TOPRIGHT="topright",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e.BOTTOMLEFT="bottomleft",e.BOTTOM="bottom",e.BOTTOMRIGHT="bottomright"}(t||(tn.ObjectAlignment=t={})),tn}var en={},Ja;function af(){if(Ja)return en;Ja=1,Object.defineProperty(en,"__esModule",{value:!0}),en.TileRenderSize=void 0;var t;return function(e){e.TILE="tile",e.GRID="grid"}(t||(en.TileRenderSize=t={})),en}var nn={},Qa;function of(){if(Qa)return nn;Qa=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.WangSetType=void 0;var t;return function(e){e.CORNER="corner",e.EDGE="edge",e.MIXED="mixed"}(t||(nn.WangSetType=t={})),nn}var to;function sf(){return to||(to=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.WangSetType=t.TileRenderSize=t.ObjectAlignment=t.FillMode=t.isTilesetRef=t.isEmbeddedTileset=t.VerticalAlign=t.HorizontalAlign=t.PropertyType=t.StaggerIndex=t.StaggerAxis=t.RenderOrder=t.MapOrientation=t.Encoding=t.DrawOrder=t.decodeTileLayer=t.Compression=t.isUnencodedTileLayer=t.isTileLayer=t.isObjectGroup=t.isImageLayer=t.isGroup=t.isEncodedTileLayer=t.GridOrientation=void 0;var e=Cc();Object.defineProperty(t,"GridOrientation",{enumerable:!0,get:function(){return e.GridOrientation}});var i=Vo();Object.defineProperty(t,"isEncodedTileLayer",{enumerable:!0,get:function(){return i.isEncodedTileLayer}}),Object.defineProperty(t,"isGroup",{enumerable:!0,get:function(){return i.isGroup}}),Object.defineProperty(t,"isImageLayer",{enumerable:!0,get:function(){return i.isImageLayer}}),Object.defineProperty(t,"isObjectGroup",{enumerable:!0,get:function(){return i.isObjectGroup}}),Object.defineProperty(t,"isTileLayer",{enumerable:!0,get:function(){return i.isTileLayer}}),Object.defineProperty(t,"isUnencodedTileLayer",{enumerable:!0,get:function(){return i.isUnencodedTileLayer}});var n=Wo();Object.defineProperty(t,"Compression",{enumerable:!0,get:function(){return n.Compression}});var r=jc();Object.defineProperty(t,"decodeTileLayer",{enumerable:!0,get:function(){return r.decodeTileLayer}});var a=Yc();Object.defineProperty(t,"DrawOrder",{enumerable:!0,get:function(){return a.DrawOrder}});var l=Gr();Object.defineProperty(t,"Encoding",{enumerable:!0,get:function(){return l.Encoding}});var s=qc();Object.defineProperty(t,"MapOrientation",{enumerable:!0,get:function(){return s.MapOrientation}});var f=Zc();Object.defineProperty(t,"RenderOrder",{enumerable:!0,get:function(){return f.MapRenderOrder}});var c=Xc();Object.defineProperty(t,"StaggerAxis",{enumerable:!0,get:function(){return c.StaggerAxis}});var h=Kc();Object.defineProperty(t,"StaggerIndex",{enumerable:!0,get:function(){return h.StaggerIndex}});var m=Jc();Object.defineProperty(t,"PropertyType",{enumerable:!0,get:function(){return m.PropertyType}});var w=Qc();Object.defineProperty(t,"HorizontalAlign",{enumerable:!0,get:function(){return w.HorizontalAlign}});var p=tf();Object.defineProperty(t,"VerticalAlign",{enumerable:!0,get:function(){return p.VerticalAlign}});var b=ef();Object.defineProperty(t,"isEmbeddedTileset",{enumerable:!0,get:function(){return b.isEmbeddedTileset}}),Object.defineProperty(t,"isTilesetRef",{enumerable:!0,get:function(){return b.isTilesetRef}});var O=nf();Object.defineProperty(t,"FillMode",{enumerable:!0,get:function(){return O.FillMode}});var k=rf();Object.defineProperty(t,"ObjectAlignment",{enumerable:!0,get:function(){return k.ObjectAlignment}});var Y=af();Object.defineProperty(t,"TileRenderSize",{enumerable:!0,get:function(){return Y.TileRenderSize}});var H=of();Object.defineProperty(t,"WangSetType",{enumerable:!0,get:function(){return H.WangSetType}})}(lr)),lr}var An=sf();const ze=Symbol("isMob"),qo=Symbol("followsPlayer"),xi=Symbol("isPlayer"),Zo=Symbol("isGenerator"),we=Symbol("isInvisible"),dn=Symbol("isSecreted"),qn=Symbol("isPassable"),Xo=Symbol("isImperviousToSpears"),Tr=Symbol("isBombable");class fe{constructor(e){Lt(this,"_ch");Lt(this,"_fg");Lt(this,"_bg");Lt(this,"blink",!1);this.ch=e.ch??null,this.fg=e.fg??null,this.bg=e.bg??null,this.blink=e.blink??!1}get ch(){return this._ch??gt.FLOOR_CHAR}set ch(e){this._ch=e}get fg(){return this._fg??Le(gt.FLOOR_FG)}set fg(e){this._fg=e===null?null:Le(e)}get bg(){return this._bg??Le(gt.FLOOR_FG)}set bg(e){this._bg=e===null?null:Le(e)}}class Bt{constructor(e={}){Lt(this,"replacement",g.Floor);Lt(this,"x");Lt(this,"y");Lt(this,"px",null);Lt(this,"py",null);this.x=e.x??0,this.y=e.y??0}moveTo(e,i){this.px=this.x,this.py=this.y,this.x=e,this.y=i}die(){this.x=-2,this.y=-2}isDead(){return this.x<0||this.y<0}}class Sr{constructor(e){Lt(this,"set");this.set=new Set(e)}by(e){return this.set.has(e)}}class Ko{constructor(e){Lt(this,"set");this.set=new Set(e)}has(e){return this.set.has(e)}}class Jo{constructor(e){Lt(this,"set");this.set=new Set(e)}has(e){return this.set.has(e)}}class _n{constructor(e){Lt(this,"damage");this.damage=e.damage||1}}class Ti{constructor(e){Lt(this,"keys",0);Lt(this,"gems",0);Lt(this,"whips",0);Lt(this,"teleports",0);Lt(this,"whipPower",0);this.keys=(e==null?void 0:e.keys)||0,this.gems=(e==null?void 0:e.gems)||0,this.whips=(e==null?void 0:e.whips)||0,this.whipPower=(e==null?void 0:e.whipPower)||0,this.teleports=(e==null?void 0:e.teleports)||0}}class Or{constructor(e){this.frames=e}getFrame(){return this.frames[C.getUniformInt(0,this.frames.length-1)]}}class Rr{constructor(e){Lt(this,"i",0);Lt(this,"ch","");this.frames=e,this.ch=e[0]}getFrame(){return this.i++,this.i%20===0&&(this.ch=this.frames[C.getUniformInt(0,this.frames.length-1)]),this.ch}}class Qo{constructor(e){this.message=e}}class Ar extends Qo{}class ts{constructor(e){Lt(this,"basePace");Lt(this,"hastedPace");this.basePace=e.basePace||1,this.hastedPace=e.hastedPace||1}}class Si{constructor(e){Lt(this,"hardness",0);Lt(this,"hitSound",null);this.hardness=e.hardness||0,this.hitSound=e.hitSound||null}}class $r extends Qo{}class Ii{constructor(e){Lt(this,"mass");this.mass=e.mass??1}}class jr{constructor(e){this.current=e}}function eo(t){return!t||t<0?-1:+t%256-1}function lf(t){const e=[],{layers:i,properties:n}=t,r=wi(n);for(const c of i)if(An.isEncodedTileLayer(c))f(An.decodeTileLayer(c));else if(An.isUnencodedTileLayer(c))f(c);else if(An.isObjectGroup(c))l(c);else throw new Error("Unsupported layer encoding");const a=t.StartTrigger??(r==null?void 0:r.StartTrigger)??void 0;return{id:(r==null?void 0:r.id)||"",data:e,startTrigger:a,properties:r};function l(c){for(const h of c.objects){if(h.text){s(h);continue}const{gid:m,x:w,y:p,height:b,width:O,properties:k,type:Y}=h;if(!(!m||w<0||p<0||!b||!O)&&m>0){const H=eo(h.gid),T=w/O,x=p/b-1;e[x*t.width+T]=yi(H,T,x,wi(k),Y)}}return e}function s(c){const{x:h,y:m,height:w,width:p,properties:b,text:O}=c;if(!h||!m||!w||!p)return;const k=97,Y=g.Wall,H=O.text,T=O.wrap,x=h/24,D=m/36,N=p/24;let $=[H];T&&($=Ys(H,N).split(`
`));const{halign:nt,color:K}=c.text,pt=wi(b||{}),wt=pt.fgColor??K??U.HighIntensityWhite,st=pt.bgColor??U.Brown;for(let tt=0;tt<$.length;tt++){let E=$[tt];nt==="right"&&(E=E.padStart(N," "));for(let I=0;I<E.length;I++){const z=x+I,W=D+tt,j=yi(k,z,W,wi(b),Y);j.get(fe).ch=E[I],j.get(fe).fg=wt,j.get(fe).bg=st,e[W*t.width+z]=j}}}function f(c){const{data:h}=c;if(!h)return e;for(let m=0;m<h.length;m++){const w=eo(+h[m]);if(w>-1){const p=m%t.width,b=Math.floor(m/t.width);e[m]=yi(w,p,b)}}return e}}const cf=Mo.filter(Boolean).length,ff=Fo.filter(Boolean).length,uf=zo.filter(Boolean).length,hf=No.filter(Boolean).length;console.log(`Kingdom: ${cf}, Caverns: ${ff}, Lost: ${uf}, Cruz: ${hf}`);const es=Symbol("END"),is={loading:je(Sc),debug:je(uc),forgotten:je(_c),kingdom:je(gc),lost:je(wc),caverns:je(vc),cruz:je(Ec),procgen:je(Pc)};function je(t){const e={title:"",readTileset:df,readColor:_f,...t};return e.findNextLevel??(e.findNextLevel=i=>pf(t.LEVELS,i)),e.findPrevLevel??(e.findPrevLevel=i=>gf(t.LEVELS,i)),e.readLevel??(e.readLevel=i=>mf(t.LEVELS,i)),e}async function df(){return(await S(async()=>{const{default:t}=await import("./kroz.tileset-DNf-ZxQL.js");return{default:t}},[],import.meta.url)).default}async function _f(){return(await S(async()=>{const{default:t}=await import("./kroz.colors-D6DTR4eg.js");return{default:t}},[],import.meta.url)).default}function pf(t,e){for(e++;!t[e]&&e<t.length;)e++;return e>=t.length?es:e}function gf(t,e){do e=po(--e,t.length);while(!t[e]);return e}async function mf(t,e){const i=await t[e]();return typeof i=="string"?Uo(i):lf(i)}async function ki(t=P.levelIndex??1){br(),Qu(),await yf(t),th(),Jn(),v.startTrigger?await Kr(v.startTrigger):await Xt("Press any key to begin this level."),Vr.dispatch(),br()}async function ns(){const t=ft.currentGame.findNextLevel(P.levelIndex);if(t===es){ft.done=!0,await Ku();return}await ki(t)}async function wf(){const t=ft.currentGame.findPrevLevel(P.levelIndex);await ki(t)}async function yf(t){P.levelIndex=t;const e=await ft.currentGame.readLevel(t);await vf(e),pe(),Jr()}async function vf(t){const{data:e,startTrigger:i}=t;v.startTrigger=i,v.map.fill((n,r,a)=>e[a]),await ea(),await cn(g.Gem,{fg:C.getUniformInt(1,15)}),v.borderFG=C.getUniformInt(8,15),v.borderBG=C.getUniformInt(1,8)}class bf{constructor(e){Lt(this,"h");Lt(this,"g");Lt(this,"n");Lt(this,"d",()=>{});Lt(this,"maxIterations",5e4);Lt(this,"todo",[]);Lt(this,"done",{});this.h=e.hurestic,this.g=e.cost,this.n=e.neighbors,this.d=e.debug||this.d,this.maxIterations=e.maxIterations||this.maxIterations}getId(e){return JSON.stringify(e)}async compute(e){var l;this.todo=[],this.done={},this.add(e,null);let i=null,n=0;for(;this.todo.length;){if(n++>this.maxIterations)return console.log("Max iterations reached"),[];const s=this.todo.shift(),f=this.getId(s.s);if(f in this.done)continue;if(this.done[f]=s,s.h==0){i=s;break}const c=this.n(s.s);for(let h=0;h<c.length;h++){const m=c[h];if(this.getId(m)in this.done)continue;const p=this.add(m,s);await((l=this.d)==null?void 0:l.call(this,p))}}const r=[];let a=i;if(!a)return r;for(;a;)r.push(a.s),a=a.prev;return r}add(e,i){const n=this.h(e),r=this.g(e),a={prev:i,g:i?i.g+r:0,h:n,s:e},l=a.g+a.h;for(let s=0;s<this.todo.length;s++){const f=this.todo[s],c=f.g+f.h;if(l<c||l==c&&n<f.h)return this.todo.splice(s,0,a),a}return this.todo.push(a),a}}const Ef=[...$n,g.Key,g.Nugget,g.Amulet,g.Tablet,g.SlowTime,g.Zap,...Yn,g.Freeze,g.ShootRight,g.ShootLeft,...Do,g.Tome,g.Bomb,g.Power,g.Amulet,g.BlockSpell,g.ShowGems],rs=[...si,g.Trap,g.Lava,g.Invisible,g.SpeedTime],Oi=new Map;let Fe=null;Vr.add(()=>{Oi.clear()});let Zn=[];const io=[[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1]];function xf(t,e){const i=[];for(let r=-1;r<=1;r++)for(let a=-1;a<=1;a++){const[l,s]=[t+r,e+a],f=v.map.get(l,s);f&&i.push([f,l,s])}return i}function Yr(t){return t?(t==null?void 0:t.type)===g.Pit||(t==null?void 0:t.type)===g.Tunnel||(t==null?void 0:t.type)===g.Stairs?!1:t==null?void 0:t.has(qn):!0}function Tf(t,e,i,n){return Math.max(Math.abs(t-i),Math.abs(e-n))}function Ri(t){const e=v.map,i=[];for(let n=0;n<e.width;n++)for(let r=0;r<e.height;r++){const a=v.map.get(n,r);a&&t(a,n,r)&&i.push([a,n,r])}return i}async function Sf(t){const e=v.player.get(Bt);return(await new bf({hurestic:r,cost:a,neighbors:f,debug:void 0}).compute({x:e.x,y:e.y,keys:P.keys,gems:P.gems,whips:P.whips})).map(c=>[c.x,c.y]);function r(c){const{x:h,y:m}=c;return t.reduce((w,p)=>{const b=Tf(h,m,p[0],p[1]);return Math.min(w,b)},1/0)}function a(c){const{x:h,y:m}=c,w=v.map.get(h,m);return w?w.has(Ii)?40:w.has(Si)?20:w.has(ze)?30:w.type===g.Door?40:rs.includes(w.type)?50:Oi.get(`${h}.${m}`)?1:2:1}function l(c,h,m){if(c<0||h<0||c>=v.map.width||h>=v.map.height)return!1;if(t.some(k=>k[0]===c&&k[1]===h)||c===e.x&&h===e.y)return!0;const{keys:w,gems:p,whips:b}=m,O=v.map.get(c,h);return O?O.has(ze)?p>0||b>0:O.has(Si)?b>0:O.type===g.Door?w>0:O.has(we)||!O.has(fe)?!0:Yr(O):!0}function s(c,h,m){const w={...m,x:c,y:h},p=v.map.get(c,h);return p&&(p.type===g.Door&&w.keys--,p.type===g.Key&&w.keys++),w}function f(c){const h=[];for(let m=0;m<io.length;m++){const w=io[m],p=c.x+w[0],b=c.y+w[1];l(p,b,c)&&h.push(s(p,b,c))}return h}}async function ui(t){const e=await Sf(t);return!e||e.length<1?null:(e.pop(),e.pop())}async function Of(){const t=Ri(a=>a.type===g.Stairs);if(t.length<1)return!1;const e=t.map(a=>[a[1],a[2]]),i=await ui(e);if(!i)return!1;const[n,r]=i;return console.log(Fe="stairs"),await hi(+n,+r)}async function Rf(){const t=Ri(a=>a.type===g.Trap);if(t.length<1)return!1;const e=t.map(a=>[a[1],a[2]]),i=await ui(e);if(!i)return!1;const[n,r]=i;return console.log(Fe="traps"),await hi(+n,+r)}async function Af(){const t=Ri(a=>Ef.includes(a.type)||a.has(Ti));if(t.length<1)return!1;const e=t.map(a=>[a[1],a[2]]),i=await ui(e);if(!i)return!1;const[n,r]=i;return console.log(Fe="collect"),await hi(+n,+r)}async function If(){const t=Ri(l=>l.type===g.Tunnel);if(Ri((l,s,f)=>l.type===g.Tunnel&&!Oi.get(`${s}.${f}`)).length<1)return!1;const i=t.map(l=>[l[1],l[2]]),n=await ui(i);if(!n)return!1;const[r,a]=n;return console.log(Fe="tunnel"),await hi(+r,+a)}async function kf(){const t=Ri((a,l,s)=>!Oi.get(`${l}.${s}`)&&Yr(a));if(t.length<1)return!1;const e=t.map(a=>[a[1],a[2]]),i=await ui(e);if(!i)return!1;const[n,r]=i;return console.log(Fe="explore"),await hi(+n,+r)}async function Lf(){const t=Zn.filter(a=>{var l;return(l=a[0])==null?void 0:l.has(Ii)});if(t.length<1)return!1;const e=t.map(a=>[a[1],a[2]]),i=await ui(e);if(!i)return!1;const[n,r]=i;return console.log(Fe="push"),await hi(+n,+r)}async function Df(){return P.teleports<1||Math.random()>.01*P.teleports?!1:(console.log(Fe="teleport"),P.teleports--,await qr(v.player),!0)}async function Pf(){if(!v.player.get(Bt))return;const e=Zn.filter(l=>Yr(l[0]));if(e.length<1)return!1;const i=e.map(l=>[l[1],l[2]]),n=await ui(i);if(!n)return!1;const[r,a]=n;return console.log(Fe="search"),await hi(+r,+a)}async function Cf(){if(P.whips<1||P.gems>2*P.whips)return!1;if(!v.player.get(Bt))return;const e=Zn.filter(i=>{var n,r,a;return si.includes((n=i[0])==null?void 0:n.type)||((r=i[0])==null?void 0:r.type)===g.Generator||((a=i[0])==null?void 0:a.type)===g.Statue});return e.length<1||e.length>5*P.whips?!1:(console.log(Fe="defend"),P.whips--,await Kn(v.player),!0)}async function Mf(){const t=v.player.get(Bt);t&&(Zn=xf(t.x,t.y),!await Cf()&&(await Af()||await Of()||await Lf()||await If()||await Rf()||await kf()||await Df()||await Pf()))}async function hi(t,e){const i=v.player.get(Bt);if(!i)return!1;const n=`${t}.${e}`,r=Oi.get(n);Oi.set(n,r?r+1:1);const a=v.map.get(t,e);if(a){if(a!=null&&a.has(ze)&&a.type!==g.MBlock)P.gems>2*P.whips&&await zf();else if(a!=null&&a.has(Si)&&!(a!=null&&a.has(qn)&&!rs.includes(a.type))&&P.whips>0&&!(a.type===g.Trap&&Fe==="traps"))return P.whips--,await Kn(v.player),!0}return await as(+t-i.x,+e-i.y),!0}async function zf(){return P.whips--,await Kn(v.player),!0}async function Ff(){const t=v.player.get(jr);t.current=Math.min(0,t.current+1),t.current>=0&&(await Nf(),tl())}async function Nf(){if(Pe(ie.Pause))return rh();if(Pe(ie.Quit))return nh();if(Pe(ie.Save))return eh();if(Pe(ie.Restore))return ih();if(Pe(ie.NextLevel))return await ns();if(Pe(ie.PrevLevel))return await wf();if(ft.difficulty===Ve.Cheat&&Pe(ie.NextLevelCheat)){const i=v.player.get(Bt);Mt(i.x+1,i.y,g.Stairs),await bl();return}if(ft.difficulty===Ve.Cheat&&Pe(ie.FreeItems)){P.gems=150,P.whips=99,P.teleports=99,P.keys=9,Ie();return}if(Pe(ie.ResetFound)){ft.foundSet=new Set,await Xt("Newly found object descriptions are reset.");return}if(Pe(ie.HideFound)){ft.foundSet=!0,await Xt("References to new objects will not be displayed.");return}De(ie.Whip)&&(P.whips<1?da():(P.whips--,await Kn(v.player))),De(ie.Teleport)&&(P.teleports<1?await da():(P.teleports--,await qr(v.player)));let t=0,e=0;if(De(ie.North)&&e--,De(ie.South)&&e++,De(ie.West)&&t--,De(ie.East)&&t++,De(ie.Southeast)&&(t++,e++),De(ie.Southwest)&&(t--,e++),De(ie.Northeast)&&(t++,e--),De(ie.Northwest)&&(t--,e--),t=ua(t,-1,1),e=ua(e,-1,1),(t!==0||e!==0)&&await as(t,e),ft.bot&&!ft.paused&&!ft.done){await Mf();return}}async function as(t,e){var l;const i=v.player.get(Bt),n=i.x+t,r=i.y+e;if(n<0||n>Dt||r<0||r>Pt)return await Ro(),Ae(g.Border),ft.foundSet===!0||ft.foundSet.has(-1)?void 0:(ft.foundSet.add(-1),await Xt("An Electrified Wall blocks your way."));const a=v.map.get(n,r);if(a){if(a.has(qn)&&Pn(n,r),a.has($r)&&await Bf(a),a.has(_n)){const s=a.get(_n).damage;P.gems-=s,Li(n,r),Ae(a.type),Pn(n,r),P.gems<0&&await Un()}if(a.has(Ti)){Fr();const s=a.get(Ti);switch(P.whips+=s.whips,P.gems+=s.gems,P.teleports+=s.teleports,P.keys+=s.keys,P.whipPower+=s.whipPower,Ae(a.type),a.type){case g.Chest:await Xt(`You found ${s.gems} gems and ${s.whips} whips inside the chest!`);break;case g.Chance:await Xt(`You found a Pouch containing ${s.gems} Gems!`);break}}if(a.has(Ii)){await _u(v.player,n,r,t,e);return}if(a.has(Ar)){ft.bot&&a.has(we)&&(a.remove(we),kt(n,r)),Ae(a.type);const s=(l=a.get(Ar))==null?void 0:l.message;s&&await Kr(s,{who:v.player,what:a,x:n,y:r}),!ft.done&&P.gems<0&&Un()}switch(a.type){case g.Door:P.keys<1?(El(),await zt(100),await Xt("To pass the Door you need a Key.")):(P.keys--,Ae(a.type),await pl(),Pn(n,r),pe());break;default:(isNaN(a.type)||typeof a.type=="string")&&Oo();break}}}async function Bf(t){var n;const e=t.type;if(ft.foundSet===!0||ft.foundSet.has(e))return"";const i=(n=t.get($r))==null?void 0:n.message;return i?(ft.foundSet.add(e),await Kr(i)):""}async function Un(){await Zr(v.player);const t=v.player.get(Bt);await Xt("Press any key to continue.",()=>{let e=hn?C.getUniformInt(1,15):U.White;if(ke(t.x,t.y,"*",e,U.Black),e=U.Black,hn){const n=Date.now()%500<250;e=Le(e,n?1:0)}It(bi/2-7,0,"YOU HAVE DIED!!",e,U.Red)}),ft.done=!0}function Pn(t,e){ln();const i=v.player,n=i.get(Bt);Mt(n.x,n.y,n.replacement),kt(n.x,n.y);const r=v.map.getType(t,e);n.replacement=[g.CWall1,g.CWall2,g.CWall3,g.Rope].includes(r)?r:g.Floor,v.map.set(t,e,i),n.x=t,n.y=e,kt(n.x,n.y)}async function Uf(t){if(!(v.T[ce.FreezeTime]>0))for(const e of v.entities){const i=e.get(ts);if(!i)continue;let n=v.T[ce.SpeedTime]>0?i.hastedPace:i.basePace;v.T[ce.SlowTime]>0&&(n=2*n);const r=n*an;t%r===r-1&&await Vf(e)}}async function Vf(t){const e=t.get(Bt);if(!e.isDead()){if(v.map.getType(e.x,e.y)!==t.type){mn(t);return}if(t.has(qo)){let i=0,n=0;const r=v.player.get(Bt);r.x<e.x&&(i=-1),r.x>e.x&&(i=1),r.y<e.y&&(n=-1),r.y>e.y&&(n=1),await Wf(t,i,n)}}}async function Wf(t,e,i){var s,f,c;const n=t.get(Bt),r=n.x+e,a=n.y+i;if(r<0||r>Dt||a<0||a>Pt)return;const l=v.map.get(r,a);if(l){if((s=t.get(Ko))!=null&&s.has(l.type)){Fr(),Cn(t,r,a);return}if((f=l.get(Sr))!=null&&f.by(t.type)){Cn(t,r,a);return}if((c=t.get(Jo))!=null&&c.has(l.type)){Mt(n.x,n.y,g.Floor),Mt(r,a,g.Floor),mn(t),Ae(l.type),_t(800,18),_t(400,20);return}if(t.has(_n)&&l.type===g.Player){const h=t.get(_n).damage;P.gems-=h,Mt(n.x,n.y,g.Floor),mn(t),Ae(l.type),P.gems<0&&await Un();return}Cn(t,n.x,n.y)}}function Cn(t,e,i){if(t.has(Or)&&t.has(fe)){const r=t.get(fe),a=t.get(Or);r.ch=a.getFrame()}const n=t.get(Bt);t.type===g.MBlock&&(e!==n.x||i!==n.y)&&t.remove(we),Mt(n.x,n.y,g.Floor),v.map.set(e,i,t),n.moveTo(e,i)}var ce=(t=>(t[t.SlowTime=4]="SlowTime",t[t.Invisible=5]="Invisible",t[t.SpeedTime=6]="SpeedTime",t[t.FreezeTime=7]="FreezeTime",t[t.StatueGemDrain=9]="StatueGemDrain",t))(ce||{});const Xn={4:70*an,5:75*an,6:80*an,7:55*an};async function Gf(t){await v.map.forEach((e,i,n)=>{(n==null?void 0:n.type)===t&&(n.add(we),kt(e,i))})}async function Hf(t){await v.map.forEach((e,i,n)=>{(n==null?void 0:n.type)===t&&(n.remove(we),kt(e,i))})}async function cn(t,e){await v.map.forEach((i,n,r)=>{if((r==null?void 0:r.type)===t)if(r.has(fe)){const a=r.get(fe);Object.assign(a,e)}else r.add(new fe(e))})}async function $f(t,e,i){for(t+=i;t>=0&&t<=Dt;){const n=v.map.get(t,e);if(typeof n.type!="number"||n!=null&&n.has(Xo))break;_t(t+30,10,100);for(let r=1;r<6;r++)Qr(t,e,"─",C.getUniformInt(0,16)),await zt(1);n.type===g.Floor||!n.has(fe)||n.has(we)||(await Il(),(n.type===g.Slow||n.type===g.Medium||n.type===g.Fast)&&await Li(t,e),Mt(t,e,g.Floor)),kt(t,e),t+=i}pe()}async function jf(t,e){Ll();let i=0;for(;i<=4;++i){_t(100-i*10/4,4*10,100);const s=Math.max(t-i,0),f=Math.min(t+i,Dt),c=Math.max(e-i,0),h=Math.min(e+i,Pt);for(let m=s;m<=f;m++)for(let w=c;w<=h;w++){Qr(m,w,"█",Le(U.LightRed,.5));const p=v.map.get(m,w);p!=null&&p.has(Tr)&&p.has(ze)&&(Ae(p.type),Li(m,w))}await Dl()}await zt(100),i=4;const n=Math.max(t-i,ri),r=Math.min(t+i,bi),a=Math.max(e-i,ai),l=Math.min(e+i,Nn);for(let s=n;s<=r;s++)for(let f=a;f<=l;f++){const c=v.map.get(s,f);c!=null&&c.has(Tr)&&Mt(s,f,g.Floor)}pe()}async function Yf(){await Pl(),await zt(50);for(let t=0;t<50;t++){do{const e=C.getUniformInt(0,Dt),i=C.getUniformInt(0,Pt),n=v.map.getType(e,i);if(tc.includes(n)){Mt(e,i,g.Rock),kt(e,i);break}}while(Math.random()>.01);await Ml()}await Cl()}async function qf(){let t=0,e=0;for(;t<500&&e<40;){t++;const i=C.getUniformInt(0,v.entities.length),n=v.entities[i];if(!n)continue;const r=n.get(Bt);r.x===-1||r.y===-1||n.type!==g.Slow&&n.type!==g.Medium&&n.type!==g.Fast||(await Li(r.x,r.y),await zt(20),e++)}P.score+=Math.floor(e/3+2),pe(),Ie()}async function Zf(){v.entities.reduce((e,i)=>i.type===g.Slow?e+1:e,0)<945&&await ms(45)}async function Xf(){for(let t=0;t<ft.difficulty*2+5;t++){let e=!1;do{const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt);v.map.getType(i,n)===g.Floor&&(e=!0,Mt(i,n,g.Gem),kt(i,n),await zl(),await zt(90))}while(!e&&Math.random()>.01)}}async function Kf(t,e){for(let i=0;i<=Dt;i++)for(let n=0;n<=Pt;n++)if(v.map.getType(i,n)===t){Fl();for(let r=20;r>0;r--)ke(i,n,gt.BLOCK_CHAR,C.getUniformInt(0,15),0);await zt(1),Mt(i,n,g.Floor),kt(i,n)}else v.map.getType(i,n)===e&&(Mt(i,n,g.Floor),kt(i,n))}async function Jf(t){t===g.K&&v.bonus===0&&(v.bonus=1),t===g.R&&v.bonus===1&&(v.bonus=2),t===g.O&&v.bonus===2&&(v.bonus=3),t===g.Z&&v.bonus===3&&(await yl(),await Xt("Super Kroz Bonus -- 10,000 points!"),Ae(t))}async function Qf(t){let e=g.OWall1;t===g.OSpell2&&(e=g.OWall2),t===g.OSpell3&&(e=g.OWall3);for(let i=0;i<=Dt;i++)for(let n=0;n<=Pt;n++)if(v.map.getType(i,n)===e){for(let a=60;a>0;a--)ke(i,n,C.getItem(["▄","▌","▐","▀"]),C.getUniformInt(0,14),0),_t(a*40,5,10),a%5===0&&await zt(1);Mt(i,n,g.Floor),kt(i,n)}}async function tu(t){const e=t-g.CSpell1+g.CWall1;for(let i=0;i<=Dt;i++)for(let n=0;n<=Pt;n++)if(v.map.getType(i,n)===e){for(let a=60;a>0;a--)ke(i,n,C.getItem(["▄","▌","▐","▀"]),C.getUniformInt(0,14),0),_t(a*40,5,10),a%5===0&&await zt(1);Mt(i,n,g.Wall),kt(i,n)}}async function eu(){for(let t=0;t<75;t++){let e=!1;do{const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt),r=v.map.getType(i,n);r===g.Block&&(Mt(i,n,g.IBlock),kt(i,n),e=!0),r===g.Wall&&(Mt(i,n,g.IWall),kt(i,n),e=!0)}while(!e&&C.getUniformInt(0,200)!==0)}}async function qr(t){await Zr(t);const e=t.get(Bt);Mt(e.x,e.y,g.Floor),kt(e.x,e.y);const i=Date.now();for(let r=0;r<700;r++){const a=C.getUniformInt(0,Dt),l=C.getUniformInt(0,Pt),s=v.map.get(a,l);if((s.type===g.Floor||s!=null&&s.has(we)||!(s!=null&&s.has(fe)))&&(ke(a,l,"☺",C.getUniformInt(0,15),C.getUniformInt(0,7)),await Al(),kt(a,l)),Date.now()-i>1500)break}const n=v.map.findRandomEmptySpace();if(n)return pn(t,...n)}function pn(t,e,i){t.has(ze)&&Cn(t,e,i),t.has(xi)&&Pn(e,i)}async function Zr(t){const e=t.get(Bt),i=t.get(fe);for(let n=0;n<160;n++)n%5===0&&(ke(e.x,e.y,i.ch,C.getUniformInt(0,15),C.getUniformInt(0,8)),await zt()),_t(n/2,80,10);pe()}function iu(t,e){const i=v.map;for(let n=0;n<i.width;n++)for(let r=0;r<i.height;r++)i.getType(n,r)===t&&(i.set(n,r,vn(e,n,r)),kt(n,r))}async function nu(t,e,i){switch(i){case g.TBlock:i=g.Block;break;case g.TRock:i=g.Rock;break;case g.TGem:i=g.Gem;break;case g.TBlind:i=g.Invisible;break;case g.TWhip:i=g.Whip;break;case g.TGold:i=g.Nugget;break;case g.TTree:i=g.Tree;break}for(let r=0;r<10;r++)await n(!1,C.getUniformInt(0,7),C.getUniformInt(0,7)),await _t((r+25)*r*2,20,10);return n(!0);async function n(r,a,l){for(let s=-1;s<=1;s++)for(let f=-1;f<=1;f++){if(s===0&&f===0)continue;const c=v.map.getType(t+s,e+f);if(ec.includes(c))if(r)Mt(t+s,e+f,i);else{Mt(t+s,e+f,i);const h=v.map.get(t+s,e+f);if(!h)continue;const m=h==null?void 0:h.get(fe);if(!m)continue;ke(t+s,e+f,m.ch,a,l)}await zt(5)}}}async function ru(){await cn(g.Fast,{ch:"☺"}),pe()}async function au(t,e){for(let i=0;i<=Dt;i++)for(let n=0;n<=Pt;n++)v.map.getType(i,n)===t&&(await _t(i*n,50,10),Mt(i,n,e),kt(i,n))}async function ou(){await v.map.forEach(async(t,e,i)=>{i.type===g.IWall&&(_t(t*e,1,10),e===0&&await zt(1),Mt(t,e,g.OWall3),kt(t,e))})}function su(){for(let t=0;t<v.map.width;t++)for(let e=0;e<v.map.height;e++){const i=v.map.get(t,e);i&&!i.has(xi)&&i.add(we)}}function lu(){v.T[6]=0,v.T[7]=0,v.T[4]=Xn[4]}function cu(){v.T[4]=0,v.T[6]=Xn[6]}function fu(t){v.T[5]=Xn[5],t.add(we);const e=t.get(Bt);kt(e.x,e.y)}function uu(){v.T[7]=Xn[7]}async function hu(){if(ft.difficulty>9)return;for(let e=0;e<v.map.width;e++)for(let i=0;i<v.map.height;i++){const n=e>=31&&e<=35?U.Black:U.Brown;ke(e,i,gt.FLOOR_CHAR,n,n)}let t=4e3;for(let e=1;e<=16;e++){e===8?It(38,12,"<--- HALF WAY!!!",U.HighIntensityWhite,U.Brown):e===9&&It(38,12,gt.FLOOR_CHAR.repeat(16),U.HighIntensityWhite,U.Brown);for(let i=0;i<=Pt;i++)ke(33,i,gt.PLAYER_CHAR,gt.PLAYER_FG,gt.PLAYER_BG),await _t(t-=8,52-3*e,30),ke(33,i,gt.FLOOR_CHAR,gt.FLOOR_FG,gt.FLOOR_BG)}ke(33,Pt,"_",gt.PLAYER_FG,U.Black),await wl(),It(bi/2-3,0,"* SPLAT!! *",U.Black,U.Red),await Xt("Press any key to continue."),P.gems=-1,ft.done=!0}function In(t,e){switch(t){case g.Gem:P.gems+=e;break;case g.Whip:P.whipPower+=e;break;case g.Key:P.keys+=e;break}}function _e(t,e,i){Mt(e,i,t),kt(e,i)}async function du(t,e,i){await zt(350),await ln(),await zt(500),Mt(e,i,g.Tunnel),kt(e,i);let n=e,r=i;for(let s=0;s<1e4;s++){const f=C.getUniformInt(0,Dt),c=C.getUniformInt(0,Pt);if((v.map.getType(f,c)??g.Floor)===g.Tunnel&&(f!==n||c!==r)){n=f,r=c,pn(t,n,r);break}}Mt(e,i,g.Tunnel),kt(e,i);let a=t.get(Bt).x,l=t.get(Bt).y;for(let s=0;s<100;s++){const f=C.getUniformInt(-1,1),c=C.getUniformInt(-1,1);if(n+f<0||n+f>Dt||r+c<0||r+c>Pt)continue;const h=v.map.getType(n+f,r+c)??g.Floor;if(nc.includes(h)){a=n+f,l=r+c;break}}pn(t,a,l),Mt(n,r,g.Tunnel),kt(n,r)}async function Kn(t){const e=t.get(Bt);if(!e)return;const i=e.x,n=e.y;xl(),await r(i-1,n-1,"\\"),await r(i-1,n,"-"),await r(i-1,n+1,"/"),await r(i,n+1,"❘"),await r(i+1,n+1,"\\"),await r(i+1,n,"-"),await r(i+1,n-1,"/"),await r(i,n-1,"❘"),pe();async function r(a,l,s){if(a<0||a>Dt||l<0||l>Pt)return;const f=v.map.get(a,l),c=(f==null?void 0:f.type)||g.Floor;if(Qr(a,l,s,ci[C.getUniformInt(1,15)]),f!=null&&f.has(dn)&&(f==null||f.remove(dn),kt(a,l)),f!=null&&f.has(Si)){const h=f.get(Si);if((h.hardness||0)*Math.random()<P.whipPower){f.has(ze)&&Li(a,l),Mt(a,l,g.Floor),kt(a,l);const w=h.hitSound||"WhipHit";switch(Ae(c),await fs(w),c){case g.Statue:v.T[9]=-1,await Xt("You've destroyed the Statue!  Your Gems are now safe.");break;case g.Generator:v.genNum--;break}}else Rl();Ie()}await zt(10)}}async function _u(t,e,i,n,r){var c;let a=!1;const l=t.get(Bt),s=l.x+n*2,f=l.y+r*2;if((s<0||s>Dt||f<0||f>Pt)&&(a=!0),!a){const h=v.map.get(s,f);h||(a=!0);const m=h.type;if(ic.includes(m)||Po.includes(m)||si.includes(m)||m===g.EWall||Co.includes(m)){a=!1;const w=(c=v.map.get(e,i))==null?void 0:c.get(Ii);if(!w)return;await pu(t,e,i,s,f);const p=v.player.get(jr);p.current-=w.mass}}a&&await So()}async function pu(t,e,i,n,r){const a=v.map.get(e,i),l=v.map.get(n,r),s=l.type;a.get(Ii).mass>1&&await gl(),si.includes(s)&&Li(n,r),v.map.set(n,r,a),pn(t,e,i),pe(),Po.includes(s)?await Fr():si.includes(s)?(Ae(s),await Nl()):s===g.EWall?(Mt(n,r,g.Floor),Bl(),await Xt("The Boulder is vaporized!")):Co.includes(s)&&(pn(t,e,i),kt(n,r,a),await Ul(),v.map.set(n,r,l)),pe()}async function gu(t,e,i,n){let r=t,a=e;for(;r+=i,a+=n,!(r<0||r>Dt||a<0||a>Pt);){const l=v.map.getType(r,a);if(l===g.Pit||l===g.River||l===g.Lava)Mt(r,a,g.Floor),kt(r,a);else break}}async function mu(t,e=1){for(let i=0;i<e;i++){const n=v.map.findRandomEmptySpace();if(!n)break;v.map.set(...n,vn(t,...n))}await ea(),pe()}var gi={},no;function wu(){if(no)return gi;no=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.sum=n;function t(c){if(Array.isArray(c)){for(var h=0,m=Array(c.length);h<c.length;h++)m[h]=c[h];return m}else return Array.from(c)}var e="VERTICAL",i="HORIZONTAL";function n(c,h){return c+h}var r=function(h,m){return Math.floor(Math.random()*(m-h+1)+h)};function a(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[e,i];if(c.length===0)return"";var h=c.length-1;return c[r(0,h)]}function l(c){var h=c.length-1,m=c[0].length-1;return c.map(function(w,p){return w.map(function(b,O){return p===0||p===h||O===0||O===m?1:b})})}var s=function(h){return h?{width:h.width||50,height:h.height||50,minRoomSize:h.minRoomSize||5,maxRoomSize:h.maxRoomSize||20}:{width:50,height:50,minRoomSize:5,maxRoomSize:20}},f=gi.NewDungeon=function(h){var m={init:function(T,x,D,N){this.minRoomSize=5,this.maxRoomSize=20,this.counter=1,this.tree={level:Array.apply(null,{length:x}).map(function(){return Array.apply(null,{length:T})})},this.split(this.tree),this.connectRooms(this.tree)},split:function(T){var x=this;if(T.level.length>this.maxRoomSize||T.level[0].length>this.maxRoomSize){var D=a(this.getSplitOptions(T.level.length,T.level[0].length)),N=this.getIndexToSplit(D,T.level[0].length,T.level.length),$=T.leftNode={},nt=T.rightNode={};T.splitDirection=D,T.splitIndex=N,D===e?($.level=T.level.map(function(K){return K.slice(0,N)}),nt.level=T.level.map(function(K){return K.slice(N,K.length)})):($.level=T.level.slice(0,N),nt.level=T.level.slice(N,T.level.length)),this.split($),this.split(nt)}else this.counter+=1,T.level=T.level.map(function(K){return K.map(function(){return x.counter})}),T.level=l(T.level)},getSplitOptions:function(T,x){var D=[];return T>this.maxRoomSize&&D.push(i),x>this.maxRoomSize&&D.push(e),D},getIndexToSplit:function(T,x,D){var N=this.minRoomSize,$=T===e?x-N:D-N;return r(N,$)},connectRooms:function(T){if(T.leftNode)this.connectRooms(T.leftNode);else return;if(T.rightNode)this.connectRooms(T.rightNode);else return;var x=T.leftNode.level,D=T.rightNode.level;if(T.splitDirection===e){var N=r(1,x.length-2);T.corridorIndex=N,x[N][x[0].length-1]=0,x[N][x[0].length-2]=0,D[N][0]=0,D[N][1]=0}else{var $=r(1,x[0].length-2);T.corridorIndex=$,x[x.length-1][$]=0,x[x.length-2][$]=0,D[0][$]=0,D[1][$]=0}if(T.level=[],T.splitDirection===e)T.level=x.reduce(function(pt,wt,st){var tt=[];return tt.push.apply(tt,t(x[st])),tt.push.apply(tt,t(D[st])),pt.push(tt),pt},[]);else{var nt,K;(nt=T.level).push.apply(nt,t(x)),(K=T.level).push.apply(K,t(D))}}},w=Object.create(m),p=s(h),b=p.width,O=p.height,k=p.minRoomSize,Y=p.maxRoomSize;return w.init(b,O,k,Y),w.tree.level};return gi.default=f,gi}var yu=wu();const vu=Es(yu);var He=256,os=6,bu=52,Vn=[],rn=typeof global>"u"?window:global,Eu=Math.pow(He,os),ss=Math.pow(2,bu),xu=ss*2,ni=He-1;const ls=function(t,e){if(e&&e.global===!0)return e.global=!1,Math.random=ls(t,e),e.global=!0,Math.random;var i=e&&e.entropy||!1,n=[];Ir(cs(i?[t,gn(Vn)]:0 in arguments?t:Su(),3),n);var r=new Tu(n);return Ir(gn(r.S),Vn),function(){for(var a=r.g(os),l=Eu,s=0;a<ss;)a=(a+s)*He,l*=He,s=r.g(1);for(;a>=xu;)a/=2,l/=2,s>>>=1;return(a+s)/l}};function Tu(t){var e,i=t.length,n=this,r=0,a=n.i=n.j=0,l=n.S=[];for(i||(t=[i++]);r<He;)l[r]=r++;for(r=0;r<He;r++)l[r]=l[a=ni&a+t[r%i]+(e=l[r])],l[a]=e;(n.g=function(s){for(var f,c=0,h=n.i,m=n.j,w=n.S;s--;)f=w[h=ni&h+1],c=c*He+w[ni&(w[h]=w[m=ni&m+f])+(w[m]=f)];return n.i=h,n.j=m,c})(He)}function cs(t,e){var i=[],n=(typeof t)[0],r;if(e&&n=="o")for(r in t)try{i.push(cs(t[r],e-1))}catch{}return i.length?i:n=="s"?t:t+"\0"}function Ir(t,e){for(var i=t+"",n,r=0;r<i.length;)e[ni&r]=ni&(n^=e[ni&r]*19)+i.charCodeAt(r++);return gn(e)}function Su(t){try{return rn.crypto.getRandomValues(t=new Uint8Array(He)),gn(t)}catch{return[+new Date,rn,rn.navigator&&rn.navigator.plugins,rn.screen,gn(Vn)]}}function gn(t){return String.fromCharCode.apply(0,t)}Ir(Math.random(),Vn);const Ou=ls;class Ru{constructor(e={}){this.options=e,this.rnd=Ou(e.seed||"default")}ratio(){return this.rnd()}float(e=Number.MAX_VALUE,i=0){const n=e-i;return i+n*this.rnd()}integer(e=Math.floor(Number.MAX_VALUE),i=0){return Math.floor(this.float(e,i))}array(e){return e[this.integer(e.length)]}string(e,i){const n=this.integer(i);let r=0,a="";for(;r<n;r++)a+=this.array(e);return a}}const Au=(Math.random()+1).toString(36).substring(7);let Iu=new Ru({seed:Au});const Xr=()=>Iu.ratio();var Oe={VOID:0,FLOOR:1,WALL:2,DOOR:3,SPECIAL_DOOR:4,ENTER:5,EXIT:6},Ye={WIDTH:21,HEIGHT:21,MIN_ROOM_WIDTH:3,MAX_ROOM_WIDTH:7,MIN_ROOM_HEIGHT:3,MAX_ROOM_HEIGHT:7,IDEAL_COUNT:10,RETRY_COUNT:100},Qt=1;class ku{constructor(e={}){e||(e={}),e.room||(e.room={}),this.max_width=e.width||Ye.WIDTH,this.max_height=e.height||Ye.HEIGHT,this.room_min_width=e.room.min_width||Ye.MIN_ROOM_WIDTH,this.room_max_width=e.room.max_width||Ye.MAX_ROOM_WIDTH,this.room_min_height=e.room.min_height||Ye.MIN_ROOM_HEIGHT,this.room_max_height=e.room.max_height||Ye.MAX_ROOM_HEIGHT,this.room_ideal_count=e.room.ideal||Ye.IDEAL_COUNT,this.retry_count=e.retry||Ye.IDEAL_COUNT,this.want_special=!!e.special}render(e={},i){var n=i||this.build(),r=n.world;let a="";for(var l=0;l<r.length;l++){for(var s="",f=0;f<r[l].length;f++){var c=r[l][f];c===0?s+=" ":c===1?s+=".":c===2?s+="#":c===3?s+="/":c===4?s+="X":c===5?s+="<":c===6?s+=">":s+=r[l][f]}a+=s+`
`}return a}build(){return this.world=null,this.rooms={},this.doors={},this.walls=[],this.enter=null,this.exit=null,this.special=null,this.deadends=[],this.room_id=0,this.door_id=0,this.createVoid(),this.addStarterRoom(),this.generateRooms(),this.addSpecialRooms(),this.buildWalls(),{width:this.max_width,height:this.max_height,enter:this.enter,exit:this.exit,deadends:this.deadends,special:this.special,door_count:this.door_id,doors:this.doors,room_count:this.room_id,rooms:this.rooms,walls:this.walls,world:this.world}}createVoid(){for(var e=[],i=0;i<this.max_height;i++){e[i]=[];for(var n=0;n<this.max_width;n++)e[i][n]=Oe.VOID}this.world=e}addStarterRoom(){var e=this.getRoomDimensions(),i=Qt,n=this.max_width-(e.width+Qt*2)+Qt,r=Qt,a=this.max_height-(e.height+Qt*2)+Qt,l=qe(i,n),s=qe(r,a);this.addRoom(l,s,e.width,e.height)}getRoomDimensions(){return{width:qe(this.room_min_width,this.room_max_width),height:qe(this.room_min_height,this.room_max_height)}}addRoom(e,i,n,r){var a=this.room_id++;this.rooms[a]={left:e,top:i,width:n,height:r,id:a,walls:[],neighbors:[],doors:[]};for(var l=i;l<i+r;l++)for(var s=e;s<e+n;s++)this.world[l][s]=Oe.FLOOR;return a}addFloor(e,i){this.world[i][e]=Oe.FLOOR}generateRooms(){for(var e=this.retry_count;this.room_id<this.room_ideal_count&&!(!this.generateRoom()&&--e<=0););}generateRoom(){var e=ei(0,3),i=e===1?1:e===3?-1:0,n=e===0?1:e===2?-1:0,r=this.getRoomDimensions(),a,l;if(e===0?(a=Qt,l=qe(Qt,this.max_width-r.width-Qt*2)):e===1?(a=qe(Qt,this.max_height-r.height-Qt*2),l=Qt):e===2?(a=this.max_height-r.height-Qt,l=qe(Qt,this.max_width-r.width-Qt*2)):e===3&&(a=qe(Qt,this.max_height-r.height-Qt*2),l=this.max_width-r.width-Qt),this.collides(a,l,r.width,r.height)!==!1)return!1;for(var s=null;(s=this.collides(a+n,l+i,r.width,r.height))===!1;)if(a+=n,l+=i,this.invalid(a,l,r.width,r.height))return!1;var f=this.addRoom(l,a,r.width,r.height);return this.addDoorBetweenRooms(i,n,s,f),!0}collides(e,i,n,r){for(var a={top:e,left:i,width:n,height:r},l=0;l<this.room_id;l++){var s=this.rooms[l];if(!(a.left>s.left+s.width||a.left+a.width<s.left||a.top>s.top+s.height||a.top+a.height<s.top))return s.id}return!1}invalid(e,i,n,r){return e<=Qt||i<=Qt||e+r>=this.max_height-Qt?!0:i+n>=this.max_width-Qt}buildWalls(){for(var e=this.rooms,i=0;i<this.room_id;i++){for(var n=e[i],r=n.left-1;r<n.left+n.width+1;r++)this.addWall(r,n.top-1,n);for(var a=n.top;a<n.top+n.height;a++)this.addWall(n.left+n.width,a,n);for(var l=n.left-1;l<n.left+n.width+1;l++)this.addWall(l,n.top+n.height,n);for(var s=n.top;s<n.top+n.height;s++)this.addWall(n.left-1,s,n)}}addWall(e,i,n){this.world[i][e]===Oe.VOID&&(this.world[i][e]=Oe.WALL,this.walls.push([e,i])),(this.world[i][e]===Oe.VOID||this.world[i][e]===Oe.WALL)&&n.walls.push([e,i])}addDoorBetweenRooms(e,i,n,r){var a=this.rooms[n],l=this.rooms[r],s,f,c;e===1?(s=a.left-1,f=ei(Math.max(a.top,l.top)+1,Math.min(a.top+a.height,l.top+l.height)-2),c="h"):e===-1?(s=l.left-1,f=ei(Math.max(l.top,a.top)+1,Math.min(l.top+l.height,a.top+a.height)-2),c="h"):i===-1?(s=ei(Math.max(a.left,l.left)+1,Math.min(a.left+a.width,l.left+l.width)-2),f=l.top-1,c="v"):i===1&&(s=ei(Math.max(l.left,a.left)+1,Math.min(l.left+l.width,a.left+a.width)-2),f=a.top-1,c="v"),this.addDoor(s,f,n,r,c),this.rooms[n].neighbors.push(r),this.rooms[r].neighbors.push(n)}addSpecialRooms(){for(var e=[],i={id:null,area:1/0},n,r,a=0;a<this.room_id;a++)n=this.rooms[a],n.neighbors.length===1&&(this.rooms[a].deadend=!0,e.push(a),r=n.width*n.height,r<i.area&&(i.id=a));if(this.want_special&&e.length>=2){var l=e.indexOf(i.id);e.splice(l,1);var s=this.rooms[i.id].doors[0],f=i.id;this.special={room_id:f,door_id:s};var c=this.doors[s];c.special=!0,this.rooms[f].special=!0,this.world[c.y][c.x]=Oe.SPECIAL_DOOR}Lu(e);var h=e.pop();if(typeof h>"u")throw new Error("Unable to find a dead end room for Enter!");var m=this.randomNonEdgeInRoom(h);this.world[m.y][m.x]=Oe.ENTER,this.enter={x:m.x,y:m.y,room_id:h},this.rooms[h].enter=!0;var w=this.rooms[h].doors[0];this.doors[w].enter=!0;var p=e.pop();if(typeof p>"u")throw new Error("Unable to find a dead end room for Exit!");var b=this.randomNonEdgeInRoom(p);this.world[b.y][b.x]=Oe.EXIT,this.exit={x:b.x,y:b.y,room_id:p},this.rooms[p].exit=!0;var O=this.rooms[p].doors[0];this.doors[O].exit=!0,this.deadends=e}randomNonEdgeInRoom(e){var i=this.rooms[e];return{x:ei(i.left+1,i.left+i.width-2),y:ei(i.top+1,i.top+i.height-2)}}addDoor(e,i,n,r,a){this.world[i][e]=Oe.DOOR;var l=this.door_id++;return this.doors[l]={x:e,y:i,id:l,orientation:a,rooms:[n,r]},this.rooms[n].doors.push(l),this.rooms[r].doors.push(l),l}}function Lu(t){for(var e,i,n=t.length;n;e=Math.floor(Xr()*n),i=t[--n],t[n]=t[e],t[e]=i);}function ei(t,e){var i=Math.floor(t),n=Math.floor(e);return Math.floor(Xr()*(n+1-i)+i)}function qe(t,e){var i=Math.floor(t),n=Math.floor(e);i%2===0&&i++,n%2===0&&n--,i-=1,n-=1,i/=2,n/=2;const r=Xr();var a=Math.floor(r*(n+1-i)+i);return a*=2,a+=1,a}const Du=ku;async function Pu(t){new Br.EllerMaze(Dt+4,Pt+3).create((i,n,r)=>{i--,n--,r&&v.map.getType(i,n)===g.Floor&&_e(t,i,n)})}async function Cu(t){const e=new Br.Cellular(Dt+1,Pt+1);e.randomize(.5);for(let i=0;i<4;i++)e.create();e.connect((i,n,r)=>{i<0||i>Dt||n<0||n>Pt||!r&&v.map.getType(i,n)===g.Floor&&_e(t,i,n)},1)}async function Mu(t){new Br.Rogue(Dt+1,Pt+1,{}).create((i,n,r)=>{i<0||i>Dt||n<0||n>Pt||r&&v.map.getType(i,n)===g.Floor&&_e(t,i,n)})}async function zu(t){const e=vu({width:Dt+3,height:Pt+5,minRoomSize:3,maxRoomSize:100});for(let i=1;i<e.length-1;i++)for(let n=1;n<e[i].length-1;n++){const[r,a]=[n-1,i-1];v.map.getType(r,a)===g.Floor&&e[i][n]===1&&_e(t,r,a)}}async function Fu(t){const i=new Du({width:Dt+1,height:Pt+1,retry:100,special:!0,room:{ideal:35,min_width:3,max_width:7,min_height:3,max_height:7}}).build().world;for(let n=0;n<i.length;n++)for(let r=0;r<i[n].length;r++)if(v.map.getType(r,n)===g.Floor)switch(i[n][r]??0){case 0:_e(g.Block,r,n);break;case 1:case 3:break;case 4:_e(g.Door,r,n);break;case 2:_e(t,r,n);break;case 5:_e(g.Player,r,n);break;case 6:_e(g.Stairs,r,n);break}ea()}async function Kr(t,e={}){if(!t||typeof t!="string")return;const i=t.split(`
`);for(let n of i)n=n.trim(),n&&(n.startsWith("##")?await Uu(n.slice(2),e):n.startsWith("@@")?await fs(n.slice(2)):n.startsWith("''")||await Xt(n))}const Nu={BECOME:({x:t,y:e,args:i})=>_e(ne(i[0]),t,e),CHANGE:({args:t})=>iu(ne(t[0]),ne(t[1])),HIDE:({args:t})=>Gf(ne(t[0])),SHOW:({args:t})=>Hf(ne(t[0])),GIVE:({args:t})=>In(ne(t[0]),+t[1]),TAKE:({args:t})=>In(ne(t[0]),-t[1]),CHAR:({args:t})=>cn(ne(t[0]),{ch:t[1]}),FG:({args:t})=>cn(ne(t[0]),{fg:t[1]}),BG:({args:t})=>cn(ne(t[0]),{bg:t[1]}),GEMS:()=>In(g.Gem,50),KEYS:()=>In(g.Key,5),ZAP:({x:t,y:e})=>{_e(g.Floor,t+1,e),_e(g.Floor,t-1,e),_e(g.Floor,t,e+1),_e(g.Floor,t,e-1)},RNDGEN:({args:t})=>mu(ne(t[0])||g.Floor,+(t[1]??1)),Bomb:({x:t,y:e})=>jf(t,e),Quake:Yf,TeleportTrap:({who:t})=>qr(t),ZapTrap:qf,CreateTrap:Zf,ShowGems:Xf,BlockSpell:({what:t,args:e})=>Kf(ne(e[0])||g.ZBlock,t.type),WallVanish:eu,KROZ:({what:t})=>Jf(t.type),OSpell:({what:t})=>Qf(t.type),CSpell:({what:t})=>tu(t.type),TTrigger:({x:t,y:e,what:i,args:n})=>nu(t,e,ne(n[0])||i.type),Shoot:({x:t,y:e,args:i})=>$f(t,e,+i[0]),SlowTime:lu,SpeedTime:cu,Invisible:({who:t})=>fu(t),Freeze:uu,HideLevel:su,ShowIWalls:ou,MagicSwap:({args:t})=>au(ne(t[0]),ne(t[1])),DisguiseFast:ru,FlashEntity:({who:t})=>Zr(t),PitFall:hu,Tunnel:({who:t,x:e,y:i})=>du(t,e,i),EvapoRate:({args:t})=>{v.evapoRate=+t[0]},LavaRate:({args:t})=>{v.lavaFlow=!0,v.lavaRate=+t[0]},TreeRate:({args:t})=>{v.treeRate=+t[0]},MagicEWalls:()=>{v.magicEWalls=!0},BridgeCaster:({x:t,y:e,args:i})=>gu(t,e,+i[0],+i[1]),NEXTLEVEL:async()=>{await ns()},CHANGELEVEL:async({args:t})=>{await ki(+t[0]-1)},CHANGEGAME:async({args:t})=>{const e=is[t[0]];e?Ur.dispatch(e):console.warn("Unknown game:",t[0])},openSourceScreen:async()=>await Yu(),REFRESH:async()=>Jn(),DIE:async({who:t})=>await mn(t),TEST:Bu,ellerMaze:async({args:t})=>Pu(ne(t[0])||g.Wall),cellular:async({args:t})=>Cu(ne(t[0])||g.Wall),rogue:async({args:t})=>Mu(ne(t[0])||g.Wall),bsp:async({args:t})=>zu(ne(t[0])||g.Wall),brogue:async({args:t})=>Fu(ne(t[0])||g.Wall)};async function Bu(){for(let n=0;n<6;n++){const r=4*n+3;for(let a=0;a<8;a++){const l=8*a+7+4*(n%2)-4;for(let c=-2;c<=2;c++)i(l+c,r),i(l,r+c);let s=0,f=0;Math.random()<.5?s=1-2*Math.floor(Math.random()*2):f=1-2*Math.floor(Math.random()*2);for(let c=0;c<5;c++)i(l+c*s,r+c*f)}}function i(n,r){v.map.getType(n,r)===g.Floor&&_e(g.Wall,n,r)}}async function Uu(t,e={}){var n,r,a,l;e.args=t.split(" "),t=e.args.shift();const i=Nu[t];if(i){e.who??(e.who=v.player),e.x??(e.x=((r=(n=e.who)==null?void 0:n.get(Bt))==null?void 0:r.x)??0),e.y??(e.y=((l=(a=e.who)==null?void 0:a.get(Bt))==null?void 0:l.y)??0),await i(e);return}console.warn("Unknown effect:",t)}const ro={Amulet:kl,SecretMessage:Vl,WhipHit:Tl,WhipBreak:Sl,WhipBreakRock:Ol,BlockedWall:Oo,Blocked:So,StaticNoise:Ro};async function fs(t){if(ro[t])return await ro[t]();console.warn("No sound for trigger:",t)}class us{constructor(e){Lt(this,"_components",new Map);Lt(this,"_tags",new Set);this.type=e}add(e){return typeof e=="symbol"||typeof e=="string"?(this._tags.add(e),this):(this._components.set(e.constructor.name,e),this)}get(e){return this._components.get(e.name)}has(e){return typeof e=="symbol"||typeof e=="string"?this._tags.has(e):this._components.has(e.name)}remove(e){return typeof e=="symbol"||typeof e=="string"?this._tags.delete(e):this._components.delete(e.name)}}let Vu=255,kr={},Lr={},Mn={},zn;const gt={PLAYER_CHAR:"☻",PLAYER_FG:14,PLAYER_BG:0,FLOOR_CHAR:" ",FLOOR_FG:0,FLOOR_BG:0,BORDER_CHAR:"▒",BORDER_FG:9,BORDER_BG:0,CHANCE_CHAR:"?",CHANCE_FG:15,CHANCE_BG:0,BLOCK_CHAR:"█"};async function Wu(t){var e,i,n,r,a,l,s,f,c,h,m,w,p,b,O,k,Y,H,T,x,D;if(kr={},Lr={},Mn={},zn=t,!zn.tiles)throw new Error("No tiles found in tileset");for(const N of zn.tiles){const $=+N.id,nt=N.type?+N.type:Vu++;kr[$]=nt,Lr[nt]=$;const K=wi((N==null?void 0:N.properties)??{});if(g[nt]&&K.name!==g[nt])throw new Error("Tile ID mismatch");const pt=g[nt]??K.name??""+nt;if(Mn[pt])throw new Error("Duplicate type name: "+pt);switch(Mn[pt]=nt,nt){case g.Floor:gt.FLOOR_CHAR=((e=K.Tile)==null?void 0:e.ch)??gt.FLOOR_CHAR,gt.FLOOR_FG=(i=K.Tile)!=null&&i.fg?U[(n=K.Tile)==null?void 0:n.fg]:gt.FLOOR_FG,gt.FLOOR_BG=(r=K.Tile)!=null&&r.bg?U[(a=K.Tile)==null?void 0:a.bg]:gt.FLOOR_BG;break;case g.Block:gt.BLOCK_CHAR=((l=K.Tile)==null?void 0:l.ch)??gt.BLOCK_CHAR;break;case g.Border:gt.BORDER_CHAR=((s=K.Tile)==null?void 0:s.ch)??gt.BORDER_CHAR,gt.BORDER_FG=(f=K.Tile)!=null&&f.fg?U[(c=K.Tile)==null?void 0:c.fg]:gt.BORDER_FG,gt.BORDER_BG=(h=K.Tile)!=null&&h.bg?U[(m=K.Tile)==null?void 0:m.bg]:gt.BORDER_BG;break;case g.Chance:gt.CHANCE_CHAR=((w=K.Tile)==null?void 0:w.ch)??gt.CHANCE_CHAR,gt.CHANCE_FG=(p=K.Tile)!=null&&p.fg?U[(b=K.Tile)==null?void 0:b.fg]:gt.CHANCE_FG,gt.CHANCE_BG=(O=K.Tile)!=null&&O.bg?U[(k=K.Tile)==null?void 0:k.bg]:gt.CHANCE_BG;break;case g.Player:gt.PLAYER_CHAR=((Y=K.Tile)==null?void 0:Y.ch)??gt.PLAYER_CHAR,gt.PLAYER_FG=(H=K.Tile)!=null&&H.fg?U[(T=K.Tile)==null?void 0:T.fg]:gt.PLAYER_FG,gt.PLAYER_BG=(x=K.Tile)!=null&&x.bg?U[(D=K.Tile)==null?void 0:D.bg]:gt.PLAYER_BG;break}}}function Gu(t){for(const e of zn.tiles)if(e.id===t)return e}function vn(t,e,i){const n=Lr[t]??0;return yi(n,e,i)}function yi(t,e,i,n,r){const a=Gu(t);r=ne(r)??kr[t]??$s(t)??g.Floor;const l=new us(r);return a&&a.properties&&so(l,wi(a.properties)),so(l,n||{}),(l.has(xi)||l.has(ze))&&l.add(new Bt({x:e,y:i})),l.has(xi)&&l.add(new jr(0)),l}function ne(t){if(typeof t=="number")return t;if(!(typeof t>"u"||t===""))return typeof t=="string"&&!isNaN(+t)?+t:t in g?g[t]:Mn[t]??t}const ao={isPlayer:xi,isMob:ze,isGenerator:Zo,isSecreted:dn,isPassable:qn,followsPlayer:qo,isBombable:Tr,isImperviousToSpears:Xo,isInvisible:we},oo={Collectible:Ti,Trigger:Ar,AnimatedWalking:Or,Attacks:_n,Pushable:Ii,Speed:ts,Breakable:Si,FoundMessage:$r,Glitch:Rr};function so(t,e){const i=t.type;for(const n in ao)e[n]&&t.add(ao[n]);if(t.has(ze)&&(i===g.Fast||i===g.Medium||i===g.Slow)&&t.add(new Ko(ga)).add(new Jo([g.Block,g.MBlock,g.ZBlock,g.GBlock])),(rc.includes(i)||ga.includes(i))&&t.add(new Sr([g.Fast,g.Medium,g.Slow])),"ChanceOdds"in e){const n=e.ChanceOdds??0;if(n>0){const r=1/n;Math.random()<r&&t.add(dn)}}switch(i){case g.Floor:t.add(new Sr([g.Fast,g.Medium,g.Slow,g.MBlock]));break;case g.Chest:t.add(new Ti({whips:C.getUniformInt(2,5),gems:C.getUniformInt(5,ft.difficulty+2)}));break;case g.Chance:{const n=C.getUniformInt(0,ft.difficulty)+13;t.add(new Ti({gems:n}));break}}if("Tile"in e){const n=e.Tile;let r=n.fg,a=n.bg;typeof r=="string"&&(r=U[r]??(r==="None"?null:r)),typeof a=="string"&&(a=U[a]??(a==="None"?null:a)),t.add(new fe({...n,fg:r,bg:a}))}for(const n in oo)if(n in e){const r=oo[n];t.add(new r(e[n]))}}function Hu(t){switch(t){case g.Border:return P.score>P.levelIndex?-P.levelIndex/2:0;case g.Slow:case g.Medium:case g.Fast:return t;case g.Block:case g.Wall:case g.ZBlock:case g.GBlock:case g.River:case g.Tree:case g.Forest:case g.MBlock:case g.OWall1:case g.OWall2:case g.OWall3:case g.EWall:return P.score>2?-2:0;case g.Whip:case g.SlowTime:return 1;case g.Stairs:return P.levelIndex;case g.Chest:return 5;case g.Gem:return 1;case g.Invisible:return 10;case g.Nugget:return 50;case g.Door:case g.Teleport:case g.Freeze:return 1;case g.SpeedTime:return 2;case g.Power:return 5;case g.Trap:return P.score>5?-5:0;case g.Lava:return 25;case g.Tome:return 5e3;case g.Tablet:return P.levelIndex+250;case g.Chance:return 100;case g.Statue:return 10;case g.Amulet:return 2500;case g.Z:return 1e3;case g.Create:return P.levelIndex*2;case g.Generator:return 50}return 0}function vi(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=Array.from(typeof t=="string"?[t]:t);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var r=n.reduce(function(s,f){var c=f.match(/\n([\t ]+|(?!\s).)/g);return c?s.concat(c.map(function(h){var m,w;return(w=(m=h.match(/[\t ]/g))===null||m===void 0?void 0:m.length)!==null&&w!==void 0?w:0})):s},[]);if(r.length){var a=new RegExp(`
[	 ]{`+Math.min.apply(Math,r)+"}","g");n=n.map(function(s){return s.replace(a,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var l=n[0];return e.forEach(function(s,f){var c=l.match(/(?:^|\n)( *)$/),h=c?c[1]:"",m=s;typeof s=="string"&&s.includes(`
`)&&(m=String(s).split(`
`).map(function(w,p){return p===0?w:""+h+w}).join(`
`)),l+=m+n[f+1]}),l}function $u(){It(70,0,"Score",U.Yellow,U.Blue),It(70,3,"Level",U.Yellow,U.Blue),It(70,6,"Gems",U.Yellow,U.Blue),It(70,9,"Whips",U.Yellow,U.Blue),It(68,12,"Teleports",U.Yellow,U.Blue),It(70,15,"Keys",U.Yellow,U.Blue);const[e,i]=Di(U.HighIntensityWhite,U.Blue);It(69,18,"OPTIONS",e,U.Red),It(69,19,`%c{${e}}W%c{}hip`,U.White,i),It(69,20,`%c{${e}}T%c{}eleport`,U.White,i),It(69,21,`%c{${e}}P%c{}ause`,U.White,i),It(69,22,`%c{${e}}Q%c{}uit`,U.White,i),It(69,23,`%c{${e}}S%c{}ave`,U.White,i),It(69,24,`%c{${e}}R%c{}estore`,U.White,i)}function Ie(){const t=P.whipPower>2?`${P.whips}+${P.whipPower-2}`:P.whips.toString(),e=4,i=7,n=!ft.paused&&P.gems<10?U.Red|16:U.Red,r=69;It(r,1,_i((P.score*10).toString(),e+1,i,gt.FLOOR_CHAR),U.Red,U.Grey),It(r,4,_i((P.levelIndex+1).toString(),e,i,Fi),U.Red,U.Grey),It(r,7,_i(P.gems.toString(),e+1,i,Fi),n,U.Grey),It(r,10,_i(t,e,i,Fi),U.Red,U.Grey),It(r,13,_i(P.teleports.toString(),e,i,Fi),U.Red,U.Grey),It(r,16,_i(P.keys.toString(),e,i,Fi),U.Red,U.Grey)}function Jr(){const t=gt.BORDER_CHAR,e=v.borderFG,i=v.borderBG;for(let n=ri-1;n<=bi+1;n++)Ze(n,0,t,e,i),Ze(n,Nn+1,t,e,i);for(let n=ai-1;n<=Nn+1;n++)Ze(0,n,t,e,i),Ze(bi+1,n,t,e,i)}async function ju(){Xe(U.Black),Ce(Ge-1,"Choose a game to start",U.HighIntensityWhite),Ce(Ge-1,"Press any key to continue",U.White),await Gn(async()=>{It(5,5,vi`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `,ho?U.Red:C.getUniformInt(1,15)),await zt(500)})}async function Yu(){ft.bot||(Xe(U.Black),Ce(1,ft.title,U.Yellow),It(2,4,vi`
    Kroz is a series of Roguelike video games created by Scott Miller and 
    published by Apogee Software in the late 1980s and early 1990s.  In March
    2009, the whole Kroz series was released as freeware by Apogee, and the
    source code was released as free software under the GPL license.`,U.White),Ce(Ge-1,"Press any key to continue.",U.HighIntensityWhite,U.Black),await on(),bn(),It(2,9,vi`
    This is a re-implementation the original Kroz series of games in typescript 
    playable in the browser.  The source code completly open-source.  If you
    enjoy this game you are asked by the author to please add a star to the
    github repo at https://github.com/Hypercubed/kroz.`,U.White),Ce(Ge-1,"Press any key to continue.",U.HighIntensityWhite,U.Black),await on(),bn(),It(2,15,vi`
    Better yet, contribute to the game yourself; or maybe fork it and add your
    own levels.  That might make a nice 7DRL challenge entry
    (https://7drl.com/).`,U.White),Ce(Ge-1,"Press any key to continue.",U.HighIntensityWhite,U.Black),await on(),bn(),It(10,20,"Thank you and enjoy the game.  -- Hypercubed"),Ce(Ge-1,"Press any key to continue.",U.HighIntensityWhite,U.Black),await on(),bn())}function pe(){for(let e=0;e<v.map.width;e++)for(let i=0;i<v.map.height;i++){const n=v.map.get(e,i);if(!n||n.type===g.Player||n.type===g.Slow||n.type===g.Medium||n.type===g.Fast){hs(e,i);continue}kt(e,i,n)}for(let e=0;e<v.entities.length;e++){const i=v.entities[e],n=i.get(Bt);n.x===-1||n.y===-1||kt(n.x,n.y,i)}const t=v.player.get(Bt);t&&kt(t.x,t.y,v.player)}function hs(t,e){Ze(t+ri,e+ai,gt.FLOOR_CHAR,gt.FLOOR_FG,gt.FLOOR_BG)}function kt(t,e,i){if(hs(t,e),i??(i=v.map.get(t,e)),!i||i.has(we))return;if(i.has(dn)){Ze(t+ri,e+ai,gt.CHANCE_CHAR,gt.CHANCE_FG,gt.CHANCE_BG);return}if(!i.has(fe))return;const n=i.get(fe);let r=n.ch,a=n.fg;if(n.blink&&hn&&!ft.paused&&ft.started){const s=Date.now()%500<250;a=Le(a,s?1:0)}i.has(Rr)&&(r=i.get(Rr).getFrame()),Ze(t+ri,e+ai,r,a,n.bg)}function ke(t,e,i,n,r){Ze(t+ri,e+ai,i,n,r)}function Qr(t,e,i,n,r="#00000000"){lh(t+ri,e+ai,i,n,r)}async function Xt(t,e){if(ft.bot||!t)return"";const i=(bi-t.length)/2,n=Nn+1;ft.paused=!0;const r=await Gn(()=>{const a=hn?C.getUniformInt(1,15):U.White;It(i,n,t,a,U.Black),e==null||e()});return Jr(),ft.paused=!1,r}function Jn(){Xe(U.Blue),Jr(),$u(),pe(),Ie()}function qu(){pe(),Ie()}async function Zu(){Xe(U.Blue),It(2,5,vi`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `,U.LightCyan,U.Blue),It(9,16,`Use the cursor keys to move yourself (%c{${ci[U.Yellow]}}☻%c{${ci[U.LightGreen]}}) through the caverns.`,U.LightGreen,U.Blue),Ce(17,"Use your whip (press W) to destroy all nearby creatures.",U.LightGreen,U.Blue),await _t(220,100,50),await Xu(),await _t(700,100,10),Ce(Ge-1,"Press any key.",U.HighIntensityWhite,U.Blue),await Gn(async()=>{await ds()})}async function ds(){const t=ft.title,e=Ai/2-t.length/2;It(e,1," ".repeat(t.length+2),C.getUniformInt(0,16),U.Red),It(e,2," "+t+" ",C.getUniformInt(0,16),U.Red),It(e,3," ".repeat(t.length+2),C.getUniformInt(0,16),U.Red),await zt(500)}const lo={"!":"SECRET MODE",T:null,N:"NOVICE",E:"EXPERENCED",A:"ADVANCED",B:null};async function Xu(){let t="";const e=ci[U.LightGreen],i=ci[U.HighIntensityWhite];for(It((Ai-52)/2,19,`Are you a %c{${i}}N%c{${e}}ovice, %c{${i}}E%c{${e}}xperenced or and %c{${i}}A%c{${e}}dvanced player?`,e,U.Blue);!lo[t];)t=await Gn(async()=>{await ds()}),t=t.toUpperCase();switch(sh(19),Ce(19,lo[t],U.LightGreen,U.Blue),t){case"N":P.gems=20,P.teleports=0,P.keys=0,P.whips=0,P.whipPower=2,ft.difficulty=Ve.Novice;break;case"E":P.gems=15,P.teleports=0,P.keys=0,P.whips=0,P.whipPower=2,ft.difficulty=Ve.Experienced;break;case"A":P.gems=10,P.teleports=0,P.keys=0,P.whips=0,P.whipPower=2,ft.difficulty=Ve.Advanced,ft.foundSet=!0;break;case"!":P.gems=250,P.whips=100,P.teleports=50,P.keys=1,P.whipPower=3,ft.difficulty=Ve.Cheat,ft.foundSet=!0;break;case"T":P.gems=1/0,P.teleports=1/0,P.keys=1,P.whips=1/0,P.whipPower=4,ft.difficulty=Ve.Tourist;break;case"B":P.gems=500,P.teleports=50,P.keys=0,P.whips=1e3,P.whipPower=3,ft.difficulty=Ve.Cheat,ft.foundSet=!0,ft.bot=Us;break}return t}async function Ku(){await ln(),await zt(200),await ln(),await zt(200),await ln(),await Xt("Oh no, something strange is happening!"),await Xt("You are magically transported from Kroz!");const t=P.gems=isFinite(P.gems)?P.gems:150,e=P.whips=isFinite(P.whips)?P.whips:20,i=P.teleports=isFinite(P.teleports)?P.teleports:10,n=P.keys=isFinite(P.keys)?P.keys:5;await Xt("Your Gems are worth 100 points each...");for(let r=0;r<t;r++)P.gems--,P.score+=10,Ie(),await _t(r*8+100,20);await Xt("Your Whips are worth 100 points each...");for(let r=0;r<e;r++)P.whips--,P.score+=10,Ie(),await _t(r*8+100,20);await Xt("Your Teleport Scrolls are worth 200 points each...");for(let r=0;r<i;r++)P.teleports--,P.score+=20,Ie(),await _t(r*8+100,20);await Xt("Your Keys are worth 10,000 points each....");for(let r=0;r<n;r++)P.keys--,P.score+=1e3,Ie(),await _t(r*8+100,20);Xe(U.Blue),It(25,3,"ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ",U.White,U.Blue),It(10,5,vi`
        Carefully, you place the ancient tome on your table and open
        to the first page.  You read the book intently, quickly
        deciphering the archaic writings.

        You learn of Lord Dullwit, the once powerful and benevolent
        ruler of Kroz, who sought wealth and education for his people.
        The magnificent KINGDOM OF KROZ was once a great empire, until
        it was overthrown by an evil Wizard, who wanted the riches of
        Kroz for himself.

        Using magic beyond understanding, the Wizard trapped Lord
        Dullwit and his people in a chamber so deep in Kroz that any
        hope of escape was fruitless.

        The Wizard then built hundreds of deadly chambers that would
        stop anyone from ever rescuing the good people of Kroz.
        Once again your thoughts becomes clear:  To venture into the
        depths once more and set free the people of Kroz.
       `,U.White,U.Blue),await Xt("Press any key, Adventurer."),ft.done=!0}class Ju{constructor(e=Dt+1,i=Pt+1){Lt(this,"PF",[]);this.width=e,this.height=i}getIndex(e,i){return i*this.width+e}get(e,i){if(e<0||e>=this.width||i<0||i>=this.height)return null;const n=this.getIndex(e,i);return this.PF[n]}set(e,i,n){if(e<0||e>=this.width||i<0||i>=this.height)return;const r=this.getIndex(e,i);this.PF[r]=n}getType(e,i){var r;if(e<0||e>=this.width||i<0||i>=this.height)return g.Border;const n=(r=this.get(e,i))==null?void 0:r.type;return typeof n=="string"?n:n??g.Floor}findRandomEmptySpace(){let e=0;for(;e<Dt*Pt*10;){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt);if(this.getType(i,n)===g.Floor)return[i,n];e++}return null}async forEach(e){for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++){const r=this.get(i,n);r&&await e(i,n,r)}}fill(e){for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.set(n,i,e(n,i,this.getIndex(n,i)))}}var Ve=(t=>(t[t.Novice=8]="Novice",t[t.Experienced=5]="Experienced",t[t.Advanced=2]="Advanced",t[t.Cheat=9]="Cheat",t[t.Tourist=10]="Tourist",t))(Ve||{});function Qn(){return{levelIndex:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2}}function ta(){return{currentLevel:null,bonus:0,genNum:0,magicEWalls:!1,evapoRate:0,treeRate:0,lavaRate:0,lavaFlow:!1,player:new us(g.Player),entities:[],map:new Ju,replacement:g.Floor,T:[0,0,0,0,0,0,0,0,0,0],startTrigger:void 0,borderFG:gt.BORDER_FG,borderBG:gt.BORDER_BG}}function _s(){return{currentGame:null,difficulty:8,clockScale:Vs,paused:!1,started:!1,done:!1,foundSet:new Set,bot:!1,title:_o}}const P=Qn(),v=ta(),ft=_s(),ps=Qn(),Dr=Qn();function gs(){Object.assign(P,Qn()),Object.assign(v,ta()),Object.assign(ft,_s())}function Qu(){Object.assign(v,ta())}function th(){Object.assign(ps,P)}async function eh(){let t="";for(;t.toLowerCase()!=="y"&&t.toLowerCase()!=="n"&&t.toLowerCase()!=="w"&&t.toLowerCase()!=="t";)t=await Xt("Are you sure you want to SAVE? (Y/N)");(t.toLowerCase()==="y"||t.toLowerCase()==="w")&&(Object.assign(Dr,ps),localStorage.setItem("Kroz--saveState--v1",JSON.stringify(Dr)))}async function ih(){let t="";for(;t.toLowerCase()!=="y"&&t.toLowerCase()!=="n"&&t.toLowerCase()!=="w"&&t.toLowerCase()!=="t";)t=await Xt("Are you sure you want to RESTORE? (Y/N)");if(t.toLowerCase()==="y"||t.toLowerCase()==="w"){let e=Dr;const i=localStorage.getItem("Kroz--saveState--v1");if(i)try{e=JSON.parse(i)}catch(n){console.error(n)}Object.assign(P,e),await ki(P.levelIndex)}}function Ae(t){P.score+=Hu(t),Ie()}async function Li(t,e){const i=v.map.get(t,e);Mt(t,e,g.Floor),kt(t,e),i&&i.has(Bt)&&await mn(i)}function Mt(t,e,i){v.map.set(t,e,vn(i,t,e))}async function mn(t){var e;typeof t.type=="number"&&t.type<4&&(await vl(t.type),(e=t.get(Bt))==null||e.die()),t.type===g.Player&&await Un()}async function ms(t=1){for(let e=0;e<t;e++){let i=!1;do{const n=C.getUniformInt(0,Dt),r=C.getUniformInt(0,Pt);if(v.map.getType(n,r)===g.Floor){const a=vn(g.Slow,n,r);v.entities.push(a),v.map.set(n,r,a),await Wl(),i=!0}pe()}while(!i&&C.getUniformInt(0,50)!==0)}}async function nh(){let t="";for(;t.toLowerCase()!=="y"&&t.toLowerCase()!=="n";)t=await Xt("Are you sure you want to quit? (Y/N)");t.toLowerCase()==="y"&&(ft.done=!0)}async function rh(){ft.paused=!0,Jn(),await Xt("Press any key to resume")}async function ea(){v.genNum=0,v.entities=[],v.T[ce.StatueGemDrain]=0,await v.map.forEach(async(t,e,i)=>{i&&(i.type===g.Statue&&(v.T[ce.StatueGemDrain]=32e3),i.has(xi)&&(v.player=i),i.has(ze)&&v.entities.push(i),i.has(Zo)&&v.genNum++)})}var U=(t=>(t[t.Black=0]="Black",t[t.Blue=1]="Blue",t[t.Green=2]="Green",t[t.Cyan=3]="Cyan",t[t.Red=4]="Red",t[t.Magenta=5]="Magenta",t[t.Brown=6]="Brown",t[t.White=7]="White",t[t.Grey=8]="Grey",t[t.LightBlue=9]="LightBlue",t[t.LightGreen=10]="LightGreen",t[t.LightCyan=11]="LightCyan",t[t.LightRed=12]="LightRed",t[t.LightMagenta=13]="LightMagenta",t[t.Yellow=14]="Yellow",t[t.HighIntensityWhite=15]="HighIntensityWhite",t))(U||{});const ci={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};async function ah(t){for(const e in t){const i=U[e];e&&(ci[i]=t[e])}}function Le(t,e=1){return typeof t=="number"&&(t>15&&(t%=16,hn&&!ft.paused&&ft.started&&(Date.now()%500<250||(e=0))),t=ci[t]),e<1&&(t=t+Math.round(e*255).toString(16).padStart(2,"0")),t}function Di(...t){return t.map(e=>Le(e))}let re;function oh(){oi.Rect.cache=!0,re=new oi({width:Ai,height:Ge,fontFamily:"IBM_VGA, monospace",bg:Le(U.Black),fg:Le(U.White),fontSize:64});const t=re.drawOver;re.drawOver=function(e,i,n,r,a){t.call(this,e,i,n,r,a),this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[`${e},${i}`]=!0)}}function Ce(t,e,i=re.getOptions().fg,n=re.getOptions().bg){const r=Math.floor((Ai-e.length)/2);It(r,t,e,...Di(i,n))}function sh(t,e=re.getOptions().fg,i=re.getOptions().bg){It(0,t," ".repeat(Ai),...Di(e,i))}function Xe(t=re.getOptions().bg){re.setOptions({bg:Le(t)}),re.clear()}function Ze(t,e,i,n=re.getOptions().fg,r=re.getOptions().bg){re.draw(t,e,i,...Di(n,r))}function lh(t,e,i,n=re.getOptions().fg,r=re.getOptions().bg){re.drawOver(t,e,i,...Di(n,r))}function It(t,e,i,n=re.getOptions().fg,r=re.getOptions().bg){return[n,r]=Di(n,r),re.drawText(t,e,`%c{${n}}%b{${r}}${i}%c{}%b{}`)}function ch(){return re||oh(),re.getContainer()}async function fh(){for(let e=0;e<v.T.length;e++)v.T[e]=Math.max(0,v.T[e]-1);v.T[ce.Invisible]>0?v.player.add(we):v.player.remove(we),v.T[ce.StatueGemDrain]>0&&C.getUniformInt(0,18)===0&&(P.gems--,await _t(3800,40),Ie());const t=v.entities.reduce((e,i)=>i.type===g.Slow?e+1:e,0);if(v.genNum>0&&t<995&&C.getUniformInt(0,17)===0&&await ms(1),v.magicEWalls&&C.getUniformInt(0,7)===0){for(let e=0;e<100;e++){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt);if(v.map.getType(i,n)===g.CWall1){Mt(i,n,g.EWall),kt(i,n);break}}for(let e=0;e<100;e++){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt);if(v.map.getType(i,n)===g.EWall){Mt(i,n,g.CWall1),kt(i,n);break}}}if(v.evapoRate>0&&C.getUniformInt(0,9)===0)for(let e=0;e<v.evapoRate;e++){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt);v.map.getType(i,n)===g.River&&(Mt(i,n,g.Floor),kt(i,n))}if(v.lavaFlow&&C.getUniformInt(0,9)===0)for(let e=0;e<v.lavaRate;e++){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt),r=v.map.getType(i,n);if(ac.includes(r)){let a=!1;v.map.getType(i+1,n)===g.Lava&&(a=!0),v.map.getType(i-1,n)===g.Lava&&(a=!0),v.map.getType(i,n+1)===g.Lava&&(a=!0),v.map.getType(i,n-1)===g.Lava&&(a=!0),a&&(Mt(i,n,g.Lava),kt(i,n))}}if(v.treeRate>0&&C.getUniformInt(0,9)===0)for(let e=0;e<v.treeRate;e++){const i=C.getUniformInt(0,Dt),n=C.getUniformInt(0,Pt),r=v.map.getType(i,n);if(oc.includes(r)){let a=!1;if((v.map.getType(i+1,n)===g.Tree||v.map.getType(i+1,n)===g.Forest)&&(a=!0),(v.map.getType(i-1,n)===g.Tree||v.map.getType(i-1,n)===g.Forest)&&(a=!0),(v.map.getType(i,n+1)===g.Tree||v.map.getType(i,n+1)===g.Forest)&&(a=!0),(v.map.getType(i,n-1)===g.Tree||v.map.getType(i,n-1)===g.Forest)&&(a=!0),a){const l=C.getUniformInt(0,3)===0?g.Tree:g.Forest;Mt(i,n,l),kt(i,n)}}}}const uh={get SlowTime(){return v.T[ce.SlowTime]},set SlowTime(t){v.T[ce.SlowTime]=t},get Invisible(){return v.T[ce.Invisible]},set Invisible(t){v.T[ce.Invisible]=t},get SpeedTime(){return v.T[ce.SpeedTime]},set SpeedTime(t){v.T[ce.SpeedTime]=t},get FreezeTime(){return v.T[ce.FreezeTime]},set FreezeTime(t){v.T[ce.FreezeTime]=t}},hh={get x(){var t,e;return((e=(t=v.player)==null?void 0:t.get(Bt))==null?void 0:e.x)??0},set x(t){v.player.get(Bt).x=t},get y(){var t,e;return((e=(t=v.player)==null?void 0:t.get(Bt))==null?void 0:e.y)??0},set y(t){v.player.get(Bt).y=t},get bot(){return ft.bot},set bot(t){ft.bot=t}},dh={get gems(){return P.gems},set gems(t){P.gems=t},get whips(){return P.whips},set whips(t){P.whips=t},get keys(){return P.keys},set keys(t){P.keys=t},get teleports(){return P.teleports},set teleports(t){P.teleports=t},get whipPower(){return P.whipPower},set whipPower(t){P.whipPower=t}},_h={get level(){return P.levelIndex},set level(t){ki(t)}},ph={timers:uh,player:hh,stats:dh,levels:_h};window.krozDebugAPI=ph;let ws=0,fn=0;function gh(){const t=ch();document.getElementById("app").appendChild(t),Qs(),gs(),Xe(U.Black),Ur.add(i=>{window.cancelAnimationFrame(ws),mh(i)})}async function ys(){fn=0,Xe(U.Black),await ju(),ft.title=_o,Ur.dispatch(is.loading)}async function mh(t){gs(),ft.currentGame=t,Xe(U.Black),fn++>0&&await Zu(),Wu(await t.readTileset()),ah(await t.readColor()),await ki(0),Jn(),ft.started=!0,await wh()}async function wh(){const t=fn;let e=0,i=0,n=0;Vr.add(()=>{e=0,i=0,n=0});const r=async a=>{if(fn!==t)return;const l=8*ft.clockScale;if(ft.done){ys();return}if(i+=a-n,n=a,i>l){if(i%=l,e++,await Ff(),fn!==t)return;await Uf(e),await fh(),pe()}qu(),requestAnimationFrame(r)};ws=requestAnimationFrame(r)}async function co(){gh(),await ys()}try{document.fonts.ready.then(co)}catch{window.addEventListener("DOMContentLoaded",co)}
