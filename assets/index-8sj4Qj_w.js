var to=Object.defineProperty;var io=(e,t,i)=>t in e?to(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var it=(e,t,i)=>io(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var nn={exports:{}},no=nn.exports,fr;function ro(){return fr||(fr=1,function(e,t){(function(i,n){e.exports=n()})(no,function(){var i=function(){function n(w){return f.appendChild(w.dom),w}function r(w){for(var O=0;O<f.children.length;O++)f.children[O].style.display=O===w?"block":"none";o=w}var o=0,f=document.createElement("div");f.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",f.addEventListener("click",function(w){w.preventDefault(),r(++o%f.children.length)},!1);var u=(performance||Date).now(),p=u,d=0,T=n(new i.Panel("FPS","#0ff","#002")),L=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var Z=n(new i.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:f,addPanel:n,showPanel:r,begin:function(){u=(performance||Date).now()},end:function(){d++;var w=(performance||Date).now();if(L.update(w-u,200),w>p+1e3&&(T.update(1e3*d/(w-p),100),p=w,d=0,Z)){var O=performance.memory;Z.update(O.usedJSHeapSize/1048576,O.jsHeapSizeLimit/1048576)}return w},update:function(){u=this.end()},domElement:f,setMode:r}};return i.Panel=function(n,r,o){var f=1/0,u=0,p=Math.round,d=p(window.devicePixelRatio||1),T=80*d,L=48*d,Z=3*d,w=2*d,O=3*d,A=15*d,C=74*d,V=30*d,H=document.createElement("canvas");H.width=T,H.height=L,H.style.cssText="width:80px;height:48px";var k=H.getContext("2d");return k.font="bold "+9*d+"px Helvetica,Arial,sans-serif",k.textBaseline="top",k.fillStyle=o,k.fillRect(0,0,T,L),k.fillStyle=r,k.fillText(n,Z,w),k.fillRect(O,A,C,V),k.fillStyle=o,k.globalAlpha=.9,k.fillRect(O,A,C,V),{dom:H,update:function(b,P){f=Math.min(f,b),u=Math.max(u,b),k.fillStyle=o,k.globalAlpha=1,k.fillRect(0,0,T,A),k.fillStyle=r,k.fillText(p(b)+" "+n+" ("+p(f)+"-"+p(u)+")",Z,w),k.drawImage(H,O+d,A,C-d,V,O,A,C-d,V),k.fillRect(O+C-d,A,d,V),k.fillStyle=o,k.globalAlpha=.9,k.fillRect(O+C-d,A,d,p((1-b/P)*V))}}},i})}(nn)),nn.exports}ro();const Dn=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},Lt=e=>Dn(e,"error"),ao=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,hi=()=>({action:()=>{},after:()=>{},before:()=>{}}),St={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},oo={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){Lt(St.INVALID_VALUE_NUMBER);return}this[i]=n}else Lt(St.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,r,o,f){r&&o%2===f?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&o%2===f&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let r=0;r<this.buttons;r++)i.buttons[r].pressed===!0?(this.pressed[`button${r}`]||(this.pressed[`button${r}`]=!0,this.buttonActions[r].before()),this.buttonActions[r].action()):this.pressed[`button${r}`]&&(delete this.pressed[`button${r}`],this.buttonActions[r].after());if(i.axes){const r=i.axes.length%2;for(let o=0;o<this.axes*2;o++){const f=i.axes[o+r].toFixed(4),u=Math.floor(o/2);this.axeValues[u][o%2]=f,this.triggerDirectionalAction("right",u,f>=this.axeThreshold[0],o,0),this.triggerDirectionalAction("left",u,f<=-this.axeThreshold[0],o,0),this.triggerDirectionalAction("down",u,f>=this.axeThreshold[0],o,1),this.triggerDirectionalAction("up",u,f<=-this.axeThreshold[0],o,1)}}}},associateEvent:function(i,n,r){if(i.match(/^button\d+$/)){const o=parseInt(i.match(/^button(\d+)$/)[1]);o>=0&&o<this.buttons?this.buttonActions[o][r]=n:Lt(St.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][r]=n;else if(i==="select")this.buttonActions[8][r]=n;else if(i==="r1")this.buttonActions[5][r]=n;else if(i==="r2")this.buttonActions[7][r]=n;else if(i==="l1")this.buttonActions[4][r]=n;else if(i==="l2")this.buttonActions[6][r]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][r]=n:Lt(St.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const o=i.match(/^(up|down|left|right)(\d+)$/),f=o[1],u=parseInt(o[2]);u>=0&&u<this.axes?this.axesActions[u][f][r]=n:Lt(St.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const o=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][o][r]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=hi();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:hi(),left:hi(),right:hi(),up:hi()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},$t={gamepads:{},axeThreshold:[1],isReady:ao(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){Lt(St.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const n=this.getGamepads(),r=Object.keys(n);for(let o=0;o<r.length;o++)n[r[o]].set("axeThreshold",this.axeThreshold)}}else Lt(St.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys($t.gamepads);$t.onBeforeCycle();for(let i=0;i<t.length;i++)$t.gamepads[t[i]].checkStatus();$t.onAfterCycle(),t.length>0&&e($t.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Dn(St.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=oo.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Dn(St.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:Lt(St.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:Lt(St.UNKNOWN_EVENT);break}return this}};$t.init();const rn=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},so=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return co(Math.atan2(n,i))},lo=(e,t,i)=>{const n={x:0,y:0};return i=Fn(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n},Fn=e=>e*(Math.PI/180),co=e=>e*(180/Math.PI),uo=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,mn=new Map,hr=e=>{mn.has(e)&&clearTimeout(mn.get(e)),mn.set(e,setTimeout(e,100))},an=(e,t,i)=>{const n=t.split(/[ ,]+/g);let r;for(let o=0;o<n.length;o+=1)r=n[o],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent&&e.attachEvent(r,i)},dr=(e,t,i)=>{const n=t.split(/[ ,]+/g);let r;for(let o=0;o<n.length;o+=1)r=n[o],e.removeEventListener?e.removeEventListener(r,i):e.detachEvent&&e.detachEvent(r,i)},pa=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),pr=()=>{const e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},gr=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},jn=(e,t,i)=>{const n=ga(e);for(let r in n)if(n.hasOwnProperty(r))if(typeof t=="string")n[r]=t+" "+i;else{let o="";for(let f=0,u=t.length;f<u;f+=1)o+=t[f]+" "+i+", ";n[r]=o.slice(0,-2)}return n},fo=(e,t)=>{const i=ga(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},ga=e=>{const t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},yn=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},ho=(e,t)=>{const i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},Bn=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},po=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});var go="ontouchstart"in window,_o=!!window.PointerEvent,mo=!!window.MSPointerEvent,di={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},oi,Fi={};_o?oi=di.pointer:mo?oi=di.MSPointer:go?(oi=di.touch,Fi=di.mouse):oi=di.mouse;function Nt(){}Nt.prototype.on=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)r=n[o],i._handlers_[r]=i._handlers_[r]||[],i._handlers_[r].push(t);return i};Nt.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Nt.prototype.trigger=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)r=n[o],i._handlers_[r]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(f){f.call(i,{type:r,target:i},t)})};Nt.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=ho(t.options,e))};Nt.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},an(e,oi[t],i._domHandlers_[t]),Fi[t]&&an(e,Fi[t],i._domHandlers_[t]),i};Nt.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},dr(e,oi[t],i._domHandlers_[t]),Fi[t]&&dr(e,Fi[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};function at(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=at.id,at.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}at.prototype=new Nt;at.constructor=at;at.id=0;at.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};at.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=fo("borderRadius","50%"),i=jn("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},yn(n.el,i),this.options.shape==="circle"&&yn(n.back,t),yn(n.front,t),this.applyStyles(n),this};at.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};at.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};at.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};at.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};at.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};at.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const i=t.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t};at.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=jn("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(r),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};at.prototype.restCallback=function(){var e=this,t={};t.front=jn("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};at.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};at.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,n=Math.PI/2,r,o,f;if(t>i&&t<i*3&&!e.lockX?r="up":t>-i&&t<=i&&!e.lockY?r="left":t>-i*3&&t<=-i&&!e.lockX?r="down":e.lockY||(r="right"),e.lockY||(t>-n&&t<n?o="left":o="right"),e.lockX||(t>0?f="up":f="down"),e.force>this.options.threshold){var u={},p;for(p in this.direction)this.direction.hasOwnProperty(p)&&(u[p]=this.direction[p]);var d={};this.direction={x:o,y:f,angle:r},e.direction=this.direction;for(p in u)u[p]===this.direction[p]&&(d[p]=!0);if(d.x&&d.y&&d.angle)return e;(!d.x||!d.y)&&this.trigger("plain",e),d.x||this.trigger("plain:"+o,e),d.y||this.trigger("plain:"+f,e),d.angle||this.trigger("dir dir:"+r,e)}else this.resetDirection();return e};function tt(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=tt.id,tt.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}tt.prototype=new Nt;tt.constructor=tt;tt.id=0;tt.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===i)return t[n];return!1}};tt.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};tt.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};tt.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},o=i.options,f={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(e.x&&e.y)r={x:e.x-f.x,y:e.y-f.y};else if(e.top||e.right||e.bottom||e.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=e.top,u.style.right=e.right,u.style.bottom=e.bottom,u.style.left=e.left,u.style.position="absolute",o.zone.appendChild(u);var p=u.getBoundingClientRect();o.zone.removeChild(u),r=e,e={x:p.left+n.x,y:p.top+n.y}}var d=new at(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(gr(d.ui.el,r),gr(d.ui.front,d.frontPosition)),i.nipples.push(d),i.trigger("added "+d.identifier+":added",d),i.manager.trigger("added "+d.identifier+":added",d),i.bindNipple(d),d};tt.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};tt.prototype.bindNipple=function(e){var t=this,i,n=function(r,o){i=r.type+" "+o.id+":"+r.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};tt.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=e.force||e.pressure||e.webkitForce||0;o!==r&&(t.trigger("pressure",o),n.trigger("pressure "+t.identifier+":pressure",o),r=o)}).bind(n),100)};tt.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=pa(e),t.updateBox();var r=function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(f){if(Object.values(n.touches).findIndex(function(p){return p.identifier===f})<0){var u=[e[0]];u.identifier=f,t.processOnEnd(u)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))};return Bn(e,r),t.manager.bindDocument(),!1};tt.prototype.processOnStart=function(e){var t=this,i=t.options,n,r=t.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,f={x:e.pageX,y:e.pageY},u=t.getOrCreate(r,f);u.identifier!==r&&t.manager.removeIdentifier(u.identifier),u.identifier=r;var p=function(T){T.trigger("start",T),t.trigger("start "+T.id+":start",T),T.show(),o>0&&t.pressureFn(e,T,T.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(u))>=0&&t.idles.splice(n,1),t.actives.push(u),t.ids.push(u.identifier),i.mode!=="semi")p(u);else{var d=rn(f,u.position);if(d<=i.catchDistance)p(u);else{u.destroy(),t.processOnStart(e);return}}return u};tt.prototype.getOrCreate=function(e,t){var i=this,n=i.options,r;return/(semi|static)/.test(n.mode)?(r=i.idles[0],r?(i.idles.splice(0,1),r):n.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(r=i.createNipple(t,e),r)};tt.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.scroll;if(!uo(e)){this.processOnEnd(e);return}if(!r){console.error("Found zombie joystick with ID "+n),t.manager.removeIdentifier(n);return}if(i.dynamicPage){var f=r.el.getBoundingClientRect();r.position={x:o.x+f.left,y:o.y+f.top}}r.identifier=n;var u=r.options.size/2,p={x:e.pageX,y:e.pageY};i.lockX&&(p.y=r.position.y),i.lockY&&(p.x=r.position.x);var d=rn(p,r.position),T=so(p,r.position),L=Fn(T),Z=d/u,w={distance:d,position:p},O,A;if(r.options.shape==="circle"?(O=Math.min(d,u),A=lo(r.position,O,T)):(A=po(p,r.position,u),O=rn(A,r.position)),i.follow){if(d>u){let k=p.x-A.x,b=p.y-A.y;r.position.x+=k,r.position.y+=b,r.el.style.top=r.position.y-(t.box.top+o.y)+"px",r.el.style.left=r.position.x-(t.box.left+o.x)+"px",d=rn(p,r.position)}}else p=A,d=O;var C=p.x-r.position.x,V=p.y-r.position.y;r.frontPosition={x:C,y:V},i.dataOnly||(r.ui.front.style.transform="translate("+C+"px,"+V+"px)");var H={identifier:r.identifier,position:p,force:Z,pressure:e.force||e.pressure||e.webkitForce||0,distance:d,angle:{radian:L,degree:T},vector:{x:C/u,y:-V/u},raw:w,instance:r,lockX:i.lockX,lockY:i.lockY};H=r.computeDirection(H),H.angle={radian:Fn(180-T),degree:180-T},r.trigger("move",H),t.trigger("move "+r.id+":move",H)};tt.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.removeIdentifier(r.identifier);r&&(i.dataOnly||r.hide(function(){i.mode==="dynamic"&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))};tt.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};tt.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};function ot(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=pr(),t.config(e),t.prepareCollections();var i=function(){var r;t.collections.forEach(function(o){o.forEach(function(f){r=f.el.getBoundingClientRect(),f.position={x:t.scroll.x+r.left,y:t.scroll.y+r.top}})})};an(window,"resize",function(){hr(i)});var n=function(){t.scroll=pr()};return an(window,"scroll",function(){hr(n)}),t.collections}ot.prototype=new Nt;ot.constructor=ot;ot.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return i=n.get(t),!i}),i}};ot.prototype.create=function(e){return this.createCollection(e)};ot.prototype.createCollection=function(e){var t=this,i=new tt(t,e);return t.bindCollection(i),t.collections.push(i),i};ot.prototype.bindCollection=function(e){var t=this,i,n=function(r,o){i=r.type+" "+o.id+":"+r.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};ot.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};ot.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};ot.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};ot.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};ot.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};ot.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};ot.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};ot.prototype.onAny=function(e,t){var i=this,n,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=pa(t);var o=function(u,p,d){d.ids.indexOf(p)>=0&&(d[r](u),u._found_=!0)},f=function(u){n=i.getIdentifier(u),Bn(i.collections,o.bind(null,u,n)),u._found_||i.removeIdentifier(n)};return Bn(t,f),!1};ot.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};ot.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};const _r=new ot,vn={create:function(e){return _r.create(e)},factory:_r},Bi="The Forgotton Adventures of Kroz",un=80,Pt=25,Dt=1,ui=un-16,jt=1,Ni=Pt-2,$e=63,Ve=22,Ft=" ",Rt=1,yo=8;var pi={},gi={},mr;function vo(){if(mr)return gi;mr=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.MiniSignal=void 0;const e=Symbol("SIGNAL");function t(n){return typeof n=="object"&&e in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...r){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let o=this._head;if(o==null)return!1;for(this._dispatching=!0;o!=null;)o.fn(...r),o=o.next;return this._dispatching=!1,!0}add(r){if(typeof r!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:r}))}detach(r){if(!t(r))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(r[e]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const o=this._refMap.get(r);return o?(this._refMap.delete(r),this._disconnectNode(o),this._destroyNode(o),this):this}detachAll(){let r=this._head;if(r==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;r!=null;)this._destroyNode(r),r=r.next;return this}_destroyNode(r){r.fn=void 0,r.prev=void 0}_disconnectNode(r){r===this._head?(this._head=r.next,r.next==null&&(this._tail=void 0)):r===this._tail&&(this._tail=r.prev,this._tail!=null&&(this._tail.next=void 0)),r.prev!=null&&(r.prev.next=r.next),r.next!=null&&(r.next.prev=r.prev)}_addNode(r){return this._head==null?(this._head=r,this._tail=r):(this._tail.next=r,r.prev=this._tail,this._tail=r),r}_createRef(r){const o={[e]:this._symbol};return this._refMap.set(o,r),o}_getRef(r){return this._refMap.get(r)}}return gi.MiniSignal=i,gi}var yr;function wo(){return yr||(yr=1,function(e){var t=pi.__createBinding||(Object.create?function(n,r,o,f){f===void 0&&(f=o);var u=Object.getOwnPropertyDescriptor(r,o);(!u||("get"in u?!r.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(n,f,u)}:function(n,r,o,f){f===void 0&&(f=o),n[f]=r[o]}),i=pi.__exportStar||function(n,r){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&t(r,n,o)};Object.defineProperty(e,"__esModule",{value:!0}),i(vo(),e)}(pi)),pi}var Xn=wo();function Ce(e=0){return new Promise(t=>{setTimeout(()=>t(),e)})}function vr(e,t,i){return Math.min(Math.max(e,t),i)}const bo={145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,159:402};function xo(e){const t=bo[e]||e;return String.fromCharCode(t)}function on(e){if(Array.isArray(e)){const t={};for(const i of e)t[i.name]=i.value;return t}return e}const Nn=new Xn.MiniSignal,Mt=new Xn.MiniSignal,Ct=new Xn.MiniSignal;let ni=null;var Xe=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.NextLevelCheat=12]="NextLevelCheat",e[e.PrevLevel=13]="PrevLevel",e[e.Teleport=14]="Teleport",e[e.ResetFound=15]="ResetFound",e[e.HideFound=16]="HideFound",e[e.Pause=17]="Pause",e[e.Quit=18]="Quit",e[e.Save=19]="Save",e[e.Restore=20]="Restore",e[e.SlowerClock=21]="SlowerClock",e[e.FasterClock=22]="FasterClock",e))(Xe||{});const At={},ht={},fn={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:14,T:14,")":10,"+":15,"-":16,"(":12,PageDown:null,PageUp:null,p:17,P:17,Escape:18,s:19,S:19,r:20,R:20,F11:21,F12:22},yt={button0:"w",button1:"t",button2:"s",button3:"r",button4:null,button5:null,button6:"F11",button7:"F12",button8:"s",button9:"p",button16:"Escape",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",button12:"ArrowUp",button13:"ArrowDown",button14:"ArrowLeft",button15:"ArrowRight"};function To(){ni||$t.on("connect",e=>{if(!ni){ni=e,ni.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(yt))i&&(ni.before(t,()=>Mt.dispatch(i)),ni.after(t,()=>Ct.dispatch(i)))}})}let wn=null,bn=null,xn=null;const So="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;function ko(){wn||!So||(document.querySelectorAll(".touch_zone").forEach(e=>{e.style.display="block"}),wn=vn.create({zone:document.querySelector(".touch_zone--axis"),mode:"dynamic",threshold:.5,dynamicPage:!0,position:{left:"50px",bottom:"50px"},restOpacity:.3}),wn.on("move end",(e,t)=>{if(t.force<.5)return;const i=.3,{x:n,y:r}=t.vector||{x:0,y:0};n>i&&!Xi(3)?Mt.dispatch(yt.right):n<-i&&!Xi(4)?Mt.dispatch(yt.left):Math.abs(n)<=i&&(Ct.dispatch(yt.right),Ct.dispatch(yt.left)),r>i&&!Xi(1)?Mt.dispatch(yt.up):r<-i&&!Xi(2)?Mt.dispatch(yt.down):Math.abs(r)<=i&&(Ct.dispatch(yt.up),Ct.dispatch(yt.down))}),bn=vn.create({zone:document.querySelector(".touch_zone--button-0"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{left:"50px",bottom:"50px"}}),bn.on("start",()=>Mt.dispatch(yt.button0)),bn.on("end",()=>Ct.dispatch(yt.button0)),xn=vn.create({zone:document.querySelector(".touch_zone--button-1"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{right:"50px",top:"50px"}}),xn.on("start",()=>Mt.dispatch(yt.button1)),xn.on("end",()=>Ct.dispatch(yt.button1)))}function Eo(e){e.repeat||(fn[e.key]&&e.preventDefault(),Mt.dispatch(e.key))}function Oo(e){fn[e.key]&&e.preventDefault(),Ct.dispatch(e.key)}Mt.add(e=>{At[e]=3;const t=fn[e];t&&(ht[t]=3)});Ct.add(e=>{(At[e]||0)&3&&Nn.dispatch(e),At[e]&=-2,At[e]|=4;const t=fn[e];t&&(ht[t]&=-2,ht[t]|=4)});function Ro(){To(),ko(),window.addEventListener("keydown",Eo),window.addEventListener("keyup",Oo)}function ji(){for(const e in At)At[e]&&(At[e]=0)}function Kn(){for(const e in ht)Object.prototype.hasOwnProperty.call(ht,e)&&delete ht[e];for(const e in At)Object.prototype.hasOwnProperty.call(At,e)&&delete At[e]}function _a(){for(const e in ht){const t=e;if(!ht[t])continue;const i=!!(ht[t]&2);ht[t]&=-15,i&&(ht[t]|=8)}}function Xi(e){return!!(ht[e]&1)}function Ot(e){return!!(ht[e]&3)&&!(ht[e]&8)}function wt(e){return!!(ht[e]&4)}async function si(){return Kn(),new Promise(e=>{const t=Nn.add(i=>{Nn.detach(t),e(i)})})}async function Vn(e,t=50){const i=si();do await(e==null?void 0:e());while(!await Promise.race([i,Ce(t)]));return i}class Jn{getContainer(){return null}setOptions(t){this._options=t}}class Qn extends Jn{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const n=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let n=this._ctx.canvas,r=n.getBoundingClientRect();return t-=r.left,i-=r.top,t*=n.width/r.width,i*=n.height/r.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function hn(e,t){return(e%t+t)%t}class ma extends Qn{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[n,r,o,f,u]=t,p=[(n+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&p.reverse(),i&&(this._ctx.fillStyle=u,this._fill(p[0],p[1])),!o)return;this._ctx.fillStyle=f;let d=[].concat(o);for(let T=0;T<d.length;T++)this._ctx.fillText(d[T],p[0],Math.ceil(p[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=Math.floor(t/this._spacingX)-1,r=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,r]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,r=i/(2+1.5*(this._options.height-1)),o=Math.min(n,r),f=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let u=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=f;let p=u/100;o=Math.floor(o)+1;let d=2*o/(this._options.spacing*(1+p/Math.sqrt(3)));return Math.ceil(d)-1}_normalizedEventToPosition(t,i){let n;this._options.transpose?(t+=i,i=t-i,t-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let r=n/this._options.height;return i=Math.floor(i/r),hn(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let n=this._hexSize,r=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-n+r,i),o.lineTo(t-n/2+r,i+this._spacingX-r),o.lineTo(t+n/2-r,i+this._spacingX-r),o.lineTo(t+n-r,i),o.lineTo(t+n/2-r,i-this._spacingX+r),o.lineTo(t-n/2+r,i-this._spacingX+r),o.lineTo(t-n+r,i)):(o.moveTo(t,i-n+r),o.lineTo(t+this._spacingX-r,i-n/2+r),o.lineTo(t+this._spacingX-r,i+n/2-r),o.lineTo(t,i+n-r),o.lineTo(t-this._spacingX+r,i+n/2-r),o.lineTo(t-this._spacingX+r,i-n/2+r),o.lineTo(t,i-n+r)),o.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,r;t.transpose?(n="height",r="width"):(n="width",r="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class Hi extends Qn{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){Hi.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,n,r,o,f]=t,u=""+r+o+f,p;if(u in this._canvasCache)p=this._canvasCache[u];else{let d=this._options.border;p=document.createElement("canvas");let T=p.getContext("2d");if(p.width=this._spacingX,p.height=this._spacingY,T.fillStyle=f,T.fillRect(d,d,p.width-d,p.height-d),r){T.fillStyle=o,T.font=this._ctx.font,T.textAlign="center",T.textBaseline="middle";let L=[].concat(r);for(let Z=0;Z<L.length;Z++)T.fillText(L[Z],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[u]=p}this._ctx.drawImage(p,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,i){let[n,r,o,f,u]=t;if(i){let d=this._options.border;this._ctx.fillStyle=u,this._ctx.fillRect(n*this._spacingX+d,r*this._spacingY+d,this._spacingX-d,this._spacingY-d)}if(!o)return;this._ctx.fillStyle=f;let p=[].concat(o);for(let d=0;d<p.length;d++)this._ctx.fillText(p[d],(n+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(t,i){let n=Math.floor(t/this._spacingX),r=Math.floor(i/this._spacingY);return[n,r]}computeFontSize(t,i){let n=Math.floor(t/this._options.width),r=Math.floor(i/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let f=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let p=f/100*r/n;return p>1&&(r=Math.floor(r/p)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}Hi.cache=!1;class ya extends Qn{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[n,r,o,f,u]=t,p=this._options.tileWidth,d=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*p,r*d,p,d):(this._ctx.fillStyle=u,this._ctx.fillRect(n*p,r*d,p,d))),!o)return;let T=[].concat(o),L=[].concat(f),Z=[].concat(u);for(let w=0;w<T.length;w++){let O=this._options.tileMap[T[w]];if(!O)throw new Error(`Char "${T[w]}" not found in tileMap`);if(this._options.tileColorize){let A=this._colorCanvas,C=A.getContext("2d");C.globalCompositeOperation="source-over",C.clearRect(0,0,p,d);let V=L[w],H=Z[w];C.drawImage(this._options.tileSet,O[0],O[1],p,d,0,0,p,d),V!="transparent"&&(C.fillStyle=V,C.globalCompositeOperation="source-atop",C.fillRect(0,0,p,d)),H!="transparent"&&(C.fillStyle=H,C.globalCompositeOperation="destination-over",C.fillRect(0,0,p,d)),this._ctx.drawImage(A,n*p,r*d,p,d)}else this._ctx.drawImage(this._options.tileSet,O[0],O[1],p,d,n*p,r*d,p,d)}}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}const Ki=23283064365386963e-26;class er{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*Ki,t=t*69069+1>>>0,this._s1=t*Ki,t=t*69069+1>>>0,this._s2=t*Ki,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*Ki;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let n=Math.max(t,i),r=Math.min(t,i);return Math.floor(this.getUniform()*(n-r+1))+r}getNormal(t=0,i=1){let n,r,o;do n=2*this.getUniform()-1,r=2*this.getUniform()-1,o=n*n+r*r;while(o>1||o==0);let f=n*Math.sqrt(-2*Math.log(o)/o);return t+f*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],n=t.slice();for(;n.length;){let r=n.indexOf(this.getItem(n));i.push(n.splice(r,1)[0])}return i}getWeightedValue(t){let i=0;for(let f in t)i+=t[f];let n=this.getUniform()*i,r,o=0;for(r in t)if(o+=t[r],n<o)return r;return r}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new er().setState(this.getState())}}const Q=new er().setSeed(Date.now());function va(e){let t,i;if(e in Tn)t=Tn[e];else{if(e.charAt(0)=="#"){let r=(e.match(/[0-9a-f]/gi)||[]).map(o=>parseInt(o,16));if(r.length==3)t=r.map(o=>o*17);else{for(let o=0;o<3;o++)r[o+1]+=16*r[o],r.splice(o,1);t=r}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):t=[0,0,0];Tn[e]=t}return t.slice()}const Tn={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class wa extends Jn{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const n=this._gl,r=this._options;let[o,f,u,p,d]=t,T=n.canvas.height-(f+1)*r.tileHeight;if(n.scissor(o*r.tileWidth,T,r.tileWidth,r.tileHeight),i&&(r.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...Vi(d)),n.clear(n.COLOR_BUFFER_BIT)),!u)return;let L=[].concat(u),Z=[].concat(d),w=[].concat(p);n.uniform2fv(this._uniforms.targetPosRel,[o,f]);for(let O=0;O<L.length;O++){let A=this._options.tileMap[L[O]];if(!A)throw new Error(`Char "${L[O]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,A),r.tileColorize&&(n.uniform4fv(this._uniforms.tint,Vi(w[O])),n.uniform4fv(this._uniforms.bg,Vi(Z[O]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...Vi(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let n=this._gl.canvas,r=n.getBoundingClientRect();return t-=r.left,i-=r.top,t*=n.width/r.width,i*=n.height/r.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=Co(t,Io,Mo);return t.useProgram(i),Lo(t),Ao.forEach(n=>this._uniforms[n]=t.getUniformLocation(i,n)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){Po(this._gl,t)}}const Ao=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],Io=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),Mo=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function Co(e,t,i){const n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"");const r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r)||"");const o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o)||"");return o}function Lo(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function Po(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let Sn={};function Vi(e){if(!(e in Sn)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=va(e).map(i=>i/255),t.push(1);Sn[e]=t}return Sn[e]}function zo(e){return`\x1B[0;48;5;${Un(e)}m\x1B[2J`}function Do(e,t){return`\x1B[0;38;5;${Un(e)};48;5;${Un(t)}m`}function Fo(e,t){return`\x1B[${t+1};${e+1}H`}function Un(e){const n=.0234375;let r=va(e),o=Math.floor(r[0]*n),f=Math.floor(r[1]*n),u=Math.floor(r[2]*n);return o*36+f*6+u*1+16}class ba extends Jn{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],n=this.computeSize();this._offset=n.map((r,o)=>Math.floor((r-i[o])/2))}clear(){process.stdout.write(zo(this._options.bg))}draw(t,i){let[n,r,o,f,u]=t,p=this._offset[0]+n,d=this._offset[1]+r,T=this.computeSize();if(p<0||p>=T[0]||d<0||d>=T[1]||((p!==this._cursor[0]||d!==this._cursor[1])&&(process.stdout.write(Fo(p,d)),this._cursor[0]=p,this._cursor[1]=d),i&&(o||(o=" ")),!o))return;let L=Do(f,u);if(L!==this._lastColor&&(process.stdout.write(L),this._lastColor=L),o!="	"){let Z=[].concat(o);process.stdout.write(Z[0])}this._cursor[0]++,this._cursor[0]>=T[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const Bo=/%([bc]){([^}]*)}/g,fi=0,zi=1,xa=2,Ta=3;function No(e,t){let i=[],n=0;e.replace(Bo,function(o,f,u,p){let d=e.substring(n,p);return d.length&&i.push({type:fi,value:d}),i.push({type:f=="c"?xa:Ta,value:u.trim()}),n=p+o.length,""});let r=e.substring(n);return r.length&&i.push({type:fi,value:r}),Uo(i,t)}function Uo(e,t){t||(t=1/0);let i=0,n=0,r=-1;for(;i<e.length;){let f=e[i];if(f.type==zi&&(n=0,r=-1),f.type!=fi){i++;continue}for(;n==0&&f.value.charAt(0)==" ";)f.value=f.value.substring(1);let u=f.value.indexOf(`
`);if(u!=-1){f.value=Ji(e,i,u,!0);let p=f.value.split("");for(;p.length&&p[p.length-1]==" ";)p.pop();f.value=p.join("")}if(!f.value.length){e.splice(i,1);continue}if(n+f.value.length>t){let p=-1;for(;;){let d=f.value.indexOf(" ",p+1);if(d==-1||n+d>t)break;p=d}if(p!=-1)f.value=Ji(e,i,p,!0);else if(r!=-1){let d=e[r],T=d.value.lastIndexOf(" ");d.value=Ji(e,r,T,!0),i=r}else f.value=Ji(e,i,t-n,!1)}else n+=f.value.length,f.value.indexOf(" ")!=-1&&(r=i);i++}e.push({type:zi});let o=null;for(let f=0;f<e.length;f++){let u=e[f];switch(u.type){case fi:o=u;break;case zi:if(o){let p=o.value.split("");for(;p.length&&p[p.length-1]==" ";)p.pop();o.value=p.join("")}o=null;break}}return e.pop(),e}function Ji(e,t,i,n){let r={type:zi},o={type:fi,value:e[t].value.substring(i+(n?1:0))};return e.splice(t+1,0,r,o),e[t].value.substring(0,i)}let Wo=80,Go=25;const Ho={hex:ma,rect:Hi,tile:ya,"tile-gl":wa,term:ba},Yo={width:Wo,height:Go,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class Xt{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},Yo,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,n){let r=[this._options.bg,this._options.fg];this.draw(t,i,null,null,r[n%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=Ho[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let n=Math.floor(t/this._options.width),r=Math.floor(i/this._options.height);return[n,r]}eventToPosition(t){let i,n;return"touches"in t?(i=t.touches[0].clientX,n=t.touches[0].clientY):(i=t.clientX,n=t.clientY),this._backend.eventToPosition(i,n)}draw(t,i,n,r,o){r||(r=this._options.fg),o||(o=this._options.bg);let f=`${t},${i}`;this._data[f]=[t,i,n,r,o],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[f]=!0)}drawOver(t,i,n,r,o){const f=`${t},${i}`,u=this._data[f];u?(u[2]=n||u[2],u[3]=r||u[3],u[4]=o||u[4]):this.draw(t,i,n,r,o)}drawText(t,i,n,r){let o=null,f=null,u=t,p=i,d=1;r||(r=this._options.width-t);let T=No(n,r);for(;T.length;){let L=T.shift();switch(L.type){case fi:let Z=!1,w=!1,O=!1,A=!1;for(let C=0;C<L.value.length;C++){let V=L.value.charCodeAt(C),H=L.value.charAt(C);if(this._options.layout==="term"){let k=V>>8;if(k===17||k>=46&&k<=159||k>=172&&k<=215||V>=43360&&V<=43391){this.draw(u+0,p,H,o,f),this.draw(u+1,p,"	",o,f),u+=2;continue}}O=V>65280&&V<65377||V>65500&&V<65512||V>65518,Z=H.charCodeAt(0)==32||H.charCodeAt(0)==12288,A&&!O&&!Z&&u++,O&&!w&&u++,this.draw(u++,p,H,o,f),w=Z,A=O}break;case xa:o=L.value||null;break;case Ta:f=L.value||null;break;case zi:u=t,p++,d++;break}}return d}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let n=this._data[t];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}Xt.Rect=Hi;Xt.Hex=ma;Xt.Tile=ya;Xt.TileGL=wa;Xt.Term=ba;var z=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(z||{});const Et={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};let rt;function qo(){Xt.Rect.cache=!0,rt=new Xt({width:un,height:Pt,fontFamily:"IBM_VGA, monospace",bg:Et[z.Black],fg:Et[z.White],fontSize:64});const e=rt.drawOver;rt.drawOver=function(t,i,n,r,o){e.call(this,t,i,n,r,o),this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[`${t},${i}`]=!0)}}function dt(e,t,i=rt.getOptions().fg,n=rt.getOptions().bg){const r=Math.floor((un-t.length)/2);Oe(r,e,t,i,n)}function ti(e=rt.getOptions().bg){typeof e=="number"&&(e=Et[e]),rt.setOptions({bg:e}),rt.clear()}function tr(e,t=rt.getOptions().bg){return typeof e=="number"&&e>15&&(e=Date.now()%500<250?e%16:t),typeof e=="number"&&(e=Et[e]),typeof t=="number"&&(t=Et[t]),[e,t]}function Wt(e,t,i,n=rt.getOptions().fg,r=rt.getOptions().bg){[n,r]=tr(n,r),rt.draw(e,t,i,n,r)}function Zo(e,t,i,n=rt.getOptions().fg,r=rt.getOptions().bg){[n,r]=tr(n,r),rt.drawOver(e,t,i,n,r)}function Oe(e,t,i,n=rt.getOptions().fg,r=rt.getOptions().bg){return typeof n=="number"&&n>15&&(n=Date.now()%500<250?n:r),typeof r=="number"&&(r=Et[r%16]),typeof n=="number"&&(n=Et[n%16]),rt.drawText(e,t,`%c{${n}}%b{${r}}`+i)}function $o(){return rt||qo(),rt.getContainer()}const dn={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((n,r)=>t.getChannelData(r).set(n)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,n=0,r=0,o=.1,f=0,u=1,p=0,d=0,T=0,L=0,Z=0,w=0,O=0,A=0,C=0,V=1,H=0,k=0,b=0){let P=Math.PI*2,q=je=>je<0?-1:1,$=this.sampleRate,ue=p*=500*P/$/$,fe=i*=(1+t*2*Math.random()-t)*P/$,Te=[],we=0,se=0,ie=0,_=1,x=0,I=0,B=0,U,te,F=2,ne=P*Math.abs(b)*2/$,ae=Math.cos(ne),Se=Math.sin(ne)/2/F,be=1+Se,le=-2*ae/be,he=(1-Se)/be,Ie=(1+q(b)*ae)/2/be,Be=-(q(b)+ae)/be,pe=Ie,ke=0,ge=0,xe=0,Re=0;for(n=n*$+9,H*=$,r*=$,o*=$,C*=$,d*=500*P/$**3,O*=P/$,T*=P/$,L*=$,Z=Z*$|0,e*=this.volume,te=n+H+r+o+C|0;ie<te;Te[ie++]=B*e)++I%(A*100|0)||(B=f?f>1?f>2?f>3?Math.sin(we*we):Math.max(Math.min(Math.tan(we),1),-1):1-(2*we/P%2+2)%2:1-4*Math.abs(Math.round(we/P)-we/P):Math.sin(we),B=(Z?1-k+k*Math.sin(P*ie/Z):1)*q(B)*Math.abs(B)**u*(ie<n?ie/n:ie<n+H?1-(ie-n)/H*(1-V):ie<n+H+r?V:ie<te-C?(te-ie-C)/o*V:0),B=C?B/2+(C>ie?0:(ie<te-C?1:(te-ie)/C)*Te[ie-C|0]/2/e):B,b&&(B=Re=pe*ke+Be*(ke=ge)+Ie*(ge=B)-he*xe-le*(xe=Re))),U=(i+=p+=d)*Math.cos(O*se++),we+=U+U*w*Math.sin(ie**5),_&&++_>L&&(i+=T,fe+=T,_=0),Z&&!(++x%Z)&&(i=fe,p=ue,_=_||1);return Te},getNote:function(e=0,t=440){return t*2**(e/12)}};dn.volume=.005;function de(e,t,i=1){return dn.play(i,0,e,0,t/1e3,0),Ce(t)}async function Kt(){for(let e=1;e<=65;e++)de(Q.getUniformInt(1e3,2e3),1);await Ce(0)}async function Wn(){for(let e=150;e>=35;e--)await de(e,1)}async function wr(){await de(400,120,5),await Ce(10),await de(700,120,5),await Ce(10)}async function ci(){for(let e=1;e<=23;e++)de(Q.getUniformInt(350,900),120);await Ce(120);for(let e=1;e<=30;e++)de(Q.getUniformInt(150,200),50)}async function jo(){for(let e=10;e<=90;e++)await de(e,15,100)}async function br(){for(let e=150;e>35;e--)await de(e,16,50)}const Xo=dn.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function ri(){dn.playSamples(Xo)}async function xr(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=Q.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)de(Q.getUniformInt(0,4e3)+3e3,16,10)}else await Ce(Q.getUniformInt(0,29))}async function Ko(){for(let e=10;e<45;e++)for(let t=1;t<13;t++)await de(e*e*t,t+1,100)}async function Vo(e){await de(200+200*e,25,100)}async function Jo(){await de(2e3,40,10)}async function Qo(){await de(Math.random()*129+30,150,100)}async function es(){await de(70,50*8,100)}async function ts(){for(let e=330;e>20;e--)de(90,10,.5)}async function is(){await de(400,50)}async function ns(){await de(130,50)}async function kn(){de(130,25),await de(90,50)}async function rs(){await de(20,10,100)}async function as(){await de(300,10,10)}async function os(){for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await de(e*e*t,t+1,100)}async function ss(){for(let e=70;e<=600;e++)de(e*2,3,10),e%10===0&&await Ce(1)}async function ls(){await de(30,10,10),await Ce(20)}async function cs(){for(let e=0;e<2500;e++)de(Q.getUniformInt(0,e),5,100),e%25===0&&await Ce()}async function us(){for(let e=2500;e>50;e--)de(Q.getUniformInt(0,e),5,100),e%25===0&&await Ce()}async function fs(){for(let e=0;e<50;e++)de(Q.getUniformInt(0,200),50,100);await Ce(50)}async function hs(){await de(Q.getUniformInt(110,1310),7,100)}async function ds(){await de(200,60,100)}async function ps(){await de(600,20)}async function gs(){await de(90,10,10)}async function _s(){for(let e=130;e>5;e--)await de(e*8,16,100)}async function ms(){for(let e=20;e<8e3;e++)de(e,1,100);await Ce(100)}async function ys(){for(let e=5;e<70;e++)de(e*8,1);await Ce(50)}class Tr{constructor(){this.heap=[],this.timestamp=0}lessThan(t,i){return t.key==i.key?t.timestamp<i.timestamp:t.key<i.key}shift(t){this.heap=this.heap.map(({key:i,value:n,timestamp:r})=>({key:i+t,value:n,timestamp:r}))}len(){return this.heap.length}push(t,i){this.timestamp+=1;const n=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:i}),this.updateUp(n)}pop(){if(this.len()==0)throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let i=0;i<this.len();i++)if(t==this.heap[i].value)return this.heap[i];return null}remove(t){let i=null;for(let n=0;n<this.len();n++)t==this.heap[n].value&&(i=n);if(i===null)return!1;if(this.len()>1){let n=this.heap.pop();return n.value!=t&&(this.heap[i]=n,this.updateDown(i)),!0}else this.heap.pop();return!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,i){const n=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=n}minNode(t){const i=t.filter(this.existNode.bind(this));let n=i[0];for(const r of i)this.lessThan(this.heap[r],this.heap[n])&&(n=r);return n}updateUp(t){if(t==0)return;const i=this.parentNode(t);this.existNode(i)&&this.lessThan(this.heap[t],this.heap[i])&&(this.swap(t,i),this.updateUp(i))}updateDown(t){const i=this.leftChildNode(t),n=this.rightChildNode(t);if(!this.existNode(i))return;const r=this.minNode([t,i,n]);r!=t&&(this.swap(t,r),this.updateDown(r))}debugPrint(){console.log(this.heap)}}class vs{constructor(){this._time=0,this._events=new Tr}getTime(){return this._time}clear(){return this._events=new Tr,this}add(t,i){this._events.push(t,i)}get(){if(!this._events.len())return null;let{key:t,value:i}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),i}getEventTime(t){const i=this._events.find(t);if(i){const{key:n}=i;return n}}remove(t){return this._events.remove(t)}}let ir=class{constructor(){this._queue=new vs,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,i){return i&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let i=this._queue.remove(t),n=this._repeat.indexOf(t);return n!=-1&&this._repeat.splice(n,1),this._current==t&&(this._current=null),i}next(){return this._current=this._queue.get(),this._current}};class ws extends ir{add(t,i){return this._queue.add(t,0),super.add(t,i)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,0),super.next()}}class bs extends ir{add(t,i,n){return this._queue.add(t,n!==void 0?n:1/t.getSpeed()),super.add(t,i)}next(){return this._current&&this._repeat.indexOf(this._current)!=-1&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}class xs extends ir{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,i,n){return this._queue.add(t,n||this._defaultDuration),super.add(t,i)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current!==null&&this._repeat.indexOf(this._current)!=-1&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}const Ts={Simple:ws,Speed:bs,Action:xs},Sa=Symbol("doesFollowsPlayer"),pn=Symbol("isPlayer"),nr=Symbol("isMobile"),ka=Symbol("isGenerator"),Vt=Symbol("isInvisible"),Ui=Symbol("isSecreted"),Ea=Symbol("isPushable");class Jt{constructor(t){it(this,"ch");it(this,"fg");it(this,"bg");this.ch=t.ch??Ft,this.fg=t.fg??nt[c.Floor][0],this.bg=t.bg??nt[c.Floor][1]}}class st{constructor(t={}){it(this,"replacement",c.Floor);it(this,"x");it(this,"y");this.x=t.x??0,this.y=t.y??0}moveTo(t,i){this.x=t,this.y=i}die(){this.x=-1,this.y=-1}isDead(){return this.x===-1||this.y===-1}}class li{constructor(t){it(this,"set");this.set=new Set(t)}by(t){return this.set.has(t)}}class Oa{constructor(t){it(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class Ra{constructor(t){it(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class Wi{constructor(t){it(this,"damage");this.damage=t.damage||1}}class Di{constructor(t){it(this,"keys",0);it(this,"gems",0);it(this,"whips",0);it(this,"teleports",0);it(this,"whipPower",0);this.keys=(t==null?void 0:t.keys)||0,this.gems=(t==null?void 0:t.gems)||0,this.whips=(t==null?void 0:t.whips)||0,this.whipPower=(t==null?void 0:t.whipPower)||0,this.teleports=(t==null?void 0:t.teleports)||0}}class sn{constructor(t){this.frames=t}getFrame(){return this.frames[Q.getUniformInt(0,this.frames.length-1)]}}class Gn{constructor(t){this.type=t}}class Aa{constructor(t){it(this,"_components",new Map);it(this,"_tags",new Set);this.type=t}add(t){return typeof t=="symbol"||typeof t=="string"?(this._tags.add(t),this):(this._components.set(t.constructor.name,t),this)}get(t){return this._components.get(t.name)}has(t){return typeof t=="symbol"||typeof t=="string"?this._tags.has(t):this._components.has(t.name)}remove(t){return typeof t=="symbol"||typeof t=="string"?this._tags.delete(t):this._components.delete(t.name)}}const Ss=16,ks={export:{format:"lua",target:""}},Es="../../tiled/ASCII.png",Os=576,Rs=384,As=0,Is="Kroz Tileset",Ms=0,Cs=256,Ls="1.11.1",Ps=36,zs=JSON.parse(`[{"id":32,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Black","ch":" ","fg":"Black"}},{"name":"name","type":"string","value":"Floor"}],"type":"0"},{"id":33,"properties":[{"name":"Message","type":"string","value":"You found an Ancient Tablet of Wisdom...2,500 points!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"■","fg":"LightBlue"}},{"name":"name","type":"string","value":"Tablet"}],"type":"42"},{"id":34,"properties":[{"name":"Message","type":"string","value":"Super Kroz Bonus -- 10,000 points!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Z","fg":"Yellow"}},{"name":"name","type":"string","value":"Z"}],"type":"51"},{"id":35,"properties":[{"name":"Message","type":"string","value":"A Solid Wall blocks your way."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"█","fg":"Brown"}},{"name":"isPushable","type":"bool","value":false},{"name":"name","type":"string","value":"Wall"}],"type":"14"},{"id":36,"properties":[{"name":"name","type":"string","value":"Trap5"}],"type":"67"},{"id":37,"properties":[{"name":"Message","type":"string","value":"A Creature Zap Spell!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"▲","fg":"LightRed"}},{"name":"description","type":"string","value":"Creature zap spell"},{"name":"name","type":"string","value":"Zap"}],"type":"34"},{"id":38,"properties":[{"name":"Message","type":"string","value":"Yah Hoo! You discovered a Reveal Gems Scroll!"},{"name":"name","type":"string","value":"ShowGems"}],"type":"41"},{"id":40,"properties":[{"name":"name","type":"string","value":"Trap4"}],"type":"39"},{"id":41,"properties":[{"name":"name","type":"string","value":"Trap3"}],"type":"37"},{"id":42,"properties":[{"name":"Collectible","propertytype":"Collectible","type":"class","value":{"score":50}},{"name":"Message","type":"string","value":"You found a Gold Nugget...500 points!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"☼","fg":"Yellow"}},{"name":"name","type":"string","value":"Nugget"}],"type":"27"},{"id":43,"properties":[{"name":"Collectible","propertytype":"Collectible","type":"class","value":{"gems":1}},{"name":"Message","type":"string","value":"Gems give you both points and strength."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"♦","fg":"Blue"}},{"name":"name","type":"string","value":"Gem"}],"type":"9"},{"id":45,"properties":[{"name":"description","type":"string","value":"Stop space"},{"name":"name","type":"string","value":"Stop"}],"type":"32"},{"id":46,"properties":[{"name":"Message","type":"string","value":"You activated a Teleport trap!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"∙","fg":"White"}},{"name":"Tile.ch","type":"string","value":"∙"},{"name":"name","type":"string","value":"Trap"}],"type":"16"},{"id":47,"properties":[{"name":"Message","type":"string","value":"You cannot travel through forest terrain."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Green","ch":"█","fg":"Green"}},{"name":"name","type":"string","value":"Forest"}],"type":"19"},{"id":48,"properties":[{"name":"Message","type":"string","value":"You pushed a big Boulder!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"O","fg":"White"}},{"name":"isPushable","type":"bool","value":true},{"name":"name","type":"string","value":"Rock"}],"type":"65"},{"id":49,"properties":[{"name":"Attacks","propertytype":"Attacks","type":"class","value":{"damage":1}},{"name":"Movement.pace","type":"int","value":4},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Ä","fg":"LightRed"}},{"name":"description","type":"string","value":"Red enemy"},{"name":"doesFollowsPlayer","type":"bool","value":true},{"name":"isMobile","type":"bool","value":true},{"name":"name","type":"string","value":"Slow"}],"type":"1"},{"id":50,"properties":[{"name":"Attacks","propertytype":"Attacks","type":"class","value":{"damage":2}},{"name":"Movement.pace","type":"int","value":3},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Ö","fg":"Green"}},{"name":"description","type":"string","value":"Green enemy"},{"name":"doesFollowsPlayer","type":"bool","value":true},{"name":"isMobile","type":"bool","value":true},{"name":"name","type":"string","value":"Medium"}],"type":"2"},{"id":51,"properties":[{"name":"Attacks","propertytype":"Attacks","type":"class","value":{"damage":3}},{"name":"Movement.pace","type":"int","value":2},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Ω","fg":"LightBlue"}},{"name":"description","type":"string","value":"Blue enemy"},{"name":"doesFollowsPlayer","type":"bool","value":true},{"name":"isMobile","type":"bool","value":true},{"name":"name","type":"string","value":"Fast"}],"type":"3"},{"id":52,"properties":[{"name":"Message","type":"string","value":"A Solid Wall blocks your way."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"█","fg":"Brown"}},{"name":"name","type":"string","value":"OWall1"}],"type":"52"},{"id":53,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"█","fg":"Brown"}},{"name":"name","type":"string","value":"OWall2"}],"type":"53"},{"id":54,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"White","ch":"█","fg":"White"}},{"name":"name","type":"string","value":"OWall3"}],"type":"54"},{"id":55,"properties":[{"name":"name","type":"string","value":"CWall1"}],"type":"55"},{"id":56,"properties":[{"name":"name","type":"string","value":"CWall2"}],"type":"56"},{"id":57,"properties":[{"name":"name","type":"string","value":"CWall3"}],"type":"57"},{"id":58,"properties":[{"name":"name","type":"string","value":"IWall"}],"type":"30"},{"id":59,"properties":[{"name":"Message","type":"string","value":"An Invisible Crumbled Wall blocks your way."},{"name":"name","type":"string","value":"IBlock"}],"type":"29"},{"id":60,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"K","fg":"Yellow"}},{"name":"name","type":"string","value":"K"}],"type":"48"},{"id":61,"properties":[{"name":"Message","type":"string","value":"* SPLAT!! *"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"░","fg":"White"}},{"name":"name","type":"string","value":"Pit"}],"type":"23"},{"id":62,"properties":[{"name":"Message","type":"string","value":"Statues are very dangerous...they drain your Gems!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"☺","fg":"HighIntensityWhite"}},{"name":"name","type":"string","value":"Statue"}],"type":"46"},{"id":63,"properties":[{"name":"Message","type":"string","value":"You found a Pouch containing Gems!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"?","fg":"HighIntensityWhite"}},{"name":"name","type":"string","value":"Chance"}],"type":"45"},{"id":64,"properties":[{"name":"name","type":"string","value":"Trap2"}],"type":"33"},{"id":65,"properties":[{"name":"Message","type":"string","value":"The Sacred Tome of Kroz is finally yours--50,000 points!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Magenta","ch":"■","fg":"Blue"}},{"name":"name","type":"string","value":"Tome"}],"type":"24"},{"id":66,"properties":[{"name":"ChanceOdds","type":"int","value":40},{"name":"Message","type":"string","value":"You activated a Magic Bomb!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"¥","fg":"HighIntensityWhite"}},{"name":"name","type":"string","value":"Bomb"}],"type":"21"},{"id":67,"properties":[{"name":"ChanceOdds","type":"int","value":20},{"name":"Message","type":"string","value":"You found gems and whips inside the chest!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Red","ch":"C","fg":"Yellow"}},{"name":"name","type":"string","value":"Chest"}],"type":"7"},{"id":68,"properties":[{"name":"Message","type":"string","value":"The Door opens!  (One of your Keys is used.)"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Magenta","ch":"∞","fg":"Cyan"}},{"name":"name","type":"string","value":"Door"}],"type":"13"},{"id":69,"properties":[{"name":"ChanceOdds","type":"int","value":15},{"name":"Message","type":"string","value":"Oh no, you set off an Earthquake trap!"},{"name":"name","type":"string","value":"Quake"}],"type":"28"},{"id":70,"properties":[{"name":"Message","type":"string","value":"You activated a Speed Creature spell."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Θ","fg":"LightCyan"}},{"name":"description","type":"string","value":"Speed time spell"},{"name":"name","type":"string","value":"SpeedTime"}],"type":"15"},{"id":71,"properties":[{"name":"Message","type":"string","value":"You have discovered a Creature Generator!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"♠","fg":"Yellow"}},{"name":"isGenerator","type":"bool","value":true},{"name":"name","type":"string","value":"Generator"}],"type":"36"},{"id":72,"properties":[{"name":"Message","type":"string","value":"You triggered Exploding Walls!"},{"name":"name","type":"string","value":"BlockSpell"}],"type":"44"},{"id":73,"properties":[{"name":"Message","type":"string","value":"Oh no, a temporary Blindness Potion!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"¡","fg":"Green"}},{"name":"name","type":"string","value":"Invisible"}],"type":"10"},{"id":75,"properties":[{"name":"ChanceOdds","type":"int","value":25},{"name":"Collectible","propertytype":"Collectible","type":"class","value":{"keys":1}},{"name":"Message","type":"string","value":"Use Keys to unlock doors."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"î","fg":"LightRed"}},{"name":"name","type":"string","value":"Key"}],"type":"12"},{"id":76,"properties":[{"name":"Message","type":"string","value":"Stairs take you to the next lower level."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"White","ch":"≡"}},{"name":"name","type":"string","value":"Stairs"}],"type":"6"},{"id":77,"properties":[{"name":"Message","type":"string","value":"A Moving Wall blocks your way."},{"name":"Movement.pace","type":"int","value":2},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"▓","fg":"Brown"}},{"name":"description","type":"string","value":"Moving wall"},{"name":"doesFollowsPlayer","type":"bool","value":true},{"name":"isMobile","type":"bool","value":true},{"name":"name","type":"string","value":"MBlock"}],"type":"38"},{"id":78,"properties":[{"name":"ChanceOdds","type":"int","value":20},{"name":"Message","type":"string","value":"Yikes!  A trap has made many of the wall sections invisible!"},{"name":"name","type":"string","value":"WallVanish"}],"type":"47"},{"id":79,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"▓","fg":"Brown"}},{"name":"name","type":"string","value":"ZBlock"}],"type":"43"},{"id":80,"properties":[{"name":"Movement.pace","type":"int","value":1},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"☻","fg":"Yellow"}},{"name":"description","type":"string","value":"The player"},{"name":"isPlayer","type":"bool","value":true},{"name":"name","type":"string","value":"Player"}],"type":"40"},{"id":81,"properties":[{"name":"ChanceOdds","type":"int","value":15},{"name":"Message","type":"string","value":"A Power Ring--your whip is now a little stronger!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"○","fg":"HighIntensityWhite"}},{"name":"name","type":"string","value":"Power"}],"type":"18"},{"id":82,"properties":[{"name":"Message","type":"string","value":"You cannot travel through Water."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Blue","ch":"≈","fg":"LightBlue"}},{"name":"name","type":"string","value":"River"}],"type":"17"},{"id":83,"properties":[{"name":"ChanceOdds","type":"int","value":35},{"name":"Message","type":"string","value":"You activated a Slow Time spell."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"Φ","fg":"LightCyan"}},{"name":"description","type":"string","value":"Slow time spell"},{"name":"name","type":"string","value":"SlowTime"}],"type":"8"},{"id":84,"properties":[{"name":"Collectible","propertytype":"Collectible","type":"class","value":{"teleports":1}},{"name":"Message","type":"string","value":"You found a Teleport scroll."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"↑","fg":"LightMagenta"}},{"name":"name","type":"string","value":"Teleport"}],"type":"11"},{"id":85,"properties":[{"name":"Message","type":"string","value":"You passed through a secret Tunnel!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"∩","fg":"HighIntensityWhite"}},{"name":"name","type":"string","value":"Tunnel"}],"type":"25"},{"id":86,"properties":[{"name":"Message","type":"string","value":"Oooooooooooooooooooh!  Lava hurts!  (Lose 10 Gems.)"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Red","ch":"▓","fg":"LightRed"}},{"name":"name","type":"string","value":"Lava"}],"type":"22"},{"id":87,"properties":[{"name":"Collectible","propertytype":"Collectible","type":"class","value":{"whips":1}},{"name":"Message","type":"string","value":"You found a Whip"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"⌠","fg":"HighIntensityWhite"}},{"name":"description","type":"string","value":"A whip"},{"name":"name","type":"string","value":"Whip"}],"type":"5"},{"id":88,"properties":[{"name":"Message","type":"string","value":"A Breakable Wall blocks your way"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"▓","fg":"Brown"}},{"name":"name","type":"string","value":"Block"}],"type":"4"},{"id":89,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Black","ch":"▓","fg":"White"}},{"name":"name","type":"string","value":"GBlock"}],"type":"64"},{"id":90,"properties":[{"name":"Message","type":"string","value":"You have activated a Freeze Creature spell!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"ƒ","fg":"LightCyan"}},{"name":"description","type":"string","value":"Freeze time spell"},{"name":"name","type":"string","value":"Freeze"}],"type":"26"},{"id":91,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"R","fg":"Yellow"}},{"name":"name","type":"string","value":"R"}],"type":"49"},{"id":92,"properties":[{"name":"Message","type":"string","value":"A tree blocks your way."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Green","ch":"♣","fg":"Brown"}},{"name":"name","type":"string","value":"Tree"}],"type":"20"},{"id":93,"properties":[{"name":"Message","type":"string","value":"A Creature Creation Trap!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"▼","fg":"HighIntensityWhite"}},{"name":"description","type":"string","value":"Creature creation trap"},{"name":"isSecreted","type":"bool","value":true},{"name":"name","type":"string","value":"Create"}],"type":"35"},{"id":96,"properties":[{"name":"Message","type":"string","value":"An Invisible Door blocks your way."},{"name":"name","type":"string","value":"IDoor"}],"type":"31"},{"id":124,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"O","fg":"Yellow"}},{"name":"name","type":"string","value":"O"}],"type":"50"},{"id":126,"properties":[{"name":"Message","type":"string","value":"You hit a Electrified Wall!  You lose one Gem."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Red","ch":"X","fg":"LightRed"}},{"name":"name","type":"string","value":"EWall"}],"type":"66"},{"id":145,"properties":[{"name":"name","type":"string","value":"TBlock"}],"type":"68"},{"id":146,"properties":[{"name":"name","type":"string","value":"TRock"}],"type":"69"},{"id":147,"properties":[{"name":"name","type":"string","value":"TGem"}],"type":"70"},{"id":148,"properties":[{"name":"name","type":"string","value":"TBlind"}],"type":"71"},{"id":149,"properties":[{"name":"name","type":"string","value":"TWhip"}],"type":"72"},{"id":150,"properties":[{"name":"name","type":"string","value":"TGold"}],"type":"73"},{"id":151,"properties":[{"name":"name","type":"string","value":"TTree"}],"type":"74"},{"id":159,"properties":[{"name":"Message","type":"string","value":"YOUR QUEST FOR THE AMULET WAS SUCCESSFUL!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"♀","fg":"HighIntensityWhite"}},{"name":"description","type":"string","value":"Amulet of Yendor"},{"name":"name","type":"string","value":"Amulet"}],"type":"81"},{"id":174,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"←","fg":"White"}},{"name":"name","type":"string","value":"ShootLeft"}],"type":"83"},{"id":175,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"→","fg":"White"}},{"name":"Tile.ch","type":"string","value":"→"},{"name":"name","type":"string","value":"ShootRight"}],"type":"82"},{"id":179,"properties":[{"name":"Message","type":"string","value":"You grabbed a Rope."},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"│","fg":"White"}},{"name":"name","type":"string","value":"Rope"}],"type":"75"},{"id":180,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":".","fg":"HighIntensityWhite"}}]},{"id":181,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"?","fg":"HighIntensityWhite"}}]},{"id":182,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"'","fg":"HighIntensityWhite"}}]},{"id":183,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":",","fg":"HighIntensityWhite"}}]},{"id":184,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":":","fg":"HighIntensityWhite"}}]},{"id":185,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"↓","fg":"White"}},{"name":"name","type":"string","value":"DropRope"}],"type":"76"},{"id":186,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"↓","fg":"White"}},{"name":"name","type":"string","value":"DropRope2"}],"type":"77"},{"id":187,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope3"}],"type":"78"},{"id":188,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope4"}],"type":"79"},{"id":189,"properties":[{"name":"Tile.ch","type":"string","value":"↓"},{"name":"Tile.fg","type":"string","value":"White"},{"name":"name","type":"string","value":"DropRope5"}],"type":"80"},{"id":195,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"!","fg":"HighIntensityWhite"}}]},{"id":224,"properties":[{"name":"name","type":"string","value":"Trap6"}],"type":"224"},{"id":225,"properties":[{"name":"name","type":"string","value":"Trap7"}],"type":"225"},{"id":226,"properties":[{"name":"name","type":"string","value":"Trap8"}],"type":"226"},{"id":227,"properties":[{"name":"name","type":"string","value":"Trap9"}],"type":"227"},{"id":228,"properties":[{"name":"name","type":"string","value":"Trap10"}],"type":"228"},{"id":229,"properties":[{"name":"name","type":"string","value":"Trap11"}],"type":"229"},{"id":230,"properties":[{"name":"name","type":"string","value":"Trap12"}],"type":"230"},{"id":231,"properties":[{"name":"name","type":"string","value":"Trap13"}],"type":"231"},{"id":239,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"∩","fg":"HighIntensityWhite"}}]},{"id":241,"properties":[{"name":"Message","type":"string","value":"Magic has been released is this chamber!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"⌂","fg":"LightCyan"}},{"name":"name","type":"string","value":"OSpell1"}],"type":"58"},{"id":242,"properties":[{"name":"Message","type":"string","value":"Magic has been released is this chamber!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"⌂","fg":"LightCyan"}},{"name":"name","type":"string","value":"OSpell2"}],"type":"59"},{"id":243,"properties":[{"name":"Message","type":"string","value":"Magic has been released is this chamber!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"ch":"⌂","fg":"LightCyan"}},{"name":"name","type":"string","value":"OSpell3"}],"type":"60"},{"id":244,"properties":[{"name":"Message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell1"}],"type":"61"},{"id":245,"properties":[{"name":"Message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell2"}],"type":"62"},{"id":246,"properties":[{"name":"Message","type":"string","value":"New Walls have magically appeared!"},{"name":"name","type":"string","value":"CSpell3"}],"type":"63"},{"id":249,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"∙","fg":"HighIntensityWhite"}}]},{"id":250,"properties":[{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Brown","ch":"·","fg":"HighIntensityWhite"}}]},{"id":252,"properties":[{"name":"Message","type":"string","value":"You notice a secret message carved into the old tree...\\\\n\\"Goodness of Heart Overcomes Adversity.\\"\\\\nReveal that you found this message to Scott Miller...\\\\nAnd receive a \\"MASTER KROZ CERTIFICATE\\" to hang on your wall!!\\\\nOnly the first 100 players to report this...\\\\nWill be awarded the certificate.  Congratulations!"},{"name":"Tile","propertytype":"Renderable","type":"class","value":{"bg":"Green","ch":"♣","fg":"Brown"}},{"name":"name","type":"string","value":"Message"}],"type":"252"}]`),Ds=24,Fs="tileset",Bs="1.10",Hn={columns:Ss,editorsettings:ks,image:Es,imageheight:Os,imagewidth:Rs,margin:As,name:Is,spacing:Ms,tilecount:Cs,tiledversion:Ls,tileheight:Ps,tiles:zs,tilewidth:Ds,type:Fs,version:Bs};var c=(e=>(e[e.Border=-1]="Border",e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(c||{});const Ia={[-1]:"▒",0:Ft},Ma={},Ca={},La={[-1]:[z.LightBlue,z.Black],0:[z.Black,z.Black]},Pa={[-1]:"An Electrified Wall blocks your way."};function za(){if(!Hn.tiles)throw new Error("No tiles found in tileset");for(const e of Hn.tiles){const t=e.id,i=+e.type;if(Ma[+t]=i,Ca[i]=+t,!e.properties)continue;const n=on(e.properties);if(n.name!==c[i])throw new Error("Tile ID mismatch");if("Tile"in n){const r=n.Tile;La[i]=[z[r.fg]??r.fg??null,z[r.bg]??r.bg??null],Ia[i]=r.ch??Ft}"Message"in n&&(Pa[i]=n.Message)}}za();const nt=La,Gi=Ia,Ns=Pa,rr=[3,2,1],Da=[5,9,11,7],Us=[8,10,15,26],Yi=[33,37,39,67,224,225,226,227,228,229,230,231],Fa=[16,...Yi],Ws=[29,30,31],Ba=[48,49,50,51],Gs=[52,53,54],qi=[55,56,57],Hs=[58,59,60],ar=[61,62,63],Zi=[68,69,70,71,72,73,74],Ys=[76,77,78,79,80],Sr=[...rr,4,...Ws,43,64,38,...Zi,13,...Fa,19,28,32,35,36,45,...Ba],qs=[0,...rr,...Da,...Us,...Fa,32],Zs=[0,32,...Yi,41,44,47,...qi,...ar,...Zi],$s=[0,32,...Yi,41,47,...Zi],js=[0,32,41,44,47,...qi,...ar,...Zi,...Yi],Xs=[...Da,8,10,12,16,18,21,26,27,34,35,42,45,...Ba,...Hs,...Ys,82,83],Ks=[6,23],Vs=[0,32,...Yi,...qi],Js=[4,6,13,14,22,25,31,36,38,42,43,46,...Gs,64,65,66,81],Qs=[0,17,23,28,29,30,32,33,37,39,67,41,44,47,...qi,...ar,...Zi,75];function el(e){var r,o;let t=nt[0][0],i=nt[0][1],n=Ft;return typeof e=="string"?(n=e.toLocaleUpperCase(),t=z.HighIntensityWhite,i=z.Brown):(n=Gi[e],t=((r=nt[e])==null?void 0:r[0])??nt[0][0],i=((o=nt[e])==null?void 0:o[1])??nt[0][1]),t??(t=nt[0][0]),i??(i=nt[0][1]),n??(n=Ft),{ch:n,fg:t,bg:i}}const tl=[0,68,69,70,71,73,72,74,5,7,8,9,10,11,12,15,16,18,26,27,48,49,50,51,82,83],il=[5,7,8,9,10,11,12,15,16,18,26,27,48,49,50,51,82,83],nl=[8,10,15,16,21,26,28,33,34,35,41,44,47,48,49,50,51,58,59,60,61,62,63,37,39,67,224,225,226,227,228,229,230,231,68,69,70,71,72,73,74,82,83];function rl(e){for(const t of Hn.tiles)if(t.id===e)return t}function or(e,t,i){const n=Ca[e]??0;return Yn(n,t,i)}function Yn(e,t,i,n){const r=Ma[e]??xo(e)??0,o=new Aa(r),f=rl(e);return f&&f.properties?kr(o,on(f.properties)):kr(o,n||{}),(o.has(pn)||o.has(nr))&&o.add(new st({x:t,y:i})),o}function kr(e,t){const i=e.type;if(typeof i=="string"&&e.add(new Jt(el(i))),t.isPlayer&&e.add(pn),t.isMobile&&(e.add(nr),(i===3||i===2||i===1)&&(e.add(new Oa(il)).add(new Ra([4,38,43,64])),i===1?e.add(new sn("AÄ")):i===2&&e.add(new sn("öÖ")))),t.doesFollowsPlayer&&e.add(Sa),t.isGenerator&&e.add(ka),t.isSecreted&&e.add(Ui),tl.includes(i)&&e.add(new li([3,2,1,40])),qi.includes(i)&&e.add(new li([40])),nl.includes(i)&&e.add(new Gn(i)),"ChanceOdds"in t){const n=t.ChanceOdds??0;if(n>0){const r=1/n;Math.random()<r&&e.add(Ui)}}switch(i){case 0:e.add(new li([3,2,1,38,40]));break;case 32:e.add(new li([40]));break;case 7:e.add(new Di({whips:Q.getUniformInt(2,5),gems:Q.getUniformInt(5,Ze.difficulty+2)}));break;case 45:e.add(new Di({gems:Q.getUniformInt(14,18)}));break}if("Attacks"in t&&e.add(new Wi(t.Attacks)),"Tile"in t){const n=t.Tile,r=z[n.fg]??null,o=z[n.bg]??null,f=n.ch??Ft;e.add(new Jt({fg:r,bg:o,ch:f}))}"Collectible"in t&&e.add(new Di(t.Collectible)),t.isPushable&&e.add(Ea)}function Er(e){return e?+e%256-1:0}var En={},_i={},Or;function al(){if(Or)return _i;Or=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.GridOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric"}(e||(_i.GridOrientation=e={})),_i}var ft={},mi={},Rr;function sr(){if(Rr)return mi;Rr=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.Encoding=void 0;var e;return function(t){t.CSV="csv",t.BASE64="base64"}(e||(mi.Encoding=e={})),mi}var Ar;function Na(){if(Ar)return ft;Ar=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.isGroup=ft.isImageLayer=ft.isObjectGroup=ft.isUnencodedTileLayer=ft.isEncodedTileLayer=ft.isTileLayer=void 0;const e=sr();function t(u){return u.type==="tilelayer"}ft.isTileLayer=t;function i(u){return u.type==="tilelayer"&&u.encoding!==e.Encoding.CSV}ft.isEncodedTileLayer=i;function n(u){return u.type==="tilelayer"&&(u.encoding==null||u.encoding===e.Encoding.CSV)}ft.isUnencodedTileLayer=n;function r(u){return u.type==="objectgroup"}ft.isObjectGroup=r;function o(u){return u.type==="imagelayer"}ft.isImageLayer=o;function f(u){return u.type==="group"}return ft.isGroup=f,ft}var yi={},Ir;function Ua(){if(Ir)return yi;Ir=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.Compression=void 0;var e;return function(t){t.NONE="",t.GZIP="gzip",t.ZLIB="zlib",t.ZSTD="zstd"}(e||(yi.Compression=e={})),yi}var vi={},wi={},Mr;function ol(){if(Mr)return wi;Mr=1,wi.byteLength=u,wi.toByteArray=d,wi.fromByteArray=Z;for(var e=[],t=[],i=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,o=n.length;r<o;++r)e[r]=n[r],t[n.charCodeAt(r)]=r;t[45]=62,t[95]=63;function f(w){var O=w.length;if(O%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var A=w.indexOf("=");A===-1&&(A=O);var C=A===O?0:4-A%4;return[A,C]}function u(w){var O=f(w),A=O[0],C=O[1];return(A+C)*3/4-C}function p(w,O,A){return(O+A)*3/4-A}function d(w){var O,A=f(w),C=A[0],V=A[1],H=new i(p(w,C,V)),k=0,b=V>0?C-4:C,P;for(P=0;P<b;P+=4)O=t[w.charCodeAt(P)]<<18|t[w.charCodeAt(P+1)]<<12|t[w.charCodeAt(P+2)]<<6|t[w.charCodeAt(P+3)],H[k++]=O>>16&255,H[k++]=O>>8&255,H[k++]=O&255;return V===2&&(O=t[w.charCodeAt(P)]<<2|t[w.charCodeAt(P+1)]>>4,H[k++]=O&255),V===1&&(O=t[w.charCodeAt(P)]<<10|t[w.charCodeAt(P+1)]<<4|t[w.charCodeAt(P+2)]>>2,H[k++]=O>>8&255,H[k++]=O&255),H}function T(w){return e[w>>18&63]+e[w>>12&63]+e[w>>6&63]+e[w&63]}function L(w,O,A){for(var C,V=[],H=O;H<A;H+=3)C=(w[H]<<16&16711680)+(w[H+1]<<8&65280)+(w[H+2]&255),V.push(T(C));return V.join("")}function Z(w){for(var O,A=w.length,C=A%3,V=[],H=16383,k=0,b=A-C;k<b;k+=H)V.push(L(w,k,k+H>b?b:k+H));return C===1?(O=w[A-1],V.push(e[O>>2]+e[O<<4&63]+"==")):C===2&&(O=(w[A-2]<<8)+w[A-1],V.push(e[O>>10]+e[O>>4&63]+e[O<<2&63]+"=")),V.join("")}return wi}var bi={},Cr;function sl(){if(Cr)return bi;Cr=1;var e=ArrayBuffer,t=Uint8Array,i=Uint16Array,n=Int16Array,r=Int32Array,o=function(_,x,I){if(t.prototype.slice)return t.prototype.slice.call(_,x,I);(x==null||x<0)&&(x=0),(I==null||I>_.length)&&(I=_.length);var B=new t(I-x);return B.set(_.subarray(x,I)),B},f=function(_,x,I,B){if(t.prototype.fill)return t.prototype.fill.call(_,x,I,B);for((I==null||I<0)&&(I=0),(B==null||B>_.length)&&(B=_.length);I<B;++I)_[I]=x;return _},u=function(_,x,I,B){if(t.prototype.copyWithin)return t.prototype.copyWithin.call(_,x,I,B);for((I==null||I<0)&&(I=0),(B==null||B>_.length)&&(B=_.length);I<B;)_[x++]=_[I++]};bi.ZstdErrorCode={InvalidData:0,WindowSizeTooLarge:1,InvalidBlockType:2,FSEAccuracyTooHigh:3,DistanceTooFarBack:4,UnexpectedEOF:5};var p=["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"],d=function(_,x,I){var B=new Error(x||p[_]);if(B.code=_,Error.captureStackTrace&&Error.captureStackTrace(B,d),!I)throw B;return B},T=function(_,x,I){for(var B=0,U=0;B<I;++B)U|=_[x++]<<(B<<3);return U},L=function(_,x){return(_[x]|_[x+1]<<8|_[x+2]<<16|_[x+3]<<24)>>>0},Z=function(_,x){var I=_[0]|_[1]<<8|_[2]<<16;if(I==3126568&&_[3]==253){var B=_[4],U=B>>5&1,te=B>>2&1,F=B&3,ne=B>>6;B&8&&d(0);var ae=6-U,Se=F==3?4:F,be=T(_,ae,Se);ae+=Se;var le=ne?1<<ne:U,he=T(_,ae,le)+(ne==1&&256),Ie=he;if(!U){var Be=1<<10+(_[5]>>3);Ie=Be+(Be>>3)*(_[5]&7)}Ie>2145386496&&d(1);var pe=new t((x==1?he||Ie:x?0:Ie)+12);return pe[0]=1,pe[4]=4,pe[8]=8,{b:ae+le,y:0,l:0,d:be,w:x&&x!=1?x:pe.subarray(12),e:Ie,o:new r(pe.buffer,0,3),u:he,c:te,m:Math.min(131072,Ie)}}else if((I>>4|_[3]<<20)==25481893)return L(_,4)+8;d(0)},w=function(_){for(var x=0;1<<x<=_;++x);return x-1},O=function(_,x,I){var B=(x<<3)+4,U=(_[x]&15)+5;U>I&&d(3);for(var te=1<<U,F=te,ne=-1,ae=-1,Se=-1,be=te,le=new e(512+(te<<2)),he=new n(le,0,256),Ie=new i(le,0,256),Be=new i(le,512,te),pe=512+(te<<1),ke=new t(le,pe,te),ge=new t(le,pe+te);ne<255&&F>0;){var xe=w(F+1),Re=B>>3,je=(1<<xe+1)-1,Le=(_[Re]|_[Re+1]<<8|_[Re+2]<<16)>>(B&7)&je,ye=(1<<xe)-1,De=je-F-1,Qe=Le&ye;if(Qe<De?(B+=xe,Le=Qe):(B+=xe+1,Le>ye&&(Le-=De)),he[++ne]=--Le,Le==-1?(F+=Le,ke[--be]=ne):F-=Le,!Le)do{var Ye=B>>3;ae=(_[Ye]|_[Ye+1]<<8)>>(B&7)&3,B+=2,ne+=ae}while(ae==3)}(ne>255||F)&&d(0);for(var Ne=0,lt=(te>>1)+(te>>3)+3,qe=te-1,Pe=0;Pe<=ne;++Pe){var _e=he[Pe];if(_e<1){Ie[Pe]=-_e;continue}for(Se=0;Se<_e;++Se){ke[Ne]=Pe;do Ne=Ne+lt&qe;while(Ne>=be)}}for(Ne&&d(0),Se=0;Se<te;++Se){var J=Ie[ke[Se]]++,Ge=ge[Se]=U-w(J);Be[Se]=(J<<Ge)-te}return[B+7>>3,{b:U,s:ke,n:ge,t:Be}]},A=function(_,x){var I=0,B=-1,U=new t(292),te=_[x],F=U.subarray(0,256),ne=U.subarray(256,268),ae=new i(U.buffer,268);if(te<128){var Se=O(_,x+1,6),be=Se[0],le=Se[1];x+=te;var he=be<<3,Ie=_[x];Ie||d(0);for(var Be=0,pe=0,ke=le.b,ge=ke,xe=(++x<<3)-8+w(Ie);xe-=ke,!(xe<he);){var Re=xe>>3;if(Be+=(_[Re]|_[Re+1]<<8)>>(xe&7)&(1<<ke)-1,F[++B]=le.s[Be],xe-=ge,xe<he)break;Re=xe>>3,pe+=(_[Re]|_[Re+1]<<8)>>(xe&7)&(1<<ge)-1,F[++B]=le.s[pe],ke=le.n[Be],Be=le.t[Be],ge=le.n[pe],pe=le.t[pe]}++B>255&&d(0)}else{for(B=te-127;I<B;I+=2){var je=_[++x];F[I]=je>>4,F[I+1]=je&15}++x}var Le=0;for(I=0;I<B;++I){var ye=F[I];ye>11&&d(0),Le+=ye&&1<<ye-1}var De=w(Le)+1,Qe=1<<De,Ye=Qe-Le;for(Ye&Ye-1&&d(0),F[B++]=w(Ye)+1,I=0;I<B;++I){var ye=F[I];++ne[F[I]=ye&&De+1-ye]}var Ne=new t(Qe<<1),lt=Ne.subarray(0,Qe),qe=Ne.subarray(Qe);for(ae[De]=0,I=De;I>0;--I){var Pe=ae[I];f(qe,I,Pe,ae[I-1]=Pe+ne[I]*(1<<De-I))}for(ae[0]!=Qe&&d(0),I=0;I<B;++I){var _e=F[I];if(_e){var J=ae[_e];f(lt,I,J,ae[_e]=J+(1<<De-_e))}}return[x,{n:qe,b:De,s:lt}]},C=O(new t([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],V=O(new t([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],H=O(new t([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],k=function(_,x){for(var I=_.length,B=new r(I),U=0;U<I;++U)B[U]=x,x+=1<<_[U];return B},b=new t(new r([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),P=k(b,0),q=new t(new r([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),$=k(q,3),ue=function(_,x,I){var B=_.length,U=x.length,te=_[B-1],F=(1<<I.b)-1,ne=-I.b;te||d(0);for(var ae=0,Se=I.b,be=(B<<3)-8+w(te)-Se,le=-1;be>ne&&le<U;){var he=be>>3,Ie=(_[he]|_[he+1]<<8|_[he+2]<<16)>>(be&7);ae=(ae<<Se|Ie)&F,x[++le]=I.s[ae],be-=Se=I.n[ae]}(be!=ne||le+1!=U)&&d(0)},fe=function(_,x,I){var B=6,U=x.length,te=U+3>>2,F=te<<1,ne=te+F;ue(_.subarray(B,B+=_[0]|_[1]<<8),x.subarray(0,te),I),ue(_.subarray(B,B+=_[2]|_[3]<<8),x.subarray(te,F),I),ue(_.subarray(B,B+=_[4]|_[5]<<8),x.subarray(F,ne),I),ue(_.subarray(B),x.subarray(ne),I)},Te=function(_,x,I){var B,U=x.b,te=_[U],F=te>>1&3;x.l=te&1;var ne=te>>3|_[U+1]<<5|_[U+2]<<13,ae=(U+=3)+ne;if(F==1)return U>=_.length?void 0:(x.b=U+1,I?(f(I,_[U],x.y,x.y+=ne),I):f(new t(ne),_[U]));if(!(ae>_.length)){if(F==0)return x.b=ae,I?(I.set(_.subarray(U,ae),x.y),x.y+=ne,I):o(_,U,ae);if(F==2){var Se=_[U],be=Se&3,le=Se>>2&3,he=Se>>4,Ie=0,Be=0;be<2?le&1?he|=_[++U]<<4|(le&2&&_[++U]<<12):he=Se>>3:(Be=le,le<2?(he|=(_[++U]&63)<<4,Ie=_[U]>>6|_[++U]<<2):le==2?(he|=_[++U]<<4|(_[++U]&3)<<12,Ie=_[U]>>2|_[++U]<<6):(he|=_[++U]<<4|(_[++U]&63)<<12,Ie=_[U]>>6|_[++U]<<2|_[++U]<<10)),++U;var pe=I?I.subarray(x.y,x.y+x.m):new t(x.m),ke=pe.length-he;if(be==0)pe.set(_.subarray(U,U+=he),ke);else if(be==1)f(pe,_[U++],ke);else{var ge=x.h;if(be==2){var xe=A(_,U);Ie+=U-(U=xe[0]),x.h=ge=xe[1]}else ge||d(0);(Be?fe:ue)(_.subarray(U,U+=Ie),pe.subarray(ke),ge)}var Re=_[U++];if(Re){Re==255?Re=(_[U++]|_[U++]<<8)+32512:Re>127&&(Re=Re-128<<8|_[U++]);var je=_[U++];je&3&&d(0);for(var Le=[V,H,C],ye=2;ye>-1;--ye){var De=je>>(ye<<1)+2&3;if(De==1){var Qe=new t([0,0,_[U++]]);Le[ye]={s:Qe.subarray(2,3),n:Qe.subarray(0,1),t:new i(Qe.buffer,0,1),b:0}}else De==2?(B=O(_,U,9-(ye&1)),U=B[0],Le[ye]=B[1]):De==3&&(x.t||d(0),Le[ye]=x.t[ye])}var Ye=x.t=Le,Ne=Ye[0],lt=Ye[1],qe=Ye[2],Pe=_[ae-1];Pe||d(0);var _e=(ae<<3)-8+w(Pe)-qe.b,J=_e>>3,Ge=0,pt=(_[J]|_[J+1]<<8)>>(_e&7)&(1<<qe.b)-1;J=(_e-=lt.b)>>3;var _t=(_[J]|_[J+1]<<8)>>(_e&7)&(1<<lt.b)-1;J=(_e-=Ne.b)>>3;var l=(_[J]|_[J+1]<<8)>>(_e&7)&(1<<Ne.b)-1;for(++Re;--Re;){var D=qe.s[pt],G=qe.n[pt],K=Ne.s[l],re=Ne.n[l],oe=lt.s[_t],g=lt.n[_t];J=(_e-=oe)>>3;var E=1<<oe,s=E+((_[J]|_[J+1]<<8|_[J+2]<<16|_[J+3]<<24)>>>(_e&7)&E-1);J=(_e-=q[K])>>3;var W=$[K]+((_[J]|_[J+1]<<8|_[J+2]<<16)>>(_e&7)&(1<<q[K])-1);J=(_e-=b[D])>>3;var me=P[D]+((_[J]|_[J+1]<<8|_[J+2]<<16)>>(_e&7)&(1<<b[D])-1);if(J=(_e-=G)>>3,pt=qe.t[pt]+((_[J]|_[J+1]<<8)>>(_e&7)&(1<<G)-1),J=(_e-=re)>>3,l=Ne.t[l]+((_[J]|_[J+1]<<8)>>(_e&7)&(1<<re)-1),J=(_e-=g)>>3,_t=lt.t[_t]+((_[J]|_[J+1]<<8)>>(_e&7)&(1<<g)-1),s>3)x.o[2]=x.o[1],x.o[1]=x.o[0],x.o[0]=s-=3;else{var Y=s-(me!=0);Y?(s=Y==3?x.o[0]-1:x.o[Y],Y>1&&(x.o[2]=x.o[1]),x.o[1]=x.o[0],x.o[0]=s):s=x.o[0]}for(var ye=0;ye<me;++ye)pe[Ge+ye]=pe[ke+ye];Ge+=me,ke+=me;var ve=Ge-s;if(ve<0){var j=-ve,Fe=x.e+ve;j>W&&(j=W);for(var ye=0;ye<j;++ye)pe[Ge+ye]=x.w[Fe+ye];Ge+=j,W-=j,ve=0}for(var ye=0;ye<W;++ye)pe[Ge+ye]=pe[ve+ye];Ge+=W}if(Ge!=ke)for(;ke<pe.length;)pe[Ge++]=pe[ke++];else Ge=pe.length;I?x.y+=Ge:pe=o(pe,0,Ge)}else if(I){if(x.y+=he,ke)for(var ye=0;ye<he;++ye)pe[ye]=pe[ke+ye]}else ke&&(pe=o(pe,ke));return x.b=ae,pe}d(2)}},we=function(_,x){if(_.length==1)return _[0];for(var I=new t(x),B=0,U=0;B<_.length;++B){var te=_[B];I.set(te,U),U+=te.length}return I};function se(_,x){for(var I=[],B=+!x,U=0,te=0;_.length;){var F=Z(_,B||x);if(typeof F=="object"){for(B?(x=null,F.w.length==F.u&&(I.push(x=F.w),te+=F.u)):(I.push(x),F.e=0);!F.l;){var ne=Te(_,F,x);ne||d(5),x?F.e=F.y:(I.push(ne),te+=ne.length,u(F.w,0,ne.length),F.w.set(ne,F.w.length-ne.length))}U=F.b+F.c*4}else U=F;_=_.subarray(U)}return we(I,te)}bi.decompress=se;var ie=function(){function _(x){this.ondata=x,this.c=[],this.l=0,this.z=0}return _.prototype.push=function(x,I){if(typeof this.s=="number"){var B=Math.min(x.length,this.s);x=x.subarray(B),this.s-=B}var U=x.length,te=U+this.l;if(!this.s){if(I){if(!te){this.ondata(new t(0),!0);return}te<5&&d(5)}else if(te<18){this.c.push(x),this.l=te;return}if(this.l&&(this.c.push(x),x=we(this.c,te),this.c=[],this.l=0),typeof(this.s=Z(x))=="number")return this.push(x,I)}if(typeof this.s!="number"){if(te<(this.z||3)){I&&d(5),this.c.push(x),this.l=te;return}if(this.l&&(this.c.push(x),x=we(this.c,te),this.c=[],this.l=0),!this.z&&te<(this.z=x[this.s.b]&2?4:3+(x[this.s.b]>>3|x[this.s.b+1]<<5|x[this.s.b+2]<<13))){I&&d(5),this.c.push(x),this.l=te;return}else this.z=0;for(;;){var F=Te(x,this.s);if(F)this.ondata(F,!1),u(this.s.w,0,F.length),this.s.w.set(F,this.s.w.length-F.length);else{I&&d(5);var ne=x.subarray(this.s.b);this.s.b=0,this.c.push(ne),this.l+=ne.length;return}if(this.s.l){var ae=x.subarray(this.s.b);this.s=this.s.c*4,this.push(ae,I);return}}}else I&&d(5)},_}();return bi.Decompress=ie,bi}var xt={},Ht={},Tt={},Yt={},Lr;function ll(){if(Lr)return Yt;Lr=1;const e=4,t=0,i=1,n=2;function r(l){let D=l.length;for(;--D>=0;)l[D]=0}const o=0,f=1,u=2,p=3,d=258,T=29,L=256,Z=L+1+T,w=30,O=19,A=2*Z+1,C=15,V=16,H=7,k=256,b=16,P=17,q=18,$=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ue=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),we=512,se=new Array((Z+2)*2);r(se);const ie=new Array(w*2);r(ie);const _=new Array(we);r(_);const x=new Array(d-p+1);r(x);const I=new Array(T);r(I);const B=new Array(w);r(B);function U(l,D,G,K,re){this.static_tree=l,this.extra_bits=D,this.extra_base=G,this.elems=K,this.max_length=re,this.has_stree=l&&l.length}let te,F,ne;function ae(l,D){this.dyn_tree=l,this.max_code=0,this.stat_desc=D}const Se=l=>l<256?_[l]:_[256+(l>>>7)],be=(l,D)=>{l.pending_buf[l.pending++]=D&255,l.pending_buf[l.pending++]=D>>>8&255},le=(l,D,G)=>{l.bi_valid>V-G?(l.bi_buf|=D<<l.bi_valid&65535,be(l,l.bi_buf),l.bi_buf=D>>V-l.bi_valid,l.bi_valid+=G-V):(l.bi_buf|=D<<l.bi_valid&65535,l.bi_valid+=G)},he=(l,D,G)=>{le(l,G[D*2],G[D*2+1])},Ie=(l,D)=>{let G=0;do G|=l&1,l>>>=1,G<<=1;while(--D>0);return G>>>1},Be=l=>{l.bi_valid===16?(be(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},pe=(l,D)=>{const G=D.dyn_tree,K=D.max_code,re=D.stat_desc.static_tree,oe=D.stat_desc.has_stree,g=D.stat_desc.extra_bits,E=D.stat_desc.extra_base,s=D.stat_desc.max_length;let W,me,Y,ve,j,Fe,R=0;for(ve=0;ve<=C;ve++)l.bl_count[ve]=0;for(G[l.heap[l.heap_max]*2+1]=0,W=l.heap_max+1;W<A;W++)me=l.heap[W],ve=G[G[me*2+1]*2+1]+1,ve>s&&(ve=s,R++),G[me*2+1]=ve,!(me>K)&&(l.bl_count[ve]++,j=0,me>=E&&(j=g[me-E]),Fe=G[me*2],l.opt_len+=Fe*(ve+j),oe&&(l.static_len+=Fe*(re[me*2+1]+j)));if(R!==0){do{for(ve=s-1;l.bl_count[ve]===0;)ve--;l.bl_count[ve]--,l.bl_count[ve+1]+=2,l.bl_count[s]--,R-=2}while(R>0);for(ve=s;ve!==0;ve--)for(me=l.bl_count[ve];me!==0;)Y=l.heap[--W],!(Y>K)&&(G[Y*2+1]!==ve&&(l.opt_len+=(ve-G[Y*2+1])*G[Y*2],G[Y*2+1]=ve),me--)}},ke=(l,D,G)=>{const K=new Array(C+1);let re=0,oe,g;for(oe=1;oe<=C;oe++)re=re+G[oe-1]<<1,K[oe]=re;for(g=0;g<=D;g++){let E=l[g*2+1];E!==0&&(l[g*2]=Ie(K[E]++,E))}},ge=()=>{let l,D,G,K,re;const oe=new Array(C+1);for(G=0,K=0;K<T-1;K++)for(I[K]=G,l=0;l<1<<$[K];l++)x[G++]=K;for(x[G-1]=K,re=0,K=0;K<16;K++)for(B[K]=re,l=0;l<1<<ue[K];l++)_[re++]=K;for(re>>=7;K<w;K++)for(B[K]=re<<7,l=0;l<1<<ue[K]-7;l++)_[256+re++]=K;for(D=0;D<=C;D++)oe[D]=0;for(l=0;l<=143;)se[l*2+1]=8,l++,oe[8]++;for(;l<=255;)se[l*2+1]=9,l++,oe[9]++;for(;l<=279;)se[l*2+1]=7,l++,oe[7]++;for(;l<=287;)se[l*2+1]=8,l++,oe[8]++;for(ke(se,Z+1,oe),l=0;l<w;l++)ie[l*2+1]=5,ie[l*2]=Ie(l,5);te=new U(se,$,L+1,Z,C),F=new U(ie,ue,0,w,C),ne=new U(new Array(0),fe,0,O,H)},xe=l=>{let D;for(D=0;D<Z;D++)l.dyn_ltree[D*2]=0;for(D=0;D<w;D++)l.dyn_dtree[D*2]=0;for(D=0;D<O;D++)l.bl_tree[D*2]=0;l.dyn_ltree[k*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},Re=l=>{l.bi_valid>8?be(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},je=(l,D,G,K)=>{const re=D*2,oe=G*2;return l[re]<l[oe]||l[re]===l[oe]&&K[D]<=K[G]},Le=(l,D,G)=>{const K=l.heap[G];let re=G<<1;for(;re<=l.heap_len&&(re<l.heap_len&&je(D,l.heap[re+1],l.heap[re],l.depth)&&re++,!je(D,K,l.heap[re],l.depth));)l.heap[G]=l.heap[re],G=re,re<<=1;l.heap[G]=K},ye=(l,D,G)=>{let K,re,oe=0,g,E;if(l.sym_next!==0)do K=l.pending_buf[l.sym_buf+oe++]&255,K+=(l.pending_buf[l.sym_buf+oe++]&255)<<8,re=l.pending_buf[l.sym_buf+oe++],K===0?he(l,re,D):(g=x[re],he(l,g+L+1,D),E=$[g],E!==0&&(re-=I[g],le(l,re,E)),K--,g=Se(K),he(l,g,G),E=ue[g],E!==0&&(K-=B[g],le(l,K,E)));while(oe<l.sym_next);he(l,k,D)},De=(l,D)=>{const G=D.dyn_tree,K=D.stat_desc.static_tree,re=D.stat_desc.has_stree,oe=D.stat_desc.elems;let g,E,s=-1,W;for(l.heap_len=0,l.heap_max=A,g=0;g<oe;g++)G[g*2]!==0?(l.heap[++l.heap_len]=s=g,l.depth[g]=0):G[g*2+1]=0;for(;l.heap_len<2;)W=l.heap[++l.heap_len]=s<2?++s:0,G[W*2]=1,l.depth[W]=0,l.opt_len--,re&&(l.static_len-=K[W*2+1]);for(D.max_code=s,g=l.heap_len>>1;g>=1;g--)Le(l,G,g);W=oe;do g=l.heap[1],l.heap[1]=l.heap[l.heap_len--],Le(l,G,1),E=l.heap[1],l.heap[--l.heap_max]=g,l.heap[--l.heap_max]=E,G[W*2]=G[g*2]+G[E*2],l.depth[W]=(l.depth[g]>=l.depth[E]?l.depth[g]:l.depth[E])+1,G[g*2+1]=G[E*2+1]=W,l.heap[1]=W++,Le(l,G,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],pe(l,D),ke(G,s,l.bl_count)},Qe=(l,D,G)=>{let K,re=-1,oe,g=D[0*2+1],E=0,s=7,W=4;for(g===0&&(s=138,W=3),D[(G+1)*2+1]=65535,K=0;K<=G;K++)oe=g,g=D[(K+1)*2+1],!(++E<s&&oe===g)&&(E<W?l.bl_tree[oe*2]+=E:oe!==0?(oe!==re&&l.bl_tree[oe*2]++,l.bl_tree[b*2]++):E<=10?l.bl_tree[P*2]++:l.bl_tree[q*2]++,E=0,re=oe,g===0?(s=138,W=3):oe===g?(s=6,W=3):(s=7,W=4))},Ye=(l,D,G)=>{let K,re=-1,oe,g=D[0*2+1],E=0,s=7,W=4;for(g===0&&(s=138,W=3),K=0;K<=G;K++)if(oe=g,g=D[(K+1)*2+1],!(++E<s&&oe===g)){if(E<W)do he(l,oe,l.bl_tree);while(--E!==0);else oe!==0?(oe!==re&&(he(l,oe,l.bl_tree),E--),he(l,b,l.bl_tree),le(l,E-3,2)):E<=10?(he(l,P,l.bl_tree),le(l,E-3,3)):(he(l,q,l.bl_tree),le(l,E-11,7));E=0,re=oe,g===0?(s=138,W=3):oe===g?(s=6,W=3):(s=7,W=4)}},Ne=l=>{let D;for(Qe(l,l.dyn_ltree,l.l_desc.max_code),Qe(l,l.dyn_dtree,l.d_desc.max_code),De(l,l.bl_desc),D=O-1;D>=3&&l.bl_tree[Te[D]*2+1]===0;D--);return l.opt_len+=3*(D+1)+5+5+4,D},lt=(l,D,G,K)=>{let re;for(le(l,D-257,5),le(l,G-1,5),le(l,K-4,4),re=0;re<K;re++)le(l,l.bl_tree[Te[re]*2+1],3);Ye(l,l.dyn_ltree,D-1),Ye(l,l.dyn_dtree,G-1)},qe=l=>{let D=4093624447,G;for(G=0;G<=31;G++,D>>>=1)if(D&1&&l.dyn_ltree[G*2]!==0)return t;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return i;for(G=32;G<L;G++)if(l.dyn_ltree[G*2]!==0)return i;return t};let Pe=!1;const _e=l=>{Pe||(ge(),Pe=!0),l.l_desc=new ae(l.dyn_ltree,te),l.d_desc=new ae(l.dyn_dtree,F),l.bl_desc=new ae(l.bl_tree,ne),l.bi_buf=0,l.bi_valid=0,xe(l)},J=(l,D,G,K)=>{le(l,(o<<1)+(K?1:0),3),Re(l),be(l,G),be(l,~G),G&&l.pending_buf.set(l.window.subarray(D,D+G),l.pending),l.pending+=G},Ge=l=>{le(l,f<<1,3),he(l,k,se),Be(l)},pt=(l,D,G,K)=>{let re,oe,g=0;l.level>0?(l.strm.data_type===n&&(l.strm.data_type=qe(l)),De(l,l.l_desc),De(l,l.d_desc),g=Ne(l),re=l.opt_len+3+7>>>3,oe=l.static_len+3+7>>>3,oe<=re&&(re=oe)):re=oe=G+5,G+4<=re&&D!==-1?J(l,D,G,K):l.strategy===e||oe===re?(le(l,(f<<1)+(K?1:0),3),ye(l,se,ie)):(le(l,(u<<1)+(K?1:0),3),lt(l,l.l_desc.max_code+1,l.d_desc.max_code+1,g+1),ye(l,l.dyn_ltree,l.dyn_dtree)),xe(l),K&&Re(l)},_t=(l,D,G)=>(l.pending_buf[l.sym_buf+l.sym_next++]=D,l.pending_buf[l.sym_buf+l.sym_next++]=D>>8,l.pending_buf[l.sym_buf+l.sym_next++]=G,D===0?l.dyn_ltree[G*2]++:(l.matches++,D--,l.dyn_ltree[(x[G]+L+1)*2]++,l.dyn_dtree[Se(D)*2]++),l.sym_next===l.sym_end);return Yt._tr_init=_e,Yt._tr_stored_block=J,Yt._tr_flush_block=pt,Yt._tr_tally=_t,Yt._tr_align=Ge,Yt}var On,Pr;function Wa(){return Pr||(Pr=1,On=(t,i,n,r)=>{let o=t&65535|0,f=t>>>16&65535|0,u=0;for(;n!==0;){u=n>2e3?2e3:n,n-=u;do o=o+i[r++]|0,f=f+o|0;while(--u);o%=65521,f%=65521}return o|f<<16|0}),On}var Rn,zr;function Ga(){if(zr)return Rn;zr=1;const e=()=>{let n,r=[];for(var o=0;o<256;o++){n=o;for(var f=0;f<8;f++)n=n&1?3988292384^n>>>1:n>>>1;r[o]=n}return r},t=new Uint32Array(e());return Rn=(n,r,o,f)=>{const u=t,p=f+o;n^=-1;for(let d=f;d<p;d++)n=n>>>8^u[(n^r[d])&255];return n^-1},Rn}var An,Dr;function lr(){return Dr||(Dr=1,An={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),An}var In,Fr;function Qt(){return Fr||(Fr=1,In={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),In}var Br;function cl(){if(Br)return Tt;Br=1;const{_tr_init:e,_tr_stored_block:t,_tr_flush_block:i,_tr_tally:n,_tr_align:r}=ll(),o=Wa(),f=Ga(),u=lr(),{Z_NO_FLUSH:p,Z_PARTIAL_FLUSH:d,Z_FULL_FLUSH:T,Z_FINISH:L,Z_BLOCK:Z,Z_OK:w,Z_STREAM_END:O,Z_STREAM_ERROR:A,Z_DATA_ERROR:C,Z_BUF_ERROR:V,Z_DEFAULT_COMPRESSION:H,Z_FILTERED:k,Z_HUFFMAN_ONLY:b,Z_RLE:P,Z_FIXED:q,Z_DEFAULT_STRATEGY:$,Z_UNKNOWN:ue,Z_DEFLATED:fe}=Qt(),Te=9,we=15,se=8,x=256+1+29,I=30,B=19,U=2*x+1,te=15,F=3,ne=258,ae=ne+F+1,Se=32,be=42,le=57,he=69,Ie=73,Be=91,pe=103,ke=113,ge=666,xe=1,Re=2,je=3,Le=4,ye=3,De=(a,S)=>(a.msg=u[S],S),Qe=a=>a*2-(a>4?9:0),Ye=a=>{let S=a.length;for(;--S>=0;)a[S]=0},Ne=a=>{let S,h,y,v=a.w_size;S=a.hash_size,y=S;do h=a.head[--y],a.head[y]=h>=v?h-v:0;while(--S);S=v,y=S;do h=a.prev[--y],a.prev[y]=h>=v?h-v:0;while(--S)};let qe=(a,S,h)=>(S<<a.hash_shift^h)&a.hash_mask;const Pe=a=>{const S=a.state;let h=S.pending;h>a.avail_out&&(h=a.avail_out),h!==0&&(a.output.set(S.pending_buf.subarray(S.pending_out,S.pending_out+h),a.next_out),a.next_out+=h,S.pending_out+=h,a.total_out+=h,a.avail_out-=h,S.pending-=h,S.pending===0&&(S.pending_out=0))},_e=(a,S)=>{i(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,S),a.block_start=a.strstart,Pe(a.strm)},J=(a,S)=>{a.pending_buf[a.pending++]=S},Ge=(a,S)=>{a.pending_buf[a.pending++]=S>>>8&255,a.pending_buf[a.pending++]=S&255},pt=(a,S,h,y)=>{let v=a.avail_in;return v>y&&(v=y),v===0?0:(a.avail_in-=v,S.set(a.input.subarray(a.next_in,a.next_in+v),h),a.state.wrap===1?a.adler=o(a.adler,S,v,h):a.state.wrap===2&&(a.adler=f(a.adler,S,v,h)),a.next_in+=v,a.total_in+=v,v)},_t=(a,S)=>{let h=a.max_chain_length,y=a.strstart,v,X,ce=a.prev_length,ee=a.nice_match;const ut=a.strstart>a.w_size-ae?a.strstart-(a.w_size-ae):0,Me=a.window,Je=a.w_mask,gt=a.prev,et=a.strstart+ne;let vt=Me[y+ce-1],mt=Me[y+ce];a.prev_length>=a.good_match&&(h>>=2),ee>a.lookahead&&(ee=a.lookahead);do if(v=S,!(Me[v+ce]!==mt||Me[v+ce-1]!==vt||Me[v]!==Me[y]||Me[++v]!==Me[y+1])){y+=2,v++;do;while(Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&Me[++y]===Me[++v]&&y<et);if(X=ne-(et-y),y=et-ne,X>ce){if(a.match_start=S,ce=X,X>=ee)break;vt=Me[y+ce-1],mt=Me[y+ce]}}while((S=gt[S&Je])>ut&&--h!==0);return ce<=a.lookahead?ce:a.lookahead},l=a=>{const S=a.w_size;let h,y,v;do{if(y=a.window_size-a.lookahead-a.strstart,a.strstart>=S+(S-ae)&&(a.window.set(a.window.subarray(S,S+S-y),0),a.match_start-=S,a.strstart-=S,a.block_start-=S,a.insert>a.strstart&&(a.insert=a.strstart),Ne(a),y+=S),a.strm.avail_in===0)break;if(h=pt(a.strm,a.window,a.strstart+a.lookahead,y),a.lookahead+=h,a.lookahead+a.insert>=F)for(v=a.strstart-a.insert,a.ins_h=a.window[v],a.ins_h=qe(a,a.ins_h,a.window[v+1]);a.insert&&(a.ins_h=qe(a,a.ins_h,a.window[v+F-1]),a.prev[v&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=v,v++,a.insert--,!(a.lookahead+a.insert<F)););}while(a.lookahead<ae&&a.strm.avail_in!==0)},D=(a,S)=>{let h=a.pending_buf_size-5>a.w_size?a.w_size:a.pending_buf_size-5,y,v,X,ce=0,ee=a.strm.avail_in;do{if(y=65535,X=a.bi_valid+42>>3,a.strm.avail_out<X||(X=a.strm.avail_out-X,v=a.strstart-a.block_start,y>v+a.strm.avail_in&&(y=v+a.strm.avail_in),y>X&&(y=X),y<h&&(y===0&&S!==L||S===p||y!==v+a.strm.avail_in)))break;ce=S===L&&y===v+a.strm.avail_in?1:0,t(a,0,0,ce),a.pending_buf[a.pending-4]=y,a.pending_buf[a.pending-3]=y>>8,a.pending_buf[a.pending-2]=~y,a.pending_buf[a.pending-1]=~y>>8,Pe(a.strm),v&&(v>y&&(v=y),a.strm.output.set(a.window.subarray(a.block_start,a.block_start+v),a.strm.next_out),a.strm.next_out+=v,a.strm.avail_out-=v,a.strm.total_out+=v,a.block_start+=v,y-=v),y&&(pt(a.strm,a.strm.output,a.strm.next_out,y),a.strm.next_out+=y,a.strm.avail_out-=y,a.strm.total_out+=y)}while(ce===0);return ee-=a.strm.avail_in,ee&&(ee>=a.w_size?(a.matches=2,a.window.set(a.strm.input.subarray(a.strm.next_in-a.w_size,a.strm.next_in),0),a.strstart=a.w_size,a.insert=a.strstart):(a.window_size-a.strstart<=ee&&(a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,a.insert>a.strstart&&(a.insert=a.strstart)),a.window.set(a.strm.input.subarray(a.strm.next_in-ee,a.strm.next_in),a.strstart),a.strstart+=ee,a.insert+=ee>a.w_size-a.insert?a.w_size-a.insert:ee),a.block_start=a.strstart),a.high_water<a.strstart&&(a.high_water=a.strstart),ce?Le:S!==p&&S!==L&&a.strm.avail_in===0&&a.strstart===a.block_start?Re:(X=a.window_size-a.strstart,a.strm.avail_in>X&&a.block_start>=a.w_size&&(a.block_start-=a.w_size,a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,X+=a.w_size,a.insert>a.strstart&&(a.insert=a.strstart)),X>a.strm.avail_in&&(X=a.strm.avail_in),X&&(pt(a.strm,a.window,a.strstart,X),a.strstart+=X,a.insert+=X>a.w_size-a.insert?a.w_size-a.insert:X),a.high_water<a.strstart&&(a.high_water=a.strstart),X=a.bi_valid+42>>3,X=a.pending_buf_size-X>65535?65535:a.pending_buf_size-X,h=X>a.w_size?a.w_size:X,v=a.strstart-a.block_start,(v>=h||(v||S===L)&&S!==p&&a.strm.avail_in===0&&v<=X)&&(y=v>X?X:v,ce=S===L&&a.strm.avail_in===0&&y===v?1:0,t(a,a.block_start,y,ce),a.block_start+=y,Pe(a.strm)),ce?je:xe)},G=(a,S)=>{let h,y;for(;;){if(a.lookahead<ae){if(l(a),a.lookahead<ae&&S===p)return xe;if(a.lookahead===0)break}if(h=0,a.lookahead>=F&&(a.ins_h=qe(a,a.ins_h,a.window[a.strstart+F-1]),h=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),h!==0&&a.strstart-h<=a.w_size-ae&&(a.match_length=_t(a,h)),a.match_length>=F)if(y=n(a,a.strstart-a.match_start,a.match_length-F),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=F){a.match_length--;do a.strstart++,a.ins_h=qe(a,a.ins_h,a.window[a.strstart+F-1]),h=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=qe(a,a.ins_h,a.window[a.strstart+1]);else y=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(y&&(_e(a,!1),a.strm.avail_out===0))return xe}return a.insert=a.strstart<F-1?a.strstart:F-1,S===L?(_e(a,!0),a.strm.avail_out===0?je:Le):a.sym_next&&(_e(a,!1),a.strm.avail_out===0)?xe:Re},K=(a,S)=>{let h,y,v;for(;;){if(a.lookahead<ae){if(l(a),a.lookahead<ae&&S===p)return xe;if(a.lookahead===0)break}if(h=0,a.lookahead>=F&&(a.ins_h=qe(a,a.ins_h,a.window[a.strstart+F-1]),h=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=F-1,h!==0&&a.prev_length<a.max_lazy_match&&a.strstart-h<=a.w_size-ae&&(a.match_length=_t(a,h),a.match_length<=5&&(a.strategy===k||a.match_length===F&&a.strstart-a.match_start>4096)&&(a.match_length=F-1)),a.prev_length>=F&&a.match_length<=a.prev_length){v=a.strstart+a.lookahead-F,y=n(a,a.strstart-1-a.prev_match,a.prev_length-F),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=v&&(a.ins_h=qe(a,a.ins_h,a.window[a.strstart+F-1]),h=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);if(a.match_available=0,a.match_length=F-1,a.strstart++,y&&(_e(a,!1),a.strm.avail_out===0))return xe}else if(a.match_available){if(y=n(a,0,a.window[a.strstart-1]),y&&_e(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return xe}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(y=n(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<F-1?a.strstart:F-1,S===L?(_e(a,!0),a.strm.avail_out===0?je:Le):a.sym_next&&(_e(a,!1),a.strm.avail_out===0)?xe:Re},re=(a,S)=>{let h,y,v,X;const ce=a.window;for(;;){if(a.lookahead<=ne){if(l(a),a.lookahead<=ne&&S===p)return xe;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=F&&a.strstart>0&&(v=a.strstart-1,y=ce[v],y===ce[++v]&&y===ce[++v]&&y===ce[++v])){X=a.strstart+ne;do;while(y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&y===ce[++v]&&v<X);a.match_length=ne-(X-v),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=F?(h=n(a,1,a.match_length-F),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(h=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),h&&(_e(a,!1),a.strm.avail_out===0))return xe}return a.insert=0,S===L?(_e(a,!0),a.strm.avail_out===0?je:Le):a.sym_next&&(_e(a,!1),a.strm.avail_out===0)?xe:Re},oe=(a,S)=>{let h;for(;;){if(a.lookahead===0&&(l(a),a.lookahead===0)){if(S===p)return xe;break}if(a.match_length=0,h=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,h&&(_e(a,!1),a.strm.avail_out===0))return xe}return a.insert=0,S===L?(_e(a,!0),a.strm.avail_out===0?je:Le):a.sym_next&&(_e(a,!1),a.strm.avail_out===0)?xe:Re};function g(a,S,h,y,v){this.good_length=a,this.max_lazy=S,this.nice_length=h,this.max_chain=y,this.func=v}const E=[new g(0,0,0,0,D),new g(4,4,8,4,G),new g(4,5,16,8,G),new g(4,6,32,32,G),new g(4,4,16,16,K),new g(8,16,32,32,K),new g(8,16,128,128,K),new g(8,32,128,256,K),new g(32,128,258,1024,K),new g(32,258,258,4096,K)],s=a=>{a.window_size=2*a.w_size,Ye(a.head),a.max_lazy_match=E[a.level].max_lazy,a.good_match=E[a.level].good_length,a.nice_match=E[a.level].nice_length,a.max_chain_length=E[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=F-1,a.match_available=0,a.ins_h=0};function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(U*2),this.dyn_dtree=new Uint16Array((2*I+1)*2),this.bl_tree=new Uint16Array((2*B+1)*2),Ye(this.dyn_ltree),Ye(this.dyn_dtree),Ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(te+1),this.heap=new Uint16Array(2*x+1),Ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*x+1),Ye(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const me=a=>{if(!a)return 1;const S=a.state;return!S||S.strm!==a||S.status!==be&&S.status!==le&&S.status!==he&&S.status!==Ie&&S.status!==Be&&S.status!==pe&&S.status!==ke&&S.status!==ge?1:0},Y=a=>{if(me(a))return De(a,A);a.total_in=a.total_out=0,a.data_type=ue;const S=a.state;return S.pending=0,S.pending_out=0,S.wrap<0&&(S.wrap=-S.wrap),S.status=S.wrap===2?le:S.wrap?be:ke,a.adler=S.wrap===2?0:1,S.last_flush=-2,e(S),w},ve=a=>{const S=Y(a);return S===w&&s(a.state),S},j=(a,S)=>me(a)||a.state.wrap!==2?A:(a.state.gzhead=S,w),Fe=(a,S,h,y,v,X)=>{if(!a)return A;let ce=1;if(S===H&&(S=6),y<0?(ce=0,y=-y):y>15&&(ce=2,y-=16),v<1||v>Te||h!==fe||y<8||y>15||S<0||S>9||X<0||X>q||y===8&&ce!==1)return De(a,A);y===8&&(y=9);const ee=new W;return a.state=ee,ee.strm=a,ee.status=be,ee.wrap=ce,ee.gzhead=null,ee.w_bits=y,ee.w_size=1<<ee.w_bits,ee.w_mask=ee.w_size-1,ee.hash_bits=v+7,ee.hash_size=1<<ee.hash_bits,ee.hash_mask=ee.hash_size-1,ee.hash_shift=~~((ee.hash_bits+F-1)/F),ee.window=new Uint8Array(ee.w_size*2),ee.head=new Uint16Array(ee.hash_size),ee.prev=new Uint16Array(ee.w_size),ee.lit_bufsize=1<<v+6,ee.pending_buf_size=ee.lit_bufsize*4,ee.pending_buf=new Uint8Array(ee.pending_buf_size),ee.sym_buf=ee.lit_bufsize,ee.sym_end=(ee.lit_bufsize-1)*3,ee.level=S,ee.strategy=X,ee.method=h,ve(a)},R=(a,S)=>Fe(a,S,fe,we,se,$),M=(a,S)=>{if(me(a)||S>Z||S<0)return a?De(a,A):A;const h=a.state;if(!a.output||a.avail_in!==0&&!a.input||h.status===ge&&S!==L)return De(a,a.avail_out===0?V:A);const y=h.last_flush;if(h.last_flush=S,h.pending!==0){if(Pe(a),a.avail_out===0)return h.last_flush=-1,w}else if(a.avail_in===0&&Qe(S)<=Qe(y)&&S!==L)return De(a,V);if(h.status===ge&&a.avail_in!==0)return De(a,V);if(h.status===be&&h.wrap===0&&(h.status=ke),h.status===be){let v=fe+(h.w_bits-8<<4)<<8,X=-1;if(h.strategy>=b||h.level<2?X=0:h.level<6?X=1:h.level===6?X=2:X=3,v|=X<<6,h.strstart!==0&&(v|=Se),v+=31-v%31,Ge(h,v),h.strstart!==0&&(Ge(h,a.adler>>>16),Ge(h,a.adler&65535)),a.adler=1,h.status=ke,Pe(a),h.pending!==0)return h.last_flush=-1,w}if(h.status===le){if(a.adler=0,J(h,31),J(h,139),J(h,8),h.gzhead)J(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),J(h,h.gzhead.time&255),J(h,h.gzhead.time>>8&255),J(h,h.gzhead.time>>16&255),J(h,h.gzhead.time>>24&255),J(h,h.level===9?2:h.strategy>=b||h.level<2?4:0),J(h,h.gzhead.os&255),h.gzhead.extra&&h.gzhead.extra.length&&(J(h,h.gzhead.extra.length&255),J(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=f(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=he;else if(J(h,0),J(h,0),J(h,0),J(h,0),J(h,0),J(h,h.level===9?2:h.strategy>=b||h.level<2?4:0),J(h,ye),h.status=ke,Pe(a),h.pending!==0)return h.last_flush=-1,w}if(h.status===he){if(h.gzhead.extra){let v=h.pending,X=(h.gzhead.extra.length&65535)-h.gzindex;for(;h.pending+X>h.pending_buf_size;){let ee=h.pending_buf_size-h.pending;if(h.pending_buf.set(h.gzhead.extra.subarray(h.gzindex,h.gzindex+ee),h.pending),h.pending=h.pending_buf_size,h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v)),h.gzindex+=ee,Pe(a),h.pending!==0)return h.last_flush=-1,w;v=0,X-=ee}let ce=new Uint8Array(h.gzhead.extra);h.pending_buf.set(ce.subarray(h.gzindex,h.gzindex+X),h.pending),h.pending+=X,h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v)),h.gzindex=0}h.status=Ie}if(h.status===Ie){if(h.gzhead.name){let v=h.pending,X;do{if(h.pending===h.pending_buf_size){if(h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v)),Pe(a),h.pending!==0)return h.last_flush=-1,w;v=0}h.gzindex<h.gzhead.name.length?X=h.gzhead.name.charCodeAt(h.gzindex++)&255:X=0,J(h,X)}while(X!==0);h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v)),h.gzindex=0}h.status=Be}if(h.status===Be){if(h.gzhead.comment){let v=h.pending,X;do{if(h.pending===h.pending_buf_size){if(h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v)),Pe(a),h.pending!==0)return h.last_flush=-1,w;v=0}h.gzindex<h.gzhead.comment.length?X=h.gzhead.comment.charCodeAt(h.gzindex++)&255:X=0,J(h,X)}while(X!==0);h.gzhead.hcrc&&h.pending>v&&(a.adler=f(a.adler,h.pending_buf,h.pending-v,v))}h.status=pe}if(h.status===pe){if(h.gzhead.hcrc){if(h.pending+2>h.pending_buf_size&&(Pe(a),h.pending!==0))return h.last_flush=-1,w;J(h,a.adler&255),J(h,a.adler>>8&255),a.adler=0}if(h.status=ke,Pe(a),h.pending!==0)return h.last_flush=-1,w}if(a.avail_in!==0||h.lookahead!==0||S!==p&&h.status!==ge){let v=h.level===0?D(h,S):h.strategy===b?oe(h,S):h.strategy===P?re(h,S):E[h.level].func(h,S);if((v===je||v===Le)&&(h.status=ge),v===xe||v===je)return a.avail_out===0&&(h.last_flush=-1),w;if(v===Re&&(S===d?r(h):S!==Z&&(t(h,0,0,!1),S===T&&(Ye(h.head),h.lookahead===0&&(h.strstart=0,h.block_start=0,h.insert=0))),Pe(a),a.avail_out===0))return h.last_flush=-1,w}return S!==L?w:h.wrap<=0?O:(h.wrap===2?(J(h,a.adler&255),J(h,a.adler>>8&255),J(h,a.adler>>16&255),J(h,a.adler>>24&255),J(h,a.total_in&255),J(h,a.total_in>>8&255),J(h,a.total_in>>16&255),J(h,a.total_in>>24&255)):(Ge(h,a.adler>>>16),Ge(h,a.adler&65535)),Pe(a),h.wrap>0&&(h.wrap=-h.wrap),h.pending!==0?w:O)},ii=a=>{if(me(a))return A;const S=a.state.status;return a.state=null,S===ke?De(a,C):w},He=(a,S)=>{let h=S.length;if(me(a))return A;const y=a.state,v=y.wrap;if(v===2||v===1&&y.status!==be||y.lookahead)return A;if(v===1&&(a.adler=o(a.adler,S,h,0)),y.wrap=0,h>=y.w_size){v===0&&(Ye(y.head),y.strstart=0,y.block_start=0,y.insert=0);let ut=new Uint8Array(y.w_size);ut.set(S.subarray(h-y.w_size,h),0),S=ut,h=y.w_size}const X=a.avail_in,ce=a.next_in,ee=a.input;for(a.avail_in=h,a.next_in=0,a.input=S,l(y);y.lookahead>=F;){let ut=y.strstart,Me=y.lookahead-(F-1);do y.ins_h=qe(y,y.ins_h,y.window[ut+F-1]),y.prev[ut&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=ut,ut++;while(--Me);y.strstart=ut,y.lookahead=F-1,l(y)}return y.strstart+=y.lookahead,y.block_start=y.strstart,y.insert=y.lookahead,y.lookahead=0,y.match_length=y.prev_length=F-1,y.match_available=0,a.next_in=ce,a.input=ee,a.avail_in=X,y.wrap=v,w};return Tt.deflateInit=R,Tt.deflateInit2=Fe,Tt.deflateReset=ve,Tt.deflateResetKeep=Y,Tt.deflateSetHeader=j,Tt.deflate=M,Tt.deflateEnd=ii,Tt.deflateSetDictionary=He,Tt.deflateInfo="pako deflate (from Nodeca project)",Tt}var Qi={},Nr;function Ha(){if(Nr)return Qi;Nr=1;const e=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);return Qi.assign=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)e(n,r)&&(t[r]=n[r])}}return t},Qi.flattenChunks=t=>{let i=0;for(let r=0,o=t.length;r<o;r++)i+=t[r].length;const n=new Uint8Array(i);for(let r=0,o=0,f=t.length;r<f;r++){let u=t[r];n.set(u,o),o+=u.length}return n},Qi}var xi={},Ur;function Ya(){if(Ur)return xi;Ur=1;let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}const t=new Uint8Array(256);for(let n=0;n<256;n++)t[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;t[254]=t[254]=1,xi.string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let r,o,f,u,p,d=n.length,T=0;for(u=0;u<d;u++)o=n.charCodeAt(u),(o&64512)===55296&&u+1<d&&(f=n.charCodeAt(u+1),(f&64512)===56320&&(o=65536+(o-55296<<10)+(f-56320),u++)),T+=o<128?1:o<2048?2:o<65536?3:4;for(r=new Uint8Array(T),p=0,u=0;p<T;u++)o=n.charCodeAt(u),(o&64512)===55296&&u+1<d&&(f=n.charCodeAt(u+1),(f&64512)===56320&&(o=65536+(o-55296<<10)+(f-56320),u++)),o<128?r[p++]=o:o<2048?(r[p++]=192|o>>>6,r[p++]=128|o&63):o<65536?(r[p++]=224|o>>>12,r[p++]=128|o>>>6&63,r[p++]=128|o&63):(r[p++]=240|o>>>18,r[p++]=128|o>>>12&63,r[p++]=128|o>>>6&63,r[p++]=128|o&63);return r};const i=(n,r)=>{if(r<65534&&n.subarray&&e)return String.fromCharCode.apply(null,n.length===r?n:n.subarray(0,r));let o="";for(let f=0;f<r;f++)o+=String.fromCharCode(n[f]);return o};return xi.buf2string=(n,r)=>{const o=r||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,r));let f,u;const p=new Array(o*2);for(u=0,f=0;f<o;){let d=n[f++];if(d<128){p[u++]=d;continue}let T=t[d];if(T>4){p[u++]=65533,f+=T-1;continue}for(d&=T===2?31:T===3?15:7;T>1&&f<o;)d=d<<6|n[f++]&63,T--;if(T>1){p[u++]=65533;continue}d<65536?p[u++]=d:(d-=65536,p[u++]=55296|d>>10&1023,p[u++]=56320|d&1023)}return i(p,u)},xi.utf8border=(n,r)=>{r=r||n.length,r>n.length&&(r=n.length);let o=r-1;for(;o>=0&&(n[o]&192)===128;)o--;return o<0||o===0?r:o+t[n[o]]>r?o:r},xi}var Mn,Wr;function qa(){if(Wr)return Mn;Wr=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return Mn=e,Mn}var Gr;function ul(){if(Gr)return Ht;Gr=1;const e=cl(),t=Ha(),i=Ya(),n=lr(),r=qa(),o=Object.prototype.toString,{Z_NO_FLUSH:f,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:p,Z_FINISH:d,Z_OK:T,Z_STREAM_END:L,Z_DEFAULT_COMPRESSION:Z,Z_DEFAULT_STRATEGY:w,Z_DEFLATED:O}=Qt();function A(k){this.options=t.assign({level:Z,method:O,chunkSize:16384,windowBits:15,memLevel:8,strategy:w},k||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let P=e.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(P!==T)throw new Error(n[P]);if(b.header&&e.deflateSetHeader(this.strm,b.header),b.dictionary){let q;if(typeof b.dictionary=="string"?q=i.string2buf(b.dictionary):o.call(b.dictionary)==="[object ArrayBuffer]"?q=new Uint8Array(b.dictionary):q=b.dictionary,P=e.deflateSetDictionary(this.strm,q),P!==T)throw new Error(n[P]);this._dict_set=!0}}A.prototype.push=function(k,b){const P=this.strm,q=this.options.chunkSize;let $,ue;if(this.ended)return!1;for(b===~~b?ue=b:ue=b===!0?d:f,typeof k=="string"?P.input=i.string2buf(k):o.call(k)==="[object ArrayBuffer]"?P.input=new Uint8Array(k):P.input=k,P.next_in=0,P.avail_in=P.input.length;;){if(P.avail_out===0&&(P.output=new Uint8Array(q),P.next_out=0,P.avail_out=q),(ue===u||ue===p)&&P.avail_out<=6){this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;continue}if($=e.deflate(P,ue),$===L)return P.next_out>0&&this.onData(P.output.subarray(0,P.next_out)),$=e.deflateEnd(this.strm),this.onEnd($),this.ended=!0,$===T;if(P.avail_out===0){this.onData(P.output);continue}if(ue>0&&P.next_out>0){this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;continue}if(P.avail_in===0)break}return!0},A.prototype.onData=function(k){this.chunks.push(k)},A.prototype.onEnd=function(k){k===T&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg};function C(k,b){const P=new A(b);if(P.push(k,!0),P.err)throw P.msg||n[P.err];return P.result}function V(k,b){return b=b||{},b.raw=!0,C(k,b)}function H(k,b){return b=b||{},b.gzip=!0,C(k,b)}return Ht.Deflate=A,Ht.deflate=C,Ht.deflateRaw=V,Ht.gzip=H,Ht.constants=Qt(),Ht}var qt={},bt={},Cn,Hr;function fl(){if(Hr)return Cn;Hr=1;const e=16209,t=16191;return Cn=function(n,r){let o,f,u,p,d,T,L,Z,w,O,A,C,V,H,k,b,P,q,$,ue,fe,Te,we,se;const ie=n.state;o=n.next_in,we=n.input,f=o+(n.avail_in-5),u=n.next_out,se=n.output,p=u-(r-n.avail_out),d=u+(n.avail_out-257),T=ie.dmax,L=ie.wsize,Z=ie.whave,w=ie.wnext,O=ie.window,A=ie.hold,C=ie.bits,V=ie.lencode,H=ie.distcode,k=(1<<ie.lenbits)-1,b=(1<<ie.distbits)-1;e:do{C<15&&(A+=we[o++]<<C,C+=8,A+=we[o++]<<C,C+=8),P=V[A&k];t:for(;;){if(q=P>>>24,A>>>=q,C-=q,q=P>>>16&255,q===0)se[u++]=P&65535;else if(q&16){$=P&65535,q&=15,q&&(C<q&&(A+=we[o++]<<C,C+=8),$+=A&(1<<q)-1,A>>>=q,C-=q),C<15&&(A+=we[o++]<<C,C+=8,A+=we[o++]<<C,C+=8),P=H[A&b];i:for(;;){if(q=P>>>24,A>>>=q,C-=q,q=P>>>16&255,q&16){if(ue=P&65535,q&=15,C<q&&(A+=we[o++]<<C,C+=8,C<q&&(A+=we[o++]<<C,C+=8)),ue+=A&(1<<q)-1,ue>T){n.msg="invalid distance too far back",ie.mode=e;break e}if(A>>>=q,C-=q,q=u-p,ue>q){if(q=ue-q,q>Z&&ie.sane){n.msg="invalid distance too far back",ie.mode=e;break e}if(fe=0,Te=O,w===0){if(fe+=L-q,q<$){$-=q;do se[u++]=O[fe++];while(--q);fe=u-ue,Te=se}}else if(w<q){if(fe+=L+w-q,q-=w,q<$){$-=q;do se[u++]=O[fe++];while(--q);if(fe=0,w<$){q=w,$-=q;do se[u++]=O[fe++];while(--q);fe=u-ue,Te=se}}}else if(fe+=w-q,q<$){$-=q;do se[u++]=O[fe++];while(--q);fe=u-ue,Te=se}for(;$>2;)se[u++]=Te[fe++],se[u++]=Te[fe++],se[u++]=Te[fe++],$-=3;$&&(se[u++]=Te[fe++],$>1&&(se[u++]=Te[fe++]))}else{fe=u-ue;do se[u++]=se[fe++],se[u++]=se[fe++],se[u++]=se[fe++],$-=3;while($>2);$&&(se[u++]=se[fe++],$>1&&(se[u++]=se[fe++]))}}else if(q&64){n.msg="invalid distance code",ie.mode=e;break e}else{P=H[(P&65535)+(A&(1<<q)-1)];continue i}break}}else if(q&64)if(q&32){ie.mode=t;break e}else{n.msg="invalid literal/length code",ie.mode=e;break e}else{P=V[(P&65535)+(A&(1<<q)-1)];continue t}break}}while(o<f&&u<d);$=C>>3,o-=$,C-=$<<3,A&=(1<<C)-1,n.next_in=o,n.next_out=u,n.avail_in=o<f?5+(f-o):5-(o-f),n.avail_out=u<d?257+(d-u):257-(u-d),ie.hold=A,ie.bits=C},Cn}var Ln,Yr;function hl(){if(Yr)return Ln;Yr=1;const e=15,t=852,i=592,n=0,r=1,o=2,f=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),p=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);return Ln=(L,Z,w,O,A,C,V,H)=>{const k=H.bits;let b=0,P=0,q=0,$=0,ue=0,fe=0,Te=0,we=0,se=0,ie=0,_,x,I,B,U,te=null,F;const ne=new Uint16Array(e+1),ae=new Uint16Array(e+1);let Se=null,be,le,he;for(b=0;b<=e;b++)ne[b]=0;for(P=0;P<O;P++)ne[Z[w+P]]++;for(ue=k,$=e;$>=1&&ne[$]===0;$--);if(ue>$&&(ue=$),$===0)return A[C++]=1<<24|64<<16|0,A[C++]=1<<24|64<<16|0,H.bits=1,0;for(q=1;q<$&&ne[q]===0;q++);for(ue<q&&(ue=q),we=1,b=1;b<=e;b++)if(we<<=1,we-=ne[b],we<0)return-1;if(we>0&&(L===n||$!==1))return-1;for(ae[1]=0,b=1;b<e;b++)ae[b+1]=ae[b]+ne[b];for(P=0;P<O;P++)Z[w+P]!==0&&(V[ae[Z[w+P]]++]=P);if(L===n?(te=Se=V,F=20):L===r?(te=f,Se=u,F=257):(te=p,Se=d,F=0),ie=0,P=0,b=q,U=C,fe=ue,Te=0,I=-1,se=1<<ue,B=se-1,L===r&&se>t||L===o&&se>i)return 1;for(;;){be=b-Te,V[P]+1<F?(le=0,he=V[P]):V[P]>=F?(le=Se[V[P]-F],he=te[V[P]-F]):(le=96,he=0),_=1<<b-Te,x=1<<fe,q=x;do x-=_,A[U+(ie>>Te)+x]=be<<24|le<<16|he|0;while(x!==0);for(_=1<<b-1;ie&_;)_>>=1;if(_!==0?(ie&=_-1,ie+=_):ie=0,P++,--ne[b]===0){if(b===$)break;b=Z[w+V[P]]}if(b>ue&&(ie&B)!==I){for(Te===0&&(Te=ue),U+=q,fe=b-Te,we=1<<fe;fe+Te<$&&(we-=ne[fe+Te],!(we<=0));)fe++,we<<=1;if(se+=1<<fe,L===r&&se>t||L===o&&se>i)return 1;I=ie&B,A[I]=ue<<24|fe<<16|U-C|0}}return ie!==0&&(A[U+ie]=b-Te<<24|64<<16|0),H.bits=ue,0},Ln}var qr;function dl(){if(qr)return bt;qr=1;const e=Wa(),t=Ga(),i=fl(),n=hl(),r=0,o=1,f=2,{Z_FINISH:u,Z_BLOCK:p,Z_TREES:d,Z_OK:T,Z_STREAM_END:L,Z_NEED_DICT:Z,Z_STREAM_ERROR:w,Z_DATA_ERROR:O,Z_MEM_ERROR:A,Z_BUF_ERROR:C,Z_DEFLATED:V}=Qt(),H=16180,k=16181,b=16182,P=16183,q=16184,$=16185,ue=16186,fe=16187,Te=16188,we=16189,se=16190,ie=16191,_=16192,x=16193,I=16194,B=16195,U=16196,te=16197,F=16198,ne=16199,ae=16200,Se=16201,be=16202,le=16203,he=16204,Ie=16205,Be=16206,pe=16207,ke=16208,ge=16209,xe=16210,Re=16211,je=852,Le=592,De=15,Qe=g=>(g>>>24&255)+(g>>>8&65280)+((g&65280)<<8)+((g&255)<<24);function Ye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ne=g=>{if(!g)return 1;const E=g.state;return!E||E.strm!==g||E.mode<H||E.mode>Re?1:0},lt=g=>{if(Ne(g))return w;const E=g.state;return g.total_in=g.total_out=E.total=0,g.msg="",E.wrap&&(g.adler=E.wrap&1),E.mode=H,E.last=0,E.havedict=0,E.flags=-1,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(je),E.distcode=E.distdyn=new Int32Array(Le),E.sane=1,E.back=-1,T},qe=g=>{if(Ne(g))return w;const E=g.state;return E.wsize=0,E.whave=0,E.wnext=0,lt(g)},Pe=(g,E)=>{let s;if(Ne(g))return w;const W=g.state;return E<0?(s=0,E=-E):(s=(E>>4)+5,E<48&&(E&=15)),E&&(E<8||E>15)?w:(W.window!==null&&W.wbits!==E&&(W.window=null),W.wrap=s,W.wbits=E,qe(g))},_e=(g,E)=>{if(!g)return w;const s=new Ye;g.state=s,s.strm=g,s.window=null,s.mode=H;const W=Pe(g,E);return W!==T&&(g.state=null),W},J=g=>_e(g,De);let Ge=!0,pt,_t;const l=g=>{if(Ge){pt=new Int32Array(512),_t=new Int32Array(32);let E=0;for(;E<144;)g.lens[E++]=8;for(;E<256;)g.lens[E++]=9;for(;E<280;)g.lens[E++]=7;for(;E<288;)g.lens[E++]=8;for(n(o,g.lens,0,288,pt,0,g.work,{bits:9}),E=0;E<32;)g.lens[E++]=5;n(f,g.lens,0,32,_t,0,g.work,{bits:5}),Ge=!1}g.lencode=pt,g.lenbits=9,g.distcode=_t,g.distbits=5},D=(g,E,s,W)=>{let me;const Y=g.state;return Y.window===null&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new Uint8Array(Y.wsize)),W>=Y.wsize?(Y.window.set(E.subarray(s-Y.wsize,s),0),Y.wnext=0,Y.whave=Y.wsize):(me=Y.wsize-Y.wnext,me>W&&(me=W),Y.window.set(E.subarray(s-W,s-W+me),Y.wnext),W-=me,W?(Y.window.set(E.subarray(s-W,s),0),Y.wnext=W,Y.whave=Y.wsize):(Y.wnext+=me,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=me))),0},G=(g,E)=>{let s,W,me,Y,ve,j,Fe,R,M,ii,He,a,S,h,y=0,v,X,ce,ee,ut,Me,Je,gt;const et=new Uint8Array(4);let vt,mt;const ur=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ne(g)||!g.output||!g.input&&g.avail_in!==0)return w;s=g.state,s.mode===ie&&(s.mode=_),ve=g.next_out,me=g.output,Fe=g.avail_out,Y=g.next_in,W=g.input,j=g.avail_in,R=s.hold,M=s.bits,ii=j,He=Fe,gt=T;e:for(;;)switch(s.mode){case H:if(s.wrap===0){s.mode=_;break}for(;M<16;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(s.wrap&2&&R===35615){s.wbits===0&&(s.wbits=15),s.check=0,et[0]=R&255,et[1]=R>>>8&255,s.check=t(s.check,et,2,0),R=0,M=0,s.mode=k;break}if(s.head&&(s.head.done=!1),!(s.wrap&1)||(((R&255)<<8)+(R>>8))%31){g.msg="incorrect header check",s.mode=ge;break}if((R&15)!==V){g.msg="unknown compression method",s.mode=ge;break}if(R>>>=4,M-=4,Je=(R&15)+8,s.wbits===0&&(s.wbits=Je),Je>15||Je>s.wbits){g.msg="invalid window size",s.mode=ge;break}s.dmax=1<<s.wbits,s.flags=0,g.adler=s.check=1,s.mode=R&512?we:ie,R=0,M=0;break;case k:for(;M<16;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(s.flags=R,(s.flags&255)!==V){g.msg="unknown compression method",s.mode=ge;break}if(s.flags&57344){g.msg="unknown header flags set",s.mode=ge;break}s.head&&(s.head.text=R>>8&1),s.flags&512&&s.wrap&4&&(et[0]=R&255,et[1]=R>>>8&255,s.check=t(s.check,et,2,0)),R=0,M=0,s.mode=b;case b:for(;M<32;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.head&&(s.head.time=R),s.flags&512&&s.wrap&4&&(et[0]=R&255,et[1]=R>>>8&255,et[2]=R>>>16&255,et[3]=R>>>24&255,s.check=t(s.check,et,4,0)),R=0,M=0,s.mode=P;case P:for(;M<16;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.head&&(s.head.xflags=R&255,s.head.os=R>>8),s.flags&512&&s.wrap&4&&(et[0]=R&255,et[1]=R>>>8&255,s.check=t(s.check,et,2,0)),R=0,M=0,s.mode=q;case q:if(s.flags&1024){for(;M<16;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.length=R,s.head&&(s.head.extra_len=R),s.flags&512&&s.wrap&4&&(et[0]=R&255,et[1]=R>>>8&255,s.check=t(s.check,et,2,0)),R=0,M=0}else s.head&&(s.head.extra=null);s.mode=$;case $:if(s.flags&1024&&(a=s.length,a>j&&(a=j),a&&(s.head&&(Je=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(W.subarray(Y,Y+a),Je)),s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,Y)),j-=a,Y+=a,s.length-=a),s.length))break e;s.length=0,s.mode=ue;case ue:if(s.flags&2048){if(j===0)break e;a=0;do Je=W[Y+a++],s.head&&Je&&s.length<65536&&(s.head.name+=String.fromCharCode(Je));while(Je&&a<j);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,Y)),j-=a,Y+=a,Je)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=fe;case fe:if(s.flags&4096){if(j===0)break e;a=0;do Je=W[Y+a++],s.head&&Je&&s.length<65536&&(s.head.comment+=String.fromCharCode(Je));while(Je&&a<j);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,Y)),j-=a,Y+=a,Je)break e}else s.head&&(s.head.comment=null);s.mode=Te;case Te:if(s.flags&512){for(;M<16;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(s.wrap&4&&R!==(s.check&65535)){g.msg="header crc mismatch",s.mode=ge;break}R=0,M=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),g.adler=s.check=0,s.mode=ie;break;case we:for(;M<32;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}g.adler=s.check=Qe(R),R=0,M=0,s.mode=se;case se:if(s.havedict===0)return g.next_out=ve,g.avail_out=Fe,g.next_in=Y,g.avail_in=j,s.hold=R,s.bits=M,Z;g.adler=s.check=1,s.mode=ie;case ie:if(E===p||E===d)break e;case _:if(s.last){R>>>=M&7,M-=M&7,s.mode=Be;break}for(;M<3;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}switch(s.last=R&1,R>>>=1,M-=1,R&3){case 0:s.mode=x;break;case 1:if(l(s),s.mode=ne,E===d){R>>>=2,M-=2;break e}break;case 2:s.mode=U;break;case 3:g.msg="invalid block type",s.mode=ge}R>>>=2,M-=2;break;case x:for(R>>>=M&7,M-=M&7;M<32;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if((R&65535)!==(R>>>16^65535)){g.msg="invalid stored block lengths",s.mode=ge;break}if(s.length=R&65535,R=0,M=0,s.mode=I,E===d)break e;case I:s.mode=B;case B:if(a=s.length,a){if(a>j&&(a=j),a>Fe&&(a=Fe),a===0)break e;me.set(W.subarray(Y,Y+a),ve),j-=a,Y+=a,Fe-=a,ve+=a,s.length-=a;break}s.mode=ie;break;case U:for(;M<14;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(s.nlen=(R&31)+257,R>>>=5,M-=5,s.ndist=(R&31)+1,R>>>=5,M-=5,s.ncode=(R&15)+4,R>>>=4,M-=4,s.nlen>286||s.ndist>30){g.msg="too many length or distance symbols",s.mode=ge;break}s.have=0,s.mode=te;case te:for(;s.have<s.ncode;){for(;M<3;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.lens[ur[s.have++]]=R&7,R>>>=3,M-=3}for(;s.have<19;)s.lens[ur[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,vt={bits:s.lenbits},gt=n(r,s.lens,0,19,s.lencode,0,s.work,vt),s.lenbits=vt.bits,gt){g.msg="invalid code lengths set",s.mode=ge;break}s.have=0,s.mode=F;case F:for(;s.have<s.nlen+s.ndist;){for(;y=s.lencode[R&(1<<s.lenbits)-1],v=y>>>24,X=y>>>16&255,ce=y&65535,!(v<=M);){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(ce<16)R>>>=v,M-=v,s.lens[s.have++]=ce;else{if(ce===16){for(mt=v+2;M<mt;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(R>>>=v,M-=v,s.have===0){g.msg="invalid bit length repeat",s.mode=ge;break}Je=s.lens[s.have-1],a=3+(R&3),R>>>=2,M-=2}else if(ce===17){for(mt=v+3;M<mt;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}R>>>=v,M-=v,Je=0,a=3+(R&7),R>>>=3,M-=3}else{for(mt=v+7;M<mt;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}R>>>=v,M-=v,Je=0,a=11+(R&127),R>>>=7,M-=7}if(s.have+a>s.nlen+s.ndist){g.msg="invalid bit length repeat",s.mode=ge;break}for(;a--;)s.lens[s.have++]=Je}}if(s.mode===ge)break;if(s.lens[256]===0){g.msg="invalid code -- missing end-of-block",s.mode=ge;break}if(s.lenbits=9,vt={bits:s.lenbits},gt=n(o,s.lens,0,s.nlen,s.lencode,0,s.work,vt),s.lenbits=vt.bits,gt){g.msg="invalid literal/lengths set",s.mode=ge;break}if(s.distbits=6,s.distcode=s.distdyn,vt={bits:s.distbits},gt=n(f,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,vt),s.distbits=vt.bits,gt){g.msg="invalid distances set",s.mode=ge;break}if(s.mode=ne,E===d)break e;case ne:s.mode=ae;case ae:if(j>=6&&Fe>=258){g.next_out=ve,g.avail_out=Fe,g.next_in=Y,g.avail_in=j,s.hold=R,s.bits=M,i(g,He),ve=g.next_out,me=g.output,Fe=g.avail_out,Y=g.next_in,W=g.input,j=g.avail_in,R=s.hold,M=s.bits,s.mode===ie&&(s.back=-1);break}for(s.back=0;y=s.lencode[R&(1<<s.lenbits)-1],v=y>>>24,X=y>>>16&255,ce=y&65535,!(v<=M);){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(X&&!(X&240)){for(ee=v,ut=X,Me=ce;y=s.lencode[Me+((R&(1<<ee+ut)-1)>>ee)],v=y>>>24,X=y>>>16&255,ce=y&65535,!(ee+v<=M);){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}R>>>=ee,M-=ee,s.back+=ee}if(R>>>=v,M-=v,s.back+=v,s.length=ce,X===0){s.mode=Ie;break}if(X&32){s.back=-1,s.mode=ie;break}if(X&64){g.msg="invalid literal/length code",s.mode=ge;break}s.extra=X&15,s.mode=Se;case Se:if(s.extra){for(mt=s.extra;M<mt;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.length+=R&(1<<s.extra)-1,R>>>=s.extra,M-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=be;case be:for(;y=s.distcode[R&(1<<s.distbits)-1],v=y>>>24,X=y>>>16&255,ce=y&65535,!(v<=M);){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(!(X&240)){for(ee=v,ut=X,Me=ce;y=s.distcode[Me+((R&(1<<ee+ut)-1)>>ee)],v=y>>>24,X=y>>>16&255,ce=y&65535,!(ee+v<=M);){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}R>>>=ee,M-=ee,s.back+=ee}if(R>>>=v,M-=v,s.back+=v,X&64){g.msg="invalid distance code",s.mode=ge;break}s.offset=ce,s.extra=X&15,s.mode=le;case le:if(s.extra){for(mt=s.extra;M<mt;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}s.offset+=R&(1<<s.extra)-1,R>>>=s.extra,M-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){g.msg="invalid distance too far back",s.mode=ge;break}s.mode=he;case he:if(Fe===0)break e;if(a=He-Fe,s.offset>a){if(a=s.offset-a,a>s.whave&&s.sane){g.msg="invalid distance too far back",s.mode=ge;break}a>s.wnext?(a-=s.wnext,S=s.wsize-a):S=s.wnext-a,a>s.length&&(a=s.length),h=s.window}else h=me,S=ve-s.offset,a=s.length;a>Fe&&(a=Fe),Fe-=a,s.length-=a;do me[ve++]=h[S++];while(--a);s.length===0&&(s.mode=ae);break;case Ie:if(Fe===0)break e;me[ve++]=s.length,Fe--,s.mode=ae;break;case Be:if(s.wrap){for(;M<32;){if(j===0)break e;j--,R|=W[Y++]<<M,M+=8}if(He-=Fe,g.total_out+=He,s.total+=He,s.wrap&4&&He&&(g.adler=s.check=s.flags?t(s.check,me,He,ve-He):e(s.check,me,He,ve-He)),He=Fe,s.wrap&4&&(s.flags?R:Qe(R))!==s.check){g.msg="incorrect data check",s.mode=ge;break}R=0,M=0}s.mode=pe;case pe:if(s.wrap&&s.flags){for(;M<32;){if(j===0)break e;j--,R+=W[Y++]<<M,M+=8}if(s.wrap&4&&R!==(s.total&4294967295)){g.msg="incorrect length check",s.mode=ge;break}R=0,M=0}s.mode=ke;case ke:gt=L;break e;case ge:gt=O;break e;case xe:return A;case Re:default:return w}return g.next_out=ve,g.avail_out=Fe,g.next_in=Y,g.avail_in=j,s.hold=R,s.bits=M,(s.wsize||He!==g.avail_out&&s.mode<ge&&(s.mode<Be||E!==u))&&D(g,g.output,g.next_out,He-g.avail_out),ii-=g.avail_in,He-=g.avail_out,g.total_in+=ii,g.total_out+=He,s.total+=He,s.wrap&4&&He&&(g.adler=s.check=s.flags?t(s.check,me,He,g.next_out-He):e(s.check,me,He,g.next_out-He)),g.data_type=s.bits+(s.last?64:0)+(s.mode===ie?128:0)+(s.mode===ne||s.mode===I?256:0),(ii===0&&He===0||E===u)&&gt===T&&(gt=C),gt},K=g=>{if(Ne(g))return w;let E=g.state;return E.window&&(E.window=null),g.state=null,T},re=(g,E)=>{if(Ne(g))return w;const s=g.state;return s.wrap&2?(s.head=E,E.done=!1,T):w},oe=(g,E)=>{const s=E.length;let W,me,Y;return Ne(g)||(W=g.state,W.wrap!==0&&W.mode!==se)?w:W.mode===se&&(me=1,me=e(me,E,s,0),me!==W.check)?O:(Y=D(g,E,s,s),Y?(W.mode=xe,A):(W.havedict=1,T))};return bt.inflateReset=qe,bt.inflateReset2=Pe,bt.inflateResetKeep=lt,bt.inflateInit=J,bt.inflateInit2=_e,bt.inflate=G,bt.inflateEnd=K,bt.inflateGetHeader=re,bt.inflateSetDictionary=oe,bt.inflateInfo="pako inflate (from Nodeca project)",bt}var Pn,Zr;function pl(){if(Zr)return Pn;Zr=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return Pn=e,Pn}var $r;function gl(){if($r)return qt;$r=1;const e=dl(),t=Ha(),i=Ya(),n=lr(),r=qa(),o=pl(),f=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:p,Z_OK:d,Z_STREAM_END:T,Z_NEED_DICT:L,Z_STREAM_ERROR:Z,Z_DATA_ERROR:w,Z_MEM_ERROR:O}=Qt();function A(H){this.options=t.assign({chunkSize:1024*64,windowBits:15,to:""},H||{});const k=this.options;k.raw&&k.windowBits>=0&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),k.windowBits>=0&&k.windowBits<16&&!(H&&H.windowBits)&&(k.windowBits+=32),k.windowBits>15&&k.windowBits<48&&(k.windowBits&15||(k.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let b=e.inflateInit2(this.strm,k.windowBits);if(b!==d)throw new Error(n[b]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),k.dictionary&&(typeof k.dictionary=="string"?k.dictionary=i.string2buf(k.dictionary):f.call(k.dictionary)==="[object ArrayBuffer]"&&(k.dictionary=new Uint8Array(k.dictionary)),k.raw&&(b=e.inflateSetDictionary(this.strm,k.dictionary),b!==d)))throw new Error(n[b])}A.prototype.push=function(H,k){const b=this.strm,P=this.options.chunkSize,q=this.options.dictionary;let $,ue,fe;if(this.ended)return!1;for(k===~~k?ue=k:ue=k===!0?p:u,f.call(H)==="[object ArrayBuffer]"?b.input=new Uint8Array(H):b.input=H,b.next_in=0,b.avail_in=b.input.length;;){for(b.avail_out===0&&(b.output=new Uint8Array(P),b.next_out=0,b.avail_out=P),$=e.inflate(b,ue),$===L&&q&&($=e.inflateSetDictionary(b,q),$===d?$=e.inflate(b,ue):$===w&&($=L));b.avail_in>0&&$===T&&b.state.wrap>0&&H[b.next_in]!==0;)e.inflateReset(b),$=e.inflate(b,ue);switch($){case Z:case w:case L:case O:return this.onEnd($),this.ended=!0,!1}if(fe=b.avail_out,b.next_out&&(b.avail_out===0||$===T))if(this.options.to==="string"){let Te=i.utf8border(b.output,b.next_out),we=b.next_out-Te,se=i.buf2string(b.output,Te);b.next_out=we,b.avail_out=P-we,we&&b.output.set(b.output.subarray(Te,Te+we),0),this.onData(se)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(!($===d&&fe===0)){if($===T)return $=e.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(b.avail_in===0)break}}return!0},A.prototype.onData=function(H){this.chunks.push(H)},A.prototype.onEnd=function(H){H===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg};function C(H,k){const b=new A(k);if(b.push(H),b.err)throw b.msg||n[b.err];return b.result}function V(H,k){return k=k||{},k.raw=!0,C(H,k)}return qt.Inflate=A,qt.inflate=C,qt.inflateRaw=V,qt.ungzip=C,qt.constants=Qt(),qt}var jr;function _l(){if(jr)return xt;jr=1;const{Deflate:e,deflate:t,deflateRaw:i,gzip:n}=ul(),{Inflate:r,inflate:o,inflateRaw:f,ungzip:u}=gl(),p=Qt();return xt.Deflate=e,xt.deflate=t,xt.deflateRaw=i,xt.gzip=n,xt.Inflate=r,xt.inflate=o,xt.inflateRaw=f,xt.ungzip=u,xt.constants=p,xt}var Xr;function ml(){if(Xr)return vi;Xr=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.decodeTileLayer=void 0;const e=ol(),t=sl(),i=_l(),n=Na(),r=Ua(),o=sr(),f={[o.Encoding.BASE64]:e.toByteArray},u={[r.Compression.NONE]:d=>d,[r.Compression.ZLIB]:i.inflate,[r.Compression.GZIP]:i.ungzip,[r.Compression.ZSTD]:t.decompress};function p(d){var w;if((0,n.isUnencodedTileLayer)(d))return d;const T=f[d.encoding],L=u[d.compression??r.Compression.NONE],Z=O=>Array.from(new Uint32Array(O.buffer,O.byteOffset));return{...d,compression:r.Compression.NONE,encoding:o.Encoding.CSV,data:d.data!=null?Z(L(T(d.data))):void 0,chunks:(w=d.chunks)==null?void 0:w.map(O=>({...O,data:Z(L(T(O.data)))}))}}return vi.decodeTileLayer=p,vi}var Ti={},Kr;function yl(){if(Kr)return Ti;Kr=1,Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.DrawOrder=void 0;var e;return function(t){t.TOPDOWN="topdown",t.INDEX="index"}(e||(Ti.DrawOrder=e={})),Ti}var Si={},Vr;function vl(){if(Vr)return Si;Vr=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.MapOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric",t.STAGGERED="staggered",t.HEXAGONAL="hexagonal"}(e||(Si.MapOrientation=e={})),Si}var ki={},Jr;function wl(){if(Jr)return ki;Jr=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.MapRenderOrder=void 0;var e;return function(t){t.RIGHT_DOWN="right-down",t.RIGHT_UP="right-up",t.LEFT_DOWN="left-down",t.LEFT_UP="left-up"}(e||(ki.MapRenderOrder=e={})),ki}var Ei={},Qr;function bl(){if(Qr)return Ei;Qr=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.StaggerAxis=void 0;var e;return function(t){t.X="x",t.Y="y"}(e||(Ei.StaggerAxis=e={})),Ei}var Oi={},ea;function xl(){if(ea)return Oi;ea=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.StaggerIndex=void 0;var e;return function(t){t.ODD="odd",t.EVEN="even"}(e||(Oi.StaggerIndex=e={})),Oi}var Ri={},ta;function Tl(){if(ta)return Ri;ta=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.PropertyType=void 0;var e;return function(t){t.STRING="string",t.INT="int",t.FLOAT="float",t.BOOL="bool",t.COLOR="color",t.FILE="file",t.OBJECT="object",t.CLASS="class"}(e||(Ri.PropertyType=e={})),Ri}var Ai={},ia;function Sl(){if(ia)return Ai;ia=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.HorizontalAlign=void 0;var e;return function(t){t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify",t.LEFT="left"}(e||(Ai.HorizontalAlign=e={})),Ai}var Ii={},na;function kl(){if(na)return Ii;na=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.VerticalAlign=void 0;var e;return function(t){t.CENTER="center",t.BOTTOM="bottom",t.TOP="top"}(e||(Ii.VerticalAlign=e={})),Ii}var Zt={},ra;function El(){if(ra)return Zt;ra=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.isTilesetRef=Zt.isEmbeddedTileset=void 0;function e(i){return i.source==null}Zt.isEmbeddedTileset=e;function t(i){return i.source!=null}return Zt.isTilesetRef=t,Zt}var Mi={},aa;function Ol(){if(aa)return Mi;aa=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.FillMode=void 0;var e;return function(t){t.STRETCH="stretch",t.PRESERVE_ASPECT_FIT="preserve-aspect-fit"}(e||(Mi.FillMode=e={})),Mi}var Ci={},oa;function Rl(){if(oa)return Ci;oa=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.ObjectAlignment=void 0;var e;return function(t){t.UNSPECIFIED="unspecified",t.TOPLEFT="topleft",t.TOP="top",t.TOPRIGHT="topright",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.BOTTOMLEFT="bottomleft",t.BOTTOM="bottom",t.BOTTOMRIGHT="bottomright"}(e||(Ci.ObjectAlignment=e={})),Ci}var Li={},sa;function Al(){if(sa)return Li;sa=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.TileRenderSize=void 0;var e;return function(t){t.TILE="tile",t.GRID="grid"}(e||(Li.TileRenderSize=e={})),Li}var Pi={},la;function Il(){if(la)return Pi;la=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.WangSetType=void 0;var e;return function(t){t.CORNER="corner",t.EDGE="edge",t.MIXED="mixed"}(e||(Pi.WangSetType=e={})),Pi}var ca;function Ml(){return ca||(ca=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WangSetType=e.TileRenderSize=e.ObjectAlignment=e.FillMode=e.isTilesetRef=e.isEmbeddedTileset=e.VerticalAlign=e.HorizontalAlign=e.PropertyType=e.StaggerIndex=e.StaggerAxis=e.RenderOrder=e.MapOrientation=e.Encoding=e.DrawOrder=e.decodeTileLayer=e.Compression=e.isUnencodedTileLayer=e.isTileLayer=e.isObjectGroup=e.isImageLayer=e.isGroup=e.isEncodedTileLayer=e.GridOrientation=void 0;var t=al();Object.defineProperty(e,"GridOrientation",{enumerable:!0,get:function(){return t.GridOrientation}});var i=Na();Object.defineProperty(e,"isEncodedTileLayer",{enumerable:!0,get:function(){return i.isEncodedTileLayer}}),Object.defineProperty(e,"isGroup",{enumerable:!0,get:function(){return i.isGroup}}),Object.defineProperty(e,"isImageLayer",{enumerable:!0,get:function(){return i.isImageLayer}}),Object.defineProperty(e,"isObjectGroup",{enumerable:!0,get:function(){return i.isObjectGroup}}),Object.defineProperty(e,"isTileLayer",{enumerable:!0,get:function(){return i.isTileLayer}}),Object.defineProperty(e,"isUnencodedTileLayer",{enumerable:!0,get:function(){return i.isUnencodedTileLayer}});var n=Ua();Object.defineProperty(e,"Compression",{enumerable:!0,get:function(){return n.Compression}});var r=ml();Object.defineProperty(e,"decodeTileLayer",{enumerable:!0,get:function(){return r.decodeTileLayer}});var o=yl();Object.defineProperty(e,"DrawOrder",{enumerable:!0,get:function(){return o.DrawOrder}});var f=sr();Object.defineProperty(e,"Encoding",{enumerable:!0,get:function(){return f.Encoding}});var u=vl();Object.defineProperty(e,"MapOrientation",{enumerable:!0,get:function(){return u.MapOrientation}});var p=wl();Object.defineProperty(e,"RenderOrder",{enumerable:!0,get:function(){return p.MapRenderOrder}});var d=bl();Object.defineProperty(e,"StaggerAxis",{enumerable:!0,get:function(){return d.StaggerAxis}});var T=xl();Object.defineProperty(e,"StaggerIndex",{enumerable:!0,get:function(){return T.StaggerIndex}});var L=Tl();Object.defineProperty(e,"PropertyType",{enumerable:!0,get:function(){return L.PropertyType}});var Z=Sl();Object.defineProperty(e,"HorizontalAlign",{enumerable:!0,get:function(){return Z.HorizontalAlign}});var w=kl();Object.defineProperty(e,"VerticalAlign",{enumerable:!0,get:function(){return w.VerticalAlign}});var O=El();Object.defineProperty(e,"isEmbeddedTileset",{enumerable:!0,get:function(){return O.isEmbeddedTileset}}),Object.defineProperty(e,"isTilesetRef",{enumerable:!0,get:function(){return O.isTilesetRef}});var A=Ol();Object.defineProperty(e,"FillMode",{enumerable:!0,get:function(){return A.FillMode}});var C=Rl();Object.defineProperty(e,"ObjectAlignment",{enumerable:!0,get:function(){return C.ObjectAlignment}});var V=Al();Object.defineProperty(e,"TileRenderSize",{enumerable:!0,get:function(){return V.TileRenderSize}});var H=Il();Object.defineProperty(e,"WangSetType",{enumerable:!0,get:function(){return H.WangSetType}})}(En)),En}var en=Ml();const Cl="modulepreload",Ll=function(e,t){return new URL(e,t).href},ua={},Ue=function(t,i,n){let r=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),p=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));r=Promise.allSettled(i.map(d=>{if(d=Ll(d,n),d in ua)return;ua[d]=!0;const T=d.endsWith(".css"),L=T?'[rel="stylesheet"]':"";if(!!n)for(let O=f.length-1;O>=0;O--){const A=f[O];if(A.href===d&&(!T||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${L}`))return;const w=document.createElement("link");if(w.rel=T?"stylesheet":Cl,T||(w.as="script"),w.crossOrigin="",w.href=d,p&&w.setAttribute("nonce",p),document.head.appendChild(w),T)return new Promise((O,A)=>{w.addEventListener("load",O),w.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(f){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=f,window.dispatchEvent(u),!u.defaultPrevented)throw f}return r.then(f=>{for(const u of f||[])u.status==="rejected"&&o(u.reason);return t().catch(o)})},Gt=[async()=>(await Ue(async()=>{const{default:e}=await import("./debug.map-Dh17g7sO.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-1.map-HrzVBmhk.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-2.map-COvut79T.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-4.map-DyaDC7a4.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./caverns-2.map-Dm8eaRKf.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./caverns-4.map-TIEY-FR3.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./kingdom-1.map-DHCgusx2.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./kingdom-2.map-DgeV_ILq.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./kingdom-4.map-BAlk0Kf_.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./kingdom-6.map-CdZtI1P2.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-11.map-CK9_RlFO.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./kingdom-12.map-C83vVbbt.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-18.map-DqjvACYs.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-20.map-Bt29gIvk.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-26-d25zOK1b.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-30-zb7b_cE_.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-34.map-DOIuDpY9.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-42-s6lUqP71.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-46.map-CShhjaIo.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-48.map-CmhiA3iK.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-52-BnTj2nEA.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-59.map-CH8JYC4u.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-61-CxlI7Ien.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-64-ZP9JZMYb.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-70.map-BkOZtI6o.js");return{default:e}},[],import.meta.url)).default,async()=>(await Ue(async()=>{const{default:e}=await import("./lost-75-DakJFaZ7.js");return{default:e}},[],import.meta.url)).default];async function gn(){var i;Ul();let e=N.levelIndex;for(;!Gt[e];)e=hn(e+1,Gt.length);za();const t=await zl(e);(i=t==null?void 0:t.onLevelStart)==null||i.call(t),Wl(),Zn()}async function Za(){Kn();let e=N.levelIndex;do e=hn(e+1,Gt.length);while(!Gt[e]);e%10===0&&await $l(),N.levelIndex=e,await gn(),await Ee("Press any key to begin this level.")}async function Pl(){Kn();let e=N.levelIndex;do e=hn(e-1,Gt.length);while(!Gt[e]);N.levelIndex=e,await gn(),await Ee("Press any key to begin this level.")}async function zl(e){N.levelIndex=e;const t=Gt[N.levelIndex],i=await t(),n=Dl(i);return m.tabletMessage=n.tabletMessage,Fl(n.data),m.map.updateTilesByType(c.Gem,{fg:Q.getUniformInt(1,15)}),nt[c.Border]=[Q.getUniformInt(8,15),Q.getUniformInt(1,8)],n}function Dl(e){const{layers:t,properties:i}=e,n=on(i),r=[];for(const d of t)if(en.isEncodedTileLayer(d))f(en.decodeTileLayer(d),r);else if(en.isUnencodedTileLayer(d))f(d,r);else if(en.isObjectGroup(d))o(d,r);else throw new Error("Unsupported layer encoding");function o(d,T){for(const L of d.objects){const{gid:Z,x:w,y:O,height:A,width:C,properties:V}=L;if(!Z||!w||!O||!A||!C)continue;const H=Er(L.gid);if(H>-1){const k=w/C,b=O/A-1;T[b*e.width+k]=Yn(H,k,b,on(V))}}return T}function f(d,T){const{data:L}=d;if(!L)return T;for(let Z=0;Z<L.length;Z++){const w=Er(+L[Z]);if(w>-1){const O=Z%e.width,A=Math.floor(Z/e.width);T[Z]=Yn(w,O,A)}}return T}async function u(){if("onLevelStart"in e&&await e.onLevelStart(),!!n&&(m.magicEwalls=n.MagicEWalls??!1,m.evapoRate=n.EvapoRate??0,m.treeRate=n.TreeRate??0,m.lavaRate=n.LavaRate??0,m.lavaFlow=n.LavaFlow??!1,n.HideGems&&m.map.hideType(c.Gem),n.HideRocks&&m.map.hideType(c.Rock),n.HideStairs&&m.map.hideType(c.Stairs),n.HideOpenWall&&(m.map.hideType(c.OSpell1),m.map.hideType(c.OSpell2),m.map.hideType(c.OSpell3)),n.HideCreate&&m.map.hideType(c.Create),n.HideMBlock&&m.map.hideType(c.MBlock),n.HideTrap&&m.map.hideType(c.Trap),n.HideLevel))for(let d=0;d<m.map.width;d++)for(let T=0;T<m.map.height;T++){const L=m.map.get(d,T);L&&!L.has(pn)&&L.add(Vt)}}const p=e.tabletMessage??(n==null?void 0:n.tabletMessage)??void 0;return{id:(n==null?void 0:n.id)||"",data:r,onLevelStart:u,tabletMessage:p,properties:n}}function Fl(e){const t=m.map;let i=0;for(let n=0;n<=Ve;n++)for(let r=0;r<=$e;r++){const o=e[i++];t.set(r,n,o)}for(let n=0;n<=Ve;n++)for(let r=0;r<=$e;r++){const o=t.get(r,n);o&&(o.type===c.Statue&&(m.T[Ke.StatueGemDrain]=32e3),o.has(pn)&&(m.player=o),o.has(nr)&&m.entities.push(o),o.has(ka)&&m.genNum++)}}class Bl{constructor(t=$e+1,i=Ve+1){it(this,"PF",[]);this.width=t,this.height=i}get(t,i){var n,r;return t<0||t>=this.width||i<0||i>=this.height?null:(r=(n=this.PF)==null?void 0:n[t])==null?void 0:r[i]}set(t,i,n){var r;t<0||t>=this.width||i<0||i>=this.height||((r=this.PF)[t]??(r[t]=[]),this.PF[t][i]=n)}getType(t,i){var r;if(t<0||t>=this.width||i<0||i>=this.height)return c.Border;const n=(r=this.get(t,i))==null?void 0:r.type;return typeof n=="string"?n:n??c.Floor}setType(t,i,n){this.set(t,i,or(n,t,i))}findRandomEmptySpace(){for(;;){const t=Q.getUniformInt(0,$e),i=Q.getUniformInt(0,Ve);if(this.getType(t,i)===c.Floor)return[t,i]}}updateTilesByType(t,i){for(let n=0;n<this.width;n++)for(let r=0;r<this.height;r++){const o=this.get(n,r);if((o==null?void 0:o.type)===t){const f=o.get(Jt);Object.assign(f,i)}}}hideType(t){for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++){const r=this.get(i,n);(r==null?void 0:r.type)===t&&r.add(Vt)}}}var Ke=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e[e.StatueGemDrain=9]="StatueGemDrain",e))(Ke||{});function _n(){return{levelIndex:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2}}function cr(){return{bonus:0,genNum:0,magicEwalls:!1,evapoRate:0,treeRate:0,lavaRate:0,lavaFlow:!1,level:null,player:new Aa(c.Player),entities:[],map:new Bl,replacement:c.Floor,T:[0,0,0,0,0,0,0,0,0,0],tabletMessage:void 0}}function $a(){return{difficulty:8,clockScale:yo,paused:!1,done:!1,foundSet:new Set}}const N=_n(),m=cr(),Ze=$a(),ja=_n(),qn=_n();function Nl(){Object.assign(N,_n()),Object.assign(m,cr()),Object.assign(Ze,$a())}function Ul(){Object.assign(m,cr())}function Wl(){Object.assign(ja,N)}async function Gl(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n"&&e.toLowerCase()!=="w"&&e.toLowerCase()!=="t";)e=await Ee("Are you sure you want to SAVE? (Y/N)");(e.toLowerCase()==="y"||e.toLowerCase()==="w")&&(Object.assign(qn,ja),localStorage.setItem("Kroz--saveState--v1",JSON.stringify(qn)))}async function Hl(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n"&&e.toLowerCase()!=="w"&&e.toLowerCase()!=="t";)e=await Ee("Are you sure you want to RESTORE? (Y/N)");if(e.toLowerCase()==="y"||e.toLowerCase()==="w"){let t=qn;const i=localStorage.getItem("Kroz--saveState--v1");if(i)try{t=JSON.parse(i)}catch(n){console.error(n)}Object.assign(N,t),await gn(),await Ee("Press any key to begin this level.")}}function We(e){switch(e){case c.Border:N.score>N.levelIndex&&(N.score-=N.levelIndex/2);break;case c.Slow:case c.Medium:case c.Fast:N.score+=e;break;case c.Block:case c.ZBlock:case c.GBlock:case c.Wall:case c.River:case c.Tree:case c.Forest:case c.MBlock:case c.OWall1:case c.OWall2:case c.OWall3:case c.EWall:N.score>2&&(N.score-=2);break;case c.Whip:case c.SlowTime:case c.Bomb:N.score++;break;case c.Stairs:N.score+=N.levelIndex*5;break;case c.Chest:N.score+=10+Math.floor(N.levelIndex/2);break;case c.Gem:N.score+=Math.floor(N.levelIndex/2)+1;break;case c.Invisible:N.score+=25;break;case c.Nugget:N.score+=50;break;case c.Door:N.score+=10;break;case c.Teleport:case c.Freeze:N.score+=2;break;case c.SpeedTime:case c.Power:N.score+=5;break;case c.Trap:N.score>5&&(N.score-=5);break;case c.Lava:N.score>100&&(N.score+=100);break;case c.Tome:N.score+=5e3;break;case c.Tablet:N.score+=N.levelIndex+250;break;case c.Chance:N.score+=100;break;case c.Statue:N.score+=10;break;case c.Amulet:N.score+=2500;break;case c.Z:N.score+=1e3;break}kt()}async function ei(e,t){const i=m.map.get(e,t);m.map.setType(e,t,c.Floor),ze(e,t),i&&i.has(st)&&await ln(i)}async function ln(e){var t;typeof e.type=="number"&&e.type<4&&await Vo(e.type),(t=e.get(st))==null||t.die()}async function Xa(e=1){for(let t=0;t<e;t++){let i=!1;do{const n=Q.getUniformInt(0,$e),r=Q.getUniformInt(0,Ve);if(m.map.getType(n,r)===c.Floor){const o=or(c.Slow,n,r);m.entities.push(o),m.map.set(n,r,o),await ys(),i=!0}It()}while(!i&&Q.getUniformInt(0,50)!==0)}}function zt(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.from(typeof e=="string"?[e]:e);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var r=n.reduce(function(u,p){var d=p.match(/\n([\t ]+|(?!\s).)/g);return d?u.concat(d.map(function(T){var L,Z;return(Z=(L=T.match(/[\t ]/g))===null||L===void 0?void 0:L.length)!==null&&Z!==void 0?Z:0})):u},[]);if(r.length){var o=new RegExp(`
[	 ]{`+Math.min.apply(Math,r)+"}","g");n=n.map(function(u){return u.replace(o,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var f=n[0];return t.forEach(function(u,p){var d=f.match(/(?:^|\n)( *)$/),T=d?d[1]:"",L=u;typeof u=="string"&&u.includes(`
`)&&(L=String(u).split(`
`).map(function(Z,w){return w===0?Z:""+T+Z}).join(`
`)),f+=L+n[p+1]}),f}function Yl(){Oe(70,0,"Score",z.Yellow,z.Blue),Oe(70,3,"Level",z.Yellow,z.Blue),Oe(70,6,"Gems",z.Yellow,z.Blue),Oe(70,9,"Whips",z.Yellow,z.Blue),Oe(68,12,"Teleports",z.Yellow,z.Blue),Oe(70,15,"Keys",z.Yellow,z.Blue);const[t,i]=tr(z.HighIntensityWhite,z.Blue);Oe(69,18,"OPTIONS",t,z.Red),Oe(69,19,`%c{${t}}W%c{}hip`,z.White,i),Oe(69,20,`%c{${t}}T%c{}eleport`,z.White,i),Oe(69,21,`%c{${t}}P%c{}ause`,z.White,i),Oe(69,22,`%c{${t}}Q%c{}uit`,z.White,i),Oe(69,23,`%c{${t}}S%c{}ave`,z.White,i),Oe(69,24,`%c{${t}}R%c{}estore`,z.White,i)}function kt(){const e=N.whipPower>2?`${N.whips}+${N.whipPower-2}`:N.whips.toString(),t=4,i=7,n=!Ze.paused&&N.gems<10?z.Red|16:z.Red,r=69;Oe(r,1,ai((N.score*10).toString(),t+1,i),z.Red,z.Grey),Oe(r,4,ai(N.levelIndex.toString(),t,i),z.Red,z.Grey),Oe(r,7,ai(N.gems.toString(),t+1,i),n,z.Grey),Oe(r,10,ai(e,t,i),z.Red,z.Grey),Oe(r,13,ai(N.teleports.toString(),t,i),z.Red,z.Grey),Oe(r,16,ai(N.keys.toString(),t,i),z.Red,z.Grey)}function Ka(){const e=Gi[c.Border],[t,i]=nt[c.Border];for(let n=Dt-1;n<=ui+1;n++)Wt(n,0,e,t,i),Wt(n,Ni+1,e,t,i);for(let n=jt-1;n<=Ni+1;n++)Wt(0,n,e,t,i),Wt(ui+1,n,e,t,i)}async function ql(){return ti(z.Black),dt(20,Bi,z.Yellow),dt(21,"Original Level Design (C) 1990 Scott Miller",z.Yellow),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite),Vn(async()=>{Oe(5,5,zt`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `,Q.getUniformInt(1,15)),await Ce(500)})}async function Zl(){ti(z.Black),dt(0,Bi,z.Yellow,z.Black),dt(1,"INSTRUCTIONS",z.HighIntensityWhite,z.Black),dt(2,"------------",z.HighIntensityWhite,z.Black),Oe(0,5,zt`
    The dungeons contain dozens of treasures,  spells,  traps and other mysteries.
  Touching an object for the first time will reveal a little of its identity,  but
  it will be left to you to decide how best to use it or avoid it.                
    When a creature touches you it will vanish,  taking with it a few of your gems
  that you have collected. If you have no gems then the creature will instead take
  your life!  Whips can be used to kill nearby creatures, but they are better used
  to smash through crumbled walls and forest terrain.`,z.LightBlue,z.Black),Oe(3,13,zt`
    You can use these        u i o    7 8 9
    cursor keys to            \\|/      \\|/     w or 5: Whip
    move your man,           j- -k    4- -6         T: Teleport
    and the four              /|\\      /|\\
    normal cursor keys       n m ,    1 2 3`,z.LightBlue,z.Black),Oe(0,19,zt`
    It's a good idea to save (S) your game at every new level,  therefore,  if you
    die you can easily restore (R) the game at that level and try again.`,z.LightBlue,z.Black),dt(22,"Have fun and good-luck...",z.HighIntensityWhite,z.Black),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await si()}async function $l(){ti(z.Black),dt(1,Bi,z.Yellow),Oe(2,4,zt`
    Kroz is a series of Roguelike video games created by Scott Miller and 
    published by Apogee Software in the late 1980s and early 1990s.  In March
    2009, the whole Kroz series was released as freeware by Apogee, and the
    source code was released as free software under the GPL license.`,z.White),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await si(),ji(),Oe(2,9,zt`
    This is a re-implementation the original Kroz series of games in typescript 
    playable in the browser.  The source code completly open-source.  If you
    enjoy this game you are asked by the author to please add a star to the
    github repo at https://github.com/Hypercubed/kroz.`,z.White),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await si(),ji(),Oe(2,15,zt`
    Better yet, contribute to the game yourself; or maybe fork it and add your
    own levels.  That might make a nice 7DRL challenge entry
    (https://7drl.com/).`,z.White),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await si(),ji(),Oe(10,20,"Thank you and enjoy the game.  -- Hypercubed"),dt(Pt-1,"Press any key to continue.",z.HighIntensityWhite,z.Black),await si(),ji()}function ai(e,t,i){return e.padStart(t,Ft).padEnd(i,Ft)}function It(){for(let t=0;t<m.map.width;t++)for(let i=0;i<m.map.height;i++){const n=m.map.get(t,i);if(!n){Va(t,i);continue}n.type===c.Player||n.type===c.Slow||n.type===c.Medium||n.type===c.Fast||ze(t,i,n)}for(let t=0;t<m.entities.length;t++){const i=m.entities[t],n=i.get(st);n.x===-1||n.y===-1||ze(n.x,n.y,i)}const e=m.player.get(st);e&&ze(e.x,e.y,m.player)}function Va(e,t){const[i,n]=nt[c.Floor];Wt(e+Dt,t+Dt,Ft,i,n)}function ze(e,t,i){if(Va(e,t),i??(i=m.map.get(e,t)),!i||i.has(Vt))return;if(i.has(Ui)){const[r,o]=nt[c.Chance];Wt(e+Dt,t+jt,Gi[c.Chance],r,o);return}if(!i.has(Jt))return;const n=i.get(Jt);Wt(e+Dt,t+jt,n.ch,n.fg,n.bg)}function Bt(e,t,i,n,r){var f,u;i??(i=m.map.getType(e,t));let o;switch(jl(i)?(o=Gi[i]??i??Gi[c.Floor],n??(n=((f=nt[i])==null?void 0:f[0])??nt[c.Floor][0]),r??(r=((u=nt[i])==null?void 0:u[1])??nt[c.Floor][1])):i>="a"&&i<="z"||["!","·","∙","∩"].includes(i)?(o=i.toUpperCase(),n=n??z.HighIntensityWhite,r=r??z.Brown):o=i,i){case c.Stairs:n=typeof n=="number"&&!Ze.paused?n|16:n;break}Wt(e+Dt,t+jt,o,n,r)}function cn(e,t,i,n){var f;const r=m.map.getType(e,t);let o;r>="a"&&r<="z"||r==="!"?o=z.Brown:o=((f=nt[r])==null?void 0:f[1])??nt[c.Floor][1],Zo(e+Dt,t+jt,i,n,o)}async function Ae(e,t=!1){if(t){if(Ze.foundSet===!0||Ze.foundSet.has(e))return"";Ze.foundSet.add(e)}const i=Ns[e];return i?await Ee(i):""}async function Ee(e){if(!e)return"";const t=(ui-e.length)/2,i=Ni+1;Ze.paused=!0;const n=await Vn(()=>{Oe(t,i,e,Q.getUniformInt(1,15),z.Black)});return Ka(),Ze.paused=!1,n}function Zn(){ti(z.Blue),Ka(),Yl(),It(),kt()}function Ja(){It(),kt()}function jl(e){return typeof e=="number"}async function Xl(){ti(z.Blue),Oe(2,5,zt`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `,z.LightCyan,z.Blue),Oe(9,16,`Use the cursor keys to move yourself (%c{${Et[z.Yellow]}}☻%c{${Et[z.LightGreen]}}) through the caverns.`,z.LightGreen,z.Blue),dt(17,"Use your whip (press W) to destroy all nearby creatures.",z.LightGreen,z.Blue),dt(Pt-1,"Press any key to begin your decent into Kroz.",z.HighIntensityWhite,z.Blue);const e=un/2-Bi.length/2;await Vn(async()=>{Oe(e,3,Bi,Q.getUniformInt(0,16),z.Red),await Ce(500)})}const tn={[Ke.SlowTime]:70*Rt,[Ke.Invisible]:75*Rt,[Ke.SpeedTime]:80*Rt,[Ke.FreezeTime]:55*Rt};async function Kl(){if(wt(Xe.NextLevel))return await Za();if(wt(Xe.PrevLevel))return await Pl();if(wt(Xe.NextLevelCheat)){const i=m.player.get(st);m.map.setType(i.x+1,i.y,c.Stairs),await Jo();return}if(wt(Xe.FreeItems)){N.gems=150,N.whips=99,N.teleports=99,N.keys=9,kt();return}if(wt(Xe.SlowerClock)){Ze.clockScale=Math.min(20,Ze.clockScale+1),console.log("Clock Scale:",Ze.clockScale);return}if(wt(Xe.FasterClock)){Ze.clockScale=Math.max(1,Ze.clockScale-1),console.log("Clock Scale:",Ze.clockScale);return}if(wt(Xe.ResetFound)){Ze.foundSet=new Set,await Ee("Newly found object descriptions are reset.");return}if(wt(Xe.HideFound)){Ze.foundSet=!0,await Ee("References to new objects will not be displayed.");return}if(wt(Xe.Pause))return tc();if(wt(Xe.Quit))return ec();if(wt(Xe.Save))return Gl();if(wt(Xe.Restore))return Hl();Ot(Xe.Whip)&&(N.whips<1?wr():(N.whips--,await Jl())),Ot(Xe.Teleport)&&(N.teleports<1?await wr():(N.teleports--,await eo()));let e=0,t=0;Ot(Xe.North)&&t--,Ot(Xe.South)&&t++,Ot(Xe.West)&&e--,Ot(Xe.East)&&e++,Ot(Xe.Southeast)&&(e++,t++),Ot(Xe.Southwest)&&(e--,t++),Ot(Xe.Northeast)&&(e++,t--),Ot(Xe.Northwest)&&(e--,t--),e=vr(e,-1,1),t=vr(t,-1,1),(e!==0||t!==0)&&await Vl(e,t)}async function Vl(e,t){var u;const i=m.player.get(st),n=i.x+e,r=i.y+t;if(n<0||n>$e||r<0||r>Ve){await xr(),We(c.Border),await Ae(c.Border,!0);return}const o=m.map.get(n,r);if(!o)return;const f=m.map.getType(n,r)||c.Floor;if(o!=null&&o.has(Wi)){const p=o.get(Wi).damage;N.gems-=p,ei(n,r),We(o.type),ct(n,r);return}if(o!=null&&o.has(Di)){Kt();const p=o.get(Di);switch(N.whips+=p.whips,N.gems+=p.gems,N.teleports+=p.teleports,N.keys+=p.keys,N.whipPower+=p.whipPower,We(f),ct(n,r),f){case c.Chest:await Ee(`You found ${p.gems} gems and ${p.whips} whips inside the chest!`);break;case c.Chance:await Ee(`You found a Pouch containing ${p.gems} Gems!`);break;default:await Ae(f,!0);break}return}if(o!=null&&o.has(Gn)){ct(n,r),await vc(o.get(Gn).type,n,r);return}if((u=o==null?void 0:o.get(li))!=null&&u.by(c.Player)){ct(n,r);return}if(o!=null&&o.has(Ea)){await gc(o,n,r,e,t);return}switch(f){case c.Wall:case c.River:case c.Block:case c.ZBlock:case c.GBlock:ri(),We(f),await Ae(f,!0);break;case c.Tree:case c.Forest:case c.Generator:case c.MBlock:We(f),await Wn(),await Ae(f,!0);break;case c.Stairs:if(ct(n,r),N.levelIndex===Gt.length-1){await nc();return}We(f),await Ae(c.Stairs,!0),ci(),await Za();break;case c.Door:N.keys<1?(Qo(),await Ce(100),await Ee("To pass the Door you need a Key.")):(N.keys--,We(f),await jo(),ct(n,r),It(),await Ae(c.Door,!0));break;case c.Lava:N.gems-=10,We(f),ct(n,r),await Ae(f,!0);break;case c.Pit:ct(n,r),N.gems=-1,await Ae(f);break;case c.Tome:m.map.setType(31,6,c.Stairs),Bt(31,6,c.Stairs),We(f),await Ae(f),await Ee("Congratulations, Adventurer, you finally did it!!!");break;case c.Tunnel:{const p=m.player.get(st),d=p.x,T=p.y;ct(n,r),await oc(n,r,d,T),await Ae(f,!0);break}case c.IBlock:ri(),m.map.setType(n,r,c.Block),ze(n,r),await Ae(f,!0);break;case c.IWall:ri(),m.map.setType(n,r,c.Wall),ze(n,r),await Ae(f,!0);break;case c.IDoor:ri(),m.map.setType(n,r,c.Door),ze(n,r),await Ae(f,!0);break;case c.Tablet:ct(n,r),Kt(),We(f),await Ae(f,!0),await ic();break;case c.Statue:Wn(),await Ae(f);break;case c.OWall1:case c.OWall2:case c.OWall3:ri(),We(c.Wall),await Ae(c.OWall1,!0);break;case c.EWall:We(f),N.gems--,xr(),await Ae(c.EWall,!0);break;case c.Message:await _c();break;case c.Amulet:ct(n,r),await rc();break;default:ri();break}}function fa(e,t){const i=m.map;for(let n=0;n<i.width;n++)for(let r=0;r<i.height;r++)i.getType(n,r)===e&&i.set(n,r,or(t,n,r))}async function Jl(){const e=m.player.get(st),t=e.x,i=e.y;es(),await n(t-1,i-1,"\\"),await n(t-1,i,"-"),await n(t-1,i+1,"/"),await n(t,i+1,"❘"),await n(t+1,i+1,"\\"),await n(t+1,i,"-"),await n(t+1,i-1,"/"),await n(t,i-1,"❘");async function n(r,o,f){if(r<0||r>$e||o<0||o>Ve)return;const u=m.map.get(r,o),p=(u==null?void 0:u.type)||c.Floor;switch(cn(r,o,f,Et[Q.getUniformInt(0,15)]),u!=null&&u.has(Ui)&&(u==null||u.remove(Ui),ze(r,o)),p){case c.Slow:case c.Medium:case c.Fast:ei(r,o),We(p);break;case c.Block:case c.Forest:case c.Tree:case c.Message:case c.MBlock:case c.ZBlock:case c.GBlock:{const d=N.whipPower;6*Math.random()<d?(p===c.MBlock&&ei(r,o),m.map.setType(r,o,c.Floor),ze(r,o),cn(r,o,f,Et[Q.getUniformInt(0,15)]),ts()):kn();break}case c.Invisible:case c.SpeedTime:case c.Trap:case c.Power:case c.K:case c.R:case c.O:case c.Z:m.map.setType(r,o,c.Floor),is();break;case c.Rock:30*Math.random()<N.whipPower?(ns(),m.map.setType(r,o,c.Floor)):kn();break;case c.Statue:50*Math.random()<N.whipPower?(m.map.setType(r,o,c.Floor),We(p),m.T[Ke.StatueGemDrain]=-1,await Ee("You've destroyed the Statue!  Your Gems are now safe.")):kn();break;case c.Generator:We(p),m.map.setType(r,o,c.Floor),m.genNum--;break}kt(),await Ce(10)}}async function Qa(){const e=m.player.get(st);for(let t=0;t<160;t++)t%5===0&&(Bt(e.x,e.y,c.Player,Q.getUniformInt(0,15),Q.getUniformInt(0,8)),await Ce()),de(t/2,80,10)}async function eo(){await Qa();const e=m.player.get(st);m.map.setType(e.x,e.y,c.Floor),ze(e.x,e.y);const t=Date.now();for(let i=0;i<700;i++){const n=Q.getUniformInt(0,$e),r=Q.getUniformInt(0,Ve),o=m.map.getType(n,r);if(Zs.indexOf(o)>-1&&(Bt(n,r,"☺",Q.getUniformInt(0,15),Q.getUniformInt(0,7)),await rs(),Bt(n,r,o)),Date.now()-t>1500)break}ct(...m.map.findRandomEmptySpace())}async function Ql(){Oe(ui/2-7,0,"You have died.",z.Black,z.Red),await Ee("Press any key to continue."),Ze.done=!0}async function ec(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await Ee("Are you sure you want to quit? (Y/N)");e.toLowerCase()==="y"&&(Ze.done=!0)}async function tc(){await Ee("Press any key to resume")}async function ic(){const e=m.tabletMessage;e&&(typeof e=="string"?await Ee(e):typeof e=="function"&&await e())}async function zc(){await Ee("On the Ancient Tablet is a short Mantra, a prayer..."),await Ee("You take a deep breath and speak the words aloud...")}async function nc(){await ci(),await Ce(200),await ci(),await Ce(200),await ci(),await Ee("Oh no, something strange is happening!"),await Ee("You are magically transported from Kroz!");const e=N.gems=isFinite(N.gems)?N.gems:150,t=N.whips=isFinite(N.whips)?N.whips:20,i=N.teleports=isFinite(N.teleports)?N.teleports:10,n=N.keys=isFinite(N.keys)?N.keys:5;await Ee("Your Gems are worth 100 points each...");for(let r=0;r<e;r++)N.gems--,N.score+=10,kt(),await de(r*8+100,20);await Ee("Your Whips are worth 100 points each...");for(let r=0;r<t;r++)N.whips--,N.score+=10,kt(),await de(r*8+100,20);await Ee("Your Teleport Scrolls are worth 200 points each...");for(let r=0;r<i;r++)N.teleports--,N.score+=20,kt(),await de(r*8+100,20);await Ee("Your Keys are worth 10,000 points each....");for(let r=0;r<n;r++)N.keys--,N.score+=1e3,kt(),await de(r*8+100,20);ti(z.Blue),Oe(25,3,"ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ",z.White,z.Blue),Oe(10,5,zt`
        Carefully, you place the ancient tome on your table and open
        to the first page.  You read the book intently, quickly
        deciphering the archaic writings.

        You learn of Lord Dullwit, the once powerful and benevolent
        ruler of Kroz, who sought wealth and education for his people.
        The magnificent KINGDOM OF KROZ was once a great empire, until
        it was overthrown by an evil Wizard, who wanted the riches of
        Kroz for himself.

        Using magic beyond understanding, the Wizard trapped Lord
        Dullwit and his people in a chamber so deep in Kroz that any
        hope of escape was fruitless.

        The Wizard then built hundreds of deadly chambers that would
        stop anyone from ever rescuing the good people of Kroz.
        Once again your thoughts becomes clear:  To venture into the
        depths once more and set free the people of Kroz.
       `,z.White,z.Blue),await Ee("Press any key, Adventurer."),Ze.done=!0}async function ha(e,t,i){for(e+=i;e>=0&&e<=$e;){const n=m.map.getType(e,t);if(typeof n!="number"||Js.includes(n))break;de(e+30,10,100);for(let r=1;r<6;r++)cn(e,t,"─",Q.getUniformInt(0,16)),await Ce(1);Qs.includes(n)||(await as(),(n===c.Slow||n===c.Medium||n===c.Fast)&&await ei(e,t),m.map.setType(e,t,c.Floor)),ze(e,t),e+=i}It()}async function rc(){await Kt(),await os(),We(c.Amulet),await Ee("You have found the Amulet of Yendor -- 25,000 points!"),await Ee("It seems that Kroz and Rogue share the same underground!)"),await Ee("Your quest for the treasure of Kroz must still continue...")}async function ac(e,t){ss();let i=0;for(;i<=4;++i){de(100-i*10/4,4*10,100);const u=Math.max(e-i,Dt),p=Math.min(e+i,ui),d=Math.max(t-i,jt),T=Math.min(t+i,Ni);for(let L=u;L<=p;L++)for(let Z=d;Z<=T;Z++){cn(L,Z,"█",z.LightRed);const w=m.map.getType(L,Z)??c.Floor;Sr.includes(w)&&w>=1&&w<=4&&(We(w),ei(L,Z))}await ls()}await Ce(100),i=4;const n=Math.max(e-i,Dt),r=Math.min(e+i,ui),o=Math.max(t-i,jt),f=Math.min(t+i,Ni);for(let u=n;u<=r;u++)for(let p=o;p<=f;p++){const d=m.map.getType(u,p)??c.Floor;Sr.includes(d)&&m.map.setType(u,p,c.Floor)}It()}async function oc(e,t,i,n){await Ce(350),await ci(),await Ce(500),m.map.setType(e,t,c.Tunnel),ze(e,t);let r=e,o=t;for(let p=0;p<1e4;p++){const d=Q.getUniformInt(0,$e),T=Q.getUniformInt(0,Ve);if((m.map.getType(d,T)??c.Floor)===c.Tunnel&&(d!==r||T!==o)){r=d,o=T,ct(r,o);break}}m.map.setType(e,t,c.Tunnel),ze(e,t);let f=i,u=n;for(let p=0;p<100;p++){const d=Q.getUniformInt(-1,1),T=Q.getUniformInt(-1,1);if(r+d<0||r+d>$e||o+T<0||o+T>Ve)continue;const L=m.map.getType(r+d,o+T)??c.Floor;if(Vs.includes(L)){f=r+d,u=o+T;break}}ct(f,u),m.map.setType(r,o,c.Tunnel),ze(r,o)}async function sc(){await cs(),await Ce(50);for(let e=0;e<50;e++){do{const t=Q.getUniformInt(0,$e),i=Q.getUniformInt(0,Ve),n=m.map.getType(t,i);if(qs.includes(n)){m.map.setType(t,i,c.Rock),ze(t,i);break}}while(Math.random()>.01);await fs()}await us()}async function lc(){let e=0,t=0;for(;e<500&&t<40;){e++;const i=Q.getUniformInt(0,m.entities.length),n=m.entities[i];if(!n)continue;const r=n.get(st);r.x===-1||r.y===-1||n.type!==c.Slow&&n.type!==c.Medium&&n.type!==c.Fast||(await ei(r.x,r.y),await Ce(20),t++)}N.score+=Math.floor(t/3+2),It(),kt()}async function cc(){m.entities.reduce((t,i)=>i.type===c.Slow?t+1:t,0)<945&&await Xa(45)}async function uc(){for(let e=0;e<Ze.difficulty*2+5;e++){let t=!1;do{const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve);m.map.getType(i,n)===c.Floor&&(t=!0,m.map.setType(i,n,c.Gem),ze(i,n),await hs(),await Ce(90))}while(!t&&Math.random()>.01)}}async function fc(){for(let e=0;e<=$e;e++)for(let t=0;t<=Ve;t++)if(m.map.getType(e,t)===c.ZBlock){ds();for(let i=20;i>0;i--)Bt(e,t,c.Block,Q.getUniformInt(0,15)),await Ce(1);m.map.setType(e,t,c.Floor),ze(e,t)}else m.map.getType(e,t)===c.BlockSpell&&(m.map.setType(e,t,c.Floor),ze(e,t))}async function hc(e){e===c.K&&m.bonus===0&&(m.bonus=1),e===c.R&&m.bonus===1&&(m.bonus=2),e===c.O&&m.bonus===2&&(m.bonus=3),e===c.Z&&m.bonus===3&&(await Ko(),We(e),await Ae(e))}async function dc(e){let t=c.OWall1;e===c.OSpell2&&(t=c.OWall2),e===c.OSpell3&&(t=c.OWall3);for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)if(m.map.getType(i,n)===t){for(let o=60;o>0;o--)Bt(i,n,Q.getItem(["▄","▌","▐","▀"]),Q.getUniformInt(0,14)),de(o*40,5,10),o%5===0&&await Ce(1);m.map.setType(i,n,c.Floor),ze(i,n)}}async function pc(e){const t=e-c.CSpell1+c.CWall1;for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)if(m.map.getType(i,n)===t){for(let o=60;o>0;o--)Bt(i,n,Q.getItem(["▄","▌","▐","▀"]),Q.getUniformInt(0,14)),de(o*40,5,10),o%5===0&&await Ce(1);m.map.setType(i,n,c.Wall),ze(i,n)}}async function gc(e,t,i,n,r){let o=!1;const f=m.player.get(st),u=f.x+n*2,p=f.y+r*2;if((u<0||u>$e||p<0||p>Ve)&&(o=!0),!o){const d=m.map.get(u,p);d||(o=!0);const T=d.type;async function L(Z=!1){o=!1,await br(),Z&&ei(u,p),m.map.set(u,p,e),ct(t,i),It(),await Ae(c.Rock,!0)}js.includes(T)?await L():Xs.includes(T)?(await L(),await Kt()):rr.includes(T)?(await L(!0),We(T),await ps()):T===c.EWall?(await L(),m.map.setType(u,p,c.Floor),gs(),await Ee("The Boulder is vaporized!")):Ks.includes(T)&&(o=!1,await br(),ct(t,i),Bt(u,p,e.type),await _s(),It(),await Ae(c.Rock,!0))}o&&await Wn()}async function _c(){await ms(),await Ee("You notice a secret message carved into the old tree..."),await Ee('"Goodness of Heart Overcomes Adversity."'),await Ee("Reveal that you found this message to Scott Miller..."),await Ee('And receive a "MASTER KROZ CERTIFICATE" to hang on your wall!!'),await Ee("Only the first 100 players to report this..."),await Ee("Will be awarded the certificate.  Congratulations!")}async function mc(e,t,i){let n=c.Floor;switch(i){case c.TBlock:n=c.Block;break;case c.TRock:n=c.Rock;break;case c.TGem:n=c.Gem;break;case c.TBlind:n=c.Invisible;break;case c.TWhip:n=c.Whip;break;case c.TGold:n=c.Nugget;break;case c.TTree:n=c.Tree;break}for(let o=0;o<10;o++)await r(!1,Q.getUniformInt(0,7),Q.getUniformInt(0,7)),await de((o+25)*o*2,20,10);return r(!0);async function r(o,f,u){for(let p=-1;p<=1;p++)for(let d=-1;d<=1;d++){if(p===0&&d===0)continue;const T=m.map.getType(e+p,t+d);$s.includes(T)&&(Bt(e+p,t+d,n,f,u),o&&m.map.setType(e+p,t+d,n)),await Ce(5)}}}async function yc(){for(let e=0;e<75;e++){let t=!1;do{const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve),r=m.map.getType(i,n);r===c.Block&&(m.map.setType(i,n,c.IBlock),ze(i,n),t=!0),r===c.Wall&&(m.map.setType(i,n,c.IWall),ze(i,n),t=!0)}while(!t&&Q.getUniformInt(0,200)!==0)}}async function vc(e,t,i){switch(e){case c.SlowTime:m.T[Ke.SpeedTime]=0,m.T[Ke.FreezeTime]=0,m.T[Ke.SlowTime]=tn[Ke.SlowTime],We(e),await Ae(e,!0);break;case c.SpeedTime:m.T[Ke.SlowTime]=0,m.T[Ke.SpeedTime]=tn[Ke.SpeedTime],We(e),await Ae(e,!0);break;case c.Invisible:m.T[Ke.Invisible]=tn[Ke.Invisible],m.player.add(Vt),ze(t,i),We(e),await Ae(e,!0);break;case c.Trap:We(e),await Ae(e,!0),await eo();break;case c.Bomb:await ac(t,i),await Ae(e,!0);break;case c.Freeze:m.T[Ke.FreezeTime]=tn[Ke.FreezeTime],await Ae(e,!0);break;case c.Quake:await sc(),await Ae(e,!0);break;case c.Trap2:fa(e,c.Floor);break;case c.Zap:await lc(),await Ae(e,!0);break;case c.Create:await cc(),We(e),await Ae(e,!0);break;case c.ShowGems:Kt(),await uc(),await Ae(e,!1);break;case c.BlockSpell:await fc(),await Ae(e,!0);break;case c.WallVanish:await yc(),await Ae(e);break;case c.K:case c.R:case c.O:case c.Z:Kt(),await hc(e);break;case c.OSpell1:case c.OSpell2:case c.OSpell3:await dc(e),await Ae(e,!0);break;case c.CSpell1:case c.CSpell2:case c.CSpell3:await pc(e),await Ae(e,!0);break;case c.Trap3:case c.Trap4:case c.Trap5:case c.Trap6:case c.Trap7:case c.Trap8:case c.Trap9:case c.Trap10:case c.Trap11:case c.Trap12:case c.Trap13:fa(e,c.Floor);break;case c.TBlock:case c.TRock:case c.TGem:case c.TBlind:case c.TWhip:case c.TGold:case c.TTree:await mc(t,i,e);break;case c.ShootRight:await ha(t,i,1);break;case c.ShootLeft:await ha(t,i,-1);break}}function ct(e,t){ci();const i=m.player,n=i.get(st);m.map.setType(n.x,n.y,n.replacement),ze(n.x,n.y);const r=m.map.getType(e,t);n.replacement=[c.CWall1,c.CWall2,c.CWall3,c.Rope].includes(r)?r:c.Floor,m.map.set(e,t,i),n.x=e,n.y=t,ze(n.x,n.y)}function wc(e){switch(e){case c.Player:return Rt;case c.Slow:return Rt/4;case c.Medium:return Rt/3;case c.Fast:return Rt/2;case c.MBlock:return Rt/2}}class $i{constructor(t){it(this,"speed");this.type=t,this.speed=wc(this.type)}getSpeed(){return this.type===c.Player?m.T[Ke.SlowTime]>0?10:1:m.T[Ke.SpeedTime]>0?Rt:this.speed}}let Ut;const bc=new $i(c.Player),xc=new $i(c.Slow),Tc=new $i(c.Medium),Sc=new $i(c.Fast),kc=new $i(c.MBlock);function Ec(){return Ut=new Ts.Speed,Ut.add(bc,!0),Ut.add(xc,!0),Ut.add(Tc,!0),Ut.add(Sc,!0),Ut.add(kc,!0),Ut}async function Oc(){const e=Ut.next();if(!e)return;const t=e.type;if(t!==c.Player&&!(m.T[Ke.FreezeTime]>0))for(const i of m.entities)i.type===t&&await Rc(i)}async function Rc(e){const t=e.get(st);if(!t.isDead()){if(m.map.getType(t.x,t.y)!==e.type){ln(e);return}if(e.has(Sa)){let i=0,n=0;const r=m.player.get(st);r.x<t.x&&(i=-1),r.x>t.x&&(i=1),r.y<t.y&&(n=-1),r.y>t.y&&(n=1),Ac(e,i,n)}}}function Ac(e,t,i){var u,p,d;const n=e.get(st),r=n.x+t,o=n.y+i;if(r<0||r>$e||o<0||o>Ve)return;const f=m.map.get(r,o);if(f){if((u=e.get(Oa))!=null&&u.has(f.type)){Kt(),zn(e,r,o);return}if((p=f.get(li))!=null&&p.by(e.type)){zn(e,r,o);return}if((d=e.get(Ra))!=null&&d.has(f.type)){m.map.setType(n.x,n.y,c.Floor),m.map.setType(r,o,c.Floor),ln(e),We(f.type),de(800,18),de(400,20);return}if(e.has(Wi)&&f.type===c.Player){const T=e.get(Wi).damage;N.gems-=T,m.map.setType(n.x,n.y,c.Floor),ln(e),We(f.type);return}zn(e,n.x,n.y)}}function zn(e,t,i){if(e.has(sn)&&e.has(Jt)){const r=e.get(Jt),o=e.get(sn);r.ch=o.getFrame()}const n=e.get(st);e.type===c.MBlock&&(t!==n.x||i!==n.y)&&e.remove(Vt),m.map.setType(n.x,n.y,c.Floor),m.map.set(t,i,e),n.moveTo(t,i)}async function Ic(){for(let t=0;t<m.T.length;t++)m.T[t]=Math.max(0,m.T[t]-1);m.T[Ke.Invisible]>0?m.player.add(Vt):m.player.remove(Vt),m.T[Ke.StatueGemDrain]>0&&Q.getUniformInt(0,18)===0&&(N.gems--,await de(3800,40),kt());const e=m.entities.reduce((t,i)=>i.type===c.Slow?t+1:t,0);if(m.genNum>0&&e<995&&Q.getUniformInt(0,17)===0&&await Xa(1),m.magicEwalls&&Q.getUniformInt(0,7)===0){for(let t=0;t<100;t++){const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve);if(m.map.getType(i,n)===c.CWall1){m.map.setType(i,n,c.EWall),ze(i,n);break}}for(let t=0;t<100;t++){const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve);if(m.map.getType(i,n)===c.EWall){m.map.setType(i,n,c.CWall1),ze(i,n);break}}}if(m.evapoRate>0&&Q.getUniformInt(0,9)===0)for(let t=0;t<m.evapoRate;t++){const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve);m.map.getType(i,n)===c.River&&(m.map.setType(i,n,c.Floor),ze(i,n))}if(m.lavaFlow&&Q.getUniformInt(0,9)===0)for(let t=0;t<m.lavaRate;t++){const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve),r=m.map.getType(i,n);if([0,1,2,3,4,5,7,8,9,10,11,15,16,18,19,20,21,26,27,28,32,33,34,35,37,38,39,41,42,43,44,45,47,48,49,50,51,57,60,64,67,68,69,70,71,72,73,74,77,78,79,80,81,82,83].includes(r)){let o=!1;m.map.getType(i+1,n)===c.Lava&&(o=!0),m.map.getType(i-1,n)===c.Lava&&(o=!0),m.map.getType(i,n+1)===c.Lava&&(o=!0),m.map.getType(i,n-1)===c.Lava&&(o=!0),o&&(m.map.setType(i,n,c.Lava),ze(i,n))}}if(m.treeRate>0&&Q.getUniformInt(0,9)===0)for(let t=0;t<m.treeRate;t++){const i=Q.getUniformInt(0,$e),n=Q.getUniformInt(0,Ve),r=m.map.getType(i,n);if([0,16,27,28,32,33,37,39].includes(r)){let o=!1;if((m.map.getType(i+1,n)===c.Tree||m.map.getType(i+1,n)===c.Forest)&&(o=!0),(m.map.getType(i-1,n)===c.Tree||m.map.getType(i-1,n)===c.Forest)&&(o=!0),(m.map.getType(i,n+1)===c.Tree||m.map.getType(i,n+1)===c.Forest)&&(o=!0),(m.map.getType(i,n-1)===c.Tree||m.map.getType(i,n-1)===c.Forest)&&(o=!0),o){const f=Q.getUniformInt(0,3)===0?c.Tree:c.Forest;m.map.setType(i,n,f),ze(i,n)}}}}function Mc(){const e=$o();document.getElementById("app").appendChild(e),Ro()}async function $n(){ti(z.Black),Nl(),await ql(),await Xl(),await Zl(),await gn(),Zn(),await Qa(),Ja(),await Ee("Press any key to begin this level."),_a(),Zn(),await Cc()}async function Cc(){Ec();let e=16*Ze.clockScale,t=0,i=0;const n=async r=>{if(N.gems<0){await Ql(),$n();return}if(Ze.done){$n();return}t+=r-i,i=r,t>e&&(t%=e,await Kl(),await Oc(),await Ic(),It(),_a()),Ja(),e=16*Ze.clockScale,requestAnimationFrame(n)};requestAnimationFrame(n)}function da(){Mc(),$n()}try{document.fonts.ready.then(da)}catch{window.addEventListener("DOMContentLoaded",da)}export{z as C,st as P,c as T,$e as X,Ve as Y,zc as a,ze as d,Ee as f,m as l,de as p,N as s,Vl as t};
