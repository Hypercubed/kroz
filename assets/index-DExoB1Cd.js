var Do=Object.defineProperty;var Co=(e,t,i)=>t in e?Do(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Le=(e,t,i)=>Co(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var cn={exports:{}},Mo=cn.exports,Pr;function zo(){return Pr||(Pr=1,function(e,t){(function(i,n){e.exports=n()})(Mo,function(){var i=function(){function n(p){return c.appendChild(p.dom),p}function r(p){for(var O=0;O<c.children.length;O++)c.children[O].style.display=O===p?"block":"none";o=p}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(p){p.preventDefault(),r(++o%c.children.length)},!1);var l=(performance||Date).now(),h=l,u=0,m=n(new i.Panel("FPS","#0ff","#002")),S=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var k=n(new i.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:c,addPanel:n,showPanel:r,begin:function(){l=(performance||Date).now()},end:function(){u++;var p=(performance||Date).now();if(S.update(p-l,200),p>h+1e3&&(m.update(1e3*u/(p-h),100),h=p,u=0,k)){var O=performance.memory;k.update(O.usedJSHeapSize/1048576,O.jsHeapSizeLimit/1048576)}return p},update:function(){l=this.end()},domElement:c,setMode:r}};return i.Panel=function(n,r,o){var c=1/0,l=0,h=Math.round,u=h(window.devicePixelRatio||1),m=80*u,S=48*u,k=3*u,p=2*u,O=3*u,A=15*u,L=74*u,Y=30*u,q=document.createElement("canvas");q.width=m,q.height=S,q.style.cssText="width:80px;height:48px";var I=q.getContext("2d");return I.font="bold "+9*u+"px Helvetica,Arial,sans-serif",I.textBaseline="top",I.fillStyle=o,I.fillRect(0,0,m,S),I.fillStyle=r,I.fillText(n,k,p),I.fillRect(O,A,L,Y),I.fillStyle=o,I.globalAlpha=.9,I.fillRect(O,A,L,Y),{dom:q,update:function(E,C){c=Math.min(c,E),l=Math.max(l,E),I.fillStyle=o,I.globalAlpha=1,I.fillRect(0,0,m,A),I.fillStyle=r,I.fillText(h(E)+" "+n+" ("+h(c)+"-"+h(l)+")",k,p),I.drawImage(q,O+u,A,L-u,Y,O,A,L-u,Y),I.fillRect(O+L-u,A,u,Y),I.fillStyle=o,I.globalAlpha=.9,I.fillRect(O+L-u,A,u,h((1-E/C)*Y))}}},i})}(cn)),cn.exports}zo();const Yn=(e,t="log")=>{t==="error"?console&&typeof console.error=="function"&&console.error(e):console&&typeof console.info=="function"&&console.info(e)},zt=e=>Yn(e,"error"),Fo=()=>navigator.getGamepads&&typeof navigator.getGamepads=="function"||navigator.getGamepads&&typeof navigator.webkitGetGamepads=="function"||!1,pi=()=>({action:()=>{},after:()=>{},before:()=>{}}),xt={ON:"Gamepad detected.",OFF:"Gamepad disconnected.",INVALID_PROPERTY:"Invalid property.",INVALID_VALUE_NUMBER:"Invalid value. It must be a number between 0.00 and 1.00.",INVALID_BUTTON:"Button does not exist.",UNKNOWN_EVENT:"Unknown event name.",NO_SUPPORT:"Your web browser does not support the Gamepad API."},Bo={init:function(e){let t={id:e.index,buttons:e.buttons.length,axes:Math.floor(e.axes.length/2),axeValues:[],axeThreshold:[1],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:e.mapping,buttonActions:{},axesActions:{},pressed:{},set:function(i,n){if(["axeThreshold"].indexOf(i)>=0){if(i==="axeThreshold"&&(!parseFloat(n)||n<0||n>1)){zt(xt.INVALID_VALUE_NUMBER);return}this[i]=n}else zt(xt.INVALID_PROPERTY)},vibrate:function(i=.75,n=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(i,n);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:n,strongMagnitude:i,weakMagnitude:i})}},triggerDirectionalAction:function(i,n,r,o,c){r&&o%2===c?(this.pressed[`${i}${n}`]||(this.pressed[`${i}${n}`]=!0,this.axesActions[n][i].before()),this.axesActions[n][i].action()):this.pressed[`${i}${n}`]&&o%2===c&&(delete this.pressed[`${i}${n}`],this.axesActions[n][i].after())},checkStatus:function(){let i={};const n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(i=n[this.id],i.buttons)for(let r=0;r<this.buttons;r++)i.buttons[r].pressed===!0?(this.pressed[`button${r}`]||(this.pressed[`button${r}`]=!0,this.buttonActions[r].before()),this.buttonActions[r].action()):this.pressed[`button${r}`]&&(delete this.pressed[`button${r}`],this.buttonActions[r].after());if(i.axes){const r=i.axes.length%2;for(let o=0;o<this.axes*2;o++){const c=i.axes[o+r].toFixed(4),l=Math.floor(o/2);this.axeValues[l][o%2]=c,this.triggerDirectionalAction("right",l,c>=this.axeThreshold[0],o,0),this.triggerDirectionalAction("left",l,c<=-this.axeThreshold[0],o,0),this.triggerDirectionalAction("down",l,c>=this.axeThreshold[0],o,1),this.triggerDirectionalAction("up",l,c<=-this.axeThreshold[0],o,1)}}}},associateEvent:function(i,n,r){if(i.match(/^button\d+$/)){const o=parseInt(i.match(/^button(\d+)$/)[1]);o>=0&&o<this.buttons?this.buttonActions[o][r]=n:zt(xt.INVALID_BUTTON)}else if(i==="start")this.buttonActions[9][r]=n;else if(i==="select")this.buttonActions[8][r]=n;else if(i==="r1")this.buttonActions[5][r]=n;else if(i==="r2")this.buttonActions[7][r]=n;else if(i==="l1")this.buttonActions[4][r]=n;else if(i==="l2")this.buttonActions[6][r]=n;else if(i==="power")this.buttons>=17?this.buttonActions[16][r]=n:zt(xt.INVALID_BUTTON);else if(i.match(/^(up|down|left|right)(\d+)$/)){const o=i.match(/^(up|down|left|right)(\d+)$/),c=o[1],l=parseInt(o[2]);l>=0&&l<this.axes?this.axesActions[l][c][r]=n:zt(xt.INVALID_BUTTON)}else if(i.match(/^(up|down|left|right)$/)){const o=i.match(/^(up|down|left|right)$/)[1];this.axesActions[0][o][r]=n}return this},on:function(i,n){return this.associateEvent(i,n,"action")},off:function(i){return this.associateEvent(i,function(){},"action")},after:function(i,n){return this.associateEvent(i,n,"after")},before:function(i,n){return this.associateEvent(i,n,"before")}};for(let i=0;i<t.buttons;i++)t.buttonActions[i]=pi();for(let i=0;i<t.axes;i++)t.axesActions[i]={down:pi(),left:pi(),right:pi(),up:pi()},t.axeValues[i]=[0,0];return e.hapticActuators?typeof e.hapticActuators.pulse=="function"?(t.hapticActuator=e.hapticActuators,t.vibrationMode=0,t.vibration=!0):e.hapticActuators[0]&&typeof e.hapticActuators[0].pulse=="function"&&(t.hapticActuator=e.hapticActuators[0],t.vibrationMode=0,t.vibration=!0):e.vibrationActuator&&typeof e.vibrationActuator.playEffect=="function"&&(t.hapticActuator=e.vibrationActuator,t.vibrationMode=1,t.vibration=!0),t}},Wt={gamepads:{},axeThreshold:[1],isReady:Fo(),onConnect:function(){},onDisconnect:function(){},onBeforeCycle:function(){},onAfterCycle:function(){},getGamepads:function(){return this.gamepads},getGamepad:function(e){return this.gamepads[e]?this.gamepads[e]:null},set:function(e,t){if(["axeThreshold"].indexOf(e)>=0){if(e==="axeThreshold"&&(!parseFloat(t)||t<0||t>1)){zt(xt.INVALID_VALUE_NUMBER);return}if(this[e]=t,e==="axeThreshold"){const n=this.getGamepads(),r=Object.keys(n);for(let o=0;o<r.length;o++)n[r[o]].set("axeThreshold",this.axeThreshold)}}else zt(xt.INVALID_PROPERTY)},checkStatus:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,t=Object.keys(Wt.gamepads);Wt.onBeforeCycle();for(let i=0;i<t.length;i++)Wt.gamepads[t[i]].checkStatus();Wt.onAfterCycle(),t.length>0&&e(Wt.checkStatus)},init:function(){window.addEventListener("gamepadconnected",e=>{const t=e.gamepad||e.detail.gamepad;if(Yn(xt.ON),window.gamepads||(window.gamepads={}),t){if(!window.gamepads[t.index]){window.gamepads[t.index]=t;const i=Bo.init(t);i.set("axeThreshold",this.axeThreshold),this.gamepads[i.id]=i,this.onConnect(this.gamepads[i.id])}Object.keys(this.gamepads).length===1&&this.checkStatus()}}),window.addEventListener("gamepaddisconnected",e=>{const t=e.gamepad||e.detail.gamepad;Yn(xt.OFF),t&&(delete window.gamepads[t.index],delete this.gamepads[t.index],this.onDisconnect(t.index))})},on:function(e,t){switch(e){case"connect":this.onConnect=t;break;case"disconnect":this.onDisconnect=t;break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=t;break;case"afterCycle":case"aftercycle":this.onAfterCycle=t;break;default:zt(xt.UNKNOWN_EVENT);break}return this},off:function(e){switch(e){case"connect":this.onConnect=function(){};break;case"disconnect":this.onDisconnect=function(){};break;case"beforeCycle":case"beforecycle":this.onBeforeCycle=function(){};break;case"afterCycle":case"aftercycle":this.onAfterCycle=function(){};break;default:zt(xt.UNKNOWN_EVENT);break}return this}};Wt.init();const fn=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},No=(e,t)=>{const i=t.x-e.x,n=t.y-e.y;return Go(Math.atan2(n,i))},Uo=(e,t,i)=>{const n={x:0,y:0};return i=Xn(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n},Xn=e=>e*(Math.PI/180),Go=e=>e*(180/Math.PI),Vo=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,Pn=new Map,Dr=e=>{Pn.has(e)&&clearTimeout(Pn.get(e)),Pn.set(e,setTimeout(e,100))},pn=(e,t,i)=>{const n=t.split(/[ ,]+/g);let r;for(let o=0;o<n.length;o+=1)r=n[o],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent&&e.attachEvent(r,i)},Cr=(e,t,i)=>{const n=t.split(/[ ,]+/g);let r;for(let o=0;o<n.length;o+=1)r=n[o],e.removeEventListener?e.removeEventListener(r,i):e.detachEvent&&e.detachEvent(r,i)},Fa=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),Mr=()=>{const e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},zr=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},fr=(e,t,i)=>{const n=Ba(e);for(let r in n)if(n.hasOwnProperty(r))if(typeof t=="string")n[r]=t+" "+i;else{let o="";for(let c=0,l=t.length;c<l;c+=1)o+=t[c]+" "+i+", ";n[r]=o.slice(0,-2)}return n},Ho=(e,t)=>{const i=Ba(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},Ba=e=>{const t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},Dn=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Wo=(e,t)=>{const i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},Kn=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},$o=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});var qo="ontouchstart"in window,Zo=!!window.PointerEvent,jo=!!window.MSPointerEvent,gi={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},ni,$i={};Zo?ni=gi.pointer:jo?ni=gi.MSPointer:qo?(ni=gi.touch,$i=gi.mouse):ni=gi.mouse;function Bt(){}Bt.prototype.on=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)r=n[o],i._handlers_[r]=i._handlers_[r]||[],i._handlers_[r].push(t);return i};Bt.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Bt.prototype.trigger=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)r=n[o],i._handlers_[r]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(c){c.call(i,{type:r,target:i},t)})};Bt.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=Wo(t.options,e))};Bt.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},pn(e,ni[t],i._domHandlers_[t]),$i[t]&&pn(e,$i[t],i._domHandlers_[t]),i};Bt.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},Cr(e,ni[t],i._domHandlers_[t]),$i[t]&&Cr(e,$i[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};function nt(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=nt.id,nt.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}nt.prototype=new Bt;nt.constructor=nt;nt.id=0;nt.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};nt.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=Ho("borderRadius","50%"),i=fr("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Dn(n.el,i),this.options.shape==="circle"&&Dn(n.back,t),Dn(n.front,t),this.applyStyles(n),this};nt.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};nt.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};nt.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};nt.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};nt.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};nt.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const i=t.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t};nt.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=fr("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(r),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};nt.prototype.restCallback=function(){var e=this,t={};t.front=fr("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};nt.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};nt.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,n=Math.PI/2,r,o,c;if(t>i&&t<i*3&&!e.lockX?r="up":t>-i&&t<=i&&!e.lockY?r="left":t>-i*3&&t<=-i&&!e.lockX?r="down":e.lockY||(r="right"),e.lockY||(t>-n&&t<n?o="left":o="right"),e.lockX||(t>0?c="up":c="down"),e.force>this.options.threshold){var l={},h;for(h in this.direction)this.direction.hasOwnProperty(h)&&(l[h]=this.direction[h]);var u={};this.direction={x:o,y:c,angle:r},e.direction=this.direction;for(h in l)l[h]===this.direction[h]&&(u[h]=!0);if(u.x&&u.y&&u.angle)return e;(!u.x||!u.y)&&this.trigger("plain",e),u.x||this.trigger("plain:"+o,e),u.y||this.trigger("plain:"+c,e),u.angle||this.trigger("dir dir:"+r,e)}else this.resetDirection();return e};function it(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=it.id,it.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}it.prototype=new Bt;it.constructor=it;it.id=0;it.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===i)return t[n];return!1}};it.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};it.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};it.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},o=i.options,c={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(e.x&&e.y)r={x:e.x-c.x,y:e.y-c.y};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",o.zone.appendChild(l);var h=l.getBoundingClientRect();o.zone.removeChild(l),r=e,e={x:h.left+n.x,y:h.top+n.y}}var u=new nt(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(zr(u.ui.el,r),zr(u.ui.front,u.frontPosition)),i.nipples.push(u),i.trigger("added "+u.identifier+":added",u),i.manager.trigger("added "+u.identifier+":added",u),i.bindNipple(u),u};it.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};it.prototype.bindNipple=function(e){var t=this,i,n=function(r,o){i=r.type+" "+o.id+":"+r.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};it.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=e.force||e.pressure||e.webkitForce||0;o!==r&&(t.trigger("pressure",o),n.trigger("pressure "+t.identifier+":pressure",o),r=o)}).bind(n),100)};it.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=Fa(e),t.updateBox();var r=function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(c){if(Object.values(n.touches).findIndex(function(h){return h.identifier===c})<0){var l=[e[0]];l.identifier=c,t.processOnEnd(l)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))};return Kn(e,r),t.manager.bindDocument(),!1};it.prototype.processOnStart=function(e){var t=this,i=t.options,n,r=t.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,c={x:e.pageX,y:e.pageY},l=t.getOrCreate(r,c);l.identifier!==r&&t.manager.removeIdentifier(l.identifier),l.identifier=r;var h=function(m){m.trigger("start",m),t.trigger("start "+m.id+":start",m),m.show(),o>0&&t.pressureFn(e,m,m.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(l))>=0&&t.idles.splice(n,1),t.actives.push(l),t.ids.push(l.identifier),i.mode!=="semi")h(l);else{var u=fn(c,l.position);if(u<=i.catchDistance)h(l);else{l.destroy(),t.processOnStart(e);return}}return l};it.prototype.getOrCreate=function(e,t){var i=this,n=i.options,r;return/(semi|static)/.test(n.mode)?(r=i.idles[0],r?(i.idles.splice(0,1),r):n.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(r=i.createNipple(t,e),r)};it.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.scroll;if(!Vo(e)){this.processOnEnd(e);return}if(!r){console.error("Found zombie joystick with ID "+n),t.manager.removeIdentifier(n);return}if(i.dynamicPage){var c=r.el.getBoundingClientRect();r.position={x:o.x+c.left,y:o.y+c.top}}r.identifier=n;var l=r.options.size/2,h={x:e.pageX,y:e.pageY};i.lockX&&(h.y=r.position.y),i.lockY&&(h.x=r.position.x);var u=fn(h,r.position),m=No(h,r.position),S=Xn(m),k=u/l,p={distance:u,position:h},O,A;if(r.options.shape==="circle"?(O=Math.min(u,l),A=Uo(r.position,O,m)):(A=$o(h,r.position,l),O=fn(A,r.position)),i.follow){if(u>l){let I=h.x-A.x,E=h.y-A.y;r.position.x+=I,r.position.y+=E,r.el.style.top=r.position.y-(t.box.top+o.y)+"px",r.el.style.left=r.position.x-(t.box.left+o.x)+"px",u=fn(h,r.position)}}else h=A,u=O;var L=h.x-r.position.x,Y=h.y-r.position.y;r.frontPosition={x:L,y:Y},i.dataOnly||(r.ui.front.style.transform="translate("+L+"px,"+Y+"px)");var q={identifier:r.identifier,position:h,force:k,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:S,degree:m},vector:{x:L/l,y:-Y/l},raw:p,instance:r,lockX:i.lockX,lockY:i.lockY};q=r.computeDirection(q),q.angle={radian:Xn(180-m),degree:180-m},r.trigger("move",q),t.trigger("move "+r.id+":move",q)};it.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.removeIdentifier(r.identifier);r&&(i.dataOnly||r.hide(function(){i.mode==="dynamic"&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))};it.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};it.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};function rt(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=Mr(),t.config(e),t.prepareCollections();var i=function(){var r;t.collections.forEach(function(o){o.forEach(function(c){r=c.el.getBoundingClientRect(),c.position={x:t.scroll.x+r.left,y:t.scroll.y+r.top}})})};pn(window,"resize",function(){Dr(i)});var n=function(){t.scroll=Mr()};return pn(window,"scroll",function(){Dr(n)}),t.collections}rt.prototype=new Bt;rt.constructor=rt;rt.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return i=n.get(t),!i}),i}};rt.prototype.create=function(e){return this.createCollection(e)};rt.prototype.createCollection=function(e){var t=this,i=new it(t,e);return t.bindCollection(i),t.collections.push(i),i};rt.prototype.bindCollection=function(e){var t=this,i,n=function(r,o){i=r.type+" "+o.id+":"+r.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};rt.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};rt.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};rt.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};rt.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};rt.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};rt.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};rt.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};rt.prototype.onAny=function(e,t){var i=this,n,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Fa(t);var o=function(l,h,u){u.ids.indexOf(h)>=0&&(u[r](l),l._found_=!0)},c=function(l){n=i.getIdentifier(l),Kn(i.collections,o.bind(null,l,n)),l._found_||i.removeIdentifier(n)};return Kn(t,c),!1};rt.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};rt.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};const Fr=new rt,Cn={create:function(e){return Fr.create(e)},factory:Fr},Yo=!1,Xo=Yo,Na="The Forgotton Adventures of Kroz",di=80,Ft=25,$t=1,ai=di-16,qt=1,gn=Ft-2,$e=63,Ve=22,Ni=1,Ko=8,Jo=.005,mi=" ";var wi={},yi={},Br;function Qo(){if(Br)return yi;Br=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.MiniSignal=void 0;const e=Symbol("SIGNAL");function t(n){return typeof n=="object"&&e in n}class i{constructor(){this._symbol=Symbol("MiniSignal"),this._refMap=new WeakMap,this._head=void 0,this._tail=void 0,this._dispatching=!1}hasListeners(){return this._head!=null}dispatch(...r){if(this._dispatching)throw new Error("MiniSignal#dispatch(): Signal already dispatching.");let o=this._head;if(o==null)return!1;for(this._dispatching=!0;o!=null;)o.fn(...r),o=o.next;return this._dispatching=!1,!0}add(r){if(typeof r!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return this._createRef(this._addNode({fn:r}))}detach(r){if(!t(r))throw new Error("MiniSignal#detach(): First arg must be a MiniSignal listener reference.");if(r[e]!==this._symbol)throw new Error("MiniSignal#detach(): MiniSignal listener does not belong to this MiniSignal.");const o=this._refMap.get(r);return o?(this._refMap.delete(r),this._disconnectNode(o),this._destroyNode(o),this):this}detachAll(){let r=this._head;if(r==null)return this;for(this._head=this._tail=void 0,this._refMap=new WeakMap;r!=null;)this._destroyNode(r),r=r.next;return this}_destroyNode(r){r.fn=void 0,r.prev=void 0}_disconnectNode(r){r===this._head?(this._head=r.next,r.next==null&&(this._tail=void 0)):r===this._tail&&(this._tail=r.prev,this._tail!=null&&(this._tail.next=void 0)),r.prev!=null&&(r.prev.next=r.next),r.next!=null&&(r.next.prev=r.prev)}_addNode(r){return this._head==null?(this._head=r,this._tail=r):(this._tail.next=r,r.prev=this._tail,this._tail=r),r}_createRef(r){const o={[e]:this._symbol};return this._refMap.set(o,r),o}_getRef(r){return this._refMap.get(r)}}return yi.MiniSignal=i,yi}var Nr;function es(){return Nr||(Nr=1,function(e){var t=wi.__createBinding||(Object.create?function(n,r,o,c){c===void 0&&(c=o);var l=Object.getOwnPropertyDescriptor(r,o);(!l||("get"in l?!r.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(n,c,l)}:function(n,r,o,c){c===void 0&&(c=o),n[c]=r[o]}),i=wi.__exportStar||function(n,r){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&t(r,n,o)};Object.defineProperty(e,"__esModule",{value:!0}),i(Qo(),e)}(wi)),wi}var Xi=es();function Fe(e=0){return new Promise(t=>{setTimeout(()=>t(),e)})}function Ur(e,t,i){return Math.min(Math.max(e,t),i)}const ts={8216:145,8217:146,8220:147,8221:148,8226:149,8211:150,8212:151,402:159},is={145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,159:402};function ns(e){const t=e.charCodeAt(0);return ts[t]||t}function rs(e){const t=is[e]||e;return String.fromCharCode(t)}function ri(e){if(Array.isArray(e)){const t={};for(const i of e)t[i.name]=i.value;return t}return e}function ti(e,t,i,n){return e.padStart(t,n).padEnd(i,n)}function as(e){let t=e.length;for(;t!=0;){const i=Math.floor(Math.random()*t);t--,[e[t],e[i]]=[e[i],e[t]]}return e}function os(e,t){return e.replace(new RegExp(`(?![^\\n]{1,${t}}$)([^\\n]{1,${t}})\\s`,"g"),`$1
`)}const Jn=new Xi.MiniSignal,Dt=new Xi.MiniSignal,Ct=new Xi.MiniSignal;let ii=null;var et=(e=>(e[e.North=1]="North",e[e.South=2]="South",e[e.East=3]="East",e[e.West=4]="West",e[e.Northwest=5]="Northwest",e[e.Northeast=6]="Northeast",e[e.Southwest=7]="Southwest",e[e.Southeast=8]="Southeast",e[e.Whip=9]="Whip",e[e.FreeItems=10]="FreeItems",e[e.NextLevel=11]="NextLevel",e[e.NextLevelCheat=12]="NextLevelCheat",e[e.PrevLevel=13]="PrevLevel",e[e.Teleport=14]="Teleport",e[e.ResetFound=15]="ResetFound",e[e.HideFound=16]="HideFound",e[e.Pause=17]="Pause",e[e.Quit=18]="Quit",e[e.Save=19]="Save",e[e.Restore=20]="Restore",e[e.SlowerClock=21]="SlowerClock",e[e.FasterClock=22]="FasterClock",e))(et||{});const It={},ut={},wn={ArrowUp:1,ArrowDown:2,ArrowLeft:4,ArrowRight:3,U:5,I:1,O:6,J:4,K:3,N:7,M:2,",":8,1:7,2:2,3:8,4:4,6:3,7:5,8:1,9:6,5:9,w:9,W:9,t:14,T:14,")":10,"+":15,"-":16,"(":12,PageDown:null,PageUp:null,p:17,P:17,q:18,Q:18,s:19,S:19,r:20,R:20,F11:21,F12:22},mt={button0:"w",button1:"t",button2:"s",button3:"r",button4:null,button5:null,button6:"F11",button7:"F12",button8:"s",button9:"p",button16:"Escape",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",button12:"ArrowUp",button13:"ArrowDown",button14:"ArrowLeft",button15:"ArrowRight"};function ss(){ii||Wt.on("connect",e=>{if(!ii){ii=e,ii.axeThreshold=[.5,.5];for(const[t,i]of Object.entries(mt))i&&(ii.before(t,()=>Dt.dispatch(i)),ii.after(t,()=>Ct.dispatch(i)))}})}let Mn=null,zn=null,Fn=null;const ls="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;function cs(){Mn||!ls||(document.querySelectorAll(".touch_zone").forEach(e=>{e.style.display="block"}),Mn=Cn.create({zone:document.querySelector(".touch_zone--axis"),mode:"dynamic",threshold:.5,dynamicPage:!0,position:{left:"50px",bottom:"50px"},restOpacity:.3}),Mn.on("move end",(e,t)=>{if(t.force<.5)return;const i=.3,{x:n,y:r}=t.vector||{x:0,y:0};n>i&&!nn(3)?Dt.dispatch(mt.right):n<-i&&!nn(4)?Dt.dispatch(mt.left):Math.abs(n)<=i&&(Ct.dispatch(mt.right),Ct.dispatch(mt.left)),r>i&&!nn(1)?Dt.dispatch(mt.up):r<-i&&!nn(2)?Dt.dispatch(mt.down):Math.abs(r)<=i&&(Ct.dispatch(mt.up),Ct.dispatch(mt.down))}),zn=Cn.create({zone:document.querySelector(".touch_zone--button-0"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{left:"50px",bottom:"50px"}}),zn.on("start",()=>Dt.dispatch(mt.button0)),zn.on("end",()=>Ct.dispatch(mt.button0)),Fn=Cn.create({zone:document.querySelector(".touch_zone--button-1"),threshold:0,mode:"dynamic",lockX:!0,lockY:!0,dynamicPage:!0,restOpacity:.3,position:{right:"50px",top:"50px"}}),Fn.on("start",()=>Dt.dispatch(mt.button1)),Fn.on("end",()=>Ct.dispatch(mt.button1)))}function fs(e){e.repeat||(wn[e.key]&&e.preventDefault(),Dt.dispatch(e.key))}function us(e){wn[e.key]&&e.preventDefault(),Ct.dispatch(e.key)}Dt.add(e=>{It[e]=3;const t=wn[e];t&&(ut[t]=3)});Ct.add(e=>{(It[e]||0)&3&&Jn.dispatch(e),It[e]&=-2,It[e]|=4;const t=wn[e];t&&(ut[t]&=-2,ut[t]|=4)});function ds(){ss(),cs(),window.addEventListener("keydown",fs),window.addEventListener("keyup",us)}function tn(){for(const e in It)It[e]&&(It[e]=0)}function ur(){for(const e in ut)Object.prototype.hasOwnProperty.call(ut,e)&&delete ut[e];for(const e in It)Object.prototype.hasOwnProperty.call(It,e)&&delete It[e]}function hs(){for(const e in ut){const t=e;if(!ut[t])continue;const i=!!(ut[t]&2);ut[t]&=-15,i&&(ut[t]|=8)}}function nn(e){return!!(ut[e]&1)}function Tt(e){return!!(ut[e]&3)&&!(ut[e]&8)}function Ot(e){return!!(ut[e]&4)}async function Ui(){return ur(),new Promise(e=>{const t=Jn.add(i=>{Jn.detach(t),e(i)})})}async function yn(e,t=50){const i=Ui();do await(e==null?void 0:e());while(!await Promise.race([i,Fe(t)]));return i}class dr{getContainer(){return null}setOptions(t){this._options=t}}class hr extends dr{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const n=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=n,this._updateSize(),this._ctx.font=n,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,i){let n=this._ctx.canvas,r=n.getBoundingClientRect();return t-=r.left,i-=r.top,t*=n.width/r.width,i*=n.height/r.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}}function _r(e,t){return(e%t+t)%t}class Ua extends hr{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[n,r,o,c,l]=t,h=[(n+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),i&&(this._ctx.fillStyle=l,this._fill(h[0],h[1])),!o)return;this._ctx.fillStyle=c;let u=[].concat(o);for(let m=0;m<u.length;m++)this._ctx.fillText(u[m],h[0],Math.ceil(h[1]))}computeSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=Math.floor(t/this._spacingX)-1,r=Math.floor((i-2*this._hexSize)/this._spacingY+1);return[n,r]}computeFontSize(t,i){this._options.transpose&&(t+=i,i=t-i,t-=i);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,r=i/(2+1.5*(this._options.height-1)),o=Math.min(n,r),c=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let l=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=c;let h=l/100;o=Math.floor(o)+1;let u=2*o/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(u)-1}_normalizedEventToPosition(t,i){let n;this._options.transpose?(t+=i,i=t-i,t-=i,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let r=n/this._options.height;return i=Math.floor(i/r),_r(i,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]}_fill(t,i){let n=this._hexSize,r=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-n+r,i),o.lineTo(t-n/2+r,i+this._spacingX-r),o.lineTo(t+n/2-r,i+this._spacingX-r),o.lineTo(t+n-r,i),o.lineTo(t+n/2-r,i-this._spacingX+r),o.lineTo(t-n/2+r,i-this._spacingX+r),o.lineTo(t-n+r,i)):(o.moveTo(t,i-n+r),o.lineTo(t+this._spacingX-r,i-n/2+r),o.lineTo(t+this._spacingX-r,i+n/2-r),o.lineTo(t,i+n-r),o.lineTo(t-this._spacingX+r,i+n/2-r),o.lineTo(t-this._spacingX+r,i-n/2+r),o.lineTo(t,i-n+r)),o.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=this._hexSize*1.5;let n,r;t.transpose?(n="height",r="width"):(n="width",r="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class Ki extends hr{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,i){Ki.cache?this._drawWithCache(t):this._drawNoCache(t,i)}_drawWithCache(t){let[i,n,r,o,c]=t,l=""+r+o+c,h;if(l in this._canvasCache)h=this._canvasCache[l];else{let u=this._options.border;h=document.createElement("canvas");let m=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,m.fillStyle=c,m.fillRect(u,u,h.width-u,h.height-u),r){m.fillStyle=o,m.font=this._ctx.font,m.textAlign="center",m.textBaseline="middle";let S=[].concat(r);for(let k=0;k<S.length;k++)m.fillText(S[k],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[l]=h}this._ctx.drawImage(h,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,i){let[n,r,o,c,l]=t;if(i){let u=this._options.border;this._ctx.fillStyle=l,this._ctx.fillRect(n*this._spacingX+u,r*this._spacingY+u,this._spacingX-u,this._spacingY-u)}if(!o)return;this._ctx.fillStyle=c;let h=[].concat(o);for(let u=0;u<h.length;u++)this._ctx.fillText(h[u],(n+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(t,i){let n=Math.floor(t/this._spacingX),r=Math.floor(i/this._spacingY);return[n,r]}computeFontSize(t,i){let n=Math.floor(t/this._options.width),r=Math.floor(i/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let c=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let h=c/100*r/n;return h>1&&(r=Math.floor(r/h)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}Ki.cache=!1;class Ga extends hr{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,i){let[n,r,o,c,l]=t,h=this._options.tileWidth,u=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(n*h,r*u,h,u):(this._ctx.fillStyle=l,this._ctx.fillRect(n*h,r*u,h,u))),!o)return;let m=[].concat(o),S=[].concat(c),k=[].concat(l);for(let p=0;p<m.length;p++){let O=this._options.tileMap[m[p]];if(!O)throw new Error(`Char "${m[p]}" not found in tileMap`);if(this._options.tileColorize){let A=this._colorCanvas,L=A.getContext("2d");L.globalCompositeOperation="source-over",L.clearRect(0,0,h,u);let Y=S[p],q=k[p];L.drawImage(this._options.tileSet,O[0],O[1],h,u,0,0,h,u),Y!="transparent"&&(L.fillStyle=Y,L.globalCompositeOperation="source-atop",L.fillRect(0,0,h,u)),q!="transparent"&&(L.fillStyle=q,L.globalCompositeOperation="destination-over",L.fillRect(0,0,h,u)),this._ctx.drawImage(A,n*h,r*u,h,u)}else this._ctx.drawImage(this._options.tileSet,O[0],O[1],h,u,n*h,r*u,h,u)}}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}const rn=23283064365386963e-26;class pr{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*rn,t=t*69069+1>>>0,this._s1=t*rn,t=t*69069+1>>>0,this._s2=t*rn,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*rn;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,i){let n=Math.max(t,i),r=Math.min(t,i);return Math.floor(this.getUniform()*(n-r+1))+r}getNormal(t=0,i=1){let n,r,o;do n=2*this.getUniform()-1,r=2*this.getUniform()-1,o=n*n+r*r;while(o>1||o==0);let c=n*Math.sqrt(-2*Math.log(o)/o);return t+c*i}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let i=[],n=t.slice();for(;n.length;){let r=n.indexOf(this.getItem(n));i.push(n.splice(r,1)[0])}return i}getWeightedValue(t){let i=0;for(let c in t)i+=t[c];let n=this.getUniform()*i,r,o=0;for(r in t)if(o+=t[r],n<o)return r;return r}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new pr().setState(this.getState())}}const ie=new pr().setSeed(Date.now());function Va(e){let t,i;if(e in Bn)t=Bn[e];else{if(e.charAt(0)=="#"){let r=(e.match(/[0-9a-f]/gi)||[]).map(o=>parseInt(o,16));if(r.length==3)t=r.map(o=>o*17);else{for(let o=0;o<3;o++)r[o+1]+=16*r[o],r.splice(o,1);t=r}}else(i=e.match(/rgb\(([0-9, ]+)\)/i))?t=i[1].split(/\s*,\s*/).map(n=>parseInt(n)):t=[0,0,0];Bn[e]=t}return t.slice()}const Bn={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class Ha extends dr{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){typeof t=="string"?alert(t):t instanceof Error&&alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let i=this._options.tileSet;i&&"complete"in i&&!i.complete?i.addEventListener("load",()=>this._updateTexture(i)):this._updateTexture(i)}draw(t,i){const n=this._gl,r=this._options;let[o,c,l,h,u]=t,m=n.canvas.height-(c+1)*r.tileHeight;if(n.scissor(o*r.tileWidth,m,r.tileWidth,r.tileHeight),i&&(r.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...an(u)),n.clear(n.COLOR_BUFFER_BIT)),!l)return;let S=[].concat(l),k=[].concat(u),p=[].concat(h);n.uniform2fv(this._uniforms.targetPosRel,[o,c]);for(let O=0;O<S.length;O++){let A=this._options.tileMap[S[O]];if(!A)throw new Error(`Char "${S[O]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,A),r.tileColorize&&(n.uniform4fv(this._uniforms.tint,an(p[O])),n.uniform4fv(this._uniforms.bg,an(k[O]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...an(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,i){let n=Math.floor(t/this._options.tileWidth),r=Math.floor(i/this._options.tileHeight);return[n,r]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,i){let n=this._gl.canvas,r=n.getBoundingClientRect();return t-=r.left,i-=r.top,t*=n.width/r.width,i*=n.height/r.height,t<0||i<0||t>=n.width||i>=n.height?[-1,-1]:this._normalizedEventToPosition(t,i)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let i=ms(t,ps,gs);return t.useProgram(i),ws(t),_s.forEach(n=>this._uniforms[n]=t.getUniformLocation(i,n)),this._program=i,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]}_updateSize(){const t=this._gl,i=this._options,n=[i.width*i.tileWidth,i.height*i.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[i.tileWidth,i.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){ys(this._gl,t)}}const _s=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],ps=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),gs=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim();function ms(e,t,i){const n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)||"");const r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r)||"");const o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o)||"");return o}function ws(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function ys(e,t){let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}let Nn={};function an(e){if(!(e in Nn)){let t;if(e=="transparent")t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let i=0;i<3;i++)t[i]=t[i]/255}else t=Va(e).map(i=>i/255),t.push(1);Nn[e]=t}return Nn[e]}function vs(e){return`\x1B[0;48;5;${Qn(e)}m\x1B[2J`}function bs(e,t){return`\x1B[0;38;5;${Qn(e)};48;5;${Qn(t)}m`}function Es(e,t){return`\x1B[${t+1};${e+1}H`}function Qn(e){const n=.0234375;let r=Va(e),o=Math.floor(r[0]*n),c=Math.floor(r[1]*n),l=Math.floor(r[2]*n);return o*36+c*6+l*1+16}class Wa extends dr{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let i=[t.width,t.height],n=this.computeSize();this._offset=n.map((r,o)=>Math.floor((r-i[o])/2))}clear(){process.stdout.write(vs(this._options.bg))}draw(t,i){let[n,r,o,c,l]=t,h=this._offset[0]+n,u=this._offset[1]+r,m=this.computeSize();if(h<0||h>=m[0]||u<0||u>=m[1]||((h!==this._cursor[0]||u!==this._cursor[1])&&(process.stdout.write(Es(h,u)),this._cursor[0]=h,this._cursor[1]=u),i&&(o||(o=" ")),!o))return;let S=bs(c,l);if(S!==this._lastColor&&(process.stdout.write(S),this._lastColor=S),o!="	"){let k=[].concat(o);process.stdout.write(k[0])}this._cursor[0]++,this._cursor[0]>=m[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,i){return[t,i]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const xs=/%([bc]){([^}]*)}/g,oi=0,Gi=1,$a=2,qa=3;function Ss(e,t){let i=[],n=0;e.replace(xs,function(o,c,l,h){let u=e.substring(n,h);return u.length&&i.push({type:oi,value:u}),i.push({type:c=="c"?$a:qa,value:l.trim()}),n=h+o.length,""});let r=e.substring(n);return r.length&&i.push({type:oi,value:r}),Ts(i,t)}function Ts(e,t){t||(t=1/0);let i=0,n=0,r=-1;for(;i<e.length;){let c=e[i];if(c.type==Gi&&(n=0,r=-1),c.type!=oi){i++;continue}for(;n==0&&c.value.charAt(0)==" ";)c.value=c.value.substring(1);let l=c.value.indexOf(`
`);if(l!=-1){c.value=on(e,i,l,!0);let h=c.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();c.value=h.join("")}if(!c.value.length){e.splice(i,1);continue}if(n+c.value.length>t){let h=-1;for(;;){let u=c.value.indexOf(" ",h+1);if(u==-1||n+u>t)break;h=u}if(h!=-1)c.value=on(e,i,h,!0);else if(r!=-1){let u=e[r],m=u.value.lastIndexOf(" ");u.value=on(e,r,m,!0),i=r}else c.value=on(e,i,t-n,!1)}else n+=c.value.length,c.value.indexOf(" ")!=-1&&(r=i);i++}e.push({type:Gi});let o=null;for(let c=0;c<e.length;c++){let l=e[c];switch(l.type){case oi:o=l;break;case Gi:if(o){let h=o.value.split("");for(;h.length&&h[h.length-1]==" ";)h.pop();o.value=h.join("")}o=null;break}}return e.pop(),e}function on(e,t,i,n){let r={type:Gi},o={type:oi,value:e[t].value.substring(i+(n?1:0))};return e.splice(t+1,0,r,o),e[t].value.substring(0,i)}let Os=80,Rs=25;const As={hex:Ua,rect:Ki,tile:Ga,"tile-gl":Ha,term:Wa},Is={width:Os,height:Rs,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class Zt{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},Is,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,i,n){let r=[this._options.bg,this._options.fg];this.draw(t,i,null,null,r[n%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let i=As[t.layout];this._backend=new i}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,i){return this._backend.computeSize(t,i)}computeFontSize(t,i){return this._backend.computeFontSize(t,i)}computeTileSize(t,i){let n=Math.floor(t/this._options.width),r=Math.floor(i/this._options.height);return[n,r]}eventToPosition(t){let i,n;return"touches"in t?(i=t.touches[0].clientX,n=t.touches[0].clientY):(i=t.clientX,n=t.clientY),this._backend.eventToPosition(i,n)}draw(t,i,n,r,o){r||(r=this._options.fg),o||(o=this._options.bg);let c=`${t},${i}`;this._data[c]=[t,i,n,r,o],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[c]=!0)}drawOver(t,i,n,r,o){const c=`${t},${i}`,l=this._data[c];l?(l[2]=n||l[2],l[3]=r||l[3],l[4]=o||l[4]):this.draw(t,i,n,r,o)}drawText(t,i,n,r){let o=null,c=null,l=t,h=i,u=1;r||(r=this._options.width-t);let m=Ss(n,r);for(;m.length;){let S=m.shift();switch(S.type){case oi:let k=!1,p=!1,O=!1,A=!1;for(let L=0;L<S.value.length;L++){let Y=S.value.charCodeAt(L),q=S.value.charAt(L);if(this._options.layout==="term"){let I=Y>>8;if(I===17||I>=46&&I<=159||I>=172&&I<=215||Y>=43360&&Y<=43391){this.draw(l+0,h,q,o,c),this.draw(l+1,h,"	",o,c),l+=2;continue}}O=Y>65280&&Y<65377||Y>65500&&Y<65512||Y>65518,k=q.charCodeAt(0)==32||q.charCodeAt(0)==12288,A&&!O&&!k&&l++,O&&!p&&l++,this.draw(l++,h,q,o,c),p=k,A=O}break;case $a:o=S.value||null;break;case qa:c=S.value||null;break;case Gi:l=t,h++,u++;break}}return u}_tick(){if(this._backend.schedule(this._tick),!!this._dirty){if(this._dirty===!0){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,i){let n=this._data[t];n[4]!=this._options.bg&&(i=!0),this._backend.draw(n,i)}}Zt.Rect=Ki;Zt.Hex=Ua;Zt.Tile=Ga;Zt.TileGL=Ha;Zt.Term=Wa;const vn={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((n,r)=>t.getChannelData(r).set(n)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,n=0,r=0,o=.1,c=0,l=1,h=0,u=0,m=0,S=0,k=0,p=0,O=0,A=0,L=0,Y=1,q=0,I=0,E=0){let C=Math.PI*2,H=Xe=>Xe<0?-1:1,Z=this.sampleRate,ae=h*=500*C/Z/Z,J=i*=(1+t*2*Math.random()-t)*C/Z,me=[],we=0,ce=0,re=0,g=1,x=0,P=0,N=0,V,ee,U=2,oe=C*Math.abs(E)*2/Z,le=Math.cos(oe),Re=Math.sin(oe)/2/U,Te=1+Re,ue=-2*le/Te,pe=(1-Re)/Te,Ce=(1+H(E)*le)/2/Te,He=-(H(E)+le)/Te,ye=Ce,Ae=0,ve=0,Oe=0,Pe=0;for(n=n*Z+9,q*=Z,r*=Z,o*=Z,L*=Z,u*=500*C/Z**3,O*=C/Z,m*=C/Z,S*=Z,k=k*Z|0,e*=this.volume,ee=n+q+r+o+L|0;re<ee;me[re++]=N*e)++P%(A*100|0)||(N=c?c>1?c>2?c>3?Math.sin(we*we):Math.max(Math.min(Math.tan(we),1),-1):1-(2*we/C%2+2)%2:1-4*Math.abs(Math.round(we/C)-we/C):Math.sin(we),N=(k?1-I+I*Math.sin(C*re/k):1)*H(N)*Math.abs(N)**l*(re<n?re/n:re<n+q?1-(re-n)/q*(1-Y):re<n+q+r?Y:re<ee-L?(ee-re-L)/o*Y:0),N=L?N/2+(L>re?0:(re<ee-L?1:(ee-re)/L)*me[re-L|0]/2/e):N,E&&(N=Pe=ye*Ae+He*(Ae=ve)+Ce*(ve=N)-pe*Oe-ue*(Oe=Pe))),V=(i+=h+=u)*Math.cos(O*ce++),we+=V+V*p*Math.sin(re**5),g&&++g>S&&(i+=m,J+=m,g=0),k&&!(++x%k)&&(i=J,h=ae,g=g||1);return me},getNote:function(e=0,t=440){return t*2**(e/12)}};vn.volume=Jo;function _e(e,t,i=1){return vn.play(i,0,e,0,t/1e3,0),Fe(t)}async function gr(){for(let e=1;e<=65;e++)_e(ie.getUniformInt(1e3,2e3),1);await Fe(0)}async function Za(){for(let e=150;e>=35;e--)await _e(e,1)}async function Gr(){await _e(400,120,5),await Fe(10),await _e(700,120,5),await Fe(10)}async function ja(){for(let e=1;e<=23;e++)_e(ie.getUniformInt(350,900),120);await Fe(120);for(let e=1;e<=30;e++)_e(ie.getUniformInt(150,200),50)}async function ks(){for(let e=10;e<=90;e++)await _e(e,15,100)}async function Vr(){for(let e=150;e>35;e--)await _e(e,16,50)}const Ls=vn.buildSamples(10,0,40,void 0,.1,0,void 0,0,void 0,void 0,void 0,void 0,void 0,1);async function Ya(){vn.playSamples(Ls)}async function Xa(){for(let e=1;e<=25;e++)if(Math.random()>.5){const t=ie.getUniformInt(0,59)+10;for(let i=1;i<=t;i++)_e(ie.getUniformInt(0,4e3)+3e3,16,10)}else await Fe(ie.getUniformInt(0,29))}async function Ps(){for(let e=8e3;e>=20;e--)_e(ie.getUniformInt(0,e),1,30);await Fe(300)}async function Ds(){for(let e=10;e<45;e++)for(let t=1;t<13;t++)await _e(e*e*t,t+1,100)}async function Cs(e){await _e(200+200*e,25,100)}async function Ms(){await _e(2e3,40,10)}async function zs(){await _e(Math.random()*129+30,150,100)}async function Fs(){await _e(70,50*8,100)}async function Bs(){for(let e=330;e>20;e--)_e(90,10,.5)}async function Ns(){await _e(400,50)}async function Us(){await _e(130,50)}async function Gs(){_e(130,25),await _e(90,50)}async function Vs(){await _e(20,10,100)}async function Hs(){await _e(300,10,10)}async function Ws(){for(let e=45;e>=11;e--)for(let t=13;t>=1;t--)await _e(e*e*t,t+1,100)}async function $s(){for(let e=70;e<=600;e++)_e(e*2,3,10),e%10===0&&await Fe(1)}async function qs(){await _e(30,10,10),await Fe(20)}async function Zs(){for(let e=0;e<2500;e++)_e(ie.getUniformInt(0,e),5,100),e%25===0&&await Fe()}async function js(){for(let e=2500;e>50;e--)_e(ie.getUniformInt(0,e),5,100),e%25===0&&await Fe()}async function Ys(){for(let e=0;e<50;e++)_e(ie.getUniformInt(0,200),50,100);await Fe(50)}async function Xs(){await _e(ie.getUniformInt(110,1310),7,100)}async function Ks(){await _e(200,60,100)}async function Js(){await _e(600,20)}async function Qs(){await _e(90,10,10)}async function el(){for(let e=130;e>5;e--)await _e(e*8,16,100)}async function tl(){for(let e=20;e<8e3;e++)_e(e,1,100);await Fe(100)}async function il(){for(let e=5;e<70;e++)_e(e*8,1);await Fe(50)}const Hr={Amulet:Ws,SecretMessage:tl,WhipHit:Bs,WhipBreak:Ns,WhipBreakRock:Us,BlockedWall:Ya,Blocked:Za,StaticNoise:Xa};async function Ka(e){if(Hr[e])return await Hr[e]();console.warn("No sound for trigger:",e)}const kt=Symbol("isMob"),Ja=Symbol("followsPlayer"),Ji=Symbol("isPlayer"),Qa=Symbol("isGenerator"),vt=Symbol("isInvisible"),qi=Symbol("isSecreted"),bn=Symbol("isPushable"),En=Symbol("isPassable"),eo=Symbol("isImperviousToSpears"),er=Symbol("isBombable");class at{constructor(t){Le(this,"ch");Le(this,"fg");Le(this,"bg");Le(this,"blink",!1);this.ch=t.ch??he.FLOOR_CHAR,this.fg=t.fg??he.FLOOR_FG,this.bg=t.bg??he.FLOOR_BG,this.blink=t.blink??!1}}class ze{constructor(t={}){Le(this,"replacement",y.Floor);Le(this,"x");Le(this,"y");Le(this,"px",null);Le(this,"py",null);this.x=t.x??0,this.y=t.y??0}moveTo(t,i){this.px=this.x,this.py=this.y,this.x=t,this.y=i}die(){this.x=-1,this.y=-1}isDead(){return this.x===-1||this.y===-1}}class tr{constructor(t){Le(this,"set");this.set=new Set(t)}by(t){return this.set.has(t)}}class to{constructor(t){Le(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class io{constructor(t){Le(this,"set");this.set=new Set(t)}has(t){return this.set.has(t)}}class Zi{constructor(t){Le(this,"damage");this.damage=t.damage||1}}class si{constructor(t){Le(this,"keys",0);Le(this,"gems",0);Le(this,"whips",0);Le(this,"teleports",0);Le(this,"whipPower",0);this.keys=(t==null?void 0:t.keys)||0,this.gems=(t==null?void 0:t.gems)||0,this.whips=(t==null?void 0:t.whips)||0,this.whipPower=(t==null?void 0:t.whipPower)||0,this.teleports=(t==null?void 0:t.teleports)||0}}class ir{constructor(t){this.frames=t}getFrame(){return this.frames[ie.getUniformInt(0,this.frames.length-1)]}}class nr{constructor(t){Le(this,"i",0);Le(this,"ch","");this.frames=t,this.ch=t[0]}getFrame(){return this.i++,this.i%20===0&&(this.ch=this.frames[ie.getUniformInt(0,this.frames.length-1)]),this.ch}}class rr{constructor(t){this.message=t}}class no{constructor(t){Le(this,"basePace");Le(this,"hastedPace");this.basePace=t.basePace||1,this.hastedPace=t.hastedPace||1}}class li{constructor(t){Le(this,"hardness",0);Le(this,"hitSound",null);this.hardness=t.hardness||0,this.hitSound=t.hitSound||null}}class mr{constructor(t){this.message=t}}class ro{constructor(t){Le(this,"_components",new Map);Le(this,"_tags",new Set);this.type=t}add(t){return typeof t=="symbol"||typeof t=="string"?(this._tags.add(t),this):(this._components.set(t.constructor.name,t),this)}get(t){return this._components.get(t.name)}has(t){return typeof t=="symbol"||typeof t=="string"?this._tags.has(t):this._components.has(t.name)}remove(t){return typeof t=="symbol"||typeof t=="string"?this._tags.delete(t):this._components.delete(t.name)}}var y=(e=>(e[e.Border=-1]="Border",e[e.Floor=0]="Floor",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=3]="Fast",e[e.Block=4]="Block",e[e.Whip=5]="Whip",e[e.Stairs=6]="Stairs",e[e.Chest=7]="Chest",e[e.SlowTime=8]="SlowTime",e[e.Gem=9]="Gem",e[e.Invisible=10]="Invisible",e[e.Teleport=11]="Teleport",e[e.Key=12]="Key",e[e.Door=13]="Door",e[e.Wall=14]="Wall",e[e.SpeedTime=15]="SpeedTime",e[e.Trap=16]="Trap",e[e.River=17]="River",e[e.Power=18]="Power",e[e.Forest=19]="Forest",e[e.Tree=20]="Tree",e[e.Bomb=21]="Bomb",e[e.Lava=22]="Lava",e[e.Pit=23]="Pit",e[e.Tome=24]="Tome",e[e.Tunnel=25]="Tunnel",e[e.Freeze=26]="Freeze",e[e.Nugget=27]="Nugget",e[e.Quake=28]="Quake",e[e.IBlock=29]="IBlock",e[e.IWall=30]="IWall",e[e.IDoor=31]="IDoor",e[e.Stop=32]="Stop",e[e.Trap2=33]="Trap2",e[e.Zap=34]="Zap",e[e.Create=35]="Create",e[e.Generator=36]="Generator",e[e.Trap3=37]="Trap3",e[e.MBlock=38]="MBlock",e[e.Trap4=39]="Trap4",e[e.Player=40]="Player",e[e.ShowGems=41]="ShowGems",e[e.Tablet=42]="Tablet",e[e.ZBlock=43]="ZBlock",e[e.BlockSpell=44]="BlockSpell",e[e.Chance=45]="Chance",e[e.Statue=46]="Statue",e[e.WallVanish=47]="WallVanish",e[e.K=48]="K",e[e.R=49]="R",e[e.O=50]="O",e[e.Z=51]="Z",e[e.OWall1=52]="OWall1",e[e.OWall2=53]="OWall2",e[e.OWall3=54]="OWall3",e[e.CWall1=55]="CWall1",e[e.CWall2=56]="CWall2",e[e.CWall3=57]="CWall3",e[e.OSpell1=58]="OSpell1",e[e.OSpell2=59]="OSpell2",e[e.OSpell3=60]="OSpell3",e[e.CSpell1=61]="CSpell1",e[e.CSpell2=62]="CSpell2",e[e.CSpell3=63]="CSpell3",e[e.GBlock=64]="GBlock",e[e.Rock=65]="Rock",e[e.EWall=66]="EWall",e[e.Trap5=67]="Trap5",e[e.TBlock=68]="TBlock",e[e.TRock=69]="TRock",e[e.TGem=70]="TGem",e[e.TBlind=71]="TBlind",e[e.TWhip=72]="TWhip",e[e.TGold=73]="TGold",e[e.TTree=74]="TTree",e[e.Rope=75]="Rope",e[e.DropRope=76]="DropRope",e[e.DropRope2=77]="DropRope2",e[e.DropRope3=78]="DropRope3",e[e.DropRope4=79]="DropRope4",e[e.DropRope5=80]="DropRope5",e[e.Amulet=81]="Amulet",e[e.ShootRight=82]="ShootRight",e[e.ShootLeft=83]="ShootLeft",e[e.Trap6=224]="Trap6",e[e.Trap7=225]="Trap7",e[e.Trap8=226]="Trap8",e[e.Trap9=227]="Trap9",e[e.Trap10=228]="Trap10",e[e.Trap11=229]="Trap11",e[e.Trap12=230]="Trap12",e[e.Trap13=231]="Trap13",e[e.Message=252]="Message",e))(y||{});let nl=255,ar={},or={},un={},dn;const he={PLAYER_CHAR:"☻",PLAYER_FG:14,PLAYER_BG:0,FLOOR_CHAR:" ",FLOOR_FG:0,FLOOR_BG:0,BORDER_CHAR:"▒",BORDER_FG:9,BORDER_BG:0,CHANCE_CHAR:"?",CHANCE_FG:15,CHANCE_BG:0,BLOCK_CHAR:"█"};async function rl(e){var t,i,n,r,o,c,l,h,u,m,S,k,p,O,A,L,Y,q,I,E,C;if(ar={},or={},un={},dn=e,!dn.tiles)throw new Error("No tiles found in tileset");for(const H of dn.tiles){const Z=+H.id,ae=H.type?+H.type:nl++;ar[Z]=ae,or[ae]=Z;const J=ri((H==null?void 0:H.properties)??{});if(y[ae]&&J.name!==y[ae])throw new Error("Tile ID mismatch");const me=y[ae]??J.name??""+ae;if(un[me])throw new Error("Duplicate type name: "+me);switch(un[me]=ae,ae){case 0:he.FLOOR_CHAR=((t=J.Tile)==null?void 0:t.ch)??he.FLOOR_CHAR,he.FLOOR_FG=(i=J.Tile)!=null&&i.fg?G[(n=J.Tile)==null?void 0:n.fg]:he.FLOOR_FG,he.FLOOR_BG=(r=J.Tile)!=null&&r.bg?G[(o=J.Tile)==null?void 0:o.bg]:he.FLOOR_BG;break;case 4:he.BLOCK_CHAR=((c=J.Tile)==null?void 0:c.ch)??he.BLOCK_CHAR;break;case-1:he.BORDER_CHAR=((l=J.Tile)==null?void 0:l.ch)??he.BORDER_CHAR,he.BORDER_FG=(h=J.Tile)!=null&&h.fg?G[(u=J.Tile)==null?void 0:u.fg]:he.BORDER_FG,he.BORDER_BG=(m=J.Tile)!=null&&m.bg?G[(S=J.Tile)==null?void 0:S.bg]:he.BORDER_BG;break;case 45:he.CHANCE_CHAR=((k=J.Tile)==null?void 0:k.ch)??he.CHANCE_CHAR,he.CHANCE_FG=(p=J.Tile)!=null&&p.fg?G[(O=J.Tile)==null?void 0:O.fg]:he.CHANCE_FG,he.CHANCE_BG=(A=J.Tile)!=null&&A.bg?G[(L=J.Tile)==null?void 0:L.bg]:he.CHANCE_BG;break;case 40:he.PLAYER_CHAR=((Y=J.Tile)==null?void 0:Y.ch)??he.PLAYER_CHAR,he.PLAYER_FG=(q=J.Tile)!=null&&q.fg?G[(I=J.Tile)==null?void 0:I.fg]:he.PLAYER_FG,he.PLAYER_BG=(E=J.Tile)!=null&&E.bg?G[(C=J.Tile)==null?void 0:C.bg]:he.PLAYER_BG;break}}}const Qi=[3,2,1],xn=[5,9,11,7],ao=[8,10,15,26],Sn=[33,37,39,67,224,225,226,227,228,229,230,231],al=[16,...Sn],Tn=[48,49,50,51],oo=[55,56,57],so=[58,59,60],ol=[61,62,63],wr=[68,69,70,71,72,73,74],sl=[0,...Qi,...xn,...ao,...al,32],ll=[0,32,...Sn,41,47,...wr],cl=[0,32,41,44,47,...oo,...ol,...wr,...Sn],fl=[...xn,8,10,12,16,18,21,26,27,34,35,42,45,...Tn,...so,82,83],ul=[6,23],dl=[0,32,...Sn,...oo],hl=[0,68,69,70,71,73,72,74],Wr=[5,7,8,9,10,11,12,15,16,18,26,27,...Tn,82,83],_l=[0,...Qi,4,...xn,...ao,16,18,19,20,21,27,28,32,33,34,35,37,38,39,41,42,43,44,45,47,...Tn,57,60,64,67,...wr,77,78,79,80,81,82,83],pl=[0,16,27,28,32,33,37,39];function gl(e){for(const t of dn.tiles)if(t.id===e)return t}function yr(e,t,i){const n=or[e]??0;return Vi(n,t,i)}function Vi(e,t,i,n,r){const o=gl(e);r=Pt(r)??ar[e]??rs(e)??0;const c=new ro(r);return o&&o.properties&&Zr(c,ri(o.properties)),Zr(c,n||{}),(c.has(Ji)||c.has(kt))&&c.add(new ze({x:t,y:i})),c}function Pt(e){if(typeof e=="number")return e;if(!(typeof e>"u"||e===""))return typeof e=="string"&&!isNaN(+e)?+e:e in y?y[e]:un[e]??e}const $r={isPlayer:Ji,isMob:kt,isGenerator:Qa,isSecreted:qi,isPushable:bn,isPassable:En,followsPlayer:Ja,isBombable:er,isImperviousToSpears:eo},qr={Collectible:si,Trigger:rr,AnimatedWalking:ir,Attacks:Zi,Speed:no,Breakable:li,FoundMessage:mr,Glitch:nr};function Zr(e,t){const i=e.type;for(const n in $r)t[n]&&e.add($r[n]);if(e.has(kt)&&(i===3||i===2||i===1)&&e.add(new to(Wr)).add(new io([4,38,43,64])),(hl.includes(i)||Wr.includes(i))&&e.add(new tr([3,2,1])),"ChanceOdds"in t){const n=t.ChanceOdds??0;if(n>0){const r=1/n;Math.random()<r&&e.add(qi)}}switch(i){case 0:e.add(new tr([3,2,1,38]));break;case 7:e.add(new si({whips:ie.getUniformInt(2,5),gems:ie.getUniformInt(5,ge.difficulty+2)}));break;case 45:{const n=ie.getUniformInt(0,ge.difficulty)+13;e.add(new si({gems:n}));break}}if("Tile"in t){const n=t.Tile,r=G[n.fg]??null,o=G[n.bg]??null,c=n.ch??he.FLOOR_CHAR,l=n.blink??!1;e.add(new at({fg:r,bg:o,ch:c,blink:l}))}for(const n in qr)if(n in t){const r=qr[n];e.add(new r(t[n]))}}function ml(e){switch(e){case-1:return F.score>F.levelIndex?-F.levelIndex/2:0;case 1:case 2:case 3:return e;case 4:case 14:case 43:case 64:case 17:case 20:case 19:case 38:case 52:case 53:case 54:case 66:return F.score>2?-2:0;case 5:case 8:return 1;case 6:return F.levelIndex;case 7:return 5;case 9:return 1;case 10:return 10;case 27:return 50;case 13:case 11:case 26:return 1;case 15:return 2;case 18:return 5;case 16:return F.score>5?-5:0;case 22:return 25;case 24:return 5e3;case 42:return F.levelIndex+250;case 45:return 100;case 46:return 10;case 81:return 2500;case 51:return 1e3;case 35:return F.levelIndex*2;case 36:return 50}return 0}function Hi(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.from(typeof e=="string"?[e]:e);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var r=n.reduce(function(l,h){var u=h.match(/\n([\t ]+|(?!\s).)/g);return u?l.concat(u.map(function(m){var S,k;return(k=(S=m.match(/[\t ]/g))===null||S===void 0?void 0:S.length)!==null&&k!==void 0?k:0})):l},[]);if(r.length){var o=new RegExp(`
[	 ]{`+Math.min.apply(Math,r)+"}","g");n=n.map(function(l){return l.replace(o,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var c=n[0];return t.forEach(function(l,h){var u=c.match(/(?:^|\n)( *)$/),m=u?u[1]:"",S=l;typeof l=="string"&&l.includes(`
`)&&(S=String(l).split(`
`).map(function(k,p){return p===0?k:""+m+k}).join(`
`)),c+=S+n[h+1]}),c}function wl(){Ie(70,0,"Score",G.Yellow,G.Blue),Ie(70,3,"Level",G.Yellow,G.Blue),Ie(70,6,"Gems",G.Yellow,G.Blue),Ie(70,9,"Whips",G.Yellow,G.Blue),Ie(68,12,"Teleports",G.Yellow,G.Blue),Ie(70,15,"Keys",G.Yellow,G.Blue);const[t,i]=_i(G.HighIntensityWhite,G.Blue);Ie(69,18,"OPTIONS",t,G.Red),Ie(69,19,`%c{${t}}W%c{}hip`,G.White,i),Ie(69,20,`%c{${t}}T%c{}eleport`,G.White,i),Ie(69,21,`%c{${t}}P%c{}ause`,G.White,i),Ie(69,22,`%c{${t}}Q%c{}uit`,G.White,i),Ie(69,23,`%c{${t}}S%c{}ave`,G.White,i),Ie(69,24,`%c{${t}}R%c{}estore`,G.White,i)}function Xt(){const e=F.whipPower>2?`${F.whips}+${F.whipPower-2}`:F.whips.toString(),t=4,i=7,n=!ge.paused&&F.gems<10?G.Red|16:G.Red,r=69;Ie(r,1,ti((F.score*10).toString(),t+1,i,he.FLOOR_CHAR),G.Red,G.Grey),Ie(r,4,ti(F.levelIndex.toString(),t,i,mi),G.Red,G.Grey),Ie(r,7,ti(F.gems.toString(),t+1,i,mi),n,G.Grey),Ie(r,10,ti(e,t,i,mi),G.Red,G.Grey),Ie(r,13,ti(F.teleports.toString(),t,i,mi),G.Red,G.Grey),Ie(r,16,ti(F.keys.toString(),t,i,mi),G.Red,G.Grey)}function vr(){const e=he.BORDER_CHAR,t=w.borderFG,i=w.borderBG;for(let n=$t-1;n<=ai+1;n++)Nt(n,0,e,t,i),Nt(n,gn+1,e,t,i);for(let n=qt-1;n<=gn+1;n++)Nt(0,n,e,t,i),Nt(ai+1,n,e,t,i)}async function yl(){Qt(G.Black),Rt(Ft-1,"Choose a game to start",G.HighIntensityWhite),Rt(Ft-1,"Press any key to continue",G.White),await yn(async()=>{Ie(5,5,Hi`
      ███     ███     ██████████         ███████████        █████████████  (R)
      ███░░  ███░░░   ███░░░░░███░      ███░░░░░░░███░        ░░░░░░████░░░
      ███░░ ███░░░    ███░░   ███░░     ███░░     ███░░            ███░░░░
      ███░░███░░░     ███░░   ███░░    ███░░░      ███░           ███░░░
      ███░███░░░      ██████████░░░    ███░░       ███░░         ███░░░
      ██████░░░       ███░░███░░░░     ███░░       ███░░        ███░░░
      ███░███░        ███░░ ███░        ███░      ███░░░       ███░░░
      ███░░███░       ███░░  ███░       ███░░     ███░░      ████░░░
      ███░░ ███░      ███░░   ███░       ███████████░░░     █████████████
      ███░░  ███░       ░░░     ░░░        ░░░░░░░░░░░        ░░░░░░░░░░░░░
      ███░░   ███░
      ███░░    ███████████████████████████████████████████████████████████
      ░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
    `,ie.getUniformInt(1,15)),await Fe(500)})}async function lo(){ge.bot||(Qt(G.Black),Rt(1,ge.title,G.Yellow),Ie(2,4,Hi`
    Kroz is a series of Roguelike video games created by Scott Miller and 
    published by Apogee Software in the late 1980s and early 1990s.  In March
    2009, the whole Kroz series was released as freeware by Apogee, and the
    source code was released as free software under the GPL license.`,G.White),Rt(Ft-1,"Press any key to continue.",G.HighIntensityWhite,G.Black),await Ui(),tn(),Ie(2,9,Hi`
    This is a re-implementation the original Kroz series of games in typescript 
    playable in the browser.  The source code completly open-source.  If you
    enjoy this game you are asked by the author to please add a star to the
    github repo at https://github.com/Hypercubed/kroz.`,G.White),Rt(Ft-1,"Press any key to continue.",G.HighIntensityWhite,G.Black),await Ui(),tn(),Ie(2,15,Hi`
    Better yet, contribute to the game yourself; or maybe fork it and add your
    own levels.  That might make a nice 7DRL challenge entry
    (https://7drl.com/).`,G.White),Rt(Ft-1,"Press any key to continue.",G.HighIntensityWhite,G.Black),await Ui(),tn(),Ie(10,20,"Thank you and enjoy the game.  -- Hypercubed"),Rt(Ft-1,"Press any key to continue.",G.HighIntensityWhite,G.Black),await Ui(),tn())}function _t(){for(let t=0;t<w.map.width;t++)for(let i=0;i<w.map.height;i++){const n=w.map.get(t,i);if(!n||n.type===y.Player||n.type===y.Slow||n.type===y.Medium||n.type===y.Fast){co(t,i);continue}ke(t,i,n)}for(let t=0;t<w.entities.length;t++){const i=w.entities[t],n=i.get(ze);n.x===-1||n.y===-1||ke(n.x,n.y,i)}const e=w.player.get(ze);e&&ke(e.x,e.y,w.player)}function co(e,t){Nt(e+$t,t+qt,he.FLOOR_CHAR,he.FLOOR_FG,he.FLOOR_BG)}function ke(e,t,i){if(co(e,t),i??(i=w.map.get(e,t)),!i||i.has(vt))return;if(i.has(qi)){Nt(e+$t,t+qt,he.CHANCE_CHAR,he.CHANCE_FG,he.CHANCE_BG);return}if(!i.has(at))return;const n=i.get(at);let r=n.ch;const o=n.fg;i.has(nr)&&(r=i.get(nr).getFrame()),Nt(e+$t,t+qt,r,o,n.bg)}function At(e,t,i,n,r){Nt(e+$t,t+qt,i,n,r)}function On(e,t,i,n,r="#00000000"){jf(e+$t,t+qt,i,n,r)}async function ot(e){if(ge.bot||!e)return"";const t=(ai-e.length)/2,i=gn+1;ge.paused=!0;const n=await yn(()=>{Ie(t,i,e,ie.getUniformInt(1,15),G.Black)});return vr(),ge.paused=!1,n}function Rn(){Qt(G.Blue),vr(),wl(),_t(),Xt()}function vl(){_t(),Xt()}async function bl(){Qt(G.Blue),Ie(2,5,Hi`
    In the mystical Kingdom of Kroz, where ASCII characters come to life and
    danger lurks around every corner, a new chapter unfolds. You, a brave
    archaeologist, have heard whispers of the legendary Magical Amulet of Kroz,
    an artifact of immense power long thought lost to time.

    Will you be the one to uncover the secrets of the forsaken caverns? Can you
    retrieve the Magical Amulet and restore glory to the Kingdom of Kroz? The
    adventure awaits, brave explorer!

  `,G.LightCyan,G.Blue),Ie(9,16,`Use the cursor keys to move yourself (%c{${Yt[G.Yellow]}}☻%c{${Yt[G.LightGreen]}}) through the caverns.`,G.LightGreen,G.Blue),Rt(17,"Use your whip (press W) to destroy all nearby creatures.",G.LightGreen,G.Blue),await _e(220,100,50),await El(),await _e(700,100,10),Rt(Ft-1,"Press any key.",G.HighIntensityWhite,G.Blue),await yn(async()=>{await fo()})}async function fo(){const e=ge.title,t=di/2-e.length/2;Ie(t,1," ".repeat(e.length+2),ie.getUniformInt(0,16),G.Red),Ie(t,2," "+e+" ",ie.getUniformInt(0,16),G.Red),Ie(t,3," ".repeat(e.length+2),ie.getUniformInt(0,16),G.Red),await Fe(500)}const jr={"!":"SECRET MODE",T:null,N:"NOVICE",E:"EXPERENCED",A:"ADVANCED",B:null};async function El(){let e="";const t=Yt[G.LightGreen],i=Yt[G.HighIntensityWhite];for(Ie((di-52)/2,19,`Are you a %c{${i}}N%c{${t}}ovice, %c{${i}}E%c{${t}}xperenced or and %c{${i}}A%c{${t}}dvanced player?`,t,G.Blue);!jr[e];)e=await yn(async()=>{await fo()}),e=e.toUpperCase();switch(Zf(19),Rt(19,jr[e],G.LightGreen,G.Blue),e){case"N":F.gems=20,F.teleports=0,F.keys=0,F.whips=0,F.whipPower=2,ge.difficulty=Mt.Novice;break;case"E":F.gems=15,F.teleports=0,F.keys=0,F.whips=0,F.whipPower=2,ge.difficulty=Mt.Experienced;break;case"A":F.gems=10,F.teleports=0,F.keys=0,F.whips=0,F.whipPower=2,ge.difficulty=Mt.Advanced,ge.foundSet=!0;break;case"!":F.gems=250,F.whips=100,F.teleports=50,F.keys=1,F.whipPower=3,ge.difficulty=Mt.Cheat,ge.foundSet=!0;break;case"T":F.gems=1/0,F.teleports=1/0,F.keys=1,F.whips=1/0,F.whipPower=4,ge.difficulty=Mt.Tourist;break;case"B":F.gems=500,F.teleports=50,F.keys=0,F.whips=1e3,F.whipPower=3,ge.difficulty=Mt.Cheat,ge.foundSet=!0,ge.bot=Xo;break}return e}var Un={},vi={},Yr;function xl(){if(Yr)return vi;Yr=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.GridOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric"}(e||(vi.GridOrientation=e={})),vi}var ct={},bi={},Xr;function br(){if(Xr)return bi;Xr=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.Encoding=void 0;var e;return function(t){t.CSV="csv",t.BASE64="base64"}(e||(bi.Encoding=e={})),bi}var Kr;function uo(){if(Kr)return ct;Kr=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.isGroup=ct.isImageLayer=ct.isObjectGroup=ct.isUnencodedTileLayer=ct.isEncodedTileLayer=ct.isTileLayer=void 0;const e=br();function t(l){return l.type==="tilelayer"}ct.isTileLayer=t;function i(l){return l.type==="tilelayer"&&l.encoding!==e.Encoding.CSV}ct.isEncodedTileLayer=i;function n(l){return l.type==="tilelayer"&&(l.encoding==null||l.encoding===e.Encoding.CSV)}ct.isUnencodedTileLayer=n;function r(l){return l.type==="objectgroup"}ct.isObjectGroup=r;function o(l){return l.type==="imagelayer"}ct.isImageLayer=o;function c(l){return l.type==="group"}return ct.isGroup=c,ct}var Ei={},Jr;function ho(){if(Jr)return Ei;Jr=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.Compression=void 0;var e;return function(t){t.NONE="",t.GZIP="gzip",t.ZLIB="zlib",t.ZSTD="zstd"}(e||(Ei.Compression=e={})),Ei}var xi={},Si={},Qr;function Sl(){if(Qr)return Si;Qr=1,Si.byteLength=l,Si.toByteArray=u,Si.fromByteArray=k;for(var e=[],t=[],i=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,o=n.length;r<o;++r)e[r]=n[r],t[n.charCodeAt(r)]=r;t[45]=62,t[95]=63;function c(p){var O=p.length;if(O%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var A=p.indexOf("=");A===-1&&(A=O);var L=A===O?0:4-A%4;return[A,L]}function l(p){var O=c(p),A=O[0],L=O[1];return(A+L)*3/4-L}function h(p,O,A){return(O+A)*3/4-A}function u(p){var O,A=c(p),L=A[0],Y=A[1],q=new i(h(p,L,Y)),I=0,E=Y>0?L-4:L,C;for(C=0;C<E;C+=4)O=t[p.charCodeAt(C)]<<18|t[p.charCodeAt(C+1)]<<12|t[p.charCodeAt(C+2)]<<6|t[p.charCodeAt(C+3)],q[I++]=O>>16&255,q[I++]=O>>8&255,q[I++]=O&255;return Y===2&&(O=t[p.charCodeAt(C)]<<2|t[p.charCodeAt(C+1)]>>4,q[I++]=O&255),Y===1&&(O=t[p.charCodeAt(C)]<<10|t[p.charCodeAt(C+1)]<<4|t[p.charCodeAt(C+2)]>>2,q[I++]=O>>8&255,q[I++]=O&255),q}function m(p){return e[p>>18&63]+e[p>>12&63]+e[p>>6&63]+e[p&63]}function S(p,O,A){for(var L,Y=[],q=O;q<A;q+=3)L=(p[q]<<16&16711680)+(p[q+1]<<8&65280)+(p[q+2]&255),Y.push(m(L));return Y.join("")}function k(p){for(var O,A=p.length,L=A%3,Y=[],q=16383,I=0,E=A-L;I<E;I+=q)Y.push(S(p,I,I+q>E?E:I+q));return L===1?(O=p[A-1],Y.push(e[O>>2]+e[O<<4&63]+"==")):L===2&&(O=(p[A-2]<<8)+p[A-1],Y.push(e[O>>10]+e[O>>4&63]+e[O<<2&63]+"=")),Y.join("")}return Si}var Ti={},ea;function Tl(){if(ea)return Ti;ea=1;var e=ArrayBuffer,t=Uint8Array,i=Uint16Array,n=Int16Array,r=Int32Array,o=function(g,x,P){if(t.prototype.slice)return t.prototype.slice.call(g,x,P);(x==null||x<0)&&(x=0),(P==null||P>g.length)&&(P=g.length);var N=new t(P-x);return N.set(g.subarray(x,P)),N},c=function(g,x,P,N){if(t.prototype.fill)return t.prototype.fill.call(g,x,P,N);for((P==null||P<0)&&(P=0),(N==null||N>g.length)&&(N=g.length);P<N;++P)g[P]=x;return g},l=function(g,x,P,N){if(t.prototype.copyWithin)return t.prototype.copyWithin.call(g,x,P,N);for((P==null||P<0)&&(P=0),(N==null||N>g.length)&&(N=g.length);P<N;)g[x++]=g[P++]};Ti.ZstdErrorCode={InvalidData:0,WindowSizeTooLarge:1,InvalidBlockType:2,FSEAccuracyTooHigh:3,DistanceTooFarBack:4,UnexpectedEOF:5};var h=["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"],u=function(g,x,P){var N=new Error(x||h[g]);if(N.code=g,Error.captureStackTrace&&Error.captureStackTrace(N,u),!P)throw N;return N},m=function(g,x,P){for(var N=0,V=0;N<P;++N)V|=g[x++]<<(N<<3);return V},S=function(g,x){return(g[x]|g[x+1]<<8|g[x+2]<<16|g[x+3]<<24)>>>0},k=function(g,x){var P=g[0]|g[1]<<8|g[2]<<16;if(P==3126568&&g[3]==253){var N=g[4],V=N>>5&1,ee=N>>2&1,U=N&3,oe=N>>6;N&8&&u(0);var le=6-V,Re=U==3?4:U,Te=m(g,le,Re);le+=Re;var ue=oe?1<<oe:V,pe=m(g,le,ue)+(oe==1&&256),Ce=pe;if(!V){var He=1<<10+(g[5]>>3);Ce=He+(He>>3)*(g[5]&7)}Ce>2145386496&&u(1);var ye=new t((x==1?pe||Ce:x?0:Ce)+12);return ye[0]=1,ye[4]=4,ye[8]=8,{b:le+ue,y:0,l:0,d:Te,w:x&&x!=1?x:ye.subarray(12),e:Ce,o:new r(ye.buffer,0,3),u:pe,c:ee,m:Math.min(131072,Ce)}}else if((P>>4|g[3]<<20)==25481893)return S(g,4)+8;u(0)},p=function(g){for(var x=0;1<<x<=g;++x);return x-1},O=function(g,x,P){var N=(x<<3)+4,V=(g[x]&15)+5;V>P&&u(3);for(var ee=1<<V,U=ee,oe=-1,le=-1,Re=-1,Te=ee,ue=new e(512+(ee<<2)),pe=new n(ue,0,256),Ce=new i(ue,0,256),He=new i(ue,512,ee),ye=512+(ee<<1),Ae=new t(ue,ye,ee),ve=new t(ue,ye+ee);oe<255&&U>0;){var Oe=p(U+1),Pe=N>>3,Xe=(1<<Oe+1)-1,Be=(g[Pe]|g[Pe+1]<<8|g[Pe+2]<<16)>>(N&7)&Xe,xe=(1<<Oe)-1,Ue=Xe-U-1,Je=Be&xe;if(Je<Ue?(N+=Oe,Be=Je):(N+=Oe+1,Be>xe&&(Be-=Ue)),pe[++oe]=--Be,Be==-1?(U+=Be,Ae[--Te]=oe):U-=Be,!Be)do{var je=N>>3;le=(g[je]|g[je+1]<<8)>>(N&7)&3,N+=2,oe+=le}while(le==3)}(oe>255||U)&&u(0);for(var We=0,st=(ee>>1)+(ee>>3)+3,Ye=ee-1,Ne=0;Ne<=oe;++Ne){var be=pe[Ne];if(be<1){Ce[Ne]=-be;continue}for(Re=0;Re<be;++Re){Ae[We]=Ne;do We=We+st&Ye;while(We>=Te)}}for(We&&u(0),Re=0;Re<ee;++Re){var te=Ce[Ae[Re]]++,qe=ve[Re]=V-p(te);He[Re]=(te<<qe)-ee}return[N+7>>3,{b:V,s:Ae,n:ve,t:He}]},A=function(g,x){var P=0,N=-1,V=new t(292),ee=g[x],U=V.subarray(0,256),oe=V.subarray(256,268),le=new i(V.buffer,268);if(ee<128){var Re=O(g,x+1,6),Te=Re[0],ue=Re[1];x+=ee;var pe=Te<<3,Ce=g[x];Ce||u(0);for(var He=0,ye=0,Ae=ue.b,ve=Ae,Oe=(++x<<3)-8+p(Ce);Oe-=Ae,!(Oe<pe);){var Pe=Oe>>3;if(He+=(g[Pe]|g[Pe+1]<<8)>>(Oe&7)&(1<<Ae)-1,U[++N]=ue.s[He],Oe-=ve,Oe<pe)break;Pe=Oe>>3,ye+=(g[Pe]|g[Pe+1]<<8)>>(Oe&7)&(1<<ve)-1,U[++N]=ue.s[ye],Ae=ue.n[He],He=ue.t[He],ve=ue.n[ye],ye=ue.t[ye]}++N>255&&u(0)}else{for(N=ee-127;P<N;P+=2){var Xe=g[++x];U[P]=Xe>>4,U[P+1]=Xe&15}++x}var Be=0;for(P=0;P<N;++P){var xe=U[P];xe>11&&u(0),Be+=xe&&1<<xe-1}var Ue=p(Be)+1,Je=1<<Ue,je=Je-Be;for(je&je-1&&u(0),U[N++]=p(je)+1,P=0;P<N;++P){var xe=U[P];++oe[U[P]=xe&&Ue+1-xe]}var We=new t(Je<<1),st=We.subarray(0,Je),Ye=We.subarray(Je);for(le[Ue]=0,P=Ue;P>0;--P){var Ne=le[P];c(Ye,P,Ne,le[P-1]=Ne+oe[P]*(1<<Ue-P))}for(le[0]!=Je&&u(0),P=0;P<N;++P){var be=U[P];if(be){var te=le[be];c(st,P,te,le[be]=te+(1<<Ue-be))}}return[x,{n:Ye,b:Ue,s:st}]},L=O(new t([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],Y=O(new t([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],q=O(new t([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],I=function(g,x){for(var P=g.length,N=new r(P),V=0;V<P;++V)N[V]=x,x+=1<<g[V];return N},E=new t(new r([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),C=I(E,0),H=new t(new r([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),Z=I(H,3),ae=function(g,x,P){var N=g.length,V=x.length,ee=g[N-1],U=(1<<P.b)-1,oe=-P.b;ee||u(0);for(var le=0,Re=P.b,Te=(N<<3)-8+p(ee)-Re,ue=-1;Te>oe&&ue<V;){var pe=Te>>3,Ce=(g[pe]|g[pe+1]<<8|g[pe+2]<<16)>>(Te&7);le=(le<<Re|Ce)&U,x[++ue]=P.s[le],Te-=Re=P.n[le]}(Te!=oe||ue+1!=V)&&u(0)},J=function(g,x,P){var N=6,V=x.length,ee=V+3>>2,U=ee<<1,oe=ee+U;ae(g.subarray(N,N+=g[0]|g[1]<<8),x.subarray(0,ee),P),ae(g.subarray(N,N+=g[2]|g[3]<<8),x.subarray(ee,U),P),ae(g.subarray(N,N+=g[4]|g[5]<<8),x.subarray(U,oe),P),ae(g.subarray(N),x.subarray(oe),P)},me=function(g,x,P){var N,V=x.b,ee=g[V],U=ee>>1&3;x.l=ee&1;var oe=ee>>3|g[V+1]<<5|g[V+2]<<13,le=(V+=3)+oe;if(U==1)return V>=g.length?void 0:(x.b=V+1,P?(c(P,g[V],x.y,x.y+=oe),P):c(new t(oe),g[V]));if(!(le>g.length)){if(U==0)return x.b=le,P?(P.set(g.subarray(V,le),x.y),x.y+=oe,P):o(g,V,le);if(U==2){var Re=g[V],Te=Re&3,ue=Re>>2&3,pe=Re>>4,Ce=0,He=0;Te<2?ue&1?pe|=g[++V]<<4|(ue&2&&g[++V]<<12):pe=Re>>3:(He=ue,ue<2?(pe|=(g[++V]&63)<<4,Ce=g[V]>>6|g[++V]<<2):ue==2?(pe|=g[++V]<<4|(g[++V]&3)<<12,Ce=g[V]>>2|g[++V]<<6):(pe|=g[++V]<<4|(g[++V]&63)<<12,Ce=g[V]>>6|g[++V]<<2|g[++V]<<10)),++V;var ye=P?P.subarray(x.y,x.y+x.m):new t(x.m),Ae=ye.length-pe;if(Te==0)ye.set(g.subarray(V,V+=pe),Ae);else if(Te==1)c(ye,g[V++],Ae);else{var ve=x.h;if(Te==2){var Oe=A(g,V);Ce+=V-(V=Oe[0]),x.h=ve=Oe[1]}else ve||u(0);(He?J:ae)(g.subarray(V,V+=Ce),ye.subarray(Ae),ve)}var Pe=g[V++];if(Pe){Pe==255?Pe=(g[V++]|g[V++]<<8)+32512:Pe>127&&(Pe=Pe-128<<8|g[V++]);var Xe=g[V++];Xe&3&&u(0);for(var Be=[Y,q,L],xe=2;xe>-1;--xe){var Ue=Xe>>(xe<<1)+2&3;if(Ue==1){var Je=new t([0,0,g[V++]]);Be[xe]={s:Je.subarray(2,3),n:Je.subarray(0,1),t:new i(Je.buffer,0,1),b:0}}else Ue==2?(N=O(g,V,9-(xe&1)),V=N[0],Be[xe]=N[1]):Ue==3&&(x.t||u(0),Be[xe]=x.t[xe])}var je=x.t=Be,We=je[0],st=je[1],Ye=je[2],Ne=g[le-1];Ne||u(0);var be=(le<<3)-8+p(Ne)-Ye.b,te=be>>3,qe=0,dt=(g[te]|g[te+1]<<8)>>(be&7)&(1<<Ye.b)-1;te=(be-=st.b)>>3;var pt=(g[te]|g[te+1]<<8)>>(be&7)&(1<<st.b)-1;te=(be-=We.b)>>3;var f=(g[te]|g[te+1]<<8)>>(be&7)&(1<<We.b)-1;for(++Pe;--Pe;){var B=Ye.s[dt],$=Ye.n[dt],Q=We.s[f],se=We.n[f],fe=st.s[pt],_=st.n[pt];te=(be-=fe)>>3;var D=1<<fe,s=D+((g[te]|g[te+1]<<8|g[te+2]<<16|g[te+3]<<24)>>>(be&7)&D-1);te=(be-=H[Q])>>3;var W=Z[Q]+((g[te]|g[te+1]<<8|g[te+2]<<16)>>(be&7)&(1<<H[Q])-1);te=(be-=E[B])>>3;var Ee=C[B]+((g[te]|g[te+1]<<8|g[te+2]<<16)>>(be&7)&(1<<E[B])-1);if(te=(be-=$)>>3,dt=Ye.t[dt]+((g[te]|g[te+1]<<8)>>(be&7)&(1<<$)-1),te=(be-=se)>>3,f=We.t[f]+((g[te]|g[te+1]<<8)>>(be&7)&(1<<se)-1),te=(be-=_)>>3,pt=st.t[pt]+((g[te]|g[te+1]<<8)>>(be&7)&(1<<_)-1),s>3)x.o[2]=x.o[1],x.o[1]=x.o[0],x.o[0]=s-=3;else{var j=s-(Ee!=0);j?(s=j==3?x.o[0]-1:x.o[j],j>1&&(x.o[2]=x.o[1]),x.o[1]=x.o[0],x.o[0]=s):s=x.o[0]}for(var xe=0;xe<Ee;++xe)ye[qe+xe]=ye[Ae+xe];qe+=Ee,Ae+=Ee;var Se=qe-s;if(Se<0){var X=-Se,Ge=x.e+Se;X>W&&(X=W);for(var xe=0;xe<X;++xe)ye[qe+xe]=x.w[Ge+xe];qe+=X,W-=X,Se=0}for(var xe=0;xe<W;++xe)ye[qe+xe]=ye[Se+xe];qe+=W}if(qe!=Ae)for(;Ae<ye.length;)ye[qe++]=ye[Ae++];else qe=ye.length;P?x.y+=qe:ye=o(ye,0,qe)}else if(P){if(x.y+=pe,Ae)for(var xe=0;xe<pe;++xe)ye[xe]=ye[Ae+xe]}else Ae&&(ye=o(ye,Ae));return x.b=le,ye}u(2)}},we=function(g,x){if(g.length==1)return g[0];for(var P=new t(x),N=0,V=0;N<g.length;++N){var ee=g[N];P.set(ee,V),V+=ee.length}return P};function ce(g,x){for(var P=[],N=+!x,V=0,ee=0;g.length;){var U=k(g,N||x);if(typeof U=="object"){for(N?(x=null,U.w.length==U.u&&(P.push(x=U.w),ee+=U.u)):(P.push(x),U.e=0);!U.l;){var oe=me(g,U,x);oe||u(5),x?U.e=U.y:(P.push(oe),ee+=oe.length,l(U.w,0,oe.length),U.w.set(oe,U.w.length-oe.length))}V=U.b+U.c*4}else V=U;g=g.subarray(V)}return we(P,ee)}Ti.decompress=ce;var re=function(){function g(x){this.ondata=x,this.c=[],this.l=0,this.z=0}return g.prototype.push=function(x,P){if(typeof this.s=="number"){var N=Math.min(x.length,this.s);x=x.subarray(N),this.s-=N}var V=x.length,ee=V+this.l;if(!this.s){if(P){if(!ee){this.ondata(new t(0),!0);return}ee<5&&u(5)}else if(ee<18){this.c.push(x),this.l=ee;return}if(this.l&&(this.c.push(x),x=we(this.c,ee),this.c=[],this.l=0),typeof(this.s=k(x))=="number")return this.push(x,P)}if(typeof this.s!="number"){if(ee<(this.z||3)){P&&u(5),this.c.push(x),this.l=ee;return}if(this.l&&(this.c.push(x),x=we(this.c,ee),this.c=[],this.l=0),!this.z&&ee<(this.z=x[this.s.b]&2?4:3+(x[this.s.b]>>3|x[this.s.b+1]<<5|x[this.s.b+2]<<13))){P&&u(5),this.c.push(x),this.l=ee;return}else this.z=0;for(;;){var U=me(x,this.s);if(U)this.ondata(U,!1),l(this.s.w,0,U.length),this.s.w.set(U,this.s.w.length-U.length);else{P&&u(5);var oe=x.subarray(this.s.b);this.s.b=0,this.c.push(oe),this.l+=oe.length;return}if(this.s.l){var le=x.subarray(this.s.b);this.s=this.s.c*4,this.push(le,P);return}}}else P&&u(5)},g}();return Ti.Decompress=re,Ti}var bt={},Ut={},Et={},Gt={},ta;function Ol(){if(ta)return Gt;ta=1;const e=4,t=0,i=1,n=2;function r(f){let B=f.length;for(;--B>=0;)f[B]=0}const o=0,c=1,l=2,h=3,u=258,m=29,S=256,k=S+1+m,p=30,O=19,A=2*k+1,L=15,Y=16,q=7,I=256,E=16,C=17,H=18,Z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ae=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),J=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),me=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),we=512,ce=new Array((k+2)*2);r(ce);const re=new Array(p*2);r(re);const g=new Array(we);r(g);const x=new Array(u-h+1);r(x);const P=new Array(m);r(P);const N=new Array(p);r(N);function V(f,B,$,Q,se){this.static_tree=f,this.extra_bits=B,this.extra_base=$,this.elems=Q,this.max_length=se,this.has_stree=f&&f.length}let ee,U,oe;function le(f,B){this.dyn_tree=f,this.max_code=0,this.stat_desc=B}const Re=f=>f<256?g[f]:g[256+(f>>>7)],Te=(f,B)=>{f.pending_buf[f.pending++]=B&255,f.pending_buf[f.pending++]=B>>>8&255},ue=(f,B,$)=>{f.bi_valid>Y-$?(f.bi_buf|=B<<f.bi_valid&65535,Te(f,f.bi_buf),f.bi_buf=B>>Y-f.bi_valid,f.bi_valid+=$-Y):(f.bi_buf|=B<<f.bi_valid&65535,f.bi_valid+=$)},pe=(f,B,$)=>{ue(f,$[B*2],$[B*2+1])},Ce=(f,B)=>{let $=0;do $|=f&1,f>>>=1,$<<=1;while(--B>0);return $>>>1},He=f=>{f.bi_valid===16?(Te(f,f.bi_buf),f.bi_buf=0,f.bi_valid=0):f.bi_valid>=8&&(f.pending_buf[f.pending++]=f.bi_buf&255,f.bi_buf>>=8,f.bi_valid-=8)},ye=(f,B)=>{const $=B.dyn_tree,Q=B.max_code,se=B.stat_desc.static_tree,fe=B.stat_desc.has_stree,_=B.stat_desc.extra_bits,D=B.stat_desc.extra_base,s=B.stat_desc.max_length;let W,Ee,j,Se,X,Ge,M=0;for(Se=0;Se<=L;Se++)f.bl_count[Se]=0;for($[f.heap[f.heap_max]*2+1]=0,W=f.heap_max+1;W<A;W++)Ee=f.heap[W],Se=$[$[Ee*2+1]*2+1]+1,Se>s&&(Se=s,M++),$[Ee*2+1]=Se,!(Ee>Q)&&(f.bl_count[Se]++,X=0,Ee>=D&&(X=_[Ee-D]),Ge=$[Ee*2],f.opt_len+=Ge*(Se+X),fe&&(f.static_len+=Ge*(se[Ee*2+1]+X)));if(M!==0){do{for(Se=s-1;f.bl_count[Se]===0;)Se--;f.bl_count[Se]--,f.bl_count[Se+1]+=2,f.bl_count[s]--,M-=2}while(M>0);for(Se=s;Se!==0;Se--)for(Ee=f.bl_count[Se];Ee!==0;)j=f.heap[--W],!(j>Q)&&($[j*2+1]!==Se&&(f.opt_len+=(Se-$[j*2+1])*$[j*2],$[j*2+1]=Se),Ee--)}},Ae=(f,B,$)=>{const Q=new Array(L+1);let se=0,fe,_;for(fe=1;fe<=L;fe++)se=se+$[fe-1]<<1,Q[fe]=se;for(_=0;_<=B;_++){let D=f[_*2+1];D!==0&&(f[_*2]=Ce(Q[D]++,D))}},ve=()=>{let f,B,$,Q,se;const fe=new Array(L+1);for($=0,Q=0;Q<m-1;Q++)for(P[Q]=$,f=0;f<1<<Z[Q];f++)x[$++]=Q;for(x[$-1]=Q,se=0,Q=0;Q<16;Q++)for(N[Q]=se,f=0;f<1<<ae[Q];f++)g[se++]=Q;for(se>>=7;Q<p;Q++)for(N[Q]=se<<7,f=0;f<1<<ae[Q]-7;f++)g[256+se++]=Q;for(B=0;B<=L;B++)fe[B]=0;for(f=0;f<=143;)ce[f*2+1]=8,f++,fe[8]++;for(;f<=255;)ce[f*2+1]=9,f++,fe[9]++;for(;f<=279;)ce[f*2+1]=7,f++,fe[7]++;for(;f<=287;)ce[f*2+1]=8,f++,fe[8]++;for(Ae(ce,k+1,fe),f=0;f<p;f++)re[f*2+1]=5,re[f*2]=Ce(f,5);ee=new V(ce,Z,S+1,k,L),U=new V(re,ae,0,p,L),oe=new V(new Array(0),J,0,O,q)},Oe=f=>{let B;for(B=0;B<k;B++)f.dyn_ltree[B*2]=0;for(B=0;B<p;B++)f.dyn_dtree[B*2]=0;for(B=0;B<O;B++)f.bl_tree[B*2]=0;f.dyn_ltree[I*2]=1,f.opt_len=f.static_len=0,f.sym_next=f.matches=0},Pe=f=>{f.bi_valid>8?Te(f,f.bi_buf):f.bi_valid>0&&(f.pending_buf[f.pending++]=f.bi_buf),f.bi_buf=0,f.bi_valid=0},Xe=(f,B,$,Q)=>{const se=B*2,fe=$*2;return f[se]<f[fe]||f[se]===f[fe]&&Q[B]<=Q[$]},Be=(f,B,$)=>{const Q=f.heap[$];let se=$<<1;for(;se<=f.heap_len&&(se<f.heap_len&&Xe(B,f.heap[se+1],f.heap[se],f.depth)&&se++,!Xe(B,Q,f.heap[se],f.depth));)f.heap[$]=f.heap[se],$=se,se<<=1;f.heap[$]=Q},xe=(f,B,$)=>{let Q,se,fe=0,_,D;if(f.sym_next!==0)do Q=f.pending_buf[f.sym_buf+fe++]&255,Q+=(f.pending_buf[f.sym_buf+fe++]&255)<<8,se=f.pending_buf[f.sym_buf+fe++],Q===0?pe(f,se,B):(_=x[se],pe(f,_+S+1,B),D=Z[_],D!==0&&(se-=P[_],ue(f,se,D)),Q--,_=Re(Q),pe(f,_,$),D=ae[_],D!==0&&(Q-=N[_],ue(f,Q,D)));while(fe<f.sym_next);pe(f,I,B)},Ue=(f,B)=>{const $=B.dyn_tree,Q=B.stat_desc.static_tree,se=B.stat_desc.has_stree,fe=B.stat_desc.elems;let _,D,s=-1,W;for(f.heap_len=0,f.heap_max=A,_=0;_<fe;_++)$[_*2]!==0?(f.heap[++f.heap_len]=s=_,f.depth[_]=0):$[_*2+1]=0;for(;f.heap_len<2;)W=f.heap[++f.heap_len]=s<2?++s:0,$[W*2]=1,f.depth[W]=0,f.opt_len--,se&&(f.static_len-=Q[W*2+1]);for(B.max_code=s,_=f.heap_len>>1;_>=1;_--)Be(f,$,_);W=fe;do _=f.heap[1],f.heap[1]=f.heap[f.heap_len--],Be(f,$,1),D=f.heap[1],f.heap[--f.heap_max]=_,f.heap[--f.heap_max]=D,$[W*2]=$[_*2]+$[D*2],f.depth[W]=(f.depth[_]>=f.depth[D]?f.depth[_]:f.depth[D])+1,$[_*2+1]=$[D*2+1]=W,f.heap[1]=W++,Be(f,$,1);while(f.heap_len>=2);f.heap[--f.heap_max]=f.heap[1],ye(f,B),Ae($,s,f.bl_count)},Je=(f,B,$)=>{let Q,se=-1,fe,_=B[0*2+1],D=0,s=7,W=4;for(_===0&&(s=138,W=3),B[($+1)*2+1]=65535,Q=0;Q<=$;Q++)fe=_,_=B[(Q+1)*2+1],!(++D<s&&fe===_)&&(D<W?f.bl_tree[fe*2]+=D:fe!==0?(fe!==se&&f.bl_tree[fe*2]++,f.bl_tree[E*2]++):D<=10?f.bl_tree[C*2]++:f.bl_tree[H*2]++,D=0,se=fe,_===0?(s=138,W=3):fe===_?(s=6,W=3):(s=7,W=4))},je=(f,B,$)=>{let Q,se=-1,fe,_=B[0*2+1],D=0,s=7,W=4;for(_===0&&(s=138,W=3),Q=0;Q<=$;Q++)if(fe=_,_=B[(Q+1)*2+1],!(++D<s&&fe===_)){if(D<W)do pe(f,fe,f.bl_tree);while(--D!==0);else fe!==0?(fe!==se&&(pe(f,fe,f.bl_tree),D--),pe(f,E,f.bl_tree),ue(f,D-3,2)):D<=10?(pe(f,C,f.bl_tree),ue(f,D-3,3)):(pe(f,H,f.bl_tree),ue(f,D-11,7));D=0,se=fe,_===0?(s=138,W=3):fe===_?(s=6,W=3):(s=7,W=4)}},We=f=>{let B;for(Je(f,f.dyn_ltree,f.l_desc.max_code),Je(f,f.dyn_dtree,f.d_desc.max_code),Ue(f,f.bl_desc),B=O-1;B>=3&&f.bl_tree[me[B]*2+1]===0;B--);return f.opt_len+=3*(B+1)+5+5+4,B},st=(f,B,$,Q)=>{let se;for(ue(f,B-257,5),ue(f,$-1,5),ue(f,Q-4,4),se=0;se<Q;se++)ue(f,f.bl_tree[me[se]*2+1],3);je(f,f.dyn_ltree,B-1),je(f,f.dyn_dtree,$-1)},Ye=f=>{let B=4093624447,$;for($=0;$<=31;$++,B>>>=1)if(B&1&&f.dyn_ltree[$*2]!==0)return t;if(f.dyn_ltree[9*2]!==0||f.dyn_ltree[10*2]!==0||f.dyn_ltree[13*2]!==0)return i;for($=32;$<S;$++)if(f.dyn_ltree[$*2]!==0)return i;return t};let Ne=!1;const be=f=>{Ne||(ve(),Ne=!0),f.l_desc=new le(f.dyn_ltree,ee),f.d_desc=new le(f.dyn_dtree,U),f.bl_desc=new le(f.bl_tree,oe),f.bi_buf=0,f.bi_valid=0,Oe(f)},te=(f,B,$,Q)=>{ue(f,(o<<1)+(Q?1:0),3),Pe(f),Te(f,$),Te(f,~$),$&&f.pending_buf.set(f.window.subarray(B,B+$),f.pending),f.pending+=$},qe=f=>{ue(f,c<<1,3),pe(f,I,ce),He(f)},dt=(f,B,$,Q)=>{let se,fe,_=0;f.level>0?(f.strm.data_type===n&&(f.strm.data_type=Ye(f)),Ue(f,f.l_desc),Ue(f,f.d_desc),_=We(f),se=f.opt_len+3+7>>>3,fe=f.static_len+3+7>>>3,fe<=se&&(se=fe)):se=fe=$+5,$+4<=se&&B!==-1?te(f,B,$,Q):f.strategy===e||fe===se?(ue(f,(c<<1)+(Q?1:0),3),xe(f,ce,re)):(ue(f,(l<<1)+(Q?1:0),3),st(f,f.l_desc.max_code+1,f.d_desc.max_code+1,_+1),xe(f,f.dyn_ltree,f.dyn_dtree)),Oe(f),Q&&Pe(f)},pt=(f,B,$)=>(f.pending_buf[f.sym_buf+f.sym_next++]=B,f.pending_buf[f.sym_buf+f.sym_next++]=B>>8,f.pending_buf[f.sym_buf+f.sym_next++]=$,B===0?f.dyn_ltree[$*2]++:(f.matches++,B--,f.dyn_ltree[(x[$]+S+1)*2]++,f.dyn_dtree[Re(B)*2]++),f.sym_next===f.sym_end);return Gt._tr_init=be,Gt._tr_stored_block=te,Gt._tr_flush_block=dt,Gt._tr_tally=pt,Gt._tr_align=qe,Gt}var Gn,ia;function _o(){return ia||(ia=1,Gn=(t,i,n,r)=>{let o=t&65535|0,c=t>>>16&65535|0,l=0;for(;n!==0;){l=n>2e3?2e3:n,n-=l;do o=o+i[r++]|0,c=c+o|0;while(--l);o%=65521,c%=65521}return o|c<<16|0}),Gn}var Vn,na;function po(){if(na)return Vn;na=1;const e=()=>{let n,r=[];for(var o=0;o<256;o++){n=o;for(var c=0;c<8;c++)n=n&1?3988292384^n>>>1:n>>>1;r[o]=n}return r},t=new Uint32Array(e());return Vn=(n,r,o,c)=>{const l=t,h=c+o;n^=-1;for(let u=c;u<h;u++)n=n>>>8^l[(n^r[u])&255];return n^-1},Vn}var Hn,ra;function Er(){return ra||(ra=1,Hn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),Hn}var Wn,aa;function jt(){return aa||(aa=1,Wn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),Wn}var oa;function Rl(){if(oa)return Et;oa=1;const{_tr_init:e,_tr_stored_block:t,_tr_flush_block:i,_tr_tally:n,_tr_align:r}=Ol(),o=_o(),c=po(),l=Er(),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:u,Z_FULL_FLUSH:m,Z_FINISH:S,Z_BLOCK:k,Z_OK:p,Z_STREAM_END:O,Z_STREAM_ERROR:A,Z_DATA_ERROR:L,Z_BUF_ERROR:Y,Z_DEFAULT_COMPRESSION:q,Z_FILTERED:I,Z_HUFFMAN_ONLY:E,Z_RLE:C,Z_FIXED:H,Z_DEFAULT_STRATEGY:Z,Z_UNKNOWN:ae,Z_DEFLATED:J}=jt(),me=9,we=15,ce=8,x=256+1+29,P=30,N=19,V=2*x+1,ee=15,U=3,oe=258,le=oe+U+1,Re=32,Te=42,ue=57,pe=69,Ce=73,He=91,ye=103,Ae=113,ve=666,Oe=1,Pe=2,Xe=3,Be=4,xe=3,Ue=(a,T)=>(a.msg=l[T],T),Je=a=>a*2-(a>4?9:0),je=a=>{let T=a.length;for(;--T>=0;)a[T]=0},We=a=>{let T,d,v,b=a.w_size;T=a.hash_size,v=T;do d=a.head[--v],a.head[v]=d>=b?d-b:0;while(--T);T=b,v=T;do d=a.prev[--v],a.prev[v]=d>=b?d-b:0;while(--T)};let Ye=(a,T,d)=>(T<<a.hash_shift^d)&a.hash_mask;const Ne=a=>{const T=a.state;let d=T.pending;d>a.avail_out&&(d=a.avail_out),d!==0&&(a.output.set(T.pending_buf.subarray(T.pending_out,T.pending_out+d),a.next_out),a.next_out+=d,T.pending_out+=d,a.total_out+=d,a.avail_out-=d,T.pending-=d,T.pending===0&&(T.pending_out=0))},be=(a,T)=>{i(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,T),a.block_start=a.strstart,Ne(a.strm)},te=(a,T)=>{a.pending_buf[a.pending++]=T},qe=(a,T)=>{a.pending_buf[a.pending++]=T>>>8&255,a.pending_buf[a.pending++]=T&255},dt=(a,T,d,v)=>{let b=a.avail_in;return b>v&&(b=v),b===0?0:(a.avail_in-=b,T.set(a.input.subarray(a.next_in,a.next_in+b),d),a.state.wrap===1?a.adler=o(a.adler,T,b,d):a.state.wrap===2&&(a.adler=c(a.adler,T,b,d)),a.next_in+=b,a.total_in+=b,b)},pt=(a,T)=>{let d=a.max_chain_length,v=a.strstart,b,K,de=a.prev_length,ne=a.nice_match;const lt=a.strstart>a.w_size-le?a.strstart-(a.w_size-le):0,Me=a.window,Ke=a.w_mask,ht=a.prev,Qe=a.strstart+oe;let wt=Me[v+de-1],gt=Me[v+de];a.prev_length>=a.good_match&&(d>>=2),ne>a.lookahead&&(ne=a.lookahead);do if(b=T,!(Me[b+de]!==gt||Me[b+de-1]!==wt||Me[b]!==Me[v]||Me[++b]!==Me[v+1])){v+=2,b++;do;while(Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&Me[++v]===Me[++b]&&v<Qe);if(K=oe-(Qe-v),v=Qe-oe,K>de){if(a.match_start=T,de=K,K>=ne)break;wt=Me[v+de-1],gt=Me[v+de]}}while((T=ht[T&Ke])>lt&&--d!==0);return de<=a.lookahead?de:a.lookahead},f=a=>{const T=a.w_size;let d,v,b;do{if(v=a.window_size-a.lookahead-a.strstart,a.strstart>=T+(T-le)&&(a.window.set(a.window.subarray(T,T+T-v),0),a.match_start-=T,a.strstart-=T,a.block_start-=T,a.insert>a.strstart&&(a.insert=a.strstart),We(a),v+=T),a.strm.avail_in===0)break;if(d=dt(a.strm,a.window,a.strstart+a.lookahead,v),a.lookahead+=d,a.lookahead+a.insert>=U)for(b=a.strstart-a.insert,a.ins_h=a.window[b],a.ins_h=Ye(a,a.ins_h,a.window[b+1]);a.insert&&(a.ins_h=Ye(a,a.ins_h,a.window[b+U-1]),a.prev[b&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=b,b++,a.insert--,!(a.lookahead+a.insert<U)););}while(a.lookahead<le&&a.strm.avail_in!==0)},B=(a,T)=>{let d=a.pending_buf_size-5>a.w_size?a.w_size:a.pending_buf_size-5,v,b,K,de=0,ne=a.strm.avail_in;do{if(v=65535,K=a.bi_valid+42>>3,a.strm.avail_out<K||(K=a.strm.avail_out-K,b=a.strstart-a.block_start,v>b+a.strm.avail_in&&(v=b+a.strm.avail_in),v>K&&(v=K),v<d&&(v===0&&T!==S||T===h||v!==b+a.strm.avail_in)))break;de=T===S&&v===b+a.strm.avail_in?1:0,t(a,0,0,de),a.pending_buf[a.pending-4]=v,a.pending_buf[a.pending-3]=v>>8,a.pending_buf[a.pending-2]=~v,a.pending_buf[a.pending-1]=~v>>8,Ne(a.strm),b&&(b>v&&(b=v),a.strm.output.set(a.window.subarray(a.block_start,a.block_start+b),a.strm.next_out),a.strm.next_out+=b,a.strm.avail_out-=b,a.strm.total_out+=b,a.block_start+=b,v-=b),v&&(dt(a.strm,a.strm.output,a.strm.next_out,v),a.strm.next_out+=v,a.strm.avail_out-=v,a.strm.total_out+=v)}while(de===0);return ne-=a.strm.avail_in,ne&&(ne>=a.w_size?(a.matches=2,a.window.set(a.strm.input.subarray(a.strm.next_in-a.w_size,a.strm.next_in),0),a.strstart=a.w_size,a.insert=a.strstart):(a.window_size-a.strstart<=ne&&(a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,a.insert>a.strstart&&(a.insert=a.strstart)),a.window.set(a.strm.input.subarray(a.strm.next_in-ne,a.strm.next_in),a.strstart),a.strstart+=ne,a.insert+=ne>a.w_size-a.insert?a.w_size-a.insert:ne),a.block_start=a.strstart),a.high_water<a.strstart&&(a.high_water=a.strstart),de?Be:T!==h&&T!==S&&a.strm.avail_in===0&&a.strstart===a.block_start?Pe:(K=a.window_size-a.strstart,a.strm.avail_in>K&&a.block_start>=a.w_size&&(a.block_start-=a.w_size,a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,K+=a.w_size,a.insert>a.strstart&&(a.insert=a.strstart)),K>a.strm.avail_in&&(K=a.strm.avail_in),K&&(dt(a.strm,a.window,a.strstart,K),a.strstart+=K,a.insert+=K>a.w_size-a.insert?a.w_size-a.insert:K),a.high_water<a.strstart&&(a.high_water=a.strstart),K=a.bi_valid+42>>3,K=a.pending_buf_size-K>65535?65535:a.pending_buf_size-K,d=K>a.w_size?a.w_size:K,b=a.strstart-a.block_start,(b>=d||(b||T===S)&&T!==h&&a.strm.avail_in===0&&b<=K)&&(v=b>K?K:b,de=T===S&&a.strm.avail_in===0&&v===b?1:0,t(a,a.block_start,v,de),a.block_start+=v,Ne(a.strm)),de?Xe:Oe)},$=(a,T)=>{let d,v;for(;;){if(a.lookahead<le){if(f(a),a.lookahead<le&&T===h)return Oe;if(a.lookahead===0)break}if(d=0,a.lookahead>=U&&(a.ins_h=Ye(a,a.ins_h,a.window[a.strstart+U-1]),d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),d!==0&&a.strstart-d<=a.w_size-le&&(a.match_length=pt(a,d)),a.match_length>=U)if(v=n(a,a.strstart-a.match_start,a.match_length-U),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=U){a.match_length--;do a.strstart++,a.ins_h=Ye(a,a.ins_h,a.window[a.strstart+U-1]),d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=Ye(a,a.ins_h,a.window[a.strstart+1]);else v=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(v&&(be(a,!1),a.strm.avail_out===0))return Oe}return a.insert=a.strstart<U-1?a.strstart:U-1,T===S?(be(a,!0),a.strm.avail_out===0?Xe:Be):a.sym_next&&(be(a,!1),a.strm.avail_out===0)?Oe:Pe},Q=(a,T)=>{let d,v,b;for(;;){if(a.lookahead<le){if(f(a),a.lookahead<le&&T===h)return Oe;if(a.lookahead===0)break}if(d=0,a.lookahead>=U&&(a.ins_h=Ye(a,a.ins_h,a.window[a.strstart+U-1]),d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=U-1,d!==0&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-le&&(a.match_length=pt(a,d),a.match_length<=5&&(a.strategy===I||a.match_length===U&&a.strstart-a.match_start>4096)&&(a.match_length=U-1)),a.prev_length>=U&&a.match_length<=a.prev_length){b=a.strstart+a.lookahead-U,v=n(a,a.strstart-1-a.prev_match,a.prev_length-U),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=b&&(a.ins_h=Ye(a,a.ins_h,a.window[a.strstart+U-1]),d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);if(a.match_available=0,a.match_length=U-1,a.strstart++,v&&(be(a,!1),a.strm.avail_out===0))return Oe}else if(a.match_available){if(v=n(a,0,a.window[a.strstart-1]),v&&be(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return Oe}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(v=n(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<U-1?a.strstart:U-1,T===S?(be(a,!0),a.strm.avail_out===0?Xe:Be):a.sym_next&&(be(a,!1),a.strm.avail_out===0)?Oe:Pe},se=(a,T)=>{let d,v,b,K;const de=a.window;for(;;){if(a.lookahead<=oe){if(f(a),a.lookahead<=oe&&T===h)return Oe;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=U&&a.strstart>0&&(b=a.strstart-1,v=de[b],v===de[++b]&&v===de[++b]&&v===de[++b])){K=a.strstart+oe;do;while(v===de[++b]&&v===de[++b]&&v===de[++b]&&v===de[++b]&&v===de[++b]&&v===de[++b]&&v===de[++b]&&v===de[++b]&&b<K);a.match_length=oe-(K-b),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=U?(d=n(a,1,a.match_length-U),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(d=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),d&&(be(a,!1),a.strm.avail_out===0))return Oe}return a.insert=0,T===S?(be(a,!0),a.strm.avail_out===0?Xe:Be):a.sym_next&&(be(a,!1),a.strm.avail_out===0)?Oe:Pe},fe=(a,T)=>{let d;for(;;){if(a.lookahead===0&&(f(a),a.lookahead===0)){if(T===h)return Oe;break}if(a.match_length=0,d=n(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,d&&(be(a,!1),a.strm.avail_out===0))return Oe}return a.insert=0,T===S?(be(a,!0),a.strm.avail_out===0?Xe:Be):a.sym_next&&(be(a,!1),a.strm.avail_out===0)?Oe:Pe};function _(a,T,d,v,b){this.good_length=a,this.max_lazy=T,this.nice_length=d,this.max_chain=v,this.func=b}const D=[new _(0,0,0,0,B),new _(4,4,8,4,$),new _(4,5,16,8,$),new _(4,6,32,32,$),new _(4,4,16,16,Q),new _(8,16,32,32,Q),new _(8,16,128,128,Q),new _(8,32,128,256,Q),new _(32,128,258,1024,Q),new _(32,258,258,4096,Q)],s=a=>{a.window_size=2*a.w_size,je(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=U-1,a.match_available=0,a.ins_h=0};function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(V*2),this.dyn_dtree=new Uint16Array((2*P+1)*2),this.bl_tree=new Uint16Array((2*N+1)*2),je(this.dyn_ltree),je(this.dyn_dtree),je(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ee+1),this.heap=new Uint16Array(2*x+1),je(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*x+1),je(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ee=a=>{if(!a)return 1;const T=a.state;return!T||T.strm!==a||T.status!==Te&&T.status!==ue&&T.status!==pe&&T.status!==Ce&&T.status!==He&&T.status!==ye&&T.status!==Ae&&T.status!==ve?1:0},j=a=>{if(Ee(a))return Ue(a,A);a.total_in=a.total_out=0,a.data_type=ae;const T=a.state;return T.pending=0,T.pending_out=0,T.wrap<0&&(T.wrap=-T.wrap),T.status=T.wrap===2?ue:T.wrap?Te:Ae,a.adler=T.wrap===2?0:1,T.last_flush=-2,e(T),p},Se=a=>{const T=j(a);return T===p&&s(a.state),T},X=(a,T)=>Ee(a)||a.state.wrap!==2?A:(a.state.gzhead=T,p),Ge=(a,T,d,v,b,K)=>{if(!a)return A;let de=1;if(T===q&&(T=6),v<0?(de=0,v=-v):v>15&&(de=2,v-=16),b<1||b>me||d!==J||v<8||v>15||T<0||T>9||K<0||K>H||v===8&&de!==1)return Ue(a,A);v===8&&(v=9);const ne=new W;return a.state=ne,ne.strm=a,ne.status=Te,ne.wrap=de,ne.gzhead=null,ne.w_bits=v,ne.w_size=1<<ne.w_bits,ne.w_mask=ne.w_size-1,ne.hash_bits=b+7,ne.hash_size=1<<ne.hash_bits,ne.hash_mask=ne.hash_size-1,ne.hash_shift=~~((ne.hash_bits+U-1)/U),ne.window=new Uint8Array(ne.w_size*2),ne.head=new Uint16Array(ne.hash_size),ne.prev=new Uint16Array(ne.w_size),ne.lit_bufsize=1<<b+6,ne.pending_buf_size=ne.lit_bufsize*4,ne.pending_buf=new Uint8Array(ne.pending_buf_size),ne.sym_buf=ne.lit_bufsize,ne.sym_end=(ne.lit_bufsize-1)*3,ne.level=T,ne.strategy=K,ne.method=d,Se(a)},M=(a,T)=>Ge(a,T,J,we,ce,Z),z=(a,T)=>{if(Ee(a)||T>k||T<0)return a?Ue(a,A):A;const d=a.state;if(!a.output||a.avail_in!==0&&!a.input||d.status===ve&&T!==S)return Ue(a,a.avail_out===0?Y:A);const v=d.last_flush;if(d.last_flush=T,d.pending!==0){if(Ne(a),a.avail_out===0)return d.last_flush=-1,p}else if(a.avail_in===0&&Je(T)<=Je(v)&&T!==S)return Ue(a,Y);if(d.status===ve&&a.avail_in!==0)return Ue(a,Y);if(d.status===Te&&d.wrap===0&&(d.status=Ae),d.status===Te){let b=J+(d.w_bits-8<<4)<<8,K=-1;if(d.strategy>=E||d.level<2?K=0:d.level<6?K=1:d.level===6?K=2:K=3,b|=K<<6,d.strstart!==0&&(b|=Re),b+=31-b%31,qe(d,b),d.strstart!==0&&(qe(d,a.adler>>>16),qe(d,a.adler&65535)),a.adler=1,d.status=Ae,Ne(a),d.pending!==0)return d.last_flush=-1,p}if(d.status===ue){if(a.adler=0,te(d,31),te(d,139),te(d,8),d.gzhead)te(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),te(d,d.gzhead.time&255),te(d,d.gzhead.time>>8&255),te(d,d.gzhead.time>>16&255),te(d,d.gzhead.time>>24&255),te(d,d.level===9?2:d.strategy>=E||d.level<2?4:0),te(d,d.gzhead.os&255),d.gzhead.extra&&d.gzhead.extra.length&&(te(d,d.gzhead.extra.length&255),te(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(a.adler=c(a.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=pe;else if(te(d,0),te(d,0),te(d,0),te(d,0),te(d,0),te(d,d.level===9?2:d.strategy>=E||d.level<2?4:0),te(d,xe),d.status=Ae,Ne(a),d.pending!==0)return d.last_flush=-1,p}if(d.status===pe){if(d.gzhead.extra){let b=d.pending,K=(d.gzhead.extra.length&65535)-d.gzindex;for(;d.pending+K>d.pending_buf_size;){let ne=d.pending_buf_size-d.pending;if(d.pending_buf.set(d.gzhead.extra.subarray(d.gzindex,d.gzindex+ne),d.pending),d.pending=d.pending_buf_size,d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b)),d.gzindex+=ne,Ne(a),d.pending!==0)return d.last_flush=-1,p;b=0,K-=ne}let de=new Uint8Array(d.gzhead.extra);d.pending_buf.set(de.subarray(d.gzindex,d.gzindex+K),d.pending),d.pending+=K,d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b)),d.gzindex=0}d.status=Ce}if(d.status===Ce){if(d.gzhead.name){let b=d.pending,K;do{if(d.pending===d.pending_buf_size){if(d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b)),Ne(a),d.pending!==0)return d.last_flush=-1,p;b=0}d.gzindex<d.gzhead.name.length?K=d.gzhead.name.charCodeAt(d.gzindex++)&255:K=0,te(d,K)}while(K!==0);d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b)),d.gzindex=0}d.status=He}if(d.status===He){if(d.gzhead.comment){let b=d.pending,K;do{if(d.pending===d.pending_buf_size){if(d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b)),Ne(a),d.pending!==0)return d.last_flush=-1,p;b=0}d.gzindex<d.gzhead.comment.length?K=d.gzhead.comment.charCodeAt(d.gzindex++)&255:K=0,te(d,K)}while(K!==0);d.gzhead.hcrc&&d.pending>b&&(a.adler=c(a.adler,d.pending_buf,d.pending-b,b))}d.status=ye}if(d.status===ye){if(d.gzhead.hcrc){if(d.pending+2>d.pending_buf_size&&(Ne(a),d.pending!==0))return d.last_flush=-1,p;te(d,a.adler&255),te(d,a.adler>>8&255),a.adler=0}if(d.status=Ae,Ne(a),d.pending!==0)return d.last_flush=-1,p}if(a.avail_in!==0||d.lookahead!==0||T!==h&&d.status!==ve){let b=d.level===0?B(d,T):d.strategy===E?fe(d,T):d.strategy===C?se(d,T):D[d.level].func(d,T);if((b===Xe||b===Be)&&(d.status=ve),b===Oe||b===Xe)return a.avail_out===0&&(d.last_flush=-1),p;if(b===Pe&&(T===u?r(d):T!==k&&(t(d,0,0,!1),T===m&&(je(d.head),d.lookahead===0&&(d.strstart=0,d.block_start=0,d.insert=0))),Ne(a),a.avail_out===0))return d.last_flush=-1,p}return T!==S?p:d.wrap<=0?O:(d.wrap===2?(te(d,a.adler&255),te(d,a.adler>>8&255),te(d,a.adler>>16&255),te(d,a.adler>>24&255),te(d,a.total_in&255),te(d,a.total_in>>8&255),te(d,a.total_in>>16&255),te(d,a.total_in>>24&255)):(qe(d,a.adler>>>16),qe(d,a.adler&65535)),Ne(a),d.wrap>0&&(d.wrap=-d.wrap),d.pending!==0?p:O)},ei=a=>{if(Ee(a))return A;const T=a.state.status;return a.state=null,T===Ae?Ue(a,L):p},Ze=(a,T)=>{let d=T.length;if(Ee(a))return A;const v=a.state,b=v.wrap;if(b===2||b===1&&v.status!==Te||v.lookahead)return A;if(b===1&&(a.adler=o(a.adler,T,d,0)),v.wrap=0,d>=v.w_size){b===0&&(je(v.head),v.strstart=0,v.block_start=0,v.insert=0);let lt=new Uint8Array(v.w_size);lt.set(T.subarray(d-v.w_size,d),0),T=lt,d=v.w_size}const K=a.avail_in,de=a.next_in,ne=a.input;for(a.avail_in=d,a.next_in=0,a.input=T,f(v);v.lookahead>=U;){let lt=v.strstart,Me=v.lookahead-(U-1);do v.ins_h=Ye(v,v.ins_h,v.window[lt+U-1]),v.prev[lt&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=lt,lt++;while(--Me);v.strstart=lt,v.lookahead=U-1,f(v)}return v.strstart+=v.lookahead,v.block_start=v.strstart,v.insert=v.lookahead,v.lookahead=0,v.match_length=v.prev_length=U-1,v.match_available=0,a.next_in=de,a.input=ne,a.avail_in=K,v.wrap=b,p};return Et.deflateInit=M,Et.deflateInit2=Ge,Et.deflateReset=Se,Et.deflateResetKeep=j,Et.deflateSetHeader=X,Et.deflate=z,Et.deflateEnd=ei,Et.deflateSetDictionary=Ze,Et.deflateInfo="pako deflate (from Nodeca project)",Et}var sn={},sa;function go(){if(sa)return sn;sa=1;const e=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);return sn.assign=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)e(n,r)&&(t[r]=n[r])}}return t},sn.flattenChunks=t=>{let i=0;for(let r=0,o=t.length;r<o;r++)i+=t[r].length;const n=new Uint8Array(i);for(let r=0,o=0,c=t.length;r<c;r++){let l=t[r];n.set(l,o),o+=l.length}return n},sn}var Oi={},la;function mo(){if(la)return Oi;la=1;let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}const t=new Uint8Array(256);for(let n=0;n<256;n++)t[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;t[254]=t[254]=1,Oi.string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let r,o,c,l,h,u=n.length,m=0;for(l=0;l<u;l++)o=n.charCodeAt(l),(o&64512)===55296&&l+1<u&&(c=n.charCodeAt(l+1),(c&64512)===56320&&(o=65536+(o-55296<<10)+(c-56320),l++)),m+=o<128?1:o<2048?2:o<65536?3:4;for(r=new Uint8Array(m),h=0,l=0;h<m;l++)o=n.charCodeAt(l),(o&64512)===55296&&l+1<u&&(c=n.charCodeAt(l+1),(c&64512)===56320&&(o=65536+(o-55296<<10)+(c-56320),l++)),o<128?r[h++]=o:o<2048?(r[h++]=192|o>>>6,r[h++]=128|o&63):o<65536?(r[h++]=224|o>>>12,r[h++]=128|o>>>6&63,r[h++]=128|o&63):(r[h++]=240|o>>>18,r[h++]=128|o>>>12&63,r[h++]=128|o>>>6&63,r[h++]=128|o&63);return r};const i=(n,r)=>{if(r<65534&&n.subarray&&e)return String.fromCharCode.apply(null,n.length===r?n:n.subarray(0,r));let o="";for(let c=0;c<r;c++)o+=String.fromCharCode(n[c]);return o};return Oi.buf2string=(n,r)=>{const o=r||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,r));let c,l;const h=new Array(o*2);for(l=0,c=0;c<o;){let u=n[c++];if(u<128){h[l++]=u;continue}let m=t[u];if(m>4){h[l++]=65533,c+=m-1;continue}for(u&=m===2?31:m===3?15:7;m>1&&c<o;)u=u<<6|n[c++]&63,m--;if(m>1){h[l++]=65533;continue}u<65536?h[l++]=u:(u-=65536,h[l++]=55296|u>>10&1023,h[l++]=56320|u&1023)}return i(h,l)},Oi.utf8border=(n,r)=>{r=r||n.length,r>n.length&&(r=n.length);let o=r-1;for(;o>=0&&(n[o]&192)===128;)o--;return o<0||o===0?r:o+t[n[o]]>r?o:r},Oi}var $n,ca;function wo(){if(ca)return $n;ca=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return $n=e,$n}var fa;function Al(){if(fa)return Ut;fa=1;const e=Rl(),t=go(),i=mo(),n=Er(),r=wo(),o=Object.prototype.toString,{Z_NO_FLUSH:c,Z_SYNC_FLUSH:l,Z_FULL_FLUSH:h,Z_FINISH:u,Z_OK:m,Z_STREAM_END:S,Z_DEFAULT_COMPRESSION:k,Z_DEFAULT_STRATEGY:p,Z_DEFLATED:O}=jt();function A(I){this.options=t.assign({level:k,method:O,chunkSize:16384,windowBits:15,memLevel:8,strategy:p},I||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let C=e.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(C!==m)throw new Error(n[C]);if(E.header&&e.deflateSetHeader(this.strm,E.header),E.dictionary){let H;if(typeof E.dictionary=="string"?H=i.string2buf(E.dictionary):o.call(E.dictionary)==="[object ArrayBuffer]"?H=new Uint8Array(E.dictionary):H=E.dictionary,C=e.deflateSetDictionary(this.strm,H),C!==m)throw new Error(n[C]);this._dict_set=!0}}A.prototype.push=function(I,E){const C=this.strm,H=this.options.chunkSize;let Z,ae;if(this.ended)return!1;for(E===~~E?ae=E:ae=E===!0?u:c,typeof I=="string"?C.input=i.string2buf(I):o.call(I)==="[object ArrayBuffer]"?C.input=new Uint8Array(I):C.input=I,C.next_in=0,C.avail_in=C.input.length;;){if(C.avail_out===0&&(C.output=new Uint8Array(H),C.next_out=0,C.avail_out=H),(ae===l||ae===h)&&C.avail_out<=6){this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;continue}if(Z=e.deflate(C,ae),Z===S)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),Z=e.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===m;if(C.avail_out===0){this.onData(C.output);continue}if(ae>0&&C.next_out>0){this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;continue}if(C.avail_in===0)break}return!0},A.prototype.onData=function(I){this.chunks.push(I)},A.prototype.onEnd=function(I){I===m&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.msg=this.strm.msg};function L(I,E){const C=new A(E);if(C.push(I,!0),C.err)throw C.msg||n[C.err];return C.result}function Y(I,E){return E=E||{},E.raw=!0,L(I,E)}function q(I,E){return E=E||{},E.gzip=!0,L(I,E)}return Ut.Deflate=A,Ut.deflate=L,Ut.deflateRaw=Y,Ut.gzip=q,Ut.constants=jt(),Ut}var Vt={},yt={},qn,ua;function Il(){if(ua)return qn;ua=1;const e=16209,t=16191;return qn=function(n,r){let o,c,l,h,u,m,S,k,p,O,A,L,Y,q,I,E,C,H,Z,ae,J,me,we,ce;const re=n.state;o=n.next_in,we=n.input,c=o+(n.avail_in-5),l=n.next_out,ce=n.output,h=l-(r-n.avail_out),u=l+(n.avail_out-257),m=re.dmax,S=re.wsize,k=re.whave,p=re.wnext,O=re.window,A=re.hold,L=re.bits,Y=re.lencode,q=re.distcode,I=(1<<re.lenbits)-1,E=(1<<re.distbits)-1;e:do{L<15&&(A+=we[o++]<<L,L+=8,A+=we[o++]<<L,L+=8),C=Y[A&I];t:for(;;){if(H=C>>>24,A>>>=H,L-=H,H=C>>>16&255,H===0)ce[l++]=C&65535;else if(H&16){Z=C&65535,H&=15,H&&(L<H&&(A+=we[o++]<<L,L+=8),Z+=A&(1<<H)-1,A>>>=H,L-=H),L<15&&(A+=we[o++]<<L,L+=8,A+=we[o++]<<L,L+=8),C=q[A&E];i:for(;;){if(H=C>>>24,A>>>=H,L-=H,H=C>>>16&255,H&16){if(ae=C&65535,H&=15,L<H&&(A+=we[o++]<<L,L+=8,L<H&&(A+=we[o++]<<L,L+=8)),ae+=A&(1<<H)-1,ae>m){n.msg="invalid distance too far back",re.mode=e;break e}if(A>>>=H,L-=H,H=l-h,ae>H){if(H=ae-H,H>k&&re.sane){n.msg="invalid distance too far back",re.mode=e;break e}if(J=0,me=O,p===0){if(J+=S-H,H<Z){Z-=H;do ce[l++]=O[J++];while(--H);J=l-ae,me=ce}}else if(p<H){if(J+=S+p-H,H-=p,H<Z){Z-=H;do ce[l++]=O[J++];while(--H);if(J=0,p<Z){H=p,Z-=H;do ce[l++]=O[J++];while(--H);J=l-ae,me=ce}}}else if(J+=p-H,H<Z){Z-=H;do ce[l++]=O[J++];while(--H);J=l-ae,me=ce}for(;Z>2;)ce[l++]=me[J++],ce[l++]=me[J++],ce[l++]=me[J++],Z-=3;Z&&(ce[l++]=me[J++],Z>1&&(ce[l++]=me[J++]))}else{J=l-ae;do ce[l++]=ce[J++],ce[l++]=ce[J++],ce[l++]=ce[J++],Z-=3;while(Z>2);Z&&(ce[l++]=ce[J++],Z>1&&(ce[l++]=ce[J++]))}}else if(H&64){n.msg="invalid distance code",re.mode=e;break e}else{C=q[(C&65535)+(A&(1<<H)-1)];continue i}break}}else if(H&64)if(H&32){re.mode=t;break e}else{n.msg="invalid literal/length code",re.mode=e;break e}else{C=Y[(C&65535)+(A&(1<<H)-1)];continue t}break}}while(o<c&&l<u);Z=L>>3,o-=Z,L-=Z<<3,A&=(1<<L)-1,n.next_in=o,n.next_out=l,n.avail_in=o<c?5+(c-o):5-(o-c),n.avail_out=l<u?257+(u-l):257-(l-u),re.hold=A,re.bits=L},qn}var Zn,da;function kl(){if(da)return Zn;da=1;const e=15,t=852,i=592,n=0,r=1,o=2,c=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);return Zn=(S,k,p,O,A,L,Y,q)=>{const I=q.bits;let E=0,C=0,H=0,Z=0,ae=0,J=0,me=0,we=0,ce=0,re=0,g,x,P,N,V,ee=null,U;const oe=new Uint16Array(e+1),le=new Uint16Array(e+1);let Re=null,Te,ue,pe;for(E=0;E<=e;E++)oe[E]=0;for(C=0;C<O;C++)oe[k[p+C]]++;for(ae=I,Z=e;Z>=1&&oe[Z]===0;Z--);if(ae>Z&&(ae=Z),Z===0)return A[L++]=1<<24|64<<16|0,A[L++]=1<<24|64<<16|0,q.bits=1,0;for(H=1;H<Z&&oe[H]===0;H++);for(ae<H&&(ae=H),we=1,E=1;E<=e;E++)if(we<<=1,we-=oe[E],we<0)return-1;if(we>0&&(S===n||Z!==1))return-1;for(le[1]=0,E=1;E<e;E++)le[E+1]=le[E]+oe[E];for(C=0;C<O;C++)k[p+C]!==0&&(Y[le[k[p+C]]++]=C);if(S===n?(ee=Re=Y,U=20):S===r?(ee=c,Re=l,U=257):(ee=h,Re=u,U=0),re=0,C=0,E=H,V=L,J=ae,me=0,P=-1,ce=1<<ae,N=ce-1,S===r&&ce>t||S===o&&ce>i)return 1;for(;;){Te=E-me,Y[C]+1<U?(ue=0,pe=Y[C]):Y[C]>=U?(ue=Re[Y[C]-U],pe=ee[Y[C]-U]):(ue=96,pe=0),g=1<<E-me,x=1<<J,H=x;do x-=g,A[V+(re>>me)+x]=Te<<24|ue<<16|pe|0;while(x!==0);for(g=1<<E-1;re&g;)g>>=1;if(g!==0?(re&=g-1,re+=g):re=0,C++,--oe[E]===0){if(E===Z)break;E=k[p+Y[C]]}if(E>ae&&(re&N)!==P){for(me===0&&(me=ae),V+=H,J=E-me,we=1<<J;J+me<Z&&(we-=oe[J+me],!(we<=0));)J++,we<<=1;if(ce+=1<<J,S===r&&ce>t||S===o&&ce>i)return 1;P=re&N,A[P]=ae<<24|J<<16|V-L|0}}return re!==0&&(A[V+re]=E-me<<24|64<<16|0),q.bits=ae,0},Zn}var ha;function Ll(){if(ha)return yt;ha=1;const e=_o(),t=po(),i=Il(),n=kl(),r=0,o=1,c=2,{Z_FINISH:l,Z_BLOCK:h,Z_TREES:u,Z_OK:m,Z_STREAM_END:S,Z_NEED_DICT:k,Z_STREAM_ERROR:p,Z_DATA_ERROR:O,Z_MEM_ERROR:A,Z_BUF_ERROR:L,Z_DEFLATED:Y}=jt(),q=16180,I=16181,E=16182,C=16183,H=16184,Z=16185,ae=16186,J=16187,me=16188,we=16189,ce=16190,re=16191,g=16192,x=16193,P=16194,N=16195,V=16196,ee=16197,U=16198,oe=16199,le=16200,Re=16201,Te=16202,ue=16203,pe=16204,Ce=16205,He=16206,ye=16207,Ae=16208,ve=16209,Oe=16210,Pe=16211,Xe=852,Be=592,Ue=15,Je=_=>(_>>>24&255)+(_>>>8&65280)+((_&65280)<<8)+((_&255)<<24);function je(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const We=_=>{if(!_)return 1;const D=_.state;return!D||D.strm!==_||D.mode<q||D.mode>Pe?1:0},st=_=>{if(We(_))return p;const D=_.state;return _.total_in=_.total_out=D.total=0,_.msg="",D.wrap&&(_.adler=D.wrap&1),D.mode=q,D.last=0,D.havedict=0,D.flags=-1,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new Int32Array(Xe),D.distcode=D.distdyn=new Int32Array(Be),D.sane=1,D.back=-1,m},Ye=_=>{if(We(_))return p;const D=_.state;return D.wsize=0,D.whave=0,D.wnext=0,st(_)},Ne=(_,D)=>{let s;if(We(_))return p;const W=_.state;return D<0?(s=0,D=-D):(s=(D>>4)+5,D<48&&(D&=15)),D&&(D<8||D>15)?p:(W.window!==null&&W.wbits!==D&&(W.window=null),W.wrap=s,W.wbits=D,Ye(_))},be=(_,D)=>{if(!_)return p;const s=new je;_.state=s,s.strm=_,s.window=null,s.mode=q;const W=Ne(_,D);return W!==m&&(_.state=null),W},te=_=>be(_,Ue);let qe=!0,dt,pt;const f=_=>{if(qe){dt=new Int32Array(512),pt=new Int32Array(32);let D=0;for(;D<144;)_.lens[D++]=8;for(;D<256;)_.lens[D++]=9;for(;D<280;)_.lens[D++]=7;for(;D<288;)_.lens[D++]=8;for(n(o,_.lens,0,288,dt,0,_.work,{bits:9}),D=0;D<32;)_.lens[D++]=5;n(c,_.lens,0,32,pt,0,_.work,{bits:5}),qe=!1}_.lencode=dt,_.lenbits=9,_.distcode=pt,_.distbits=5},B=(_,D,s,W)=>{let Ee;const j=_.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new Uint8Array(j.wsize)),W>=j.wsize?(j.window.set(D.subarray(s-j.wsize,s),0),j.wnext=0,j.whave=j.wsize):(Ee=j.wsize-j.wnext,Ee>W&&(Ee=W),j.window.set(D.subarray(s-W,s-W+Ee),j.wnext),W-=Ee,W?(j.window.set(D.subarray(s-W,s),0),j.wnext=W,j.whave=j.wsize):(j.wnext+=Ee,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=Ee))),0},$=(_,D)=>{let s,W,Ee,j,Se,X,Ge,M,z,ei,Ze,a,T,d,v=0,b,K,de,ne,lt,Me,Ke,ht;const Qe=new Uint8Array(4);let wt,gt;const Lr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(We(_)||!_.output||!_.input&&_.avail_in!==0)return p;s=_.state,s.mode===re&&(s.mode=g),Se=_.next_out,Ee=_.output,Ge=_.avail_out,j=_.next_in,W=_.input,X=_.avail_in,M=s.hold,z=s.bits,ei=X,Ze=Ge,ht=m;e:for(;;)switch(s.mode){case q:if(s.wrap===0){s.mode=g;break}for(;z<16;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(s.wrap&2&&M===35615){s.wbits===0&&(s.wbits=15),s.check=0,Qe[0]=M&255,Qe[1]=M>>>8&255,s.check=t(s.check,Qe,2,0),M=0,z=0,s.mode=I;break}if(s.head&&(s.head.done=!1),!(s.wrap&1)||(((M&255)<<8)+(M>>8))%31){_.msg="incorrect header check",s.mode=ve;break}if((M&15)!==Y){_.msg="unknown compression method",s.mode=ve;break}if(M>>>=4,z-=4,Ke=(M&15)+8,s.wbits===0&&(s.wbits=Ke),Ke>15||Ke>s.wbits){_.msg="invalid window size",s.mode=ve;break}s.dmax=1<<s.wbits,s.flags=0,_.adler=s.check=1,s.mode=M&512?we:re,M=0,z=0;break;case I:for(;z<16;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(s.flags=M,(s.flags&255)!==Y){_.msg="unknown compression method",s.mode=ve;break}if(s.flags&57344){_.msg="unknown header flags set",s.mode=ve;break}s.head&&(s.head.text=M>>8&1),s.flags&512&&s.wrap&4&&(Qe[0]=M&255,Qe[1]=M>>>8&255,s.check=t(s.check,Qe,2,0)),M=0,z=0,s.mode=E;case E:for(;z<32;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.head&&(s.head.time=M),s.flags&512&&s.wrap&4&&(Qe[0]=M&255,Qe[1]=M>>>8&255,Qe[2]=M>>>16&255,Qe[3]=M>>>24&255,s.check=t(s.check,Qe,4,0)),M=0,z=0,s.mode=C;case C:for(;z<16;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.head&&(s.head.xflags=M&255,s.head.os=M>>8),s.flags&512&&s.wrap&4&&(Qe[0]=M&255,Qe[1]=M>>>8&255,s.check=t(s.check,Qe,2,0)),M=0,z=0,s.mode=H;case H:if(s.flags&1024){for(;z<16;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.length=M,s.head&&(s.head.extra_len=M),s.flags&512&&s.wrap&4&&(Qe[0]=M&255,Qe[1]=M>>>8&255,s.check=t(s.check,Qe,2,0)),M=0,z=0}else s.head&&(s.head.extra=null);s.mode=Z;case Z:if(s.flags&1024&&(a=s.length,a>X&&(a=X),a&&(s.head&&(Ke=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(W.subarray(j,j+a),Ke)),s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,j)),X-=a,j+=a,s.length-=a),s.length))break e;s.length=0,s.mode=ae;case ae:if(s.flags&2048){if(X===0)break e;a=0;do Ke=W[j+a++],s.head&&Ke&&s.length<65536&&(s.head.name+=String.fromCharCode(Ke));while(Ke&&a<X);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,j)),X-=a,j+=a,Ke)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=J;case J:if(s.flags&4096){if(X===0)break e;a=0;do Ke=W[j+a++],s.head&&Ke&&s.length<65536&&(s.head.comment+=String.fromCharCode(Ke));while(Ke&&a<X);if(s.flags&512&&s.wrap&4&&(s.check=t(s.check,W,a,j)),X-=a,j+=a,Ke)break e}else s.head&&(s.head.comment=null);s.mode=me;case me:if(s.flags&512){for(;z<16;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(s.wrap&4&&M!==(s.check&65535)){_.msg="header crc mismatch",s.mode=ve;break}M=0,z=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),_.adler=s.check=0,s.mode=re;break;case we:for(;z<32;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}_.adler=s.check=Je(M),M=0,z=0,s.mode=ce;case ce:if(s.havedict===0)return _.next_out=Se,_.avail_out=Ge,_.next_in=j,_.avail_in=X,s.hold=M,s.bits=z,k;_.adler=s.check=1,s.mode=re;case re:if(D===h||D===u)break e;case g:if(s.last){M>>>=z&7,z-=z&7,s.mode=He;break}for(;z<3;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}switch(s.last=M&1,M>>>=1,z-=1,M&3){case 0:s.mode=x;break;case 1:if(f(s),s.mode=oe,D===u){M>>>=2,z-=2;break e}break;case 2:s.mode=V;break;case 3:_.msg="invalid block type",s.mode=ve}M>>>=2,z-=2;break;case x:for(M>>>=z&7,z-=z&7;z<32;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if((M&65535)!==(M>>>16^65535)){_.msg="invalid stored block lengths",s.mode=ve;break}if(s.length=M&65535,M=0,z=0,s.mode=P,D===u)break e;case P:s.mode=N;case N:if(a=s.length,a){if(a>X&&(a=X),a>Ge&&(a=Ge),a===0)break e;Ee.set(W.subarray(j,j+a),Se),X-=a,j+=a,Ge-=a,Se+=a,s.length-=a;break}s.mode=re;break;case V:for(;z<14;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(s.nlen=(M&31)+257,M>>>=5,z-=5,s.ndist=(M&31)+1,M>>>=5,z-=5,s.ncode=(M&15)+4,M>>>=4,z-=4,s.nlen>286||s.ndist>30){_.msg="too many length or distance symbols",s.mode=ve;break}s.have=0,s.mode=ee;case ee:for(;s.have<s.ncode;){for(;z<3;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.lens[Lr[s.have++]]=M&7,M>>>=3,z-=3}for(;s.have<19;)s.lens[Lr[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,wt={bits:s.lenbits},ht=n(r,s.lens,0,19,s.lencode,0,s.work,wt),s.lenbits=wt.bits,ht){_.msg="invalid code lengths set",s.mode=ve;break}s.have=0,s.mode=U;case U:for(;s.have<s.nlen+s.ndist;){for(;v=s.lencode[M&(1<<s.lenbits)-1],b=v>>>24,K=v>>>16&255,de=v&65535,!(b<=z);){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(de<16)M>>>=b,z-=b,s.lens[s.have++]=de;else{if(de===16){for(gt=b+2;z<gt;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(M>>>=b,z-=b,s.have===0){_.msg="invalid bit length repeat",s.mode=ve;break}Ke=s.lens[s.have-1],a=3+(M&3),M>>>=2,z-=2}else if(de===17){for(gt=b+3;z<gt;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}M>>>=b,z-=b,Ke=0,a=3+(M&7),M>>>=3,z-=3}else{for(gt=b+7;z<gt;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}M>>>=b,z-=b,Ke=0,a=11+(M&127),M>>>=7,z-=7}if(s.have+a>s.nlen+s.ndist){_.msg="invalid bit length repeat",s.mode=ve;break}for(;a--;)s.lens[s.have++]=Ke}}if(s.mode===ve)break;if(s.lens[256]===0){_.msg="invalid code -- missing end-of-block",s.mode=ve;break}if(s.lenbits=9,wt={bits:s.lenbits},ht=n(o,s.lens,0,s.nlen,s.lencode,0,s.work,wt),s.lenbits=wt.bits,ht){_.msg="invalid literal/lengths set",s.mode=ve;break}if(s.distbits=6,s.distcode=s.distdyn,wt={bits:s.distbits},ht=n(c,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,wt),s.distbits=wt.bits,ht){_.msg="invalid distances set",s.mode=ve;break}if(s.mode=oe,D===u)break e;case oe:s.mode=le;case le:if(X>=6&&Ge>=258){_.next_out=Se,_.avail_out=Ge,_.next_in=j,_.avail_in=X,s.hold=M,s.bits=z,i(_,Ze),Se=_.next_out,Ee=_.output,Ge=_.avail_out,j=_.next_in,W=_.input,X=_.avail_in,M=s.hold,z=s.bits,s.mode===re&&(s.back=-1);break}for(s.back=0;v=s.lencode[M&(1<<s.lenbits)-1],b=v>>>24,K=v>>>16&255,de=v&65535,!(b<=z);){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(K&&!(K&240)){for(ne=b,lt=K,Me=de;v=s.lencode[Me+((M&(1<<ne+lt)-1)>>ne)],b=v>>>24,K=v>>>16&255,de=v&65535,!(ne+b<=z);){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}M>>>=ne,z-=ne,s.back+=ne}if(M>>>=b,z-=b,s.back+=b,s.length=de,K===0){s.mode=Ce;break}if(K&32){s.back=-1,s.mode=re;break}if(K&64){_.msg="invalid literal/length code",s.mode=ve;break}s.extra=K&15,s.mode=Re;case Re:if(s.extra){for(gt=s.extra;z<gt;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.length+=M&(1<<s.extra)-1,M>>>=s.extra,z-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=Te;case Te:for(;v=s.distcode[M&(1<<s.distbits)-1],b=v>>>24,K=v>>>16&255,de=v&65535,!(b<=z);){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(!(K&240)){for(ne=b,lt=K,Me=de;v=s.distcode[Me+((M&(1<<ne+lt)-1)>>ne)],b=v>>>24,K=v>>>16&255,de=v&65535,!(ne+b<=z);){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}M>>>=ne,z-=ne,s.back+=ne}if(M>>>=b,z-=b,s.back+=b,K&64){_.msg="invalid distance code",s.mode=ve;break}s.offset=de,s.extra=K&15,s.mode=ue;case ue:if(s.extra){for(gt=s.extra;z<gt;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}s.offset+=M&(1<<s.extra)-1,M>>>=s.extra,z-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){_.msg="invalid distance too far back",s.mode=ve;break}s.mode=pe;case pe:if(Ge===0)break e;if(a=Ze-Ge,s.offset>a){if(a=s.offset-a,a>s.whave&&s.sane){_.msg="invalid distance too far back",s.mode=ve;break}a>s.wnext?(a-=s.wnext,T=s.wsize-a):T=s.wnext-a,a>s.length&&(a=s.length),d=s.window}else d=Ee,T=Se-s.offset,a=s.length;a>Ge&&(a=Ge),Ge-=a,s.length-=a;do Ee[Se++]=d[T++];while(--a);s.length===0&&(s.mode=le);break;case Ce:if(Ge===0)break e;Ee[Se++]=s.length,Ge--,s.mode=le;break;case He:if(s.wrap){for(;z<32;){if(X===0)break e;X--,M|=W[j++]<<z,z+=8}if(Ze-=Ge,_.total_out+=Ze,s.total+=Ze,s.wrap&4&&Ze&&(_.adler=s.check=s.flags?t(s.check,Ee,Ze,Se-Ze):e(s.check,Ee,Ze,Se-Ze)),Ze=Ge,s.wrap&4&&(s.flags?M:Je(M))!==s.check){_.msg="incorrect data check",s.mode=ve;break}M=0,z=0}s.mode=ye;case ye:if(s.wrap&&s.flags){for(;z<32;){if(X===0)break e;X--,M+=W[j++]<<z,z+=8}if(s.wrap&4&&M!==(s.total&4294967295)){_.msg="incorrect length check",s.mode=ve;break}M=0,z=0}s.mode=Ae;case Ae:ht=S;break e;case ve:ht=O;break e;case Oe:return A;case Pe:default:return p}return _.next_out=Se,_.avail_out=Ge,_.next_in=j,_.avail_in=X,s.hold=M,s.bits=z,(s.wsize||Ze!==_.avail_out&&s.mode<ve&&(s.mode<He||D!==l))&&B(_,_.output,_.next_out,Ze-_.avail_out),ei-=_.avail_in,Ze-=_.avail_out,_.total_in+=ei,_.total_out+=Ze,s.total+=Ze,s.wrap&4&&Ze&&(_.adler=s.check=s.flags?t(s.check,Ee,Ze,_.next_out-Ze):e(s.check,Ee,Ze,_.next_out-Ze)),_.data_type=s.bits+(s.last?64:0)+(s.mode===re?128:0)+(s.mode===oe||s.mode===P?256:0),(ei===0&&Ze===0||D===l)&&ht===m&&(ht=L),ht},Q=_=>{if(We(_))return p;let D=_.state;return D.window&&(D.window=null),_.state=null,m},se=(_,D)=>{if(We(_))return p;const s=_.state;return s.wrap&2?(s.head=D,D.done=!1,m):p},fe=(_,D)=>{const s=D.length;let W,Ee,j;return We(_)||(W=_.state,W.wrap!==0&&W.mode!==ce)?p:W.mode===ce&&(Ee=1,Ee=e(Ee,D,s,0),Ee!==W.check)?O:(j=B(_,D,s,s),j?(W.mode=Oe,A):(W.havedict=1,m))};return yt.inflateReset=Ye,yt.inflateReset2=Ne,yt.inflateResetKeep=st,yt.inflateInit=te,yt.inflateInit2=be,yt.inflate=$,yt.inflateEnd=Q,yt.inflateGetHeader=se,yt.inflateSetDictionary=fe,yt.inflateInfo="pako inflate (from Nodeca project)",yt}var jn,_a;function Pl(){if(_a)return jn;_a=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return jn=e,jn}var pa;function Dl(){if(pa)return Vt;pa=1;const e=Ll(),t=go(),i=mo(),n=Er(),r=wo(),o=Pl(),c=Object.prototype.toString,{Z_NO_FLUSH:l,Z_FINISH:h,Z_OK:u,Z_STREAM_END:m,Z_NEED_DICT:S,Z_STREAM_ERROR:k,Z_DATA_ERROR:p,Z_MEM_ERROR:O}=jt();function A(q){this.options=t.assign({chunkSize:1024*64,windowBits:15,to:""},q||{});const I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,I.windowBits===0&&(I.windowBits=-15)),I.windowBits>=0&&I.windowBits<16&&!(q&&q.windowBits)&&(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&(I.windowBits&15||(I.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let E=e.inflateInit2(this.strm,I.windowBits);if(E!==u)throw new Error(n[E]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),I.dictionary&&(typeof I.dictionary=="string"?I.dictionary=i.string2buf(I.dictionary):c.call(I.dictionary)==="[object ArrayBuffer]"&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(E=e.inflateSetDictionary(this.strm,I.dictionary),E!==u)))throw new Error(n[E])}A.prototype.push=function(q,I){const E=this.strm,C=this.options.chunkSize,H=this.options.dictionary;let Z,ae,J;if(this.ended)return!1;for(I===~~I?ae=I:ae=I===!0?h:l,c.call(q)==="[object ArrayBuffer]"?E.input=new Uint8Array(q):E.input=q,E.next_in=0,E.avail_in=E.input.length;;){for(E.avail_out===0&&(E.output=new Uint8Array(C),E.next_out=0,E.avail_out=C),Z=e.inflate(E,ae),Z===S&&H&&(Z=e.inflateSetDictionary(E,H),Z===u?Z=e.inflate(E,ae):Z===p&&(Z=S));E.avail_in>0&&Z===m&&E.state.wrap>0&&q[E.next_in]!==0;)e.inflateReset(E),Z=e.inflate(E,ae);switch(Z){case k:case p:case S:case O:return this.onEnd(Z),this.ended=!0,!1}if(J=E.avail_out,E.next_out&&(E.avail_out===0||Z===m))if(this.options.to==="string"){let me=i.utf8border(E.output,E.next_out),we=E.next_out-me,ce=i.buf2string(E.output,me);E.next_out=we,E.avail_out=C-we,we&&E.output.set(E.output.subarray(me,me+we),0),this.onData(ce)}else this.onData(E.output.length===E.next_out?E.output:E.output.subarray(0,E.next_out));if(!(Z===u&&J===0)){if(Z===m)return Z=e.inflateEnd(this.strm),this.onEnd(Z),this.ended=!0,!0;if(E.avail_in===0)break}}return!0},A.prototype.onData=function(q){this.chunks.push(q)},A.prototype.onEnd=function(q){q===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg};function L(q,I){const E=new A(I);if(E.push(q),E.err)throw E.msg||n[E.err];return E.result}function Y(q,I){return I=I||{},I.raw=!0,L(q,I)}return Vt.Inflate=A,Vt.inflate=L,Vt.inflateRaw=Y,Vt.ungzip=L,Vt.constants=jt(),Vt}var ga;function Cl(){if(ga)return bt;ga=1;const{Deflate:e,deflate:t,deflateRaw:i,gzip:n}=Al(),{Inflate:r,inflate:o,inflateRaw:c,ungzip:l}=Dl(),h=jt();return bt.Deflate=e,bt.deflate=t,bt.deflateRaw=i,bt.gzip=n,bt.Inflate=r,bt.inflate=o,bt.inflateRaw=c,bt.ungzip=l,bt.constants=h,bt}var ma;function Ml(){if(ma)return xi;ma=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.decodeTileLayer=void 0;const e=Sl(),t=Tl(),i=Cl(),n=uo(),r=ho(),o=br(),c={[o.Encoding.BASE64]:e.toByteArray},l={[r.Compression.NONE]:u=>u,[r.Compression.ZLIB]:i.inflate,[r.Compression.GZIP]:i.ungzip,[r.Compression.ZSTD]:t.decompress};function h(u){var p;if((0,n.isUnencodedTileLayer)(u))return u;const m=c[u.encoding],S=l[u.compression??r.Compression.NONE],k=O=>Array.from(new Uint32Array(O.buffer,O.byteOffset));return{...u,compression:r.Compression.NONE,encoding:o.Encoding.CSV,data:u.data!=null?k(S(m(u.data))):void 0,chunks:(p=u.chunks)==null?void 0:p.map(O=>({...O,data:k(S(m(O.data)))}))}}return xi.decodeTileLayer=h,xi}var Ri={},wa;function zl(){if(wa)return Ri;wa=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.DrawOrder=void 0;var e;return function(t){t.TOPDOWN="topdown",t.INDEX="index"}(e||(Ri.DrawOrder=e={})),Ri}var Ai={},ya;function Fl(){if(ya)return Ai;ya=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.MapOrientation=void 0;var e;return function(t){t.ORTHOGONAL="orthogonal",t.ISOMETRIC="isometric",t.STAGGERED="staggered",t.HEXAGONAL="hexagonal"}(e||(Ai.MapOrientation=e={})),Ai}var Ii={},va;function Bl(){if(va)return Ii;va=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.MapRenderOrder=void 0;var e;return function(t){t.RIGHT_DOWN="right-down",t.RIGHT_UP="right-up",t.LEFT_DOWN="left-down",t.LEFT_UP="left-up"}(e||(Ii.MapRenderOrder=e={})),Ii}var ki={},ba;function Nl(){if(ba)return ki;ba=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.StaggerAxis=void 0;var e;return function(t){t.X="x",t.Y="y"}(e||(ki.StaggerAxis=e={})),ki}var Li={},Ea;function Ul(){if(Ea)return Li;Ea=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.StaggerIndex=void 0;var e;return function(t){t.ODD="odd",t.EVEN="even"}(e||(Li.StaggerIndex=e={})),Li}var Pi={},xa;function Gl(){if(xa)return Pi;xa=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.PropertyType=void 0;var e;return function(t){t.STRING="string",t.INT="int",t.FLOAT="float",t.BOOL="bool",t.COLOR="color",t.FILE="file",t.OBJECT="object",t.CLASS="class"}(e||(Pi.PropertyType=e={})),Pi}var Di={},Sa;function Vl(){if(Sa)return Di;Sa=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.HorizontalAlign=void 0;var e;return function(t){t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify",t.LEFT="left"}(e||(Di.HorizontalAlign=e={})),Di}var Ci={},Ta;function Hl(){if(Ta)return Ci;Ta=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.VerticalAlign=void 0;var e;return function(t){t.CENTER="center",t.BOTTOM="bottom",t.TOP="top"}(e||(Ci.VerticalAlign=e={})),Ci}var Ht={},Oa;function Wl(){if(Oa)return Ht;Oa=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.isTilesetRef=Ht.isEmbeddedTileset=void 0;function e(i){return i.source==null}Ht.isEmbeddedTileset=e;function t(i){return i.source!=null}return Ht.isTilesetRef=t,Ht}var Mi={},Ra;function $l(){if(Ra)return Mi;Ra=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.FillMode=void 0;var e;return function(t){t.STRETCH="stretch",t.PRESERVE_ASPECT_FIT="preserve-aspect-fit"}(e||(Mi.FillMode=e={})),Mi}var zi={},Aa;function ql(){if(Aa)return zi;Aa=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.ObjectAlignment=void 0;var e;return function(t){t.UNSPECIFIED="unspecified",t.TOPLEFT="topleft",t.TOP="top",t.TOPRIGHT="topright",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.BOTTOMLEFT="bottomleft",t.BOTTOM="bottom",t.BOTTOMRIGHT="bottomright"}(e||(zi.ObjectAlignment=e={})),zi}var Fi={},Ia;function Zl(){if(Ia)return Fi;Ia=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.TileRenderSize=void 0;var e;return function(t){t.TILE="tile",t.GRID="grid"}(e||(Fi.TileRenderSize=e={})),Fi}var Bi={},ka;function jl(){if(ka)return Bi;ka=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.WangSetType=void 0;var e;return function(t){t.CORNER="corner",t.EDGE="edge",t.MIXED="mixed"}(e||(Bi.WangSetType=e={})),Bi}var La;function Yl(){return La||(La=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WangSetType=e.TileRenderSize=e.ObjectAlignment=e.FillMode=e.isTilesetRef=e.isEmbeddedTileset=e.VerticalAlign=e.HorizontalAlign=e.PropertyType=e.StaggerIndex=e.StaggerAxis=e.RenderOrder=e.MapOrientation=e.Encoding=e.DrawOrder=e.decodeTileLayer=e.Compression=e.isUnencodedTileLayer=e.isTileLayer=e.isObjectGroup=e.isImageLayer=e.isGroup=e.isEncodedTileLayer=e.GridOrientation=void 0;var t=xl();Object.defineProperty(e,"GridOrientation",{enumerable:!0,get:function(){return t.GridOrientation}});var i=uo();Object.defineProperty(e,"isEncodedTileLayer",{enumerable:!0,get:function(){return i.isEncodedTileLayer}}),Object.defineProperty(e,"isGroup",{enumerable:!0,get:function(){return i.isGroup}}),Object.defineProperty(e,"isImageLayer",{enumerable:!0,get:function(){return i.isImageLayer}}),Object.defineProperty(e,"isObjectGroup",{enumerable:!0,get:function(){return i.isObjectGroup}}),Object.defineProperty(e,"isTileLayer",{enumerable:!0,get:function(){return i.isTileLayer}}),Object.defineProperty(e,"isUnencodedTileLayer",{enumerable:!0,get:function(){return i.isUnencodedTileLayer}});var n=ho();Object.defineProperty(e,"Compression",{enumerable:!0,get:function(){return n.Compression}});var r=Ml();Object.defineProperty(e,"decodeTileLayer",{enumerable:!0,get:function(){return r.decodeTileLayer}});var o=zl();Object.defineProperty(e,"DrawOrder",{enumerable:!0,get:function(){return o.DrawOrder}});var c=br();Object.defineProperty(e,"Encoding",{enumerable:!0,get:function(){return c.Encoding}});var l=Fl();Object.defineProperty(e,"MapOrientation",{enumerable:!0,get:function(){return l.MapOrientation}});var h=Bl();Object.defineProperty(e,"RenderOrder",{enumerable:!0,get:function(){return h.MapRenderOrder}});var u=Nl();Object.defineProperty(e,"StaggerAxis",{enumerable:!0,get:function(){return u.StaggerAxis}});var m=Ul();Object.defineProperty(e,"StaggerIndex",{enumerable:!0,get:function(){return m.StaggerIndex}});var S=Gl();Object.defineProperty(e,"PropertyType",{enumerable:!0,get:function(){return S.PropertyType}});var k=Vl();Object.defineProperty(e,"HorizontalAlign",{enumerable:!0,get:function(){return k.HorizontalAlign}});var p=Hl();Object.defineProperty(e,"VerticalAlign",{enumerable:!0,get:function(){return p.VerticalAlign}});var O=Wl();Object.defineProperty(e,"isEmbeddedTileset",{enumerable:!0,get:function(){return O.isEmbeddedTileset}}),Object.defineProperty(e,"isTilesetRef",{enumerable:!0,get:function(){return O.isTilesetRef}});var A=$l();Object.defineProperty(e,"FillMode",{enumerable:!0,get:function(){return A.FillMode}});var L=ql();Object.defineProperty(e,"ObjectAlignment",{enumerable:!0,get:function(){return L.ObjectAlignment}});var Y=Zl();Object.defineProperty(e,"TileRenderSize",{enumerable:!0,get:function(){return Y.TileRenderSize}});var q=jl();Object.defineProperty(e,"WangSetType",{enumerable:!0,get:function(){return q.WangSetType}})}(Un)),Un}var ln=Yl();const xr=new Xi.MiniSignal,Sr=new Xi.MiniSignal;class Xl{constructor(t){Le(this,"h");Le(this,"g");Le(this,"n");Le(this,"d",()=>{});Le(this,"maxIterations",5e4);Le(this,"todo",[]);Le(this,"done",{});this.h=t.hurestic,this.g=t.cost,this.n=t.neighbors,this.d=t.debug||this.d,this.maxIterations=t.maxIterations||this.maxIterations}getId(t){return JSON.stringify(t)}async compute(t){var c;this.todo=[],this.done={},this.add(t,null);let i=null,n=0;for(;this.todo.length;){if(n++>this.maxIterations)return console.log("Max iterations reached"),[];const l=this.todo.shift(),h=this.getId(l.s);if(h in this.done)continue;if(this.done[h]=l,l.h==0){i=l;break}const u=this.n(l.s);for(let m=0;m<u.length;m++){const S=u[m];if(this.getId(S)in this.done)continue;const p=this.add(S,l);await((c=this.d)==null?void 0:c.call(this,p))}}const r=[];let o=i;if(!o)return r;for(;o;)r.push(o.s),o=o.prev;return r}add(t,i){const n=this.h(t),r=this.g(t),o={prev:i,g:i?i.g+r:0,h:n,s:t},c=o.g+o.h;for(let l=0;l<this.todo.length;l++){const h=this.todo[l],u=h.g+h.h;if(c<u||c==u&&n<h.h)return this.todo.splice(l,0,o),o}return this.todo.push(o),o}}const Kl=[...xn,y.Key,y.Nugget,y.Amulet,y.Tablet,y.SlowTime,y.Zap,...Tn,y.Freeze,y.ShootRight,y.ShootLeft,...so,y.Tome,y.Bomb,y.Power,y.Amulet,y.BlockSpell,y.ShowGems],yo=[...Qi,y.Trap,y.Lava,y.Invisible,y.SpeedTime],ci=new Map;let Lt=null;Sr.add(()=>{ci.clear()});let An=[];const Pa=[[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1]];function Jl(e,t){const i=[];for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){const[c,l]=[e+r,t+o],h=w.map.get(c,l);h&&i.push([h,c,l])}return i}function Tr(e){return e?(e==null?void 0:e.type)===y.Pit||(e==null?void 0:e.type)===y.Tunnel||(e==null?void 0:e.type)===y.Stairs?!1:e==null?void 0:e.has(En):!0}function Ql(e,t,i,n){return Math.max(Math.abs(e-i),Math.abs(t-n))}function fi(e){const t=w.map,i=[];for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++){const o=w.map.get(n,r);o&&e(o,n,r)&&i.push([o,n,r])}return i}async function ec(e){const t=w.player.get(ze);return(await new Xl({hurestic:r,cost:o,neighbors:h,debug:void 0}).compute({x:t.x,y:t.y,keys:F.keys,gems:F.gems,whips:F.whips})).map(u=>[u.x,u.y]);function r(u){const{x:m,y:S}=u;return e.reduce((k,p)=>{const O=Ql(m,S,p[0],p[1]);return Math.min(k,O)},1/0)}function o(u){const{x:m,y:S}=u,k=w.map.get(m,S);return k?k.has(bn)?40:k.has(li)?20:k.has(kt)?30:k.type===y.Door?40:yo.includes(k.type)?50:ci.get(`${m}.${S}`)?1:2:1}function c(u,m,S){if(u<0||m<0||u>=w.map.width||m>=w.map.height)return!1;if(e.some(L=>L[0]===u&&L[1]===m)||u===t.x&&m===t.y)return!0;const{keys:k,gems:p,whips:O}=S,A=w.map.get(u,m);return A?A.has(kt)?p>0||O>0:A.has(li)?O>0:A.type===y.Door?k>0:A.has(vt)||!A.has(at)?!0:Tr(A):!0}function l(u,m,S){const k={...S,x:u,y:m},p=w.map.get(u,m);return p&&(p.type===y.Door&&k.keys--,p.type===y.Key&&k.keys++),k}function h(u){const m=[];for(let S=0;S<Pa.length;S++){const k=Pa[S],p=u.x+k[0],O=u.y+k[1];c(p,O,u)&&m.push(l(p,O,u))}return m}}async function Kt(e){const t=await ec(e);return!t||t.length<1?null:(t.pop(),t.pop())}async function tc(){const e=fi(o=>o.type===y.Stairs);if(e.length<1)return!1;const t=e.map(o=>[o[1],o[2]]),i=await Kt(t);if(!i)return!1;const[n,r]=i;return console.log(Lt="stairs"),await Jt(+n,+r)}async function ic(){const e=fi(o=>o.type===y.Trap);if(e.length<1)return!1;const t=e.map(o=>[o[1],o[2]]),i=await Kt(t);if(!i)return!1;const[n,r]=i;return console.log(Lt="traps"),await Jt(+n,+r)}async function nc(){const e=fi(o=>Kl.includes(o.type)||o.has(si));if(e.length<1)return!1;const t=e.map(o=>[o[1],o[2]]),i=await Kt(t);if(!i)return!1;const[n,r]=i;return console.log(Lt="collect"),await Jt(+n,+r)}async function rc(){const e=fi(c=>c.type===y.Tunnel);if(fi((c,l,h)=>c.type===y.Tunnel&&!ci.get(`${l}.${h}`)).length<1)return!1;const i=e.map(c=>[c[1],c[2]]),n=await Kt(i);if(!n)return!1;const[r,o]=n;return console.log(Lt="tunnel"),await Jt(+r,+o)}async function ac(){const e=fi((o,c,l)=>!ci.get(`${c}.${l}`)&&Tr(o));if(e.length<1)return!1;const t=e.map(o=>[o[1],o[2]]),i=await Kt(t);if(!i)return!1;const[n,r]=i;return console.log(Lt="explore"),await Jt(+n,+r)}async function oc(){const e=An.filter(o=>{var c;return(c=o[0])==null?void 0:c.has(bn)});if(e.length<1)return!1;const t=e.map(o=>[o[1],o[2]]),i=await Kt(t);if(!i)return!1;const[n,r]=i;return console.log(Lt="push"),await Jt(+n,+r)}async function sc(){return F.teleports<1||Math.random()>.01*F.teleports?!1:(console.log(Lt="teleport"),F.teleports--,await Or(w.player),!0)}async function lc(){if(!w.player.get(ze))return;const t=An.filter(c=>Tr(c[0]));if(t.length<1)return!1;const i=t.map(c=>[c[1],c[2]]),n=await Kt(i);if(!n)return!1;const[r,o]=n;return console.log(Lt="search"),await Jt(+r,+o)}async function cc(){if(F.whips<1||F.gems>2*F.whips)return!1;if(!w.player.get(ze))return;const t=An.filter(i=>{var n,r,o;return Qi.includes((n=i[0])==null?void 0:n.type)||((r=i[0])==null?void 0:r.type)===y.Generator||((o=i[0])==null?void 0:o.type)===y.Statue});return t.length<1||t.length>5*F.whips?!1:(console.log(Lt="defend"),F.whips--,await kn(w.player),!0)}async function fc(){const e=w.player.get(ze);e&&(An=Jl(e.x,e.y),!await cc()&&(await nc()||await tc()||await oc()||await rc()||await ic()||await ac()||await sc()||await lc()))}async function Jt(e,t){const i=w.player.get(ze);if(!i)return!1;const n=`${e}.${t}`,r=ci.get(n);ci.set(n,r?r+1:1);const o=w.map.get(e,t);if(o){if(o!=null&&o.has(kt)&&o.type!==y.MBlock)F.gems>2*F.whips&&await uc();else if(o!=null&&o.has(li)&&!(o!=null&&o.has(En)&&!yo.includes(o.type))&&F.whips>0&&!(o.type===y.Trap&&Lt==="traps"))return F.whips--,await kn(w.player),!0}return await vo(+e-i.x,+t-i.y),!0}async function uc(){return F.whips--,await kn(w.player),!0}async function dc(){await hc(),hs()}async function hc(){if(Ot(et.Pause))return Wf();if(Ot(et.Quit))return Hf();if(Ot(et.Save))return Gf();if(Ot(et.Restore))return Vf();if(Ot(et.NextLevel))return await lr();if(Ot(et.PrevLevel))return await Df();if(ge.difficulty===Mt.Cheat&&Ot(et.NextLevelCheat)){const i=w.player.get(ze);De(i.x+1,i.y,y.Stairs),await Ms();return}if(ge.difficulty===Mt.Cheat&&Ot(et.FreeItems)){F.gems=150,F.whips=99,F.teleports=99,F.keys=9,Xt();return}if(Ot(et.ResetFound)){ge.foundSet=new Set,await ot("Newly found object descriptions are reset.");return}if(Ot(et.HideFound)){ge.foundSet=!0,await ot("References to new objects will not be displayed.");return}Tt(et.Whip)&&(F.whips<1?Gr():(F.whips--,await kn(w.player))),Tt(et.Teleport)&&(F.teleports<1?await Gr():(F.teleports--,await Or(w.player)));let e=0,t=0;if(Tt(et.North)&&t--,Tt(et.South)&&t++,Tt(et.West)&&e--,Tt(et.East)&&e++,Tt(et.Southeast)&&(e++,t++),Tt(et.Southwest)&&(e--,t++),Tt(et.Northeast)&&(e++,t--),Tt(et.Northwest)&&(e--,t--),e=Ur(e,-1,1),t=Ur(t,-1,1),(e!==0||t!==0)&&await vo(e,t),ge.bot&&!ge.paused&&!ge.done){await fc();return}}async function vo(e,t){var c;const i=w.player.get(ze),n=i.x+e,r=i.y+t;if(n<0||n>$e||r<0||r>Ve)return await Xa(),St(y.Border),ge.foundSet===!0||ge.foundSet.has(-1)?void 0:(ge.foundSet.add(-1),await ot("An Electrified Wall blocks your way."));const o=w.map.get(n,r);if(o){if(o.has(En)&&hn(n,r),o.has(mr)&&await _c(o),o.has(Zi)){const l=o.get(Zi).damage;F.gems-=l,hi(n,r),St(o.type),hn(n,r),F.gems<0&&await sr()}if(o.has(si)){gr();const l=o.get(si);switch(F.whips+=l.whips,F.gems+=l.gems,F.teleports+=l.teleports,F.keys+=l.keys,F.whipPower+=l.whipPower,St(o.type),o.type){case y.Chest:await ot(`You found ${l.gems} gems and ${l.whips} whips inside the chest!`);break;case y.Chance:await ot(`You found a Pouch containing ${l.gems} Gems!`);break}}if(o.has(bn)){await Rf(w.player,o,n,r,e,t);return}if(o.has(rr)){ge.bot&&o.has(vt)&&(o.remove(vt),ke(n,r)),St(o.type);const l=(c=o.get(rr))==null?void 0:c.message;l&&await Ar(l,{who:w.player,what:o,x:n,y:r}),!ge.done&&F.gems<0&&sr()}switch(o.type){case y.Door:F.keys<1?(zs(),await Fe(100),await ot("To pass the Door you need a Key.")):(F.keys--,St(o.type),await ks(),hn(n,r),_t());break;default:(isNaN(o.type)||typeof o.type=="string")&&Ya();break}}}async function _c(e){var n;const t=e.type;if(ge.foundSet===!0||ge.foundSet.has(t))return"";const i=(n=e.get(mr))==null?void 0:n.message;return i?(ge.foundSet.add(t),await Ar(i)):""}async function sr(){await Rr(w.player);const e=w.player.get(ze);On(e.x,e.y,"*",G.White),Ie(ai/2-7,0," YOU HAVE DIED!! ",G.Black|16,G.Red),await ot("Press any key to continue."),ge.done=!0}function hn(e,t){ja();const i=w.player,n=i.get(ze);De(n.x,n.y,n.replacement),ke(n.x,n.y);const r=w.map.getType(e,t);n.replacement=[y.CWall1,y.CWall2,y.CWall3,y.Rope].includes(r)?r:y.Floor,w.map.set(e,t,i),n.x=e,n.y=t,ke(n.x,n.y)}async function pc(e){if(!(w.T[ft.FreezeTime]>0))for(const t of w.entities){const i=t.get(no);if(!i)continue;let n=w.T[ft.SpeedTime]>0?i.hastedPace:i.basePace;w.T[ft.SlowTime]>0&&(n=2*n);const r=n*Ni;e%r===r-1&&await gc(t)}}async function gc(e){const t=e.get(ze);if(!t.isDead()){if(w.map.getType(t.x,t.y)!==e.type){mn(e);return}if(e.has(Ja)){let i=0,n=0;const r=w.player.get(ze);r.x<t.x&&(i=-1),r.x>t.x&&(i=1),r.y<t.y&&(n=-1),r.y>t.y&&(n=1),await mc(e,i,n)}}}async function mc(e,t,i){var l,h,u;const n=e.get(ze),r=n.x+t,o=n.y+i;if(r<0||r>$e||o<0||o>Ve)return;const c=w.map.get(r,o);if(c){if((l=e.get(to))!=null&&l.has(c.type)){gr(),_n(e,r,o);return}if((h=c.get(tr))!=null&&h.by(e.type)){_n(e,r,o);return}if((u=e.get(io))!=null&&u.has(c.type)){De(n.x,n.y,y.Floor),De(r,o,y.Floor),mn(e),St(c.type),_e(800,18),_e(400,20);return}if(e.has(Zi)&&c.type===y.Player){const m=e.get(Zi).damage;F.gems-=m,De(n.x,n.y,y.Floor),mn(e),St(c.type),F.gems<0&&await sr();return}_n(e,n.x,n.y)}}function _n(e,t,i){if(e.has(ir)&&e.has(at)){const r=e.get(at),o=e.get(ir);r.ch=o.getFrame()}const n=e.get(ze);e.type===y.MBlock&&(t!==n.x||i!==n.y)&&e.remove(vt),De(n.x,n.y,y.Floor),w.map.set(t,i,e),n.moveTo(t,i)}const wc="modulepreload",yc=function(e,t){return new URL(e,t).href},Da={},R=function(t,i,n){let r=Promise.resolve();if(i&&i.length>0){const c=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.allSettled(i.map(u=>{if(u=yc(u,n),u in Da)return;Da[u]=!0;const m=u.endsWith(".css"),S=m?'[rel="stylesheet"]':"";if(!!n)for(let O=c.length-1;O>=0;O--){const A=c[O];if(A.href===u&&(!m||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${S}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":wc,m||(p.as="script"),p.crossOrigin="",p.href=u,h&&p.setAttribute("nonce",h),document.head.appendChild(p),m)return new Promise((O,A)=>{p.addEventListener("load",O),p.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return r.then(c=>{for(const l of c||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})},vc="DEBUG",bc=[async()=>(await R(async()=>{const{default:e}=await import("./debug.map-DK9F52t9.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./effects.map-C_OVT49H.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./speed.map-CFFLLcYB.js");return{default:e}},[],import.meta.url)).default];async function Ec(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function xc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Sc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:bc,readColor:xc,readTileset:Ec,title:vc},Symbol.toStringTag,{value:"Module"})),Tc="The Forgotton Adventures of Kroz",Oc=[null,async()=>(await R(async()=>{const{default:e}=await import("./lost-1.map-CtA3lajL.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-2.map-h92PbXov.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-4.map-Bqgl-wJU.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./caverns-2.map-le5zxprZ.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./caverns-4.map-D7MP8R1b.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-1.map-BOdFXchZ.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-2.map-ipr7oULK.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-4.map-srWjVGjM.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-6.map-D_cXJk4t.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-11.map-DVDKxKKN.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-12.map-Cl3DvUtO.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-18.map-1ODCneRr.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-20.map-D7Hprev7.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-26.map-uBE4Y2Pj.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-30.map-Bm_8Un-h.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-34.map-Col9yS94.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-42.map-89gM7GPI.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-46.map-CdrsBwn1.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-48.map-CFB6MPvR.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-52.map-DZzCGaGA.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-59.map-DRn9RJcj.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-61.map-B2FKIWd4.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-64.map-Colf8OB4.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-70.map-DRTxmUgY.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-75.map-DitL5S_V.js");return{default:e}},[],import.meta.url)).default];async function Rc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function Ac(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Ic=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Oc,readColor:Ac,readTileset:Rc,title:Tc},Symbol.toStringTag,{value:"Module"})),kc="Kingdom of Kroz II",bo=[null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-1.map-BOdFXchZ.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-2.map-ipr7oULK.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-4.map-srWjVGjM.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-6.map-D_cXJk4t.js");return{default:e}},[],import.meta.url)).default,null,null,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-10.map-CT7fFytJ.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-12.map-Cl3DvUtO.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-46.map-CdrsBwn1.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-16.map-BsaRuWSt.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-18.map-1ODCneRr.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-22.map--lJvJBgq.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-30.map-Bm_8Un-h.js");return{default:e}},[],import.meta.url)).default,null,null,async()=>(await R(async()=>{const{default:e}=await import("./kingdom-25.map-CNICbb9N.js");return{default:e}},[],import.meta.url)).default];async function Lc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function Pc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Dc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:bo,readColor:Pc,readTileset:Lc,title:kc},Symbol.toStringTag,{value:"Module"})),Cc="Lost Adventures of Kroz",Eo=[null,async()=>(await R(async()=>{const{default:e}=await import("./lost-1.map-C4CGCnx7.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-2.map-h92PbXov.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-3-DCmdBwEu.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-4.map-Bqgl-wJU.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-5-gVBzu3xE.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-7-BEJsfvPv.js");return{default:e}},[],import.meta.url)).default,null,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-10-DrbiRVDP.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-11.map-DVDKxKKN.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-12-CLTCiVVj.js");return{default:e}},[],import.meta.url)).default,null,null,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-16-CtWPlVsR.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-17-S4Hy0G_5.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-18.map-1ODCneRr.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-19-CfIZOqbq.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-20.map-D7Hprev7.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-21-BFS5N00D.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-22.map--lJvJBgq.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-23-gJ0A7wOh.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-25-CQ7y-ZjD.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-26.map-uBE4Y2Pj.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-27-BVdwuwK_.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-29-C1qJG2cR.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-30.map-Bm_8Un-h.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-31-Byjs77zl.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-33.map-B67w9-RH.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-34.map-Col9yS94.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-35.map-sE7uuxhi.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-36-DqOgGY6C.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-38-i44rY_DK.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-39-BVb1rwhE.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-40.map-DHB2ja2T.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-41-BygikuGK.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-42.map-89gM7GPI.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-43-BplAsPXr.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-45-DK9qAG1e.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-46.map-CdrsBwn1.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-47-DWUblgB_.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-48.map-CFB6MPvR.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-49-DTNz_oP1.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-50-C6Kv-sVF.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-51-CzQ-Ok4G.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-52.map-DZzCGaGA.js");return{default:e}},[],import.meta.url)).default,null,null,null,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-57-CeSMG7q_.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-58-DF_Hx_II.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-59.map-DRn9RJcj.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-60-CNTdBOqz.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-61.map-B2FKIWd4.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-62-DTNz_oP1.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-63-DFrRVWzU.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-64.map-Colf8OB4.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-65-BdEk9HOg.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-67-URmKnQme.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-69-Dz6uuDoA.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-70.map-DRTxmUgY.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-71-BN8V7DXa.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./lost-73-53Ns5Y84.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-74.map-BDvtsxjs.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./lost-75.map-DitL5S_V.js");return{default:e}},[],import.meta.url)).default];async function Mc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function zc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Fc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Eo,readColor:zc,readTileset:Mc,title:Cc},Symbol.toStringTag,{value:"Module"})),Bc="The Caverns of Kroz",xo=[null,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-2.map-le5zxprZ.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-4.map-D7MP8R1b.js");return{default:e}},[],import.meta.url)).default,null,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-7.map-BOh1Ho2Q.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-9.map-DjpKaF4H.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-11.map-D3By0oB7.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./caverns-12.map-RaeLPhdY.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-14.map-CZ5Kv9vO.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-16.map-CjO4x_t5.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-18.map-BaNTIOgF.js");return{default:e}},[],import.meta.url)).default,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,async()=>(await R(async()=>{const{default:e}=await import("./caverns-40.map-Cm6AZRko.js");return{default:e}},[],import.meta.url)).default];async function Nc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function Uc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Gc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:xo,readColor:Uc,readTileset:Nc,title:Bc},Symbol.toStringTag,{value:"Module"})),Vc="The Underground Empire of Cruz",So=[null,async()=>(await R(async()=>{const{default:e}=await import("./cruz-1.map-DG9JAo5J.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-2.map-CGhciUzY.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-3.map-DWgQw5DG.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-4.map-C4BZwTXl.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-5.map-C2SPX2w-.js");return{default:e}},[],import.meta.url)).default,null,async()=>(await R(async()=>{const{default:e}=await import("./cruz-7.map-uA10CqeQ.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-8.map-Dt9OxfQV.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./cruz-9.map-BRPIdZ7V.js");return{default:e}},[],import.meta.url)).default];async function Hc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function Wc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const $c=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:So,readColor:Wc,readTileset:Hc,title:Vc},Symbol.toStringTag,{value:"Module"})),qc="The Forgotton Adventures of Kroz",Zc=[null,async()=>(await R(async()=>{const{default:e}=await import("./start.map-BoTi2hFr.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./classics.map-BFQefCXA.js");return{default:e}},[],import.meta.url)).default,async()=>(await R(async()=>{const{default:e}=await import("./instructions.map-CqtI9Cqo.js");return{default:e}},[],import.meta.url)).default];async function jc(){return(await R(async()=>{const{default:e}=await import("./kroz.tileset-BSGIhvha.js");return{default:e}},[],import.meta.url)).default}async function Yc(){return(await R(async()=>{const{default:e}=await import("./kroz.colors-D6DTR4eg.js");return{default:e}},[],import.meta.url)).default}const Xc=Object.freeze(Object.defineProperty({__proto__:null,LEVELS:Zc,readColor:Yc,readTileset:jc,title:qc},Symbol.toStringTag,{value:"Module"})),Kc=bo.filter(Boolean).length,Jc=xo.filter(Boolean).length,Qc=Eo.filter(Boolean).length,ef=So.filter(Boolean).length;console.log(`Kingdom: ${Kc}, Caverns: ${Jc}, Lost: ${Qc}, Cruz: ${ef}`);const To={loading:Xc,debug:Sc,forgotton:Ic,kingdom:Dc,lost:Fc,caverns:Gc,cruz:$c};var ft=(e=>(e[e.SlowTime=4]="SlowTime",e[e.Invisible=5]="Invisible",e[e.SpeedTime=6]="SpeedTime",e[e.FreezeTime=7]="FreezeTime",e[e.StatueGemDrain=9]="StatueGemDrain",e))(ft||{});const In={4:70*Ni,5:75*Ni,6:80*Ni,7:55*Ni};async function tf(e){await w.map.forEach((t,i,n)=>{(n==null?void 0:n.type)===e&&(n.add(vt),ke(t,i))})}async function Oo(e,t){await w.map.forEach((i,n,r)=>{if((r==null?void 0:r.type)===e)if(r.has(at)){const o=r.get(at);Object.assign(o,t)}else r.add(new at(t))})}async function nf(e,t,i){for(e+=i;e>=0&&e<=$e;){const n=w.map.get(e,t);if(typeof n.type!="number"||n!=null&&n.has(eo))break;_e(e+30,10,100);for(let r=1;r<6;r++)On(e,t,"─",ie.getUniformInt(0,16)),await Fe(1);n.type===y.Floor||!n.has(at)||n.has(vt)||(await Hs(),(n.type===y.Slow||n.type===y.Medium||n.type===y.Fast)&&await hi(e,t),De(e,t,y.Floor)),ke(e,t),e+=i}_t()}async function rf(e,t){$s();let i=0;for(;i<=4;++i){_e(100-i*10/4,4*10,100);const l=Math.max(e-i,0),h=Math.min(e+i,$e),u=Math.max(t-i,0),m=Math.min(t+i,Ve);for(let S=l;S<=h;S++)for(let k=u;k<=m;k++){On(S,k,"█",Yi(G.LightRed,.5));const p=w.map.get(S,k);p!=null&&p.has(er)&&p.has(kt)&&(St(p.type),hi(S,k))}await qs()}await Fe(100),i=4;const n=Math.max(e-i,$t),r=Math.min(e+i,ai),o=Math.max(t-i,qt),c=Math.min(t+i,gn);for(let l=n;l<=r;l++)for(let h=o;h<=c;h++){const u=w.map.get(l,h);u!=null&&u.has(er)&&De(l,h,y.Floor)}_t()}async function af(){await Zs(),await Fe(50);for(let e=0;e<50;e++){do{const t=ie.getUniformInt(0,$e),i=ie.getUniformInt(0,Ve),n=w.map.getType(t,i);if(sl.includes(n)){De(t,i,y.Rock),ke(t,i);break}}while(Math.random()>.01);await Ys()}await js()}async function of(){let e=0,t=0;for(;e<500&&t<40;){e++;const i=ie.getUniformInt(0,w.entities.length),n=w.entities[i];if(!n)continue;const r=n.get(ze);r.x===-1||r.y===-1||n.type!==y.Slow&&n.type!==y.Medium&&n.type!==y.Fast||(await hi(r.x,r.y),await Fe(20),t++)}F.score+=Math.floor(t/3+2),_t(),Xt()}async function sf(){w.entities.reduce((t,i)=>i.type===y.Slow?t+1:t,0)<945&&await ko(45)}async function lf(){for(let e=0;e<ge.difficulty*2+5;e++){let t=!1;do{const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve);w.map.getType(i,n)===y.Floor&&(t=!0,De(i,n,y.Gem),ke(i,n),await Xs(),await Fe(90))}while(!t&&Math.random()>.01)}}async function cf(e,t){for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)if(w.map.getType(i,n)===e){Ks();for(let r=20;r>0;r--)At(i,n,he.BLOCK_CHAR,ie.getUniformInt(0,15),0);await Fe(1),De(i,n,y.Floor),ke(i,n)}else w.map.getType(i,n)===t&&(De(i,n,y.Floor),ke(i,n))}async function ff(e){e===y.K&&w.bonus===0&&(w.bonus=1),e===y.R&&w.bonus===1&&(w.bonus=2),e===y.O&&w.bonus===2&&(w.bonus=3),e===y.Z&&w.bonus===3&&(await Ds(),await ot("Super Kroz Bonus -- 10,000 points!"),St(e))}async function uf(e){let t=y.OWall1;e===y.OSpell2&&(t=y.OWall2),e===y.OSpell3&&(t=y.OWall3);for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)if(w.map.getType(i,n)===t){for(let o=60;o>0;o--)At(i,n,ie.getItem(["▄","▌","▐","▀"]),ie.getUniformInt(0,14),0),_e(o*40,5,10),o%5===0&&await Fe(1);De(i,n,y.Floor),ke(i,n)}}async function df(e){const t=e-y.CSpell1+y.CWall1;for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)if(w.map.getType(i,n)===t){for(let o=60;o>0;o--)At(i,n,ie.getItem(["▄","▌","▐","▀"]),ie.getUniformInt(0,14),0),_e(o*40,5,10),o%5===0&&await Fe(1);De(i,n,y.Wall),ke(i,n)}}async function hf(){for(let e=0;e<75;e++){let t=!1;do{const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve),r=w.map.getType(i,n);r===y.Block&&(De(i,n,y.IBlock),ke(i,n),t=!0),r===y.Wall&&(De(i,n,y.IWall),ke(i,n),t=!0)}while(!t&&ie.getUniformInt(0,200)!==0)}}async function Or(e){await Rr(e);const t=e.get(ze);De(t.x,t.y,y.Floor),ke(t.x,t.y);const i=Date.now();for(let r=0;r<700;r++){const o=ie.getUniformInt(0,$e),c=ie.getUniformInt(0,Ve),l=w.map.get(o,c);if((l.type===y.Floor||l!=null&&l.has(vt)||!(l!=null&&l.has(at)))&&(At(o,c,"☺",ie.getUniformInt(0,15),ie.getUniformInt(0,7)),await Vs(),ke(o,c)),Date.now()-i>1500)break}const n=w.map.findRandomEmptySpace();return ji(e,...n)}function ji(e,t,i){e.has(kt)&&_n(e,t,i),e.has(Ji)&&hn(t,i)}async function Rr(e){const t=e.get(ze),i=e.get(at);for(let n=0;n<160;n++)n%5===0&&(At(t.x,t.y,i.ch,ie.getUniformInt(0,15),ie.getUniformInt(0,8)),await Fe()),_e(n/2,80,10);_t()}function _f(e,t){const i=w.map;for(let n=0;n<i.width;n++)for(let r=0;r<i.height;r++)i.getType(n,r)===e&&(i.set(n,r,yr(t,n,r)),ke(n,r))}async function pf(e,t,i){switch(i){case y.TBlock:i=y.Block;break;case y.TRock:i=y.Rock;break;case y.TGem:i=y.Gem;break;case y.TBlind:i=y.Invisible;break;case y.TWhip:i=y.Whip;break;case y.TGold:i=y.Nugget;break;case y.TTree:i=y.Tree;break}for(let r=0;r<10;r++)await n(!1,ie.getUniformInt(0,7),ie.getUniformInt(0,7)),await _e((r+25)*r*2,20,10);return n(!0);async function n(r,o,c){for(let l=-1;l<=1;l++)for(let h=-1;h<=1;h++){if(l===0&&h===0)continue;const u=w.map.getType(e+l,t+h);if(ll.includes(u))if(r)De(e+l,t+h,i);else{De(e+l,t+h,i);const m=w.map.get(e+l,t+h);if(!m)continue;const S=m==null?void 0:m.get(at);if(!S)continue;At(e+l,t+h,S.ch,o,c)}await Fe(5)}}}async function gf(){await Oo(y.Fast,{ch:"☺"}),_t()}async function mf(e,t){for(let i=0;i<=$e;i++)for(let n=0;n<=Ve;n++)w.map.getType(i,n)===e&&(await _e(i*n,50,10),De(i,n,t),ke(i,n))}async function wf(){await w.map.forEach(async(e,t,i)=>{i.type===y.IWall&&(_e(e*t,1,10),t===0&&await Fe(1),De(e,t,y.OWall3),ke(e,t))})}function yf(){for(let e=0;e<w.map.width;e++)for(let t=0;t<w.map.height;t++){const i=w.map.get(e,t);i&&!i.has(Ji)&&i.add(vt)}}function vf(){w.T[6]=0,w.T[7]=0,w.T[4]=In[4]}function bf(){w.T[4]=0,w.T[6]=In[6]}function Ef(e){w.T[5]=In[5],e.add(vt);const t=e.get(ze);ke(t.x,t.y)}function xf(){w.T[7]=In[7]}async function Sf(){if(ge.difficulty>9)return;for(let t=0;t<w.map.width;t++)for(let i=0;i<w.map.height;i++){const n=t>=31&&t<=35?G.Black:G.Brown;At(t,i,he.FLOOR_CHAR,n,n)}let e=4e3;for(let t=1;t<=16;t++){t===8?Ie(38,12,"<--- HALF WAY!!!",G.HighIntensityWhite,G.Brown):t===9&&Ie(38,12,he.FLOOR_CHAR.repeat(16),G.HighIntensityWhite,G.Brown);for(let i=0;i<=Ve;i++)At(33,i,he.PLAYER_CHAR,he.PLAYER_FG,he.PLAYER_BG),await _e(e-=8,52-3*t,30),At(33,i,he.FLOOR_CHAR,he.FLOOR_FG,he.FLOOR_BG)}At(33,Ve,"_",he.PLAYER_FG,G.Black),await Ps(),Ie(ai/2-3,0,"* SPLAT!! *",G.Black,G.Red),await ot("Press any key to continue."),F.gems=-1,ge.done=!0}function Ca(e,t){switch(e){case"Gem":F.gems+=t;break;case"Whip":F.whipPower+=t;break}}function Tf(e,t,i){De(t,i,e),ke(t,i)}async function Of(e,t,i){await Fe(350),await ja(),await Fe(500),De(t,i,y.Tunnel),ke(t,i);let n=t,r=i;for(let l=0;l<1e4;l++){const h=ie.getUniformInt(0,$e),u=ie.getUniformInt(0,Ve);if((w.map.getType(h,u)??y.Floor)===y.Tunnel&&(h!==n||u!==r)){n=h,r=u,ji(e,n,r);break}}De(t,i,y.Tunnel),ke(t,i);let o=e.get(ze).x,c=e.get(ze).y;for(let l=0;l<100;l++){const h=ie.getUniformInt(-1,1),u=ie.getUniformInt(-1,1);if(n+h<0||n+h>$e||r+u<0||r+u>Ve)continue;const m=w.map.getType(n+h,r+u)??y.Floor;if(dl.includes(m)){o=n+h,c=r+u;break}}ji(e,o,c),De(n,r,y.Tunnel),ke(n,r)}async function kn(e){const t=e.get(ze);if(!t)return;const i=t.x,n=t.y;Fs(),await r(i-1,n-1,"\\"),await r(i-1,n,"-"),await r(i-1,n+1,"/"),await r(i,n+1,"❘"),await r(i+1,n+1,"\\"),await r(i+1,n,"-"),await r(i+1,n-1,"/"),await r(i,n-1,"❘"),_t();async function r(o,c,l){if(o<0||o>$e||c<0||c>Ve)return;const h=w.map.get(o,c),u=(h==null?void 0:h.type)||y.Floor;if(On(o,c,l,Yt[ie.getUniformInt(1,15)]),h!=null&&h.has(qi)&&(h==null||h.remove(qi),ke(o,c)),h!=null&&h.has(li)){const m=h.get(li);if((m.hardness||0)*Math.random()<F.whipPower){h.has(kt)&&hi(o,c),De(o,c,y.Floor),ke(o,c);const k=m.hitSound||"WhipHit";switch(St(u),await Ka(k),u){case y.Statue:w.T[9]=-1,await ot("You've destroyed the Statue!  Your Gems are now safe.");break;case y.Generator:w.genNum--;break}}else Gs();Xt()}await Fe(10)}}async function Rf(e,t,i,n,r,o){let c=!1;const l=e.get(ze);if(!l)return;const h=l.x+r*2,u=l.y+o*2;if((h<0||h>$e||u<0||u>Ve)&&(c=!0),!c){const m=w.map.get(h,u);m||(c=!0);const S=m.type;async function k(p=!1){c=!1,await Vr(),p&&hi(h,u),w.map.set(h,u,t),ji(e,i,n),_t()}cl.includes(S)?await k():fl.includes(S)?(await k(),await gr()):Qi.includes(S)?(await k(!0),St(S),await Js()):S===y.EWall?(await k(),De(h,u,y.Floor),Qs(),await ot("The Boulder is vaporized!")):ul.includes(S)&&(c=!1,await Vr(),ji(e,i,n),ke(h,u,t),await el(),_t())}c&&await Za()}async function Af(e,t,i,n){let r=e,o=t;for(;r+=i,o+=n,!(r<0||r>$e||o<0||o>Ve);){const c=w.map.getType(r,o);if(c===y.Pit||c===y.River||c===y.Lava)De(r,o,y.Floor),ke(r,o);else break}}async function Ar(e,t={}){if(e&&typeof e=="string"){const i=e.split(`
`);for(let n of i)n=n.trim(),n&&(n.startsWith("##")?await kf(n.slice(2),t):n.startsWith("@@")?await Ka(n.slice(2)):await ot(n))}}const If={BECOME:({x:e,y:t,args:i})=>Tf(Pt(i[0]),e,t),CHANGE:({args:e})=>_f(Pt(e[0]),Pt(e[1])),HIDE:({args:e})=>tf(Pt(e[0])),GIVE:({args:e})=>Ca(e[0],+e[1]),TAKE:({args:e})=>Ca(e[0],-e[1]),Bomb:({x:e,y:t})=>rf(e,t),Quake:af,Trap:({who:e})=>Or(e),Zap:of,Create:sf,ShowGems:lf,BlockSpell:({what:e,args:t})=>cf(Pt(t[0])||y.ZBlock,e.type),WallVanish:hf,KROZ:({what:e})=>ff(e.type),OSpell:({what:e})=>uf(e.type),CSpell:({what:e})=>df(e.type),TTrigger:({x:e,y:t,what:i,args:n})=>pf(e,t,Pt(n[0])||i.type),Shoot:({x:e,y:t,args:i})=>nf(e,t,+i[0]),SlowTime:vf,SpeedTime:bf,Invisible:({who:e})=>Ef(e),Freeze:xf,HideLevel:yf,ShowIWalls:wf,MagicSwap:({args:e})=>mf(Pt(e[0]),Pt(e[1])),DisguiseFast:gf,FlashEntity:({who:e})=>Rr(e),PitFall:Sf,Tunnel:({who:e,x:t,y:i})=>Of(e,t,i),EvapoRate:({args:e})=>{w.evapoRate=+e[0]},LavaRate:({args:e})=>{w.lavaFlow=!0,w.lavaRate=+e[0]},TreeRate:({args:e})=>{w.treeRate=+e[0]},MagicEWalls:()=>{w.magicEWalls=!0},BridgeCaster:({x:e,y:t,args:i})=>Af(e,t,+i[0],+i[1]),NEXTLEVEL:async()=>{await lr()},CHANGELEVEL:async({args:e})=>{F.levelIndex=+e[0],await lr(0)},CHANGEGAME:async({args:e})=>{const t=To[e[0]];t?xr.dispatch(t):console.warn("Unknown game:",e[0])},openSourceScreen:async()=>{await lo()},REFRESH:async()=>{Rn()}};async function kf(e,t={}){var n,r;t.args=e.split(" "),e=t.args.shift();const i=If[e];if(i){t.who??(t.who=w.player),t.x??(t.x=((n=t.who.get(ze))==null?void 0:n.x)??0),t.y??(t.y=((r=t.who.get(ze))==null?void 0:r.y)??0),await i(t);return}console.warn("Unknown effect:",e)}let ui=[];function Lf(e){ui=e}async function en(){Nf();const e=Ir(F.levelIndex);await Cf(e),Uf(),Rn(),w.startTrigger?await Ar(w.startTrigger):await ot("Press any key to begin this level."),Sr.dispatch(),ur()}function Ir(e){for(;!ui[e];)e=_r(e+1,ui.length);return e}async function Pf(e){const t=Ir(e);F.levelIndex=t,await en()}async function lr(e=1){const t=Ir(F.levelIndex+e);t%10===0&&await lo(),F.levelIndex=t,await en()}async function Df(e=1){ur();let t=F.levelIndex-e+1;do t=_r(t-1,ui.length);while(!ui[t]);F.levelIndex=t,await en()}async function Cf(e){F.levelIndex=e;const t=await ui[F.levelIndex](),i=typeof t=="string"?Mf(t):zf(t);return await Ff(i),_t(),vr(),i}function Mf(e){const t=[];let i="";const n=e.split(`
`);for(let h=0;h<n.length;h++){const u=n[h],m=n[++h];for(let S=0;S<u.length;S+=3){const k=u.substring(S,S+3).trim(),p=k==="P"?1:+m.substring(S,S+3);i+=k.repeat(p)}}const r=$e+1,o=Ve+1,c=r*o;i.length<c&&(i+=" ".repeat(c-i.length));const l=as(i.split(""));for(let h=0;h<c;h++){const u=ns(l[h]),m=h%r,S=Math.floor(h/r);t[h]=Vi(u,m,S)}return{id:"",data:t,startTrigger:void 0,properties:{}}}function zf(e){const{layers:t,properties:i}=e,n=ri(i),r=[];for(const u of t)if(ln.isEncodedTileLayer(u))l(ln.decodeTileLayer(u),r);else if(ln.isUnencodedTileLayer(u))l(u,r);else if(ln.isObjectGroup(u))o(u,r);else throw new Error("Unsupported layer encoding");function o(u,m){for(const S of u.objects){if(S.text){c(S,m);continue}const{gid:k,x:p,y:O,height:A,width:L,properties:Y,type:q}=S;if(!(!k||p<0||O<0||!A||!L)&&k>0){const I=Ma(S.gid),E=p/L,C=O/A-1;m[C*e.width+E]=Vi(I,E,C,ri(Y),q)}}return m}function c(u,m){const{x:S,y:k,height:p,width:O,properties:A,text:L}=u;if(console.log(u),!S||!k||!p||!O)return;const Y=97,q=y.Wall,I=L.text,E=L.wrap,C=S/24,H=k/36,Z=O/24;let ae=[I];E&&(ae=os(I,Z).split(`
`));const{halign:J,color:me}=u.text,we=ri(A||{}),ce=we.fgColor??me??G.HighIntensityWhite,re=we.bgColor??G.Brown;for(let g=0;g<ae.length;g++){let x=ae[g];J==="right"&&(x=x.padStart(Z," "));for(let P=0;P<x.length;P++){const N=C+P,V=H+g,ee=Vi(Y,N,V,ri(A),q);ee.get(at).ch=x[P],ee.get(at).fg=ce,ee.get(at).bg=re,console.log(ee.get(at)),m[V*e.width+N]=ee}}}function l(u,m){const{data:S}=u;if(!S)return m;for(let k=0;k<S.length;k++){const p=Ma(+S[k]);if(p>-1){const O=k%e.width,A=Math.floor(k/e.width);m[k]=Vi(p,O,A)}}return m}const h=e.StartTrigger??(n==null?void 0:n.StartTrigger)??void 0;return{id:(n==null?void 0:n.id)||"",data:r,startTrigger:h,properties:n}}async function Ff(e){const{data:t,startTrigger:i}=e;w.startTrigger=i;const n=w.map;let r=0;n.fill(()=>t[r++]),n.forEach((o,c,l)=>{l&&(l.type===y.Statue&&(w.T[ft.StatueGemDrain]=32e3),l.has(Ji)&&(w.player=l),l.has(kt)&&w.entities.push(l),l.has(Qa)&&w.genNum++)}),await Oo(y.Gem,{fg:ie.getUniformInt(1,15)}),w.borderFG=ie.getUniformInt(8,15),w.borderBG=ie.getUniformInt(1,8)}function Ma(e){return!e||e<0?-1:+e%256-1}class Bf{constructor(t=$e+1,i=Ve+1){Le(this,"PF",[]);this.width=t,this.height=i}getIndex(t,i){return i*this.width+t}get(t,i){if(t<0||t>=this.width||i<0||i>=this.height)return null;const n=this.getIndex(t,i);return this.PF[n]}set(t,i,n){if(t<0||t>=this.width||i<0||i>=this.height)return;const r=this.getIndex(t,i);this.PF[r]=n}getType(t,i){var r;if(t<0||t>=this.width||i<0||i>=this.height)return y.Border;const n=(r=this.get(t,i))==null?void 0:r.type;return typeof n=="string"?n:n??y.Floor}findRandomEmptySpace(){for(;;){const t=ie.getUniformInt(0,$e),i=ie.getUniformInt(0,Ve);if(this.getType(t,i)===y.Floor)return[t,i]}}async forEach(t){for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++){const r=this.get(i,n);r&&await t(i,n,r)}}fill(t){for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)this.set(n,i,t(n,i))}}var Mt=(e=>(e[e.Novice=8]="Novice",e[e.Experienced=5]="Experienced",e[e.Advanced=2]="Advanced",e[e.Cheat=9]="Cheat",e[e.Tourist=10]="Tourist",e))(Mt||{});function Ln(){return{levelIndex:1,score:0,gems:20,whips:0,teleports:0,keys:0,whipPower:2}}function kr(){return{bonus:0,genNum:0,magicEWalls:!1,evapoRate:0,treeRate:0,lavaRate:0,lavaFlow:!1,level:null,player:new ro(y.Player),entities:[],map:new Bf,replacement:y.Floor,T:[0,0,0,0,0,0,0,0,0,0],startTrigger:void 0,borderFG:he.BORDER_FG,borderBG:he.BORDER_BG}}function Ro(){return{difficulty:8,clockScale:Ko,paused:!1,started:!1,done:!1,foundSet:new Set,bot:!1,title:Na}}const F=Ln(),w=kr(),ge=Ro(),Ao=Ln(),cr=Ln();function Io(){Object.assign(F,Ln()),Object.assign(w,kr()),Object.assign(ge,Ro())}function Nf(){Object.assign(w,kr())}function Uf(){Object.assign(Ao,F)}async function Gf(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n"&&e.toLowerCase()!=="w"&&e.toLowerCase()!=="t";)e=await ot("Are you sure you want to SAVE? (Y/N)");(e.toLowerCase()==="y"||e.toLowerCase()==="w")&&(Object.assign(cr,Ao),localStorage.setItem("Kroz--saveState--v1",JSON.stringify(cr)))}async function Vf(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n"&&e.toLowerCase()!=="w"&&e.toLowerCase()!=="t";)e=await ot("Are you sure you want to RESTORE? (Y/N)");if(e.toLowerCase()==="y"||e.toLowerCase()==="w"){let t=cr;const i=localStorage.getItem("Kroz--saveState--v1");if(i)try{t=JSON.parse(i)}catch(n){console.error(n)}Object.assign(F,t),await en()}}function St(e){F.score+=ml(e),Xt()}async function hi(e,t){const i=w.map.get(e,t);De(e,t,y.Floor),ke(e,t),i&&i.has(ze)&&await mn(i)}function De(e,t,i){w.map.set(e,t,yr(i,e,t))}async function mn(e){var t;typeof e.type=="number"&&e.type<4&&await Cs(e.type),(t=e.get(ze))==null||t.die()}async function ko(e=1){for(let t=0;t<e;t++){let i=!1;do{const n=ie.getUniformInt(0,$e),r=ie.getUniformInt(0,Ve);if(w.map.getType(n,r)===y.Floor){const o=yr(y.Slow,n,r);w.entities.push(o),w.map.set(n,r,o),await il(),i=!0}_t()}while(!i&&ie.getUniformInt(0,50)!==0)}}async function Hf(){let e="";for(;e.toLowerCase()!=="y"&&e.toLowerCase()!=="n";)e=await ot("Are you sure you want to quit? (Y/N)");e.toLowerCase()==="y"&&(ge.done=!0)}async function Wf(){ge.paused=!0,Rn(),await ot("Press any key to resume")}var G=(e=>(e[e.Black=0]="Black",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Cyan=3]="Cyan",e[e.Red=4]="Red",e[e.Magenta=5]="Magenta",e[e.Brown=6]="Brown",e[e.White=7]="White",e[e.Grey=8]="Grey",e[e.LightBlue=9]="LightBlue",e[e.LightGreen=10]="LightGreen",e[e.LightCyan=11]="LightCyan",e[e.LightRed=12]="LightRed",e[e.LightMagenta=13]="LightMagenta",e[e.Yellow=14]="Yellow",e[e.HighIntensityWhite=15]="HighIntensityWhite",e))(G||{});const Yt={0:"#000000",1:"#0000AA",2:"#00AA00",3:"#00AAAA",4:"#AA0000",5:"#AA00AA",6:"#AA5500",7:"#AAAAAA",8:"#AAAAAA",9:"#5555FF",10:"#55FF55",11:"#55FFFF",12:"#FF5555",13:"#FF55FF",14:"#FFFF55",15:"#FFFFFF"};async function $f(e){for(const t in e){const i=G[t];t&&(Yt[i]=e[t])}}function Yi(e,t=1){return typeof e=="number"&&(e>15&&(e%=16),e=Yt[e]),t<1&&(e=e+Math.round(t*255).toString(16).padStart(2,"0")),e}function _i(...e){return e.map(t=>Yi(t))}let tt;function qf(){Zt.Rect.cache=!0,tt=new Zt({width:di,height:Ft,fontFamily:"IBM_VGA, monospace",bg:Yi(G.Black),fg:Yi(G.White),fontSize:64});const e=tt.drawOver;tt.drawOver=function(t,i,n,r,o){e.call(this,t,i,n,r,o),this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[`${t},${i}`]=!0)}}function Rt(e,t,i=tt.getOptions().fg,n=tt.getOptions().bg){const r=Math.floor((di-t.length)/2);Ie(r,e,t,..._i(i,n))}function Zf(e,t=tt.getOptions().fg,i=tt.getOptions().bg){Ie(0,e," ".repeat(di),..._i(t,i))}function Qt(e=tt.getOptions().bg){tt.setOptions({bg:Yi(e)}),tt.clear()}function Nt(e,t,i,n=tt.getOptions().fg,r=tt.getOptions().bg){tt.draw(e,t,i,..._i(n,r))}function jf(e,t,i,n=tt.getOptions().fg,r=tt.getOptions().bg){tt.drawOver(e,t,i,..._i(n,r))}function Ie(e,t,i,n=tt.getOptions().fg,r=tt.getOptions().bg){return[n,r]=_i(n,r),tt.drawText(e,t,`%c{${n}}%b{${r}}${i}%c{}%b{}`)}function Yf(){return tt||qf(),tt.getContainer()}async function Xf(){for(let t=0;t<w.T.length;t++)w.T[t]=Math.max(0,w.T[t]-1);w.T[ft.Invisible]>0?w.player.add(vt):w.player.remove(vt),w.T[ft.StatueGemDrain]>0&&ie.getUniformInt(0,18)===0&&(F.gems--,await _e(3800,40),Xt());const e=w.entities.reduce((t,i)=>i.type===y.Slow?t+1:t,0);if(w.genNum>0&&e<995&&ie.getUniformInt(0,17)===0&&await ko(1),w.magicEWalls&&ie.getUniformInt(0,7)===0){for(let t=0;t<100;t++){const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve);if(w.map.getType(i,n)===y.CWall1){De(i,n,y.EWall),ke(i,n);break}}for(let t=0;t<100;t++){const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve);if(w.map.getType(i,n)===y.EWall){De(i,n,y.CWall1),ke(i,n);break}}}if(w.evapoRate>0&&ie.getUniformInt(0,9)===0)for(let t=0;t<w.evapoRate;t++){const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve);w.map.getType(i,n)===y.River&&(De(i,n,y.Floor),ke(i,n))}if(w.lavaFlow&&ie.getUniformInt(0,9)===0)for(let t=0;t<w.lavaRate;t++){const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve),r=w.map.getType(i,n);if(_l.includes(r)){let o=!1;w.map.getType(i+1,n)===y.Lava&&(o=!0),w.map.getType(i-1,n)===y.Lava&&(o=!0),w.map.getType(i,n+1)===y.Lava&&(o=!0),w.map.getType(i,n-1)===y.Lava&&(o=!0),o&&(De(i,n,y.Lava),ke(i,n))}}if(w.treeRate>0&&ie.getUniformInt(0,9)===0)for(let t=0;t<w.treeRate;t++){const i=ie.getUniformInt(0,$e),n=ie.getUniformInt(0,Ve),r=w.map.getType(i,n);if(pl.includes(r)){let o=!1;if((w.map.getType(i+1,n)===y.Tree||w.map.getType(i+1,n)===y.Forest)&&(o=!0),(w.map.getType(i-1,n)===y.Tree||w.map.getType(i-1,n)===y.Forest)&&(o=!0),(w.map.getType(i,n+1)===y.Tree||w.map.getType(i,n+1)===y.Forest)&&(o=!0),(w.map.getType(i,n-1)===y.Tree||w.map.getType(i,n-1)===y.Forest)&&(o=!0),o){const c=ie.getUniformInt(0,3)===0?y.Tree:y.Forest;De(i,n,c),ke(i,n)}}}}const Kf={get SlowTime(){return w.T[ft.SlowTime]},set SlowTime(e){w.T[ft.SlowTime]=e},get Invisible(){return w.T[ft.Invisible]},set Invisible(e){w.T[ft.Invisible]=e},get SpeedTime(){return w.T[ft.SpeedTime]},set SpeedTime(e){w.T[ft.SpeedTime]=e},get FreezeTime(){return w.T[ft.FreezeTime]},set FreezeTime(e){w.T[ft.FreezeTime]=e}},Jf={get x(){var e,t;return((t=(e=w.player)==null?void 0:e.get(ze))==null?void 0:t.x)??0},set x(e){w.player.get(ze).x=e},get y(){var e,t;return((t=(e=w.player)==null?void 0:e.get(ze))==null?void 0:t.y)??0},set y(e){w.player.get(ze).y=e},get bot(){return ge.bot},set bot(e){ge.bot=e}},Qf={get gems(){return F.gems},set gems(e){F.gems=e},get whips(){return F.whips},set whips(e){F.whips=e},get keys(){return F.keys},set keys(e){F.keys=e},get teleports(){return F.teleports},set teleports(e){F.teleports=e},get whipPower(){return F.whipPower},set whipPower(e){F.whipPower=e}},eu={get level(){return F.levelIndex},set level(e){Pf(e)}},tu={timers:Kf,player:Jf,stats:Qf,levels:eu};window.krozDebugAPI=tu;let Lo=0,Wi=0;function iu(){const e=Yf();document.getElementById("app").appendChild(e),ds(),Io(),Qt(G.Black),xr.add(i=>{window.cancelAnimationFrame(Lo),nu(i)})}async function Po(){Wi=0,Qt(G.Black),await yl(),ge.title=Na,xr.dispatch(To.loading)}async function nu(e){Io(),Qt(G.Black),Wi++>0&&await bl(),Lf(e.LEVELS),rl(await e.readTileset()),$f(await e.readColor()),await en(),Rn(),ge.started=!0,await ru()}async function ru(){const e=Wi;let t=0,i=0,n=0;Sr.add(()=>{t=0,i=0,n=0});const r=async o=>{if(Wi!==e)return;const c=8*ge.clockScale;if(ge.done){Po();return}if(i+=o-n,n=o,i>c){if(i%=c,t++,await dc(),Wi!==e)return;await pc(t),await Xf(),_t()}vl(),requestAnimationFrame(r)};Lo=requestAnimationFrame(r)}async function za(){iu(),await Po()}try{document.fonts.ready.then(za)}catch{window.addEventListener("DOMContentLoaded",za)}
